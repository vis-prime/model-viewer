import*as e from"three";import{Quaternion as t,Matrix4 as s,RGBAFormat as i,RGBA_ASTC_4x4_Format as n,RGBA_BPTC_Format as r,RGBA_ETC2_EAC_Format as o,RGBA_PVRTC_4BPPV1_Format as a,RGBA_S3TC_DXT5_Format as A,RGB_ETC1_Format as l,RGB_ETC2_Format as h,RGB_PVRTC_4BPPV1_Format as c,RGB_S3TC_DXT1_Format as u,Texture as g,Vector3 as d,Color as p,Vector2 as m,PerspectiveCamera as I,MeshBasicMaterial as f,PlaneGeometry as C,Matrix3 as E,Triangle as B,Raycaster as y,Loader as w,FileLoader as Q,SRGBColorSpace as v,LinearSRGBColorSpace as b,BufferGeometry as S,BufferAttribute as x,CompressedCubeTexture as M,UnsignedByteType as R,CompressedArrayTexture as D,CompressedTexture as T,LinearFilter as L,LinearMipmapLinearFilter as F,FloatType as k,HalfFloatType as _,DataTexture as U,Data3DTexture as N,DisplayP3ColorSpace as G,LinearDisplayP3ColorSpace as P,NoColorSpace as O,EventDispatcher as H,WebGLRenderer as q,ACESFilmicToneMapping as V,LoaderUtils as J,SpotLight as K,PointLight as $,DirectionalLight as Y,MeshPhysicalMaterial as z,InstancedMesh as j,Object3D as W,TextureLoader as X,ImageBitmapLoader as Z,InterleavedBuffer as ee,InterleavedBufferAttribute as te,RepeatWrapping as se,PointsMaterial as ie,Material as ne,LineBasicMaterial as re,MeshStandardMaterial as oe,DoubleSide as ae,PropertyBinding as Ae,SkinnedMesh as le,Mesh as he,LineSegments as ce,Line as ue,LineLoop as ge,Points as de,Group as pe,MathUtils as me,OrthographicCamera as Ie,Skeleton as fe,AnimationClip as Ce,Bone as Ee,InterpolateLinear as Be,ColorManagement as ye,RGFormat as we,RedFormat as Qe,RGBA_ASTC_6x6_Format as ve,Spherical as be,Euler as Se,Sphere as xe,FrontSide as Me,EquirectangularReflectionMapping as Re,sRGBEncoding as De,WebGLCubeRenderTarget as Te,CubeCamera as Le,NoToneMapping as Fe,BoxGeometry as ke,Scene as _e,ShaderMaterial as Ue,NoBlending as Ne,BackSide as Ge,VideoTexture as Pe,CanvasTexture as Oe,Box3 as He,AnimationMixer as qe,LoopPingPong as Ve,LoopRepeat as Je,LoopOnce as Ke,TrianglesDrawMode as $e,TriangleFanDrawMode as Ye,TriangleStripDrawMode as ze,NearestFilter as je,NearestMipmapNearestFilter as We,LinearMipmapNearestFilter as Xe,NearestMipmapLinearFilter as Ze,ClampToEdgeWrapping as et,MirroredRepeatWrapping as tt,InterpolateDiscrete as st,VectorKeyframeTrack as it,NumberKeyframeTrack as nt,QuaternionKeyframeTrack as rt,LightProbe as ot,Float32BufferAttribute as at,DataTextureLoader as At,MeshDepthMaterial as lt,WebGLRenderTarget as ht,Interpolant as ct,Source as ut,DataUtils as gt,Uniform as dt}from"three";export{CanvasTexture,FileLoader,Loader,NearestFilter}from"three";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const pt=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(s){s.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(s){s.createProperty(t.key,e)}};function mt(e){return(t,s)=>void 0!==s?((e,t,s)=>{t.constructor.createProperty(s,e)})(e,t,s):pt(e,t)
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}var It;null===(It=window.HTMLSlotElement)||void 0===It||It.prototype.assignedElements;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ft=window,Ct=ft.ShadowRoot&&(void 0===ft.ShadyCSS||ft.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Et=Symbol(),Bt=new WeakMap;class yt{constructor(e,t,s){if(this._$cssResult$=!0,s!==Et)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Ct&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=Bt.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Bt.set(t,e))}return e}toString(){return this.cssText}}const wt=Ct?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new yt("string"==typeof e?e:e+"",void 0,Et))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var Qt;const vt=window,bt=vt.trustedTypes,St=bt?bt.emptyScript:"",xt=vt.reactiveElementPolyfillSupport,Mt={toAttribute(e,t){switch(t){case Boolean:e=e?St:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},Rt=(e,t)=>t!==e&&(t==t||e==e),Dt={attribute:!0,type:String,converter:Mt,reflect:!1,hasChanged:Rt},Tt="finalized";class Lt extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,s)=>{const i=this._$Ep(s,t);void 0!==i&&(this._$Ev.set(i,s),e.push(i))})),e}static createProperty(e,t=Dt){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(i){const n=this[e];this[t]=i,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Dt}static finalize(){if(this.hasOwnProperty(Tt))return!1;this[Tt]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const s of t)this.createProperty(s,e[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(wt(e))}else void 0!==e&&t.push(wt(e));return t}static _$Ep(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,s;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(s=e.hostConnected)||void 0===s||s.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{Ct?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const s=document.createElement("style"),i=ft.litNonce;void 0!==i&&s.setAttribute("nonce",i),s.textContent=t.cssText,e.appendChild(s)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EO(e,t,s=Dt){var i;const n=this.constructor._$Ep(e,s);if(void 0!==n&&!0===s.reflect){const r=(void 0!==(null===(i=s.converter)||void 0===i?void 0:i.toAttribute)?s.converter:Mt).toAttribute(t,s.type);this._$El=e,null==r?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(e,t){var s;const i=this.constructor,n=i._$Ev.get(e);if(void 0!==n&&this._$El!==n){const e=i.getPropertyOptions(n),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(s=e.converter)||void 0===s?void 0:s.fromAttribute)?e.converter:Mt;this._$El=n,this[n]=r.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,s){let i=!0;void 0!==e&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||Rt)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(s)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var Ft;Lt[Tt]=!0,Lt.elementProperties=new Map,Lt.elementStyles=[],Lt.shadowRootOptions={mode:"open"},null==xt||xt({ReactiveElement:Lt}),(null!==(Qt=vt.reactiveElementVersions)&&void 0!==Qt?Qt:vt.reactiveElementVersions=[]).push("1.6.3");const kt=window,_t=kt.trustedTypes,Ut=_t?_t.createPolicy("lit-html",{createHTML:e=>e}):void 0,Nt="$lit$",Gt=`lit$${(Math.random()+"").slice(9)}$`,Pt="?"+Gt,Ot=`<${Pt}>`,Ht=document,qt=()=>Ht.createComment(""),Vt=e=>null===e||"object"!=typeof e&&"function"!=typeof e,Jt=Array.isArray,Kt="[ \t\n\f\r]",$t=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Yt=/-->/g,zt=/>/g,jt=RegExp(`>|${Kt}(?:([^\\s"'>=/]+)(${Kt}*=${Kt}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Wt=/'/g,Xt=/"/g,Zt=/^(?:script|style|textarea|title)$/i,es=(e=>(t,...s)=>({_$litType$:e,strings:t,values:s}))(1),ts=Symbol.for("lit-noChange"),ss=Symbol.for("lit-nothing"),is=new WeakMap,ns=Ht.createTreeWalker(Ht,129,null,!1);function rs(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Ut?Ut.createHTML(t):t}const os=(e,t)=>{const s=e.length-1,i=[];let n,r=2===t?"<svg>":"",o=$t;for(let t=0;t<s;t++){const s=e[t];let a,A,l=-1,h=0;for(;h<s.length&&(o.lastIndex=h,A=o.exec(s),null!==A);)h=o.lastIndex,o===$t?"!--"===A[1]?o=Yt:void 0!==A[1]?o=zt:void 0!==A[2]?(Zt.test(A[2])&&(n=RegExp("</"+A[2],"g")),o=jt):void 0!==A[3]&&(o=jt):o===jt?">"===A[0]?(o=null!=n?n:$t,l=-1):void 0===A[1]?l=-2:(l=o.lastIndex-A[2].length,a=A[1],o=void 0===A[3]?jt:'"'===A[3]?Xt:Wt):o===Xt||o===Wt?o=jt:o===Yt||o===zt?o=$t:(o=jt,n=void 0);const c=o===jt&&e[t+1].startsWith("/>")?" ":"";r+=o===$t?s+Ot:l>=0?(i.push(a),s.slice(0,l)+Nt+s.slice(l)+Gt+c):s+Gt+(-2===l?(i.push(void 0),t):c)}return[rs(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),i]};class as{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let n=0,r=0;const o=e.length-1,a=this.parts,[A,l]=os(e,t);if(this.el=as.createElement(A,s),ns.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(i=ns.nextNode())&&a.length<o;){if(1===i.nodeType){if(i.hasAttributes()){const e=[];for(const t of i.getAttributeNames())if(t.endsWith(Nt)||t.startsWith(Gt)){const s=l[r++];if(e.push(t),void 0!==s){const e=i.getAttribute(s.toLowerCase()+Nt).split(Gt),t=/([.?@])?(.*)/.exec(s);a.push({type:1,index:n,name:t[2],strings:e,ctor:"."===t[1]?us:"?"===t[1]?ds:"@"===t[1]?ps:cs})}else a.push({type:6,index:n})}for(const t of e)i.removeAttribute(t)}if(Zt.test(i.tagName)){const e=i.textContent.split(Gt),t=e.length-1;if(t>0){i.textContent=_t?_t.emptyScript:"";for(let s=0;s<t;s++)i.append(e[s],qt()),ns.nextNode(),a.push({type:2,index:++n});i.append(e[t],qt())}}}else if(8===i.nodeType)if(i.data===Pt)a.push({type:2,index:n});else{let e=-1;for(;-1!==(e=i.data.indexOf(Gt,e+1));)a.push({type:7,index:n}),e+=Gt.length-1}n++}}static createElement(e,t){const s=Ht.createElement("template");return s.innerHTML=e,s}}function As(e,t,s=e,i){var n,r,o,a;if(t===ts)return t;let A=void 0!==i?null===(n=s._$Co)||void 0===n?void 0:n[i]:s._$Cl;const l=Vt(t)?void 0:t._$litDirective$;return(null==A?void 0:A.constructor)!==l&&(null===(r=null==A?void 0:A._$AO)||void 0===r||r.call(A,!1),void 0===l?A=void 0:(A=new l(e),A._$AT(e,s,i)),void 0!==i?(null!==(o=(a=s)._$Co)&&void 0!==o?o:a._$Co=[])[i]=A:s._$Cl=A),void 0!==A&&(t=As(e,A._$AS(e,t.values),A,i)),t}class ls{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:s},parts:i}=this._$AD,n=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:Ht).importNode(s,!0);ns.currentNode=n;let r=ns.nextNode(),o=0,a=0,A=i[0];for(;void 0!==A;){if(o===A.index){let t;2===A.type?t=new hs(r,r.nextSibling,this,e):1===A.type?t=new A.ctor(r,A.name,A.strings,this,e):6===A.type&&(t=new ms(r,this,e)),this._$AV.push(t),A=i[++a]}o!==(null==A?void 0:A.index)&&(r=ns.nextNode(),o++)}return ns.currentNode=Ht,n}v(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class hs{constructor(e,t,s,i){var n;this.type=2,this._$AH=ss,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cp=null===(n=null==i?void 0:i.isConnected)||void 0===n||n}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=As(this,e,t),Vt(e)?e===ss||null==e||""===e?(this._$AH!==ss&&this._$AR(),this._$AH=ss):e!==this._$AH&&e!==ts&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):(e=>Jt(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==ss&&Vt(this._$AH)?this._$AA.nextSibling.data=e:this.$(Ht.createTextNode(e)),this._$AH=e}g(e){var t;const{values:s,_$litType$:i}=e,n="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=as.createElement(rs(i.h,i.h[0]),this.options)),i);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===n)this._$AH.v(s);else{const e=new ls(n,this),t=e.u(this.options);e.v(s),this.$(t),this._$AH=e}}_$AC(e){let t=is.get(e.strings);return void 0===t&&is.set(e.strings,t=new as(e)),t}T(e){Jt(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const n of e)i===t.length?t.push(s=new hs(this.k(qt()),this.k(qt()),this,this.options)):s=t[i],s._$AI(n),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class cs{constructor(e,t,s,i,n){this.type=1,this._$AH=ss,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=ss}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,i){const n=this.strings;let r=!1;if(void 0===n)e=As(this,e,t,0),r=!Vt(e)||e!==this._$AH&&e!==ts,r&&(this._$AH=e);else{const i=e;let o,a;for(e=n[0],o=0;o<n.length-1;o++)a=As(this,i[s+o],t,o),a===ts&&(a=this._$AH[o]),r||(r=!Vt(a)||a!==this._$AH[o]),a===ss?e=ss:e!==ss&&(e+=(null!=a?a:"")+n[o+1]),this._$AH[o]=a}r&&!i&&this.j(e)}j(e){e===ss?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class us extends cs{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===ss?void 0:e}}const gs=_t?_t.emptyScript:"";class ds extends cs{constructor(){super(...arguments),this.type=4}j(e){e&&e!==ss?this.element.setAttribute(this.name,gs):this.element.removeAttribute(this.name)}}class ps extends cs{constructor(e,t,s,i,n){super(e,t,s,i,n),this.type=5}_$AI(e,t=this){var s;if((e=null!==(s=As(this,e,t,0))&&void 0!==s?s:ss)===ts)return;const i=this._$AH,n=e===ss&&i!==ss||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==ss&&(i===ss||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;"function"==typeof this._$AH?this._$AH.call(null!==(s=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==s?s:this.element,e):this._$AH.handleEvent(e)}}class ms{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){As(this,e)}}const Is=kt.litHtmlPolyfillSupport;null==Is||Is(as,hs),(null!==(Ft=kt.litHtmlVersions)&&void 0!==Ft?Ft:kt.litHtmlVersions=[]).push("2.8.0");const fs=(e,t,s)=>{var i,n;const r=null!==(i=null==s?void 0:s.renderBefore)&&void 0!==i?i:t;let o=r._$litPart$;if(void 0===o){const e=null!==(n=null==s?void 0:s.renderBefore)&&void 0!==n?n:null;r._$litPart$=o=new hs(t.insertBefore(qt(),e),e,void 0,null!=s?s:{})}return o._$AI(e),o
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */},Cs=window,Es=Cs.ShadowRoot&&(void 0===Cs.ShadyCSS||Cs.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Bs=Symbol(),ys=new WeakMap;class ws{constructor(e,t,s){if(this._$cssResult$=!0,s!==Bs)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Es&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=ys.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&ys.set(t,e))}return e}toString(){return this.cssText}}const Qs=Es?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new ws("string"==typeof e?e:e+"",void 0,Bs))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var vs;const bs=window,Ss=bs.trustedTypes,xs=Ss?Ss.emptyScript:"",Ms=bs.reactiveElementPolyfillSupport,Rs={toAttribute(e,t){switch(t){case Boolean:e=e?xs:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},Ds=(e,t)=>t!==e&&(t==t||e==e),Ts={attribute:!0,type:String,converter:Rs,reflect:!1,hasChanged:Ds},Ls="finalized";class Fs extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,s)=>{const i=this._$Ep(s,t);void 0!==i&&(this._$Ev.set(i,s),e.push(i))})),e}static createProperty(e,t=Ts){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(i){const n=this[e];this[t]=i,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Ts}static finalize(){if(this.hasOwnProperty(Ls))return!1;this[Ls]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const s of t)this.createProperty(s,e[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(Qs(e))}else void 0!==e&&t.push(Qs(e));return t}static _$Ep(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,s;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(s=e.hostConnected)||void 0===s||s.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{Es?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const s=document.createElement("style"),i=Cs.litNonce;void 0!==i&&s.setAttribute("nonce",i),s.textContent=t.cssText,e.appendChild(s)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EO(e,t,s=Ts){var i;const n=this.constructor._$Ep(e,s);if(void 0!==n&&!0===s.reflect){const r=(void 0!==(null===(i=s.converter)||void 0===i?void 0:i.toAttribute)?s.converter:Rs).toAttribute(t,s.type);this._$El=e,null==r?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(e,t){var s;const i=this.constructor,n=i._$Ev.get(e);if(void 0!==n&&this._$El!==n){const e=i.getPropertyOptions(n),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(s=e.converter)||void 0===s?void 0:s.fromAttribute)?e.converter:Rs;this._$El=n,this[n]=r.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,s){let i=!0;void 0!==e&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||Ds)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(s)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var ks,_s;Fs[Ls]=!0,Fs.elementProperties=new Map,Fs.elementStyles=[],Fs.shadowRootOptions={mode:"open"},null==Ms||Ms({ReactiveElement:Fs}),(null!==(vs=bs.reactiveElementVersions)&&void 0!==vs?vs:bs.reactiveElementVersions=[]).push("1.6.3");class Us extends Fs{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const s=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=s.firstChild),s}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=fs(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return ts}}Us.finalized=!0,Us._$litElement$=!0,null===(ks=globalThis.litElementHydrateSupport)||void 0===ks||ks.call(globalThis,{LitElement:Us});const Ns=globalThis.litElementPolyfillSupport;null==Ns||Ns({LitElement:Us}),(null!==(_s=globalThis.litElementVersions)&&void 0!==_s?_s:globalThis.litElementVersions=[]).push("3.3.3");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Gs=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,Ps=Gs&&null!=self.XRSession.prototype.requestHitTestSource,Os=null!=self.ResizeObserver,Hs=null!=self.IntersectionObserver,qs=Ps;(()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})(),/\bCrOS\b/.test(navigator.userAgent);const Vs=/android/i.test(navigator.userAgent),Js=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const Ks=/firefox/i.test(navigator.userAgent),$s=/OculusBrowser/.test(navigator.userAgent);Js&&/CriOS\//.test(navigator.userAgent);const Ys=Vs&&!Ks&&!$s,zs=Boolean(window.webkit&&window.webkit.messageHandlers),js=(()=>{if(Js){if(zs)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}}return!1})(),Ws=e=>e&&"null"!==e?Zs(e):null,Xs=()=>{if(qs)return;const e=[];throw Gs||e.push("WebXR Device API"),Ps||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},Zs=e=>new URL(e,window.location.toString()).toString(),ei=(e,t)=>{let s=null;return(...i)=>{null!=s&&self.clearTimeout(s),s=self.setTimeout((()=>{s=null,e(...i)}),t)}},ti=(e,t,s)=>Math.max(t,Math.min(s,e)),si=(()=>{const e=(()=>{var e;if(null===(e=document.documentElement.getAttribute("itemtype"))||void 0===e?void 0:e.includes("schema.org/SearchResultsPage"))return!0;const t=null!=document.head?Array.from(document.head.querySelectorAll("meta")):[];for(const e of t)if("viewport"===e.name)return!0;return!1})();return e||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>e?window.devicePixelRatio:1})(),ii=(()=>{const e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ni=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const ri=Symbol("currentEnvironmentMap"),oi=Symbol("currentBackground"),ai=Symbol("updateEnvironment"),Ai=Symbol("cancelEnvironmentUpdate");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const li=es`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View in your space">
        ${es`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${es`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${es`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,hi=new WeakMap;function ci(){let e,t;function s(e,t,s,i,n,r){const o=r.num_components(),a=s.num_points()*o,A=a*n.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),h=e._malloc(A);t.GetAttributeDataArrayForAllPoints(s,r,l,A,h);const c=new n(e.HEAPF32.buffer,h,a).slice();return e._free(h),{name:i,array:c,itemSize:o}}onmessage=function(i){const n=i.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=n.buffer,r=n.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder;try{const e=function(e,t,i,n){const r=n.attributeIDs,o=n.attributeTypes;let a,A;const l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)a=new e.Mesh,A=t.DecodeArrayToMesh(i,i.byteLength,a);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,A=t.DecodeArrayToPointCloud(i,i.byteLength,a)}if(!A.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const h={index:null,attributes:[]};for(const i in r){const A=self[o[i]];let l,c;if(n.useUniqueIDs)c=r[i],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[r[i]]),-1===c)continue;l=t.GetAttribute(a,c)}const u=s(e,t,a,i,A,l);"color"===i&&(u.vertexColorSpace=n.vertexColorSpace),h.attributes.push(u)}l===e.TRIANGULAR_MESH&&(h.index=function(e,t,s){const i=s.num_faces(),n=3*i,r=4*n,o=e._malloc(r);t.GetTrianglesUInt32Array(s,r,o);const a=new Uint32Array(e.HEAPF32.buffer,o,n).slice();return e._free(o),{array:a,itemSize:1}}(e,t,a));return e.destroy(a),h}(t,o,new Int8Array(i),r),a=e.attributes.map((e=>e.array.buffer));e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},a)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(o)}}))}}}function ui(e,t){if(t===$e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Ye||t===ze){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const i=s.count-2,n=[];if(t===Ye)for(let e=1;e<=i;e++)n.push(s.getX(0)),n.push(s.getX(e)),n.push(s.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(s.getX(e)),n.push(s.getX(e+1)),n.push(s.getX(e+2))):(n.push(s.getX(e+2)),n.push(s.getX(e+1)),n.push(s.getX(e)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(n),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class gi extends w{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Ci(e)})),this.register((function(e){return new Si(e)})),this.register((function(e){return new xi(e)})),this.register((function(e){return new Mi(e)})),this.register((function(e){return new Bi(e)})),this.register((function(e){return new yi(e)})),this.register((function(e){return new wi(e)})),this.register((function(e){return new Qi(e)})),this.register((function(e){return new fi(e)})),this.register((function(e){return new vi(e)})),this.register((function(e){return new Ei(e)})),this.register((function(e){return new bi(e)})),this.register((function(e){return new mi(e)})),this.register((function(e){return new Ri(e)})),this.register((function(e){return new Di(e)}))}load(e,t,s,i){const n=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:J.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){i?i(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},a=new Q(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(s){try{n.parse(s,r,(function(s){t(s),n.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let n;const r={},o={},a=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===Ti){try{r[pi.KHR_BINARY_GLTF]=new ki(e)}catch(e){return void(i&&i(e))}n=JSON.parse(r[pi.KHR_BINARY_GLTF].content)}else n=JSON.parse(a.decode(e))}else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const A=new An(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});A.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](A);o[t.name]=t,r[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){const t=n.extensionsUsed[e],s=n.extensionsRequired||[];switch(t){case pi.KHR_MATERIALS_UNLIT:r[t]=new Ii;break;case pi.KHR_DRACO_MESH_COMPRESSION:r[t]=new _i(n,this.dracoLoader);break;case pi.KHR_TEXTURE_TRANSFORM:r[t]=new Ui;break;case pi.KHR_MESH_QUANTIZATION:r[t]=new Ni;break;default:s.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}A.setExtensions(r),A.setPlugins(o),A.parse(s,i)}parseAsync(e,t){const s=this;return new Promise((function(i,n){s.parse(e,t,i,n)}))}}function di(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const pi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mi{constructor(e){this.parser=e,this.name=pi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const n=t.json,r=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let o;const a=new p(16777215);void 0!==r.color&&a.setRGB(r.color[0],r.color[1],r.color[2],b);const A=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new Y(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new $(a),o.distance=A;break;case"spot":o=new K(a),o.distance=A,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,tn(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),i=Promise.resolve(o),t.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return s._getNodeRef(t.cache,n,e)}))}}class Ii{constructor(){this.name=pi.KHR_MATERIALS_UNLIT}getMaterialType(){return f}extendParams(e,t,s){const i=[];e.color=new p(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],b),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(s.assignTexture(e,"map",n.baseColorTexture,v))}return Promise.all(i)}}class fi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class Ci{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new m(e,e)}return Promise.all(n)}}class Ei{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&n.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&n.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class Bi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new p(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],b)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&n.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,v)),void 0!==r.sheenRoughnessTexture&&n.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}}class yi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class wi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&n.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=(new p).setRGB(o[0],o[1],o[2],b),Promise.all(n)}}class Qi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class vi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&n.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=(new p).setRGB(o[0],o[1],o[2],b),void 0!==r.specularColorTexture&&n.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,v)),Promise.all(n)}}class bi{constructor(e){this.parser=e,this.name=pi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?z:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&n.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}}class Si{constructor(e){this.parser=e,this.name=pi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class xi{constructor(e){this.parser=e,this.name=pi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],o=i.images[r.source];let a=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(n){if(n)return s.loadTextureImage(e,r.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Mi{constructor(e){this.parser=e,this.name=pi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],o=i.images[r.source];let a=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(n){if(n)return s.loadTextureImage(e,r.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ri{constructor(e){this.name=pi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const s=e.byteOffset||0,i=e.byteLength||0,r=e.count,o=e.byteStride,a=new Uint8Array(t,s,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(r,o,a,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){const t=new ArrayBuffer(r*o);return n.decodeGltfBuffer(new Uint8Array(t),r,o,a,e.mode,e.filter),t}))}))}return null}}class Di{constructor(e){this.name=pi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,n=i.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=i.meshes[n.mesh];for(const e of r.primitives)if(e.mode!==Hi.TRIANGLES&&e.mode!==Hi.TRIANGLE_STRIP&&e.mode!==Hi.TRIANGLE_FAN&&void 0!==e.mode)return null;const o=n.extensions[this.name].attributes,a=[],A={};for(const e in o)a.push(this.parser.getDependency("accessor",o[e]).then((t=>(A[e]=t,A[e]))));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then((e=>{const i=e.pop(),n=i.isGroup?i.children:[i],r=e[0].count,o=[];for(const e of n){const i=new s,n=new d,a=new t,l=new d(1,1,1),h=new j(e.geometry,e.material,r);for(let e=0;e<r;e++)A.TRANSLATION&&n.fromBufferAttribute(A.TRANSLATION,e),A.ROTATION&&a.fromBufferAttribute(A.ROTATION,e),A.SCALE&&l.fromBufferAttribute(A.SCALE,e),h.setMatrixAt(e,i.compose(n,a,l));for(const t in A)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,A[t]);W.prototype.copy.call(h,e),this.parser.assignFinalMaterial(h),o.push(h)}return i.isGroup?(i.clear(),i.add(...o),i):o[0]})))}}const Ti="glTF",Li=1313821514,Fi=5130562;class ki{constructor(e){this.name=pi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ti)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,n=new DataView(e,12);let r=0;for(;r<i;){const t=n.getUint32(r,!0);r+=4;const i=n.getUint32(r,!0);if(r+=4,i===Li){const i=new Uint8Array(e,12+r,t);this.content=s.decode(i)}else if(i===Fi){const s=12+r;this.body=e.slice(s,s+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _i{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=pi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},A={};for(const e in r){const t=$i[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const i=$i[t]||t.toLowerCase();if(void 0!==r[t]){const n=s.accessors[e.attributes[t]],r=qi[n.componentType];A[i]=r.name,a[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],i=a[t];void 0!==i&&(s.normalized=i)}t(e)}),o,A)}))}))}}class Ui{constructor(){this.name=pi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Ni{constructor(){this.name=pi.KHR_MESH_QUANTIZATION}}class Gi extends ct{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=s[n+e];return t}interpolate_(e,t,s,i){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,A=3*o,l=i-t,h=(s-t)/l,c=h*h,u=c*h,g=e*A,d=g-A,p=-2*u+3*c,m=u-c,I=1-p,f=m-c+h;for(let e=0;e!==o;e++){const t=r[d+e+o],s=r[d+e+a]*l,i=r[g+e+o],A=r[g+e]*l;n[e]=I*t+f*s+p*i+m*A}return n}}const Pi=new t;class Oi extends Gi{interpolate_(e,t,s,i){const n=super.interpolate_(e,t,s,i);return Pi.fromArray(n).normalize().toArray(n),n}}const Hi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Vi={9728:je,9729:L,9984:We,9985:Xe,9986:Ze,9987:F},Ji={33071:et,33648:tt,10497:se},Ki={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$i={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Yi={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},zi={CUBICSPLINE:void 0,LINEAR:Be,STEP:st},ji="OPAQUE",Wi="MASK",Xi="BLEND";function Zi(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new oe({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Me})),e.DefaultMaterial}function en(e,t,s){for(const i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function tn(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function sn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,i=s.length;t<i;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function nn(e){let t;const s=e.extensions&&e.extensions[pi.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+rn(s.attributes):e.indices+":"+rn(e.attributes)+":"+e.mode,void 0!==e.targets)for(let s=0,i=e.targets.length;s<i;s++)t+=":"+rn(e.targets[s]);return t}function rn(e){let t="";const s=Object.keys(e).sort();for(let i=0,n=s.length;i<n;i++)t+=s[i]+":"+e[s[i]]+";";return t}function on(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const an=new s;class An{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new di,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=!1,n=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,n=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||i&&n<98?this.textureLoader=new X(this.options.manager):this.textureLoader=new Z(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Q(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const r={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};en(n,r,i),tn(r,i),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,i=t.length;s<i;s++){const i=t[s].joints;for(let t=0,s=i.length;t<s;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(s[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),n=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,i]of e.children.entries())n(i,t.children[s])};return n(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return s.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[pi.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,n){s.load(J.resolveURL(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)}))}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Ki[i.type],t=qi[i.componentType],s=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new x(n,e,s))}const n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then((function(e){const n=e[0],r=Ki[i.type],o=qi[i.componentType],a=o.BYTES_PER_ELEMENT,A=a*r,l=i.byteOffset||0,h=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,c=!0===i.normalized;let u,g;if(h&&h!==A){const e=Math.floor(l/h),s="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let A=t.cache.get(s);A||(u=new o(n,e*h,i.count*h/a),A=new ee(u,h/a),t.cache.add(s,A)),g=new te(A,r,l%h/a,c)}else u=null===n?new o(i.count*r):new o(n,l,i.count*r),g=new x(u,r,c);if(void 0!==i.sparse){const t=Ki.SCALAR,s=qi[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,A=i.sparse.values.byteOffset||0,l=new s(e[1],a,i.sparse.count*t),h=new o(e[2],A,i.sparse.count*r);null!==n&&(g=new x(g.array.slice(),g.itemSize,g.normalized));for(let e=0,t=l.length;e<t;e++){const t=l[e];if(g.setX(t,h[e*r]),r>=2&&g.setY(t,h[e*r+1]),r>=3&&g.setZ(t,h[e*r+2]),r>=4&&g.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g}))}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,n=t.images[i];let r=this.textureLoader;if(n.uri){const e=s.manager.getHandler(n.uri);null!==e&&(r=e)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,t,s){const i=this,n=this.json,r=n.textures[e],o=n.images[t],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const A=this.loadImageSource(t,s).then((function(t){t.flipY=!1,t.name=r.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const s=(n.samplers||{})[r.sampler]||{};return t.magFilter=Vi[s.magFilter]||L,t.minFilter=Vi[s.minFilter]||F,t.wrapS=Ji[s.wrapS]||se,t.wrapT=Ji[s.wrapT]||se,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=A,A}loadImageSource(e,t){const s=this,i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=i.images[e],o=self.URL||self.webkitURL;let a=r.uri||"",A=!1;if(void 0!==r.bufferView)a=s.getDependency("bufferView",r.bufferView).then((function(e){A=!0;const t=new Blob([e],{type:r.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(e){return new Promise((function(s,i){let r=s;!0===t.isImageBitmapLoader&&(r=function(e){const t=new g(e);t.needsUpdate=!0,s(t)}),t.load(J.resolveURL(e,n.path),r,void 0,i)}))})).then((function(e){var t;return!0===A&&o.revokeObjectURL(a),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,s,i){const n=this;return this.getDependency("texture",s.index).then((function(r){if(!r)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((r=r.clone()).channel=s.texCoord),n.extensions[pi.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[pi.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(r);r=n.extensions[pi.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),n.associations.set(r,t)}}return void 0!==i&&(r.colorSpace=i),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new ie,ne.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new re,ne.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(i||n||r){let e="ClonedMaterial:"+s.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),n&&(t.vertexColors=!0),r&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return oe}loadMaterial(e){const t=this,s=this.json,i=this.extensions,n=s.materials[e];let r;const o={},a=[];if((n.extensions||{})[pi.KHR_MATERIALS_UNLIT]){const e=i[pi.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),a.push(e.extendParams(o,n,t))}else{const s=n.pbrMetallicRoughness||{};if(o.color=new p(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],b),o.opacity=e[3]}void 0!==s.baseColorTexture&&a.push(t.assignTexture(o,"map",s.baseColorTexture,v)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===n.doubleSided&&(o.side=ae);const A=n.alphaMode||ji;if(A===Xi?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,A===Wi&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&r!==f&&(a.push(t.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new m(1,1),void 0!==n.normalTexture.scale)){const e=n.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==n.occlusionTexture&&r!==f&&(a.push(t.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&r!==f){const e=n.emissiveFactor;o.emissive=(new p).setRGB(e[0],e[1],e[2],b)}return void 0!==n.emissiveTexture&&r!==f&&a.push(t.assignTexture(o,"emissiveMap",n.emissiveTexture,v)),Promise.all(a).then((function(){const s=new r(o);return n.name&&(s.name=n.name),tn(s,n),t.associations.set(s,{materials:e}),n.extensions&&en(i,s,n),s}))}createUniqueName(e){const t=Ae.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function n(e){return s[pi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return ln(s,e,t)}))}const r=[];for(let s=0,o=e.length;s<o;s++){const o=e[s],a=nn(o),A=i[a];if(A)r.push(A.promise);else{let e;e=o.extensions&&o.extensions[pi.KHR_DRACO_MESH_COMPRESSION]?n(o):ln(new S,o,t),i[a]={primitive:o,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,i=this.extensions,n=s.meshes[e],r=n.primitives,o=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?Zi(this.cache):this.getDependency("material",r[e].material);o.push(t)}return o.push(t.loadGeometries(r)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),a=s[s.length-1],A=[];for(let s=0,l=a.length;s<l;s++){const l=a[s],h=r[s];let c;const u=o[s];if(h.mode===Hi.TRIANGLES||h.mode===Hi.TRIANGLE_STRIP||h.mode===Hi.TRIANGLE_FAN||void 0===h.mode)c=!0===n.isSkinnedMesh?new le(l,u):new he(l,u),!0===c.isSkinnedMesh&&c.normalizeSkinWeights(),h.mode===Hi.TRIANGLE_STRIP?c.geometry=ui(c.geometry,ze):h.mode===Hi.TRIANGLE_FAN&&(c.geometry=ui(c.geometry,Ye));else if(h.mode===Hi.LINES)c=new ce(l,u);else if(h.mode===Hi.LINE_STRIP)c=new ue(l,u);else if(h.mode===Hi.LINE_LOOP)c=new ge(l,u);else{if(h.mode!==Hi.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);c=new de(l,u)}Object.keys(c.geometry.morphAttributes).length>0&&sn(c,n),c.name=t.createUniqueName(n.name||"mesh_"+e),tn(c,n),h.extensions&&en(i,c,h),t.assignFinalMaterial(c),A.push(c)}for(let s=0,i=A.length;s<i;s++)t.associations.set(A[s],{meshes:e,primitives:s});if(1===A.length)return n.extensions&&en(i,A[0],n),A[0];const l=new pe;n.extensions&&en(i,l,n),t.associations.set(l,{meshes:e});for(let e=0,t=A.length;e<t;e++)l.add(A[e]);return l}))}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?t=new I(me.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(t=new Ie(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),tn(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let e=0,s=t.joints.length;e<s;e++)i.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),n=e,r=[],o=[];for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a){r.push(a);const t=new s;null!==i&&t.fromArray(i.array,16*e),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new fe(r,o)}))}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,r=[],o=[],a=[],A=[],l=[];for(let e=0,t=i.channels.length;e<t;e++){const t=i.channels[e],s=i.samplers[t.sampler],n=t.target,h=n.node,c=void 0!==i.parameters?i.parameters[s.input]:s.input,u=void 0!==i.parameters?i.parameters[s.output]:s.output;void 0!==n.node&&(r.push(this.getDependency("node",h)),o.push(this.getDependency("accessor",c)),a.push(this.getDependency("accessor",u)),A.push(s),l.push(n))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(A),Promise.all(l)]).then((function(e){const t=e[0],i=e[1],r=e[2],o=e[3],a=e[4],A=[];for(let e=0,n=t.length;e<n;e++){const n=t[e],l=i[e],h=r[e],c=o[e],u=a[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();const g=s._createAnimationTracks(n,l,h,c,u);if(g)for(let e=0;e<g.length;e++)A.push(g[e])}return new Ce(n,void 0,A)}))}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return void 0===i.mesh?null:s.getDependency("mesh",i.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,s=this.json.nodes[e],i=t._loadNodeShallow(e),n=[],r=s.children||[];for(let e=0,s=r.length;e<s;e++)n.push(t.getDependency("node",r[e]));const o=void 0===s.skin?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(n),o]).then((function(e){const t=e[0],s=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,an)}));for(let e=0,i=s.length;e<i;e++)t.add(s[e]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],A=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return A&&a.push(A),void 0!==r.camera&&a.push(n.getDependency("camera",r.camera).then((function(e){return n._getNodeRef(n.cameraCache,r.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===r.isBone?new Ee:t.length>1?new pe:1===t.length?t[0]:new W,a!==t[0])for(let e=0,s=t.length;e<s;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=o),tn(a,r),r.extensions&&en(i,a,r),void 0!==r.matrix){const e=new s;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,n=new pe;s.name&&(n.name=i.createUniqueName(s.name)),tn(n,s),s.extensions&&en(t,n,s);const r=s.nodes||[],o=[];for(let e=0,t=r.length;e<t;e++)o.push(i.getDependency("node",r[e]));return Promise.all(o).then((function(e){for(let t=0,s=e.length;t<s;t++)n.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,s]of i.associations)(e instanceof ne||e instanceof g)&&t.set(e,s);return e.traverse((e=>{const s=i.associations.get(e);null!=s&&t.set(e,s)})),t})(n),n}))}_createAnimationTracks(e,t,s,i,n){const r=[],o=e.name?e.name:e.uuid,a=[];let A;switch(Yi[n.path]===Yi.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(o),Yi[n.path]){case Yi.weights:A=nt;break;case Yi.rotation:A=rt;break;case Yi.position:case Yi.scale:A=it;break;default:if(1===s.itemSize)A=nt;else A=it}const l=void 0!==i.interpolation?zi[i.interpolation]:Be,h=this._getArrayFromAccessor(s);for(let e=0,s=a.length;e<s;e++){const s=new A(a[e]+"."+Yi[n.path],t.array,h,l);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(s),r.push(s)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=on(t.constructor),s=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)s[i]=t[i]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof rt?Oi:Gi)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ln(e,t,s){const i=t.attributes,n=[];function r(t,i){return s.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const s=$i[t]||t.toLowerCase();s in e.attributes||n.push(r(i[t],s))}if(void 0!==t.indices&&!e.index){const i=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(i)}return ye.workingColorSpace!==b&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ye.workingColorSpace}" not supported.`),tn(e,t),function(e,t,s){const i=t.attributes,n=new He;if(void 0===i.POSITION)return;{const e=s.json.accessors[i.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(n.set(new d(t[0],t[1],t[2]),new d(r[0],r[1],r[2])),e.normalized){const t=on(qi[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new d,t=new d;for(let i=0,n=r.length;i<n;i++){const n=r[i];if(void 0!==n.POSITION){const i=s.json.accessors[n.POSITION],r=i.min,o=i.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),i.normalized){const e=on(qi[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;const o=new xe;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(n).then((function(){return void 0!==t.targets?function(e,t,s){let i=!1,n=!1,r=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(i=!0),void 0!==s.NORMAL&&(n=!0),void 0!==s.COLOR_0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(e);const o=[],a=[],A=[];for(let l=0,h=t.length;l<h;l++){const h=t[l];if(i){const t=void 0!==h.POSITION?s.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(n){const t=void 0!==h.NORMAL?s.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(r){const t=void 0!==h.COLOR_0?s.getDependency("accessor",h.COLOR_0):e.attributes.color;A.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(A)]).then((function(t){const s=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=s),n&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}class hn{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:t,msg:s,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(s,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((s=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const cn=2,un=0,gn=1,dn=10;class pn{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class mn{constructor(e,t,s,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const s=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,i)}}const In=[171,75,84,88,32,50,48,187,13,10,26,10];function fn(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let Cn,En,Bn;const yn={env:{emscripten_notify_memory_growth:function(e){Bn=new Uint8Array(En.exports.memory.buffer)}}};class wn{init(){return Cn||(Cn="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Qn).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,yn))).then(this._init):WebAssembly.instantiate(Buffer.from(Qn,"base64"),yn).then(this._init),Cn)}_init(e){En=e.instance,yn.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!En)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,i=En.exports.malloc(s);Bn.set(e,i),t=t||Number(En.exports.ZSTD_findDecompressedSize(i,s));const n=En.exports.malloc(t),r=En.exports.ZSTD_decompress(n,t,i,s),o=Bn.slice(n,n+r);return En.exports.free(i),En.exports.free(n),o}}const Qn="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",vn=new WeakMap;let bn,Sn=0;class xn extends w{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new hn,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new Q(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new Q(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then((([e,t])=>{const s=xn.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(xn.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(xn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(xn.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Sn>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Sn++}return this.transcoderPending}load(e,t,s,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const n=new Q(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,(e=>{if(vn.has(e)){return vn.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}),s,i)}_createTextureFrom(e,t){const{faces:s,width:i,height:n,format:r,type:o,error:a,dfdFlags:A}=e;if("error"===o)return Promise.reject(a);let l;if(6===t.faceCount)l=new M(s,r,R);else{const e=s[0].mipmaps;l=t.layerCount>1?new D(e,i,n,t.layerCount,r,R):new T(e,i,n,r,R)}return l.minFilter=1===s[0].mipmaps.length?L:F,l.magFilter=L,l.generateMipmaps=!1,l.needsUpdate=!0,l.colorSpace=Tn(t),l.premultiplyAlpha=!!(1&A),l}async _createTexture(e,t={}){const s=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,In.length);if(t[0]!==In[0]||t[1]!==In[1]||t[2]!==In[2]||t[3]!==In[3]||t[4]!==In[4]||t[5]!==In[5]||t[6]!==In[6]||t[7]!==In[7]||t[8]!==In[8]||t[9]!==In[9]||t[10]!==In[10]||t[11]!==In[11])throw new Error("Missing KTX 2.0 identifier.");const s=new pn,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new mn(e,In.length,i,!0);s.vkFormat=n._nextUint32(),s.typeSize=n._nextUint32(),s.pixelWidth=n._nextUint32(),s.pixelHeight=n._nextUint32(),s.pixelDepth=n._nextUint32(),s.layerCount=n._nextUint32(),s.faceCount=n._nextUint32();const r=n._nextUint32();s.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),A=n._nextUint32(),l=n._nextUint32(),h=n._nextUint64(),c=n._nextUint64(),u=new mn(e,In.length+i,3*r*8,!0);for(let t=0;t<r;t++)s.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const g=new mn(e,o,a,!0),d={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},p=(d.descriptorBlockSize/4-6)/4;for(let e=0;e<p;e++){const t={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=g._nextInt32(),t.sampleUpper=g._nextInt32()):(t.sampleLower=g._nextUint32(),t.sampleUpper=g._nextUint32()),d.samples[e]=t}s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(d);const m=new mn(e,A,l,!0);for(;m._offset<l;){const e=m._nextUint32(),t=m._scan(e),i=fn(t),n=m._scan(e-t.byteLength);s.keyValue[i]=i.match(/^ktx/i)?fn(n):n,m._offset%4&&m._skip(4-m._offset%4)}if(c<=0)return s;const I=new mn(e,h,c,!0),f=I._nextUint16(),C=I._nextUint16(),E=I._nextUint32(),B=I._nextUint32(),y=I._nextUint32(),w=I._nextUint32(),Q=[];for(let e=0;e<r;e++)Q.push({imageFlags:I._nextUint32(),rgbSliceByteOffset:I._nextUint32(),rgbSliceByteLength:I._nextUint32(),alphaSliceByteOffset:I._nextUint32(),alphaSliceByteLength:I._nextUint32()});const v=h+I._offset,b=v+E,S=b+B,x=S+y,M=new Uint8Array(e.buffer,e.byteOffset+v,E),R=new Uint8Array(e.buffer,e.byteOffset+b,B),D=new Uint8Array(e.buffer,e.byteOffset+S,y),T=new Uint8Array(e.buffer,e.byteOffset+x,w);return s.globalData={endpointCount:f,selectorCount:C,imageDescs:Q,endpointsData:M,selectorsData:R,tablesData:D,extendedData:T},s}(new Uint8Array(e));if(0!==s.vkFormat)return async function(e){const{vkFormat:t}=e;if(void 0===Rn[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let s;2===e.supercompressionScheme&&(bn||(bn=new Promise((async e=>{const t=new wn;await t.init(),e(t)}))),s=await bn);const i=[];for(let n=0;n<e.levels.length;n++){const r=Math.max(1,e.pixelWidth>>n),o=Math.max(1,e.pixelHeight>>n),a=e.pixelDepth?Math.max(1,e.pixelDepth>>n):0,A=e.levels[n];let l,h;if(0===e.supercompressionScheme)l=A.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");l=s.decode(A.levelData,A.uncompressedByteLength)}h=Dn[t]===k?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):Dn[t]===_?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l,i.push({data:h,width:r,height:o,depth:a})}let n;if(Mn.has(Rn[t]))n=0===e.pixelDepth?new U(i[0].data,e.pixelWidth,e.pixelHeight):new N(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new T(i,e.pixelWidth,e.pixelHeight)}return n.mipmaps=i,n.type=Dn[t],n.format=Rn[t],n.colorSpace=Tn(e),n.needsUpdate=!0,Promise.resolve(n)}(s);const i=t,n=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e]))).then((e=>this._createTextureFrom(e.data,s)));return vn.set(e,{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Sn--,this}}xn.BasisFormat={ETC1S:0,UASTC_4x4:1},xn.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},xn.EngineFormat={RGBAFormat:i,RGBA_ASTC_4x4_Format:n,RGBA_BPTC_Format:r,RGBA_ETC2_EAC_Format:o,RGBA_PVRTC_4BPPV1_Format:a,RGBA_S3TC_DXT5_Format:A,RGB_ETC1_Format:l,RGB_ETC2_Format:h,RGB_PVRTC_4BPPV1_Format:c,RGB_S3TC_DXT1_Format:u},xn.BasisWorker=function(){let e,t,s;const i=_EngineFormat,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",(function(o){const c=o.data;switch(c.type){case"init":e=c.config,u=c.transcoderBinary,t=new Promise((e=>{s={wasmBinary:u,onRuntimeInitialized:e},BASIS(s)})).then((()=>{s.initializeBasis(),void 0===s.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:o,width:u,height:g,hasAlpha:d,format:p,dfdFlags:m}=function(t){const o=new s.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const u=o.isUASTC()?r.UASTC_4x4:r.ETC1S,g=o.getWidth(),d=o.getHeight(),p=o.getLayers()||1,m=o.getLevels(),I=o.getFaces(),f=o.getHasAlpha(),C=o.getDFDFlags(),{transcoderFormat:E,engineFormat:B}=function(t,s,o,h){let c,u;const g=t===r.ETC1S?a:A;for(let i=0;i<g.length;i++){const n=g[i];if(e[n.if]&&(n.basisFormat.includes(t)&&!(h&&n.transcoderFormat.length<2)&&(!n.needsPowerOfTwo||l(s)&&l(o))))return c=n.transcoderFormat[h?1:0],u=n.engineFormat[h?1:0],{transcoderFormat:c,engineFormat:u}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),c=n.RGBA32,u=i.RGBAFormat,{transcoderFormat:c,engineFormat:u}}(u,g,d,f);if(!g||!d||!m)throw c(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw c(),new Error("THREE.KTX2Loader: .startTranscoding failed");const y=[],w=[];for(let e=0;e<I;e++){const t=[];for(let s=0;s<m;s++){const i=[];let n,r;for(let t=0;t<p;t++){const a=o.getImageLevelInfo(s,t,e);0!==e||0!==s||0!==t||a.origWidth%4==0&&a.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(n=a.origWidth,r=a.origHeight):(n=a.width,r=a.height);const A=new Uint8Array(o.getImageTranscodedSizeInBytes(s,t,0,E));if(!o.transcodeImage(A,s,t,e,E,0,-1,-1))throw c(),new Error("THREE.KTX2Loader: .transcodeImage failed.");i.push(A)}const a=h(i);t.push({data:a,width:n,height:r}),w.push(a.buffer)}y.push({mipmaps:t,width:g,height:d,format:B})}return c(),{faces:y,buffers:w,width:g,height:d,hasAlpha:f,format:B,dfdFlags:C}}(c.buffer);self.postMessage({type:"transcode",id:c.id,faces:t,width:u,height:g,hasAlpha:d,format:p,dfdFlags:m},o)}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}}))}var u}));const o=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),A=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(e){return e<=2||0==(e&e-1)&&0!==e}function h(e){if(1===e.length)return e[0];let t=0;for(let s=0;s<e.length;s++){t+=e[s].byteLength}const s=new Uint8Array(t);let i=0;for(let t=0;t<e.length;t++){const n=e[t];s.set(n,i),i+=n.byteLength}return s}};const Mn=new Set([i,we,Qe]),Rn={109:i,97:i,37:i,43:i,103:we,83:we,16:we,22:we,100:Qe,76:Qe,15:Qe,9:Qe,166:ve,165:ve},Dn={109:k,97:_,37:R,43:R,103:k,83:_,16:R,22:R,100:k,76:_,15:R,9:R,166:R,165:R};function Tn(e){const t=e.dataFormatDescriptor[0];return t.colorPrimaries===gn?t.transferFunction===cn?v:b:t.colorPrimaries===dn?t.transferFunction===cn?G:P:(t.colorPrimaries===un||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),O)}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ln,Fn;const kn=Symbol("retainerCount"),_n=Symbol("recentlyUsed"),Un=Symbol("evict"),Nn=Symbol("evictionThreshold"),Gn=Symbol("cache");class Pn{constructor(e,t=5){this[Ln]=new Map,this[Fn]=[],this[Gn]=e,this[Nn]=t}set evictionThreshold(e){this[Nn]=e,this[Un]()}get evictionThreshold(){return this[Nn]}get cache(){return this[Gn]}retainerCount(e){return this[kn].get(e)||0}reset(){this[kn].clear(),this[_n]=[]}retain(e){this[kn].has(e)||this[kn].set(e,0),this[kn].set(e,this[kn].get(e)+1);const t=this[_n].indexOf(e);-1!==t&&this[_n].splice(t,1),this[_n].unshift(e),this[Un]()}release(e){this[kn].has(e)&&this[kn].set(e,Math.max(this[kn].get(e)-1,0)),this[Un]()}[(Ln=kn,Fn=_n,Un)](){if(!(this[_n].length<this[Nn]))for(let e=this[_n].length-1;e>=this[Nn];--e){const t=this[_n][e];0===this[kn].get(t)&&(this[Gn].delete(t),this[_n].splice(e,1))}}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On=e=>{const t=new Map;for(const s of e.mappings)for(const e of s.variants)t.set(e,{material:null,gltfMaterialIndex:s.material});return t};class Hn{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,s=t.json;if(void 0===s.extensions||void 0===s.extensions[this.name])return null;const i=(e=>{const t=[],s=new Set;for(const i of e){let e=i,n=0;for(;s.has(e);)e=i+"."+ ++n;s.add(e),t.push(e)}return t})((s.extensions[this.name].variants||[]).map((e=>e.name)));for(const i of e.scenes)i.traverse((e=>{const i=e;if(!i.material)return;const n=t.associations.get(i);if(null==n||null==n.meshes||null==n.primitives)return;const r=s.meshes[n.meshes].primitives[n.primitives].extensions;r&&r[this.name]&&(i.userData.variantMaterials=On(r[this.name]))}));return e.userData.variants=i,Promise.resolve()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qn,Vn;g.DEFAULT_ANISOTROPY=4;const Jn=new Map,Kn=new Map;let $n;const Yn=new class extends w{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,i){const n=new Q(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(e=>{this.parse(e,t,i)}),s,i)}parse(e,t,s){this.decodeDracoFile(e,t,null,null,v).catch(s)}decodeDracoFile(e,t,s,i,n=b){const r={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const s=JSON.stringify(t);if(hi.has(e)){const t=hi.get(e);if(t.key===s)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const n=this.workerNextTaskID++,r=e.byteLength,o=this._getWorker(n,r).then((s=>(i=s,new Promise(((s,r)=>{i._callbacks[n]={resolve:s,reject:r},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return o.catch((()=>!0)).then((()=>{i&&n&&this._releaseTask(i,n)})),hi.set(e,{key:s,promise:o}),o}_createGeometry(e){const t=new S;e.index&&t.setIndex(new x(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const i=e.attributes[s],n=i.name,r=i.array,o=i.itemSize,a=new x(r,o);"color"===n&&(this._assignVertexColorSpace(a,i.vertexColorSpace),a.normalized=r instanceof Float32Array==!1),t.setAttribute(n,a)}return t}_assignVertexColorSpace(e,t){if(t!==v)return;const s=new p;for(let t=0,i=e.count;t<i;t++)s.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new Q(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{s.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const s=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=ci.toString(),n=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const s=t.data;switch(s.type){case"decode":e._callbacks[s.id].resolve(s);break;case"error":e._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};let zn;const jn=new xn;let Wn,Xn;const Zn=Symbol("loader"),er=Symbol("evictionPolicy"),tr=Symbol("GLTFInstance");class sr extends H{constructor(e){super(),this[Vn]=(new gi).register((e=>new Hn(e))),this[tr]=e,this[Zn].setDRACOLoader(Yn),this[Zn].setKTX2Loader(jn)}static setDRACODecoderLocation(e){$n=e,Yn.setDecoderPath(e)}static getDRACODecoderLocation(){return $n}static setKTX2TranscoderLocation(e){zn=e,jn.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return zn}static setMeshoptDecoderLocation(e){var t;Wn!==e&&(Wn=e,Xn=(t=e,new Promise(((e,s)=>{const i=document.createElement("script");document.body.appendChild(i),i.onload=e,i.onerror=s,i.async=!0,i.src=t}))).then((()=>MeshoptDecoder.ready)).then((()=>MeshoptDecoder)))}static getMeshoptDecoderLocation(){return Wn}static initializeKTX2Loader(e){jn.detectSupport(e)}static get cache(){return Jn}static clearCache(){Jn.forEach(((e,t)=>{this.delete(t)})),this[er].reset()}static has(e){return Jn.has(e)}static async delete(e){if(!this.has(e))return;const t=Jn.get(e);Kn.delete(e),Jn.delete(e);(await t).dispose()}static hasFinishedLoading(e){return!!Kn.get(e)}get[(qn=er,Vn=Zn,er)](){return this.constructor[er]}async preload(e,t,s=(()=>{})){if(this[Zn].setWithCredentials(sr.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Jn.has(e)){null!=Xn&&this[Zn].setMeshoptDecoder(await Xn);const t=((e,t,s=(()=>{}))=>{const i=e=>{const t=e.loaded/e.total;s(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(((s,n)=>{t.load(e,s,i,n)}))})(e,this[Zn],(e=>{s(.8*e)})),i=this[tr],n=t.then((e=>i.prepare(e))).then((e=>(s(.9),new i(e)))).catch((e=>(console.error(e),new i)));Jn.set(e,n)}await Jn.get(e),Kn.set(e,!0),s&&s(1)}async load(e,t,s=(()=>{})){await this.preload(e,t,s);const i=await Jn.get(e),n=await i.clone();return this[er].retain(e),n.dispose=()=>{this[er].release(e)},n}}sr[qn]=new Pn(sr);class ir extends W{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new m(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const nr=new d,rr=new s,or=new s,ar=new d,Ar=new d;class lr{constructor(e={}){const t=this;let s,i,n,r;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function A(e,s,i){if(e.isCSS2DObject){nr.setFromMatrixPosition(e.matrixWorld),nr.applyMatrix4(or);const A=!0===e.visible&&nr.z>=-1&&nr.z<=1&&!0===e.layers.test(i.layers);if(e.element.style.display=!0===A?"":"none",!0===A){e.onBeforeRender(t,s,i);const o=e.element;o.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(nr.x*n+n)+"px,"+(-nr.y*r+r)+"px)",o.parentNode!==a&&a.appendChild(o),e.onAfterRender(t,s,i)}const h={distanceToCameraSquared:l(i,e)};o.objects.set(e,h)}for(let t=0,n=e.children.length;t<n;t++)A(e.children[t],s,i)}function l(e,t){return ar.setFromMatrixPosition(e.matrixWorld),Ar.setFromMatrixPosition(t.matrixWorld),ar.distanceToSquared(Ar)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:s,height:i}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),rr.copy(t.matrixWorldInverse),or.multiplyMatrices(t.projectionMatrix,rr),A(e,e,t),function(e){const t=function(e){const t=[];return e.traverse((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared})),s=t.length;for(let e=0,i=t.length;e<i;e++)t[e].element.style.zIndex=s-e}(e)},this.setSize=function(e,t){s=e,i=t,n=s/2,r=i/2,a.style.width=e+"px",a.style.height=t+"px"}}}function hr(e,t,s){let i=s;const n=new d;return e.updateWorldMatrix(!0,!0),e.traverseVisible((e=>{const{geometry:s}=e;if(void 0!==s){const{position:r}=s.attributes;if(void 0!==r)for(let s=0,o=r.count;s<o;s++)e.isMesh?e.getVertexPosition(s,n):n.fromBufferAttribute(r,s),e.isSkinnedMesh||n.applyMatrix4(e.matrixWorld),i=t(i,n)}})),i}let cr,ur,gr,dr;function pr(e,t=1/0,s=null){ur||(ur=new C(2,2,1,1)),gr||(gr=new Ue({uniforms:{blitTexture:new dt(e)},vertexShader:"\n            varying vec2 vUv;\n            void main(){\n                vUv = uv;\n                gl_Position = vec4(position.xy * 1.0,0.,.999999);\n            }",fragmentShader:"\n            uniform sampler2D blitTexture; \n            varying vec2 vUv;\n\n            void main(){ \n                gl_FragColor = vec4(vUv.xy, 0, 1);\n                \n                #ifdef IS_SRGB\n                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n                #else\n                gl_FragColor = texture2D( blitTexture, vUv);\n                #endif\n            }"})),gr.uniforms.blitTexture.value=e,gr.defines.IS_SRGB=e.colorSpace==v,gr.needsUpdate=!0,dr||(dr=new he(ur,gr),dr.frustrumCulled=!1);const i=new I,n=new _e;n.add(dr),s||(s=cr=new q({antialias:!1})),s.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),s.clear(),s.render(n,i);const r=new g(s.domElement);return r.minFilter=e.minFilter,r.magFilter=e.magFilter,r.wrapS=e.wrapS,r.wrapT=e.wrapT,r.name=e.name,cr&&(cr.dispose(),cr=null),r}const mr={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Ir{constructor(){this.pluginCallbacks=[],this.register((function(e){return new Wr(e)})),this.register((function(e){return new Xr(e)})),this.register((function(e){return new to(e)})),this.register((function(e){return new so(e)})),this.register((function(e){return new io(e)})),this.register((function(e){return new no(e)})),this.register((function(e){return new Zr(e)})),this.register((function(e){return new eo(e)})),this.register((function(e){return new ro(e)})),this.register((function(e){return new oo(e)})),this.register((function(e){return new ao(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){const n=new jr,r=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)r.push(this.pluginCallbacks[e](n));n.setPlugins(r),n.write(e,t,i).catch(s)}parseAsync(e,t){const s=this;return new Promise((function(i,n){s.parse(e,i,n,t)}))}}const fr=0,Cr=1,Er=2,Br=3,yr=4,wr=5120,Qr=5121,vr=5122,br=5123,Sr=5124,xr=5125,Mr=5126,Rr=34962,Dr=34963,Tr=9728,Lr=9729,Fr=9984,kr=9985,_r=9986,Ur=9987,Nr=33071,Gr=33648,Pr=10497,Or="KHR_mesh_quantization",Hr={};Hr[je]=Tr,Hr[We]=Fr,Hr[Ze]=_r,Hr[L]=Lr,Hr[Xe]=kr,Hr[F]=Ur,Hr[et]=Nr,Hr[se]=Pr,Hr[tt]=Gr;const qr={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Vr=new p;function Jr(e,t){return e.length===t.length&&e.every((function(e,s){return e===t[s]}))}function Kr(e){return 4*Math.ceil(e/4)}function $r(e,t=0){const s=Kr(e.byteLength);if(s!==e.byteLength){const i=new Uint8Array(s);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<s;n++)i[n]=t;return i.buffer}return e}function Yr(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function zr(e,t){if(void 0!==e.toBlob)return new Promise((s=>e.toBlob(s,t)));let s;return"image/jpeg"===t?s=.92:"image/webp"===t&&(s=.8),e.convertToBlob({type:t,quality:s})}class jr{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,n=i.buffers,r=i.json;s=i.options;const o=i.extensionsUsed,a=i.extensionsRequired,A=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(o),h=Object.keys(a);if(l.length>0&&(r.extensionsUsed=l),h.length>0&&(r.extensionsRequired=h),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=A.size),!0===s.binary){const e=new FileReader;e.readAsArrayBuffer(A),e.onloadend=function(){const s=$r(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,s.byteLength,!0),i.setUint32(4,5130562,!0);const n=$r((o=JSON.stringify(r),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,n.byteLength,!0),a.setUint32(4,1313821514,!0);const A=new ArrayBuffer(12),l=new DataView(A);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const h=12+a.byteLength+n.byteLength+i.byteLength+s.byteLength;l.setUint32(8,h,!0);const c=new Blob([A,a,n,i,s],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){t(u.result)}}}else if(r.buffers&&r.buffers.length>0){const e=new FileReader;e.readAsDataURL(A),e.onloadend=function(){const s=e.result;r.buffers[0].uri=s,t(r)}}else t(r)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const s=this.options,i=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new d;for(let s=0,i=e.count;s<i;s++)if(Math.abs(t.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),i=new d;for(let e=0,t=s.count;e<t;e++)i.fromBufferAttribute(s,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),s.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),s=!0),0!==t.rotation&&(i.rotation=t.rotation,s=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(e){return e.colorSpace===v?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof T&&(e=pr(e)),t instanceof T&&(t=pr(t));const i=e?e.image:null,n=t?t.image:null,r=Math.max(i?i.width:0,n?n.width:0),o=Math.max(i?i.height:0,n?n.height:0),a=Yr();a.width=r,a.height=o;const A=a.getContext("2d");A.fillStyle="#00ffff",A.fillRect(0,0,r,o);const l=A.getImageData(0,0,r,o);if(i){A.drawImage(i,0,0,r,o);const t=s(e),n=A.getImageData(0,0,r,o).data;for(let e=2;e<n.length;e+=4)l.data[e]=256*t(n[e]/256)}if(n){A.drawImage(n,0,0,r,o);const e=s(t),i=A.getImageData(0,0,r,o).data;for(let t=1;t<i.length;t+=4)l.data[t]=256*e(i[t]/256)}A.putImageData(l,0,0);const h=(e||t).clone();return h.source=new ut(a),h.colorSpace=O,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,i,n){const r=this.json;let o;switch(r.bufferViews||(r.bufferViews=[]),t){case wr:case Qr:o=1;break;case vr:case br:o=2;break;default:o=4}const a=Kr(i*e.itemSize*o),A=new DataView(new ArrayBuffer(a));let l=0;for(let n=s;n<s+i;n++)for(let s=0;s<e.itemSize;s++){let i;e.itemSize>4?i=e.array[n*e.itemSize+s]:(0===s?i=e.getX(n):1===s?i=e.getY(n):2===s?i=e.getZ(n):3===s&&(i=e.getW(n)),!0===e.normalized&&(i=me.normalize(i,e.array))),t===Mr?A.setFloat32(l,i,!0):t===Sr?A.setInt32(l,i,!0):t===xr?A.setUint32(l,i,!0):t===vr?A.setInt16(l,i,!0):t===br?A.setUint16(l,i,!0):t===wr?A.setInt8(l,i):t===Qr&&A.setUint8(l,i),l+=o}const h={buffer:this.processBuffer(A.buffer),byteOffset:this.byteOffset,byteLength:a};void 0!==n&&(h.target=n),n===Rr&&(h.byteStride=e.itemSize*o),this.byteOffset+=a,r.bufferViews.push(h);return{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise((function(i){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=$r(n.result),r={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(s.bufferViews.push(r)-1)}}))}processAccessor(e,t,s,i){const n=this.json;let r;if(e.array.constructor===Float32Array)r=Mr;else if(e.array.constructor===Int32Array)r=Sr;else if(e.array.constructor===Uint32Array)r=xr;else if(e.array.constructor===Int16Array)r=vr;else if(e.array.constructor===Uint16Array)r=br;else if(e.array.constructor===Int8Array)r=wr;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);r=Qr}if(void 0===s&&(s=0),void 0===i&&(i=e.count),0===i)return null;const o=function(e,t,s){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+s;n++)for(let t=0;t<e.itemSize;t++){let s;e.itemSize>4?s=e.array[n*e.itemSize+t]:(0===t?s=e.getX(n):1===t?s=e.getY(n):2===t?s=e.getZ(n):3===t&&(s=e.getW(n)),!0===e.normalized&&(s=me.normalize(s,e.array))),i.min[t]=Math.min(i.min[t],s),i.max[t]=Math.max(i.max[t],s)}return i}(e,s,i);let a;void 0!==t&&(a=e===t.index?Dr:Rr);const A=this.processBufferView(e,r,s,i,a),l={bufferView:A.id,byteOffset:A.byteOffset,componentType:r,count:i,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(l.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(l)-1}processImage(e,t,s,n="image/png"){if(null!==e){const r=this,o=r.cache,a=r.json,A=r.options,l=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),c=n+":flipY/"+s.toString();if(void 0!==h[c])return h[c];a.images||(a.images=[]);const u={mimeType:n},g=Yr();g.width=Math.min(e.width,A.maxTextureSize),g.height=Math.min(e.height,A.maxTextureSize);const d=g.getContext("2d");if(!0===s&&(d.translate(0,g.height),d.scale(1,-1)),void 0!==e.data){t!==i&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>A.maxTextureSize||e.height>A.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const s=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<s.length;t+=4)s[t+0]=e.data[t+0],s[t+1]=e.data[t+1],s[t+2]=e.data[t+2],s[t+3]=e.data[t+3];d.putImageData(new ImageData(s,e.width,e.height),0,0)}else d.drawImage(e,0,0,g.width,g.height);!0===A.binary?l.push(zr(g,n).then((e=>r.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==g.toDataURL?u.uri=g.toDataURL(n):l.push(zr(g,n).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{u.uri=e})));const p=a.images.push(u)-1;return h[c]=p,p}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:Hr[e.magFilter],minFilter:Hr[e.minFilter],wrapS:Hr[e.wrapS],wrapT:Hr[e.wrapT]};return t.samplers.push(s)-1}processTexture(e){const t=this.options,s=this.cache,i=this.json;if(s.textures.has(e))return s.textures.get(e);i.textures||(i.textures=[]),e instanceof T&&(e=pr(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(r.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,r)}));const o=i.textures.push(r)-1;return s.textures.set(e,o),o}processMaterial(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=e.color.toArray().concat([e.opacity]);if(Jr(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),s={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(s,t),i.pbrMetallicRoughness.metallicRoughnessTexture=s}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===ae&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)}));const r=s.materials.push(i)-1;return t.materials.set(e,r),r}processMesh(e){const t=this.cache,s=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,s=e.material.length;t<s;t++)i.push(e.material[t].uuid);else i.push(e.material.uuid);const n=i.join(":");if(t.meshes.has(n))return t.meshes.get(n);const r=e.geometry;let o;o=e.isLineSegments?Cr:e.isLineLoop?Er:e.isLine?Br:e.isPoints?fr:e.material.wireframe?Cr:yr;const a={},A={},l=[],h=[],c={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=r.getAttribute("normal");void 0===u||this.isNormalizedNormalAttribute(u)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(u)));let g=null;for(let e in r.attributes){if("morph"===e.slice(0,5))continue;const s=r.attributes[e];e=c[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(s))){A[e]=t.attributes.get(this.getUID(s));continue}g=null;const i=s.array;"JOINTS_0"!==e||i instanceof Uint16Array||i instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new x(new Uint16Array(i),s.itemSize,s.normalized));const n=this.processAccessor(g||s,r);null!==n&&(e.startsWith("_")||this.detectMeshQuantization(e,s),A[e]=n,t.attributes.set(this.getUID(s),n))}if(void 0!==u&&r.setAttribute("normal",u),0===Object.keys(A).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const s=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let o=0;o<e.morphTargetInfluences.length;++o){const a={};let A=!1;for(const e in r.morphAttributes){if("position"!==e&&"normal"!==e){A||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),A=!0);continue}const s=r.morphAttributes[e][o],i=e.toUpperCase(),n=r.attributes[e];if(t.attributes.has(this.getUID(s,!0))){a[i]=t.attributes.get(this.getUID(s,!0));continue}const l=s.clone();if(!r.morphTargetsRelative)for(let e=0,t=s.count;e<t;e++)for(let t=0;t<s.itemSize;t++)0===t&&l.setX(e,s.getX(e)-n.getX(e)),1===t&&l.setY(e,s.getY(e)-n.getY(e)),2===t&&l.setZ(e,s.getZ(e)-n.getZ(e)),3===t&&l.setW(e,s.getW(e)-n.getW(e));a[i]=this.processAccessor(l,r),t.attributes.set(this.getUID(n,!0),a[i])}h.push(a),s.push(e.morphTargetInfluences[o]),void 0!==e.morphTargetDictionary&&i.push(n[o])}a.weights=s,i.length>0&&(a.extras={},a.extras.targetNames=i)}const d=Array.isArray(e.material);if(d&&0===r.groups.length)return null;const p=d?e.material:[e.material],m=d?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,s=m.length;e<s;e++){const s={mode:o,attributes:A};if(this.serializeUserData(r,s),h.length>0&&(s.targets=h),null!==r.index){let i=this.getUID(r.index);void 0===m[e].start&&void 0===m[e].count||(i+=":"+m[e].start+":"+m[e].count),t.attributes.has(i)?s.indices=t.attributes.get(i):(s.indices=this.processAccessor(r.index,r,m[e].start,m[e].count),t.attributes.set(i,s.indices)),null===s.indices&&delete s.indices}const i=this.processMaterial(p[m[e].materialIndex]);null!==i&&(s.material=i),l.push(s)}a.primitives=l,s.meshes||(s.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,a)}));const I=s.meshes.push(a)-1;return t.meshes.set(n,I),I}detectMeshQuantization(e,t){if(this.extensionsUsed[Or])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const i=e.split("_",1)[0];mr[i]&&mr[i].includes(s)&&(this.extensionsUsed[Or]=!0,this.extensionsRequired[Or]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:me.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const s=this.json,i=this.nodeMap;s.animations||(s.animations=[]);const n=(e=Ir.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,r=[],o=[];for(let e=0;e<n.length;++e){const s=n[e],a=Ae.parseTrackName(s.name);let A=Ae.findNode(t,a.nodeName);const l=qr[a.propertyName];if("bones"===a.objectName&&(A=!0===A.isSkinnedMesh?A.skeleton.getBoneByName(a.objectIndex):void 0),!A||!l)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;const h=1;let c,u=s.values.length/s.times.length;l===qr.morphTargetInfluences&&(u/=A.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(c="CUBICSPLINE",u/=3):c=s.getInterpolation()===st?"STEP":"LINEAR",o.push({input:this.processAccessor(new x(s.times,h)),output:this.processAccessor(new x(s.values,u)),interpolation:c}),r.push({sampler:o.length-1,target:{node:i.get(A),path:l}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:o,channels:r}),s.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],r=e.skeleton;if(void 0===r)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],A=new Float32Array(16*r.bones.length),l=new s;for(let t=0;t<r.bones.length;++t)a.push(i.get(r.bones[t])),l.copy(r.boneInverses[t]),l.multiply(e.bindMatrix).toArray(A,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new x(A,16)),joints:a,skeleton:i.get(o)});return n.skin=t.skins.length-1}processNode(e){const t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(s.trs){const t=e.quaternion.toArray(),s=e.position.toArray(),i=e.scale.toArray();Jr(t,[0,0,0,1])||(n.rotation=t),Jr(s,[0,0,0])||(n.translation=s),Jr(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Jr(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,n=e.children.length;i<n;i++){const n=e.children[i];if(n.visible||!1===s.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));const r=t.nodes.push(n)-1;return i.set(e,r),r}processScene(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const n=[];for(let t=0,i=e.children.length;t<i;t++){const i=e.children[t];if(i.visible||!1===s.onlyVisible){const e=this.processNode(i);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}processObjects(e){const t=new _e;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const s=[];for(let t=0;t<e.length;t++)e[t]instanceof _e?this.processScene(e[t]):s.push(e[t]);s.length>0&&this.processObjects(s);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}class Wr{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,i=s.json,n=s.extensionsUsed,r={};e.name&&(r.name=e.name),r.color=e.color.toArray(),r.intensity=e.intensity,e.isDirectionalLight?r.type="directional":e.isPointLight?(r.type="point",e.distance>0&&(r.range=e.distance)):e.isSpotLight&&(r.type="spot",e.distance>0&&(r.range=e.distance),r.spot={},r.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,r.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);const o=i.extensions[this.name].lights;o.push(r),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class Xr{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Zr{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};s.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class eo{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class to{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class so{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class io{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const s=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class no{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Vr)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class ro{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class oo{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.anisotropyMap){const t={index:s.processTexture(e.anisotropyMap)};s.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class ao{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const s=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}Ir.Utils={insertKeyframe:function(e,t){const s=.001,i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),r=new e.ValueBufferType(e.values.length+i),o=e.createInterpolant(new e.ValueBufferType(i));let a;if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)r[e]=0;a=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<s)return 0;n[0]=t,n.set(e.times,1),r.set(o.evaluate(t),0),r.set(e.values,i),a=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<s)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),r.set(e.values,0),r.set(o.evaluate(t),e.values.length),a=n.length-1}else for(let A=0;A<e.times.length;A++){if(Math.abs(e.times[A]-t)<s)return A;if(e.times[A]<t&&e.times[A+1]>t){n.set(e.times.slice(0,A+1),0),n[A+1]=t,n.set(e.times.slice(A+1),A+2),r.set(e.values.slice(0,(A+1)*i),0),r.set(o.evaluate(t),(A+1)*i),r.set(e.values.slice((A+1)*i),(A+2)*i),a=A+1;break}}return e.times=n,e.values=r,a},mergeMorphTargetTracks:function(e,t){const s=[],i={},n=e.tracks;for(let e=0;e<n.length;++e){let r=n[e];const o=Ae.parseTrackName(r.name),a=Ae.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){s.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(Be)}const A=a.morphTargetInfluences.length,l=a.morphTargetDictionary[o.propertyIndex];if(void 0===l)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let h;if(void 0===i[a.uuid]){h=r.clone();const e=new h.ValueBufferType(A*h.times.length);for(let t=0;t<h.times.length;t++)e[t*A+l]=h.values[t];h.name=(o.nodeName||"")+".morphTargetInfluences",h.values=e,i[a.uuid]=h,s.push(h);continue}const c=r.createInterpolant(new r.ValueBufferType(1));h=i[a.uuid];for(let e=0;e<h.times.length;e++)h.values[e*A+l]=c.evaluate(h.times[e]);for(let e=0;e<r.times.length;e++){const t=this.insertKeyframe(h,r.times[e]);h.values[t*A+l]=r.values[e]}}return e.tracks=s,e}};
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ao=e=>void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter((e=>lo(e.material))),lo=e=>e&&e.isMaterial&&!Array.isArray(e);class ho{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set;for(const s of e)s.traverse((e=>{if(!Ao(e))return;const s=e.userData.variantMaterials,i=e.userData.variantData;for(const[e,n]of i){const i=s.get(n.index);i&&lo(i.material)&&t.add(e)}}));t.forEach((e=>this.variantNames.push(e)))}writeMesh(e,t){if(!Ao(e))return;const s=e.userData,i=s.variantMaterials,n=s.variantData,r=new Map,o=new Map,a=Array.from(n.values()).sort(((e,t)=>e.index-t.index));for(const[e,t]of a.entries())o.set(t.index,e);for(const e of n.values()){const t=i.get(e.index);if(!t||!lo(t.material))continue;const s=this.writer.processMaterial(t.material);r.has(s)||r.set(s,{material:s,variants:[]}),r.get(s).variants.push(o.get(e.index))}const A=Array.from(r.values()).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===A.length)return;const l=lo(s.originalMaterial)?this.writer.processMaterial(s.originalMaterial):-1;for(const e of t.primitives)l>=0&&(e.material=l),e.extensions=e.extensions||{},e.extensions[this.name]={mappings:A}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map((e=>({name:e})));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class co{constructor(e,t,s,i,n){this.xrLight=e,this.renderer=t,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=n,this.frameCallback=this.onXRFrame.bind(this);const r=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const s=new Te(16);e.environment=s.texture;const i=t.getContext();switch(r.preferredReflectionFormat){case"srgba8":i.getExtension("EXT_sRGB");break;case"rgba16f":i.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(r,i),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}r.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const s=t.getLightEstimate(this.lightProbe);if(s){this.xrLight.lightProbe.sh.fromArray(s.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(s.primaryLightIntensity.x,Math.max(s.primaryLightIntensity.y,s.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(s.primaryLightIntensity.x/e,s.primaryLightIntensity.y/e,s.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(s.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class uo extends pe{constructor(e,t=!0){super(),this.lightProbe=new ot,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new Y,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,i=!1;e.xr.addEventListener("sessionstart",(()=>{const n=e.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then((n=>{s=new co(this,e,n,t,(()=>{i=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{s&&(s.dispose(),s=null),i&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,s,i){const n=2e-4*this.naturalFrequency;if(null==e||0===i)return t;if(e===t&&0===this.velocity)return t;if(s<0)return e;const r=e-t,o=this.velocity+this.naturalFrequency*r,a=r+s*o,A=Math.exp(-this.naturalFrequency*s),l=(o-this.naturalFrequency*a)*A,h=-this.naturalFrequency*(l+o*A);return Math.abs(l)<n*Math.abs(i)&&h*r>=0?(this.velocity=0,t):(this.velocity=l,t+a*A)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const po=.2,mo=Math.PI/24,Io=new m,fo=(e,t,s)=>{let i=t>0?s>0?0:-Math.PI/2:s>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)e.push(t+.17*Math.cos(i),s+.17*Math.sin(i),0,t+po*Math.cos(i),s+po*Math.sin(i),0),i+=mo};class Co extends he{constructor(e,t){const s=new S,i=[],n=[],{size:r,boundingBox:o}=e,a=r.x/2,A=("back"===t?r.y:r.z)/2;fo(n,a,A),fo(n,-a,A),fo(n,-a,-A),fo(n,a,-A);const l=n.length/3;for(let e=0;e<l-2;e+=2)i.push(e,e+1,e+3,e,e+3,e+2);const h=l-2;i.push(h,h+1,1,h,1,0),s.setAttribute("position",new at(n,3)),s.setIndex(i),super(s),this.side=t;const c=this.material;switch(c.side=ae,c.transparent=!0,c.opacity=0,this.goalOpacity=0,this.opacityDamper=new go,this.hitPlane=new he(new C(2*(a+po),2*(A+po))),this.hitPlane.visible=!1,this.hitPlane.material.side=ae,this.add(this.hitPlane),o.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=o.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=o.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.offsetHeight=0}getHit(e,t,s){Io.set(t,-s),this.hitPlane.visible=!0;const i=e.positionAndNormalFromPoint(Io,this.hitPlane);return this.hitPlane.visible=!1,null==i?null:i.position}getExpandedHit(e,t,s){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const i=this.getHit(e,t,s);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:s}=this.hitPlane;t.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo=(e,t)=>({type:"number",number:e,unit:t}),Bo=(()=>{const e={};return t=>{const s=t;if(s in e)return e[s];const i=[];let n=0;for(;t;){if(++n>1e3){t="";break}const e=yo(t),s=e.nodes[0];if(null==s||0===s.terms.length)break;i.push(s),t=e.remainingInput}return e[s]=i}})(),yo=(()=>{const e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,s=/^[\),]/;return i=>{const n=[];for(;i.length&&(i=i.trim(),!s.test(i));)if("("===i[0]){const{nodes:e,remainingInput:t}=bo(i);i=t,n.push({type:"function",name:{type:"ident",value:"calc"},arguments:e})}else if(e.test(i)){const e=wo(i),t=e.nodes[0];if("("===(i=e.remainingInput)[0]){const{nodes:e,remainingInput:s}=bo(i);n.push({type:"function",name:t,arguments:e}),i=s}else n.push(t)}else if(t.test(i))n.push({type:"operator",value:i[0]}),i=i.slice(1);else{const{nodes:e,remainingInput:t}="#"===i[0]?vo(i):Qo(i);if(0===e.length)break;n.push(e[0]),i=t}return{nodes:[{type:"expression",terms:n}],remainingInput:i}}})(),wo=(()=>{const e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const s=t.match(e);return{nodes:[{type:"ident",value:null==s?t:t.substr(0,s.index)}],remainingInput:null==s?"":t.substr(s.index)}}})(),Qo=(()=>{const e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,s=/^(m|mm|cm|rad|deg|[%])$/;return i=>{const n=i.match(e),r=null==n?"0":n[0],o=(i=null==r?i:i.slice(r.length)).match(t);let a=null!=o&&""!==o[0]?o[0]:null;const A=null==o?i:i.slice(a.length);return null==a||s.test(a)||(a=null),{nodes:[{type:"number",number:parseFloat(r)||0,unit:a}],remainingInput:A}}})(),vo=(()=>{const e=/^[a-f0-9]*/i;return t=>{const s=(t=t.slice(1).trim()).match(e);return{nodes:null==s?[]:[{type:"hex",value:s[0]}],remainingInput:null==s?t:t.slice(s[0].length)}}})(),bo=e=>{const t=[];for(e=e.slice(1).trim();e.length;){const s=yo(e);if(t.push(s.nodes[0]),","===(e=s.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},So=Symbol("visitedTypes");class xo{constructor(e){this[So]=e}walk(e,t){const s=e.slice();for(;s.length;){const e=s.shift();switch(this[So].indexOf(e.type)>-1&&t(e),e.type){case"expression":s.unshift(...e.terms);break;case"function":s.unshift(e.name,...e.arguments)}}}}const Mo=Object.freeze({type:"number",number:0,unit:null}),Ro=(e,t=0)=>{let{number:s,unit:i}=e;if(isFinite(s)){if("rad"===e.unit||null==e.unit)return e}else s=t,i="rad";return{type:"number",number:("deg"===i&&null!=s?s:0)*Math.PI/180,unit:"rad"}},Do=(e,t=0)=>{let s,{number:i,unit:n}=e;if(isFinite(i)){if("m"===e.unit)return e}else i=t,n="m";switch(n){default:s=1;break;case"cm":s=.01;break;case"mm":s=.001}return{type:"number",number:s*i,unit:"m"}},To=(()=>{const e=e=>e,t={rad:e,deg:Ro,m:e,mm:Do,cm:Do};return(e,s=Mo)=>{isFinite(e.number)||(e.number=s.number,e.unit=s.unit);const{unit:i}=e;if(null==i)return e;const n=t[i];return null==n?s:n(e)}})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Lo,Fo,ko;const _o=Symbol("evaluate"),Uo=Symbol("lastValue");class No{constructor(){this[Lo]=null}static evaluatableFor(e,t=Mo){if(e instanceof No)return e;if("number"===e.type)return"%"===e.unit?new Oo(e,t):e;switch(e.name.value){case"calc":return new Ko(e,t);case"env":return new qo(e)}return Mo}static evaluate(e){return e instanceof No?e.evaluate():e}static isConstant(e){return!(e instanceof No)||e.isConstant}static applyIntrinsics(e,t){const{basis:s,keywords:i}=t,{auto:n}=i;return s.map(((t,s)=>{const r=null==n[s]?t:n[s];let o=e[s]?e[s]:r;if("ident"===o.type){const e=o.value;e in i&&(o=i[e][s])}return null!=o&&"ident"!==o.type||(o=r),"%"===o.unit?Eo(o.number/100*t.number,t.unit):(o=To(o,t),o.unit!==t.unit?t:o)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[Uo]||(this[Uo]=this[_o]()),this[Uo]}}Lo=Uo;const Go=Symbol("percentage"),Po=Symbol("basis");class Oo extends No{constructor(e,t){super(),this[Go]=e,this[Po]=t}get isConstant(){return!0}[_o](){return Eo(this[Go].number/100*this[Po].number,this[Po].unit)}}const Ho=Symbol("identNode");class qo extends No{constructor(e){super(),this[Fo]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[Ho]=t)}get isConstant(){return!1}[(Fo=Ho,_o)](){if(null!=this[Ho]&&"window-scroll-y"===this[Ho].value){return{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}}return Mo}}const Vo=/[\*\/]/,Jo=Symbol("evaluator");class Ko extends No{constructor(e,t=Mo){if(super(),this[ko]=null,1!==e.arguments.length)return;const s=e.arguments[0].terms.slice(),i=[];for(;s.length;){const e=s.shift();if(i.length>0){const s=i[i.length-1];if("operator"===s.type&&Vo.test(s.value)){const s=i.pop(),n=i.pop();if(null==n)return;i.push(new jo(s,No.evaluatableFor(n,t),No.evaluatableFor(e,t)));continue}}i.push("operator"===e.type?e:No.evaluatableFor(e,t))}for(;i.length>2;){const[e,s,n]=i.splice(0,3);if("operator"!==s.type)return;i.unshift(new jo(s,No.evaluatableFor(e,t),No.evaluatableFor(n,t)))}1===i.length&&(this[Jo]=i[0])}get isConstant(){return null==this[Jo]||No.isConstant(this[Jo])}[(ko=Jo,_o)](){return null!=this[Jo]?No.evaluate(this[Jo]):Mo}}const $o=Symbol("operator"),Yo=Symbol("left"),zo=Symbol("right");class jo extends No{constructor(e,t,s){super(),this[$o]=e,this[Yo]=t,this[zo]=s}get isConstant(){return No.isConstant(this[Yo])&&No.isConstant(this[zo])}[_o](){const e=To(No.evaluate(this[Yo])),t=To(No.evaluate(this[zo])),{number:s,unit:i}=e,{number:n,unit:r}=t;if(null!=r&&null!=i&&r!=i)return Mo;const o=i||r;let a;switch(this[$o].value){case"+":a=s+n;break;case"-":a=s-n;break;case"/":a=s/n;break;case"*":a=s*n;break;default:return Mo}return{type:"number",number:a,unit:o}}}const Wo=Symbol("evaluatables"),Xo=Symbol("intrinsics");class Zo extends No{constructor(e,t){super(),this[Xo]=t;const s=e[0],i=null!=s?s.terms:[];this[Wo]=t.basis.map(((e,t)=>{const s=i[t];return null==s?{type:"ident",value:"auto"}:"ident"===s.type?s:No.evaluatableFor(s,e)}))}get isConstant(){for(const e of this[Wo])if(!No.isConstant(e))return!1;return!0}[_o](){const e=this[Wo].map((e=>No.evaluate(e)));return No.applyIntrinsics(e,this[Xo]).map((e=>e.number))}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ea,ta,sa,ia;const na=Symbol("instances"),ra=Symbol("activateListener"),oa=Symbol("deactivateListener"),aa=Symbol("notifyInstances"),Aa=Symbol("notify"),la=Symbol("callback");class ha{constructor(e){this[la]=e}static[aa](){for(const e of ha[na])e[Aa]()}static[(ea=na,ra)](){window.addEventListener("scroll",this[aa],{passive:!0})}static[oa](){window.removeEventListener("scroll",this[aa])}observe(){0===ha[na].size&&ha[ra](),ha[na].add(this)}disconnect(){ha[na].delete(this),0===ha[na].size&&ha[oa]()}[Aa](){this[la]()}}ha[ea]=new Set;const ca=Symbol("computeStyleCallback"),ua=Symbol("astWalker"),ga=Symbol("dependencies"),da=Symbol("onScroll");class pa{constructor(e){this[ta]={},this[sa]=new xo(["function"]),this[ia]=()=>{this[ca]({relatedState:"window-scroll"})},this[ca]=e}observeEffectsFor(e){const t={},s=this[ga];this[ua].walk(e,(e=>{const{name:i}=e,n=e.arguments[0].terms[0];if("env"===i.value&&null!=n&&"ident"===n.type&&"window-scroll-y"===n.value)if(null==t["window-scroll"]){const e="window-scroll"in s?s["window-scroll"]:new ha(this[da]);e.observe(),delete s["window-scroll"],t["window-scroll"]=e}}));for(const e in s){s[e].disconnect()}this[ga]=t}dispose(){for(const e in this[ga]){this[ga][e].disconnect()}}}ta=ga,sa=ua,ia=da;
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ma=e=>{const t=e.observeEffects||!1,s=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(i,n)=>{const r=i.updated,o=i.connectedCallback,a=i.disconnectedCallback,A=Symbol(`${n}StyleEffector`),l=Symbol(`${n}StyleEvaluator`),h=Symbol(`${n}UpdateEvaluator`),c=Symbol(`${n}EvaluateAndSync`);Object.defineProperties(i,{[A]:{value:null,writable:!0},[l]:{value:null,writable:!0},[h]:{value:function(){const e=Bo(this[n]);this[l]=new Zo(e,s(this)),null==this[A]&&t&&(this[A]=new pa((()=>this[c]()))),null!=this[A]&&this[A].observeEffectsFor(e)}},[c]:{value:function(){if(null==this[l])return;const t=this[l].evaluate();this[e.updateHandler](t)}},updated:{value:function(e){e.has(n)&&(this[h](),this[c]()),r.call(this,e)}},connectedCallback:{value:function(){o.call(this),this.requestUpdate(n,this[n])}},disconnectedCallback:{value:function(){a.call(this),null!=this[A]&&(this[A].dispose(),this[A]=null)}}})}},Ia=e=>e<.5?2*e*e:(4-2*e)*e-1,fa=(e,t,s=Ia)=>i=>e+(t-e)*s(i),Ca=e=>{const t=[],s=[];let i=e.initialValue;for(let n=0;n<e.keyframes.length;++n){const r=e.keyframes[n],{value:o,frames:a}=r,A=r.ease||Ia,l=fa(i,o,A);t.push(l),s.push(a),i=o}return((e,t)=>{const s=t.map((i=0,e=>i+=e));var i;return t=>{t=ti(t,0,1),t*=s[s.length-1];const i=s.findIndex((e=>e>=t)),n=i<1?0:s[i-1],r=s[i];return e[i]((t-n)/(r-n))}})(t,s)};
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ea=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const Ba=Ca({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),ya=Ca({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),wa="0deg 75deg 105%",Qa=["front","right","back","left"],va=["upper-","","lower-"],ba="auto",Sa="basic",xa="wiggle",Ma="none",Ra=()=>({basis:[Ro(Eo(30,"deg"))],keywords:{auto:[null]}}),Da=()=>({basis:[Ro(Eo(12,"deg"))],keywords:{auto:[null]}}),Ta=(()=>{const e=Bo(wa)[0].terms,t=To(e[0]),s=To(e[1]);return e=>{const i=e[qc].idealCameraDistance();return{basis:[t,s,Eo(i,"m")],keywords:{auto:[null,null,Eo(105,"%")]}}}})(),La=e=>{const t=2.2*e[qc].boundingSphere.radius;return{basis:[Eo(-1/0,"rad"),Eo(Math.PI/8,"rad"),Eo(t,"m")],keywords:{auto:[null,null,null]}}},Fa=e=>{const t=Ta(e),s=new Zo([],t).evaluate()[2];return{basis:[Eo(1/0,"rad"),Eo(Math.PI-Math.PI/8,"rad"),Eo(s,"m")],keywords:{auto:[null,null,null]}}},ka=e=>{const t=e[qc].boundingBox.getCenter(new d);return{basis:[Eo(t.x,"m"),Eo(t.y,"m"),Eo(t.z,"m")],keywords:{auto:[null,null,null]}}},_a=Math.PI/2,Ua=Math.PI/3,Na=_a/2,Ga=2*Math.PI,Pa=Symbol("controls"),Oa=Symbol("panElement"),Ha=Symbol("promptElement"),qa=Symbol("promptAnimatedContainer"),Va=Symbol("fingerAnimatedContainers"),Ja=Symbol("deferInteractionPrompt"),Ka=Symbol("updateAria"),$a=Symbol("updateCameraForRadius"),Ya=Symbol("cancelPrompts"),za=Symbol("onChange"),ja=Symbol("onPointerChange"),Wa=Symbol("waitingToPromptUser"),Xa=Symbol("userHasInteracted"),Za=Symbol("promptElementVisibleTime"),eA=Symbol("lastPromptOffset"),tA=Symbol("cancellationSource"),sA=Symbol("lastSpherical"),iA=Symbol("jumpCamera"),nA=Symbol("initialized"),rA=Symbol("maintainThetaPhi"),oA=Symbol("syncCameraOrbit"),aA=Symbol("syncFieldOfView"),AA=Symbol("syncCameraTarget"),lA=Symbol("syncMinCameraOrbit"),hA=Symbol("syncMaxCameraOrbit"),cA=Symbol("syncMinFieldOfView"),uA=Symbol("syncMaxFieldOfView"),gA=new m,dA=new d,pA=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),mA=Math.PI/8,IA=.04,fA={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class CA extends H{constructor(e,t,s){super(),this.camera=e,this.element=t,this.scene=s,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=fA.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new E,this.panPerPixel=0,this.spherical=new be,this.goalSpherical=new be,this.thetaDamper=new go,this.phiDamper=new go,this.radiusDamper=new go,this.logFov=Math.log(pA.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new go,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=e=>{if(this.enablePan)e.preventDefault();else for(const e of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:e.id})))},this.touchModeZoom=(e,t)=>{if(!this._disableZoom){const e=this.twoTouchDistance(this.pointers[0],this.pointers[1]),t=IA*this.zoomSensitivity*(this.lastSeparation-e)*50/this.scene.height;this.lastSeparation=e,this.userAdjustOrbit(0,0,t)}this.panPerPixel>0&&this.movePan(e,t)},this.disableScroll=e=>{e.preventDefault()},this.touchModeRotate=(e,t)=>{const{touchAction:s}=this._options;if(!this.touchDecided&&"none"!==s){this.touchDecided=!0;const i=Math.abs(e),n=Math.abs(t);if(this.changeSource===fA.USER_INTERACTION&&("pan-y"===s&&n>i||"pan-x"===s&&i>n))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(e,t)},this.onPointerDown=e=>{if(this.pointers.length>2)return;const{element:t}=this;0===this.pointers.length&&(t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=e.clientX,this.startPointerPosition.clientY=e.clientY,this.startTime=performance.now());try{t.setPointerCapture(e.pointerId)}catch(e){}this.pointers.push({clientX:e.clientX,clientY:e.clientY,id:e.pointerId}),this.isUserPointing=!1,"touch"===e.pointerType?(this.changeSource=e.altKey?fA.AUTOMATIC:fA.USER_INTERACTION,this.onTouchChange(e)):(this.changeSource=fA.USER_INTERACTION,this.onMouseDown(e)),this.changeSource===fA.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=e=>{const t=this.pointers.find((t=>t.id===e.pointerId));if(null==t)return;if("mouse"===e.pointerType&&0===e.buttons)return void this.onPointerUp(e);const s=this.pointers.length,i=(e.clientX-t.clientX)/s,n=(e.clientY-t.clientY)/s;0===i&&0===n||(t.clientX=e.clientX,t.clientY=e.clientY,"touch"===e.pointerType?(this.changeSource=e.altKey?fA.AUTOMATIC:fA.USER_INTERACTION,null!==this.touchMode&&this.touchMode(i,n)):(this.changeSource=fA.USER_INTERACTION,this.panPerPixel>0?this.movePan(i,n):this.handleSinglePointerMove(i,n)))},this.onPointerUp=e=>{const{element:t}=this,s=this.pointers.findIndex((t=>t.id===e.pointerId));-1!==s&&this.pointers.splice(s,1),this.panPerPixel>0&&!e.altKey&&this.resetRadius(),0===this.pointers.length?(t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(e)):null!==this.touchMode&&this.onTouchChange(e),this.scene.element[Oa].style.opacity=0,t.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=e=>{this.changeSource=fA.USER_INTERACTION;const t=e.deltaY*(1==e.deltaMode?18:1)*IA*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,t),e.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=e=>{const{changeSource:t}=this;this.changeSource=fA.USER_INTERACTION;(e.shiftKey&&this.enablePan?this.panKeyCodeHandler(e):this.orbitZoomKeyCodeHandler(e))?(e.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=t},this._options=Object.assign({},pA),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",(()=>{}),{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new be){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=0===t?2:t,this.camera.near=Math.max(e,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,s=this.goalSpherical.radius){const{minimumAzimuthalAngle:i,maximumAzimuthalAngle:n,minimumPolarAngle:r,maximumPolarAngle:o,minimumRadius:a,maximumRadius:A}=this._options,{theta:l,phi:h,radius:c}=this.goalSpherical,u=ti(e,i,n);isFinite(i)||isFinite(n)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const g=ti(t,r,o),d=ti(s,a,A);return(u!==l||g!==h||d!==c)&&(!!(isFinite(u)&&isFinite(g)&&isFinite(d))&&(this.goalSpherical.theta=u,this.goalSpherical.phi=g,this.goalSpherical.radius=d,this.goalSpherical.makeSafe(),!0))}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:s}=this._options;e=ti(e,t,s),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,s){const{theta:i,phi:n,radius:r}=this.goalSpherical,{minimumRadius:o,maximumRadius:a,minimumFieldOfView:A,maximumFieldOfView:l}=this._options,h=this.spherical.theta-i,c=Math.PI-.001,u=i-ti(e,-c-h,c-h),g=n-t,d=0===s?0:((s>0?a:o)-r)/(Math.log(s>0?l:A)-this.goalLogFov),p=r+s*(isFinite(d)?d:2*(a-o));if(this.setOrbit(u,g,p),0!==s){const e=this.goalLogFov+s;this.setFieldOfView(Math.exp(e))}}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:s,maximumRadius:i}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(n)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,s),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,i),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&"none"!==t?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new Se(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,s){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,s*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:s,clientY:i}=e,{clientX:n,clientY:r}=t,o=n-s,a=r-i;return Math.sqrt(o*o+a*a)}handleSinglePointerMove(e,t){const s=this.pixelLengthToSphericalAngle(e),i=this.pixelLengthToSphericalAngle(t);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(s,i,0)}initializePan(){const{theta:e,phi:t}=this.spherical,s=e-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(s),-Math.cos(t)*Math.sin(s),0,0,Math.sin(t),0,Math.sin(s),-Math.cos(t)*Math.cos(s),0)}movePan(e,t){const{scene:s}=this,i=dA.set(e,t,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;i.multiplyScalar(n);const r=s.getTarget();r.add(i.applyMatrix3(this.panProjection)),s.boundingSphere.clampPoint(r,r),s.setTarget(r.x,r.y,r.z)}recenter(e){if(performance.now()>this.startTime+300||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this,s=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==s){const{cameraTarget:e}=t.element;t.element.cameraTarget="",t.element.cameraTarget=e,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(s.position),t.setTarget(s.position.x,s.position.y,s.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(gA.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const s=e.getTarget(),{theta:i,phi:n}=this.spherical,r=i-e.yaw,o=dA.set(Math.sin(n)*Math.sin(r),Math.cos(n),Math.sin(n)*Math.cos(r)),a=o.dot(t.position.sub(s));s.add(o.multiplyScalar(a)),e.setTarget(s.x,s.y,s.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-a)}onTouchChange(e){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),e.altKey||(this.scene.element[Oa].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(2===e.button||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[Oa].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,IA*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-mA,0);break;case"ArrowDown":this.userAdjustOrbit(0,mA,0);break;case"ArrowLeft":this.userAdjustOrbit(-mA,0,0);break;case"ArrowRight":this.userAdjustOrbit(mA,0,0);break;default:t=!1}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:t=!1}return t}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EA="not-presenting",BA="session-started",yA="object-placed",wA="failed",QA="tracking",vA="not-tracking",bA=new d,SA=new s,xA=new d,MA=new I(45,1,.1,100);class RA extends H{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new d,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new d,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new d,this.goalYaw=0,this.goalScale=1,this.xDamper=new go,this.yDamper=new go,this.zDamper=new go,this.yawDamper=new go,this.scaleDamper=new go,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Co(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const s=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,n=this.placementBox;if(1===s.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,s=n.getHit(this.presentedScene,t[0],t[1]);n.show=!0,null!=s?(this.isTranslating=!0,this.lastDragPosition.copy(s)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===s.length){n.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(s);this.firstRatio=e/i.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){Xs();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return Xs(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let s=new Promise(((e,t)=>{requestAnimationFrame((()=>e()))}));e.setHotspotsVisibility(!1),e.queueRender(),await s,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(this.xrLight=new uo(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const e=this.presentedScene;e.add(this.xrLight),e.environment=this.xrLight.environment})));const i=await this.resolveARSession();i.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const n=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const r=await i.requestReferenceSpace("viewer");this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.background=null,this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const o=20*Math.PI/180,a=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(o),z:-Math.cos(o)});i.requestHitTestSource({space:r,offsetRay:a}).then((e=>{this.initialHitSource=e})),this.currentSession=i,this.placementBox=new Co(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:BA})}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise((e=>{this.resolveCleanup=e}));try{await this.currentSession.end(),await e}catch(e){console.warn("Error while trying to end WebXR AR session"),console.warn(e),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,null!=t){const{element:e}=t;null!=this.xrLight&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowOffset(0);const s=this.turntableRotation;null!=s&&(t.yaw=s);const i=this.oldShadowIntensity;null!=i&&t.setShadowIntensity(i),t.setEnvironmentAndSkybox(e[ri],e[oi]);const n=this.oldTarget;t.setTarget(n.x,n.y,n.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0),e.requestUpdate("cameraTarget"),e.requestUpdate("maxCameraOrbit"),e[$c](e.getBoundingClientRect()),requestAnimationFrame((()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:fA.NONE}}))}))}this.renderer.height=0;const s=this.exitWebXRButtonContainer;null!=s&&(s.classList.remove("enabled"),s.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const i=this.transientHitTestSource;null!=i&&(i.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;null!=n&&(n.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:EA})}updateView(e){const t=this.presentedScene,s=this.threeRenderer.xr;s.updateCamera(MA),t.xrCamera=s.getCamera();const{elements:i}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(i[1],i[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const t=e.recommendedViewportScale;e.requestViewportScale(Math.max(t,.25))}const n=s.getBaseLayer();if(null!=n){const t=n instanceof XRWebGLLayer?n.getViewport(e):s.getBinding().getViewSubImage(n,e).viewport;this.threeRenderer.setViewport(t.x,t.y,t.width,t.height)}}placeInitially(){const e=this.presentedScene,{position:t,element:s}=e,i=e.getCamera(),{width:n,height:r}=this.overlay.getBoundingClientRect();e.setSize(n,r),i.projectionMatrixInverse.copy(i.projectionMatrix).invert();const{theta:o,radius:a}=s.getCameraOrbit(),A=i.getWorldDirection(bA);e.yaw=Math.atan2(-A.x,-A.z)-o,this.goalYaw=e.yaw,t.copy(i.position).add(A.multiplyScalar(a)),this.updateTarget();const l=e.getTarget();t.add(l).sub(this.oldTarget),this.goalPosition.copy(t),e.setHotspotsVisibility(!0);const{session:h}=this.frame;h.addEventListener("selectstart",this.onSelectStart),h.addEventListener("selectend",this.onSelectEnd),h.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((e=>{this.transientHitTestSource=e}))}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(bA.copy(t).sub(this.presentedScene.getCamera().position),bA.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),s=e.getPose(t);if(null==s)return null;const i=SA.fromArray(s.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(i.elements[4],i.elements[6])),i.elements[5]>.75!==this.placeOnWall?xA.setFromMatrixPosition(i):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const s=e.getHitTestResults(t);if(0==s.length)return;const i=s[0],n=this.getHitPoint(i);null!=n&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:yA}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,s=e[1].inputSource.gamepad.axes,i=s[0]-t[0],n=s[1]-t[1],r=Math.atan2(n,i);let o=this.lastAngle-r;return o>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),this.lastAngle=r,{separation:Math.sqrt(i*i+n*n),deltaYaw:o}}processInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const s=e.getHitTestResultsForTransientInput(t),i=this.presentedScene,n=i.scale.x;if(this.isTwoFingering)if(s.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(s);if(!1===this.placeOnWall&&(this.goalYaw+=t),i.canScale){const t=e/this.firstRatio;this.goalScale=t<1.3&&t>.7692307692307692?1:t}}else if(2!==s.length)if(this.isRotating){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&s.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/n,this.presentedScene.setShadowOffset(e);const s=bA.copy(i.getCamera().position),r=-e/(s.y-t.y);s.multiplyScalar(r),t.multiplyScalar(1-r).add(s)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(s);this.firstRatio=e/n}}moveScene(e){const t=this.presentedScene,{position:s,yaw:i}=t,n=t.boundingSphere.radius,r=this.goalPosition,o=t.scale.x,a=this.placementBox;let A=fA.NONE;if(!r.equals(s)||this.goalScale!==o){A=fA.USER_INTERACTION;let{x:i,y:l,z:h}=s;i=this.xDamper.update(i,r.x,e,n),l=this.yDamper.update(l,r.y,e,n),h=this.zDamper.update(h,r.z,e,n),s.set(i,l,h);const c=this.scaleDamper.update(o,this.goalScale,e,1);if(t.scale.set(c,c,c),!this.isTranslating){const e=r.y-l;this.placementComplete&&!1===this.placeOnWall?(a.offsetHeight=e/c,t.setShadowOffset(e)):0===e&&(this.placementComplete=!0,a.show=!1,t.setShadowIntensity(.8))}}a.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(i,this.goalYaw,e,Math.PI),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:A}}))}onWebXRFrame(e,t){this.frame=t,++this.frames;const s=this.threeRenderer.xr.getReferenceSpace(),i=t.getViewerPose(s);null==i&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:vA}));const n=this.presentedScene;if(null==i||null==n||!n.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:QA}));let r=!0;for(const s of i.views){if(this.updateView(s),r){this.moveToFloor(t),this.processInput(t);const s=e-this.lastTick;this.moveScene(s),this.renderer.preRender(n,e,s),this.lastTick=e,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),r=!1}}}function DA(e){const t=new Map,s=new Map,i=e.clone();return TA(e,i,(function(e,i){t.set(i,e),s.set(e,i)})),i.traverse((function(e){if(!e.isSkinnedMesh)return;const i=e,n=t.get(e),r=n.skeleton.bones;i.skeleton=n.skeleton.clone(),i.bindMatrix.copy(n.bindMatrix),i.skeleton.bones=r.map((function(e){return s.get(e)})),i.bind(i.skeleton,i.bindMatrix)})),i}function TA(e,t,s){s(e,t);for(let i=0;i<e.children.length;i++)TA(e.children[i],t.children[i],s)}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=Symbol("prepared"),FA=Symbol("prepare"),kA=Symbol("preparedGLTF"),_A=Symbol("clone");class UA{constructor(e){this[kA]=e}static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[LA])return e;const t=this[FA](e);return t[LA]=!0,t}static[FA](e){const{scene:t}=e,s=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:s})}get parser(){return this[kA].parser}get animations(){return this[kA].animations}get scene(){return this[kA].scene}get scenes(){return this[kA].scenes}get cameras(){return this[kA].cameras}get asset(){return this[kA].asset}get userData(){return this[kA].userData}clone(){return new(0,this.constructor)(this[_A]())}dispose(){this.scenes.forEach((e=>{e.traverse((e=>{const t=e;if(!t.material)return;(Array.isArray(t.material)?t.material:[t.material]).forEach((e=>{for(const t in e){const s=e[t];if(s instanceof g){const e=s.source.data;null!=e.close&&e.close(),s.dispose()}}e.dispose()})),t.geometry.dispose()}))}))}[_A](){const e=this[kA],t=DA(this.scene);NA(t,this.scene);const s=[t],i=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:s,userData:i})}}const NA=(e,t)=>{GA(e,t,((e,t)=>{void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.variantData&&(e.userData.variantData=t.userData.variantData),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)}))},GA=(e,t,s)=>{s(e,t);for(let i=0;i<e.children.length;i++)GA(e.children[i],t.children[i],s)},PA=Symbol("threeGLTF"),OA=Symbol("gltf"),HA=Symbol("gltfElementMap"),qA=Symbol("threeObjectMap"),VA=Symbol("parallelTraverseThreeScene"),JA=Symbol("correlateOriginalThreeGLTF"),KA=Symbol("correlateCloneThreeGLTF");class $A{constructor(e,t,s,i){this[PA]=e,this[OA]=t,this[HA]=i,this[qA]=s}static from(e,t){return null!=t?this[KA](e,t):this[JA](e)}static[JA](e){const t=e.parser.json,s=e.parser.associations,i=new Map,n={name:"Default"},r={type:"materials",index:-1};for(const e of s.keys())e instanceof ne&&null==s.get(e)&&(r.index<0&&(null==t.materials&&(t.materials=[]),r.index=t.materials.length,t.materials.push(n)),e.name=n.name,s.set(e,{materials:r.index}));for(const[e,n]of s){if(n){const t=e;t.userData=t.userData||{},t.userData.associations=n}for(const s in n)if(null!=s&&"primitives"!==s){const r=s,o=(t[r]||[])[n[r]];if(null==o)continue;let a=i.get(o);null==a&&(a=new Set,i.set(o,a)),a.add(e)}}return new $A(e,t,s,i)}static[KA](e,t){const s=t.threeGLTF,i=t.gltf,n=JSON.parse(JSON.stringify(i)),r=new Map,o=new Map;for(let i=0;i<s.scenes.length;i++)this[VA](s.scenes[i],e.scenes[i],((e,s)=>{const i=t.threeObjectMap.get(e);if(null!=i)for(const e in i)if(null!=e&&"primitives"!==e){const t=e,a=i[t],A=n[t][a],l=r.get(s)||{};l[t]=a,r.set(s,l);const h=o.get(A)||new Set;h.add(s),o.set(A,h)}}));return new $A(e,n,r,o)}static[VA](e,t,s){const i=(e,t)=>{if(s(e,t),e.isObject3D){const n=e,r=t;if(n.material)if(Array.isArray(n.material))for(let e=0;e<n.material.length;++e)s(n.material[e],r.material[e]);else s(n.material,r.material);for(let s=0;s<e.children.length;++s)i(e.children[s],t.children[s])}};i(e,t)}get threeGLTF(){return this[PA]}get gltf(){return this[OA]}get gltfElementMap(){return this[HA]}get threeObjectMap(){return this[qA]}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=Symbol("correlatedSceneGraph");class zA extends UA{static[FA](e){const t=super[FA](e);null==t[YA]&&(t[YA]=$A.from(t));const{scene:s}=t,i=new xe(void 0,1/0);return s.traverse((e=>{e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);const s=e;if(s.material){const{geometry:e}=s;s.castShadow=!0,s.isSkinnedMesh&&(e.boundingSphere=i,e.boundingBox=null);const n=s.material;if(!0===n.isMeshBasicMaterial&&(n.toneMapped=!1),n.shadowSide=Me,n.aoMap){const{gltf:s,threeObjectMap:i}=t[YA],r=i.get(n);if(null!=s.materials&&null!=r&&null!=r.materials){const t=s.materials[r.materials];t.occlusionTexture&&0===t.occlusionTexture.texCoord&&null!=e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv)}}}})),t}get correlatedSceneGraph(){return this[kA][YA]}[_A](){const e=super[_A](),t=new Map;return e.scene.traverse((e=>{const s=e;if(s.material){const e=s.material;if(null!=e){if(t.has(e.uuid))return void(s.material=t.get(e.uuid));s.material=e.clone(),t.set(e.uuid,s.material)}}const i=e;void 0!==i.target&&i.add(i.target)})),e[YA]=$A.from(e,this.correlatedSceneGraph),e}}class jA extends At{constructor(e){super(e),this.type=_}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,s){t=t||1024;let i=e.pos,n=-1,r=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=a.indexOf("\n"))&&r<t&&i<e.byteLength;)o+=a,r+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<n&&(!1!==s&&(e.pos+=r+n+1),o+a.slice(0,n))},i=function(e,t,s,i){const n=e[t+3],r=Math.pow(2,n-128)/255;s[i+0]=e[t+0]*r,s[i+1]=e[t+1]*r,s[i+2]=e[t+2]*r,s[i+3]=1},n=function(e,t,s,i){const n=e[t+3],r=Math.pow(2,n-128)/255;s[i+0]=gt.toHalfFloat(Math.min(e[t+0]*r,65504)),s[i+1]=gt.toHalfFloat(Math.min(e[t+1]*r,65504)),s[i+2]=gt.toHalfFloat(Math.min(e[t+2]*r,65504)),s[i+3]=gt.toHalfFloat(1)},r=new Uint8Array(e);r.pos=0;const o=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let A,l;for((e.pos>=e.byteLength||!(A=s(e)))&&t(1,"no header found"),(l=A.match(/^#\?(\S+)/))||t(3,"bad initial token"),a.valid|=1,a.programtype=l[1],a.string+=A+"\n";A=s(e),!1!==A;)if(a.string+=A+"\n","#"!==A.charAt(0)){if((l=A.match(i))&&(a.gamma=parseFloat(l[1])),(l=A.match(n))&&(a.exposure=parseFloat(l[1])),(l=A.match(r))&&(a.valid|=2,a.format=l[1]),(l=A.match(o))&&(a.valid|=4,a.height=parseInt(l[1],10),a.width=parseInt(l[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=A+"\n";return 2&a.valid||t(3,"missing format specifier"),4&a.valid||t(3,"missing image size specifier"),a}(r),a=o.width,A=o.height,l=function(e,s,i){const n=s;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const r=new Uint8Array(4*s*i);r.length||t(4,"unable to allocate buffer space");let o=0,a=0;const A=4*n,l=new Uint8Array(4),h=new Uint8Array(A);let c=i;for(;c>0&&a<e.byteLength;){a+4>e.byteLength&&t(1),l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],l[3]=e[a++],2==l[0]&&2==l[1]&&(l[2]<<8|l[3])==n||t(3,"bad rgbe scanline format");let s,i=0;for(;i<A&&a<e.byteLength;){s=e[a++];const n=s>128;if(n&&(s-=128),(0===s||i+s>A)&&t(3,"bad scanline data"),n){const t=e[a++];for(let e=0;e<s;e++)h[i++]=t}else h.set(e.subarray(a,a+s),i),i+=s,a+=s}const u=n;for(let e=0;e<u;e++){let t=0;r[o]=h[e+t],t+=n,r[o+1]=h[e+t],t+=n,r[o+2]=h[e+t],t+=n,r[o+3]=h[e+t],o+=4}c--}return r}(r.subarray(r.pos),a,A);let h,c,u;switch(this.type){case k:u=l.length/4;const e=new Float32Array(4*u);for(let t=0;t<u;t++)i(l,4*t,e,4*t);h=e,c=k;break;case _:u=l.length/4;const t=new Uint16Array(4*u);for(let e=0;e<u;e++)n(l,4*e,t,4*e);h=t,c=_;break;default:throw new Error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:a,height:A,data:h,header:o.string,gamma:o.gamma,exposure:o.exposure,type:c}}setDataType(e){return this.type=e,this}load(e,t,s,i){return super.load(e,(function(e,s){switch(e.type){case k:case _:e.colorSpace=b,e.minFilter=L,e.magFilter=L,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,s)}),s,i)}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA extends _e{constructor(){super(),this.position.y=-3.5;const e=new ke;e.deleteAttribute("uv");const t=new oe({metalness:0,side:Ge}),s=new oe({metalness:0}),i=new $(16777215,500,28,2);i.position.set(.418,16.199,.3),this.add(i);const n=new he(e,t);n.position.set(-.757,13.219,.717),n.scale.set(31.713,28.305,28.591),this.add(n);const r=new he(e,s);r.position.set(-10.906,2.009,1.846),r.rotation.set(0,-.195,0),r.scale.set(2.328,7.905,4.651),this.add(r);const o=new he(e,s);o.position.set(-5.607,-.754,-.758),o.rotation.set(0,.994,0),o.scale.set(1.97,1.534,3.955),this.add(o);const a=new he(e,s);a.position.set(6.167,.857,7.803),a.rotation.set(0,.561,0),a.scale.set(3.927,6.285,3.687),this.add(a);const A=new he(e,s);A.position.set(-2.017,.018,6.124),A.rotation.set(0,.333,0),A.scale.set(2.002,4.566,2.064),this.add(A);const l=new he(e,s);l.position.set(2.291,-.756,-2.621),l.rotation.set(0,-.286,0),l.scale.set(1.546,1.552,1.496),this.add(l);const h=new he(e,s);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const c=new he(e,this.createAreaLightMaterial(50));c.position.set(-16.116,14.37,8.208),c.scale.set(.1,2.428,2.739),this.add(c);const u=new he(e,this.createAreaLightMaterial(50));u.position.set(-16.109,18.021,-8.207),u.scale.set(.1,2.425,2.751),this.add(u);const g=new he(e,this.createAreaLightMaterial(17));g.position.set(14.904,12.198,-1.832),g.scale.set(.15,4.265,6.331),this.add(g);const d=new he(e,this.createAreaLightMaterial(43));d.position.set(-.462,8.89,14.52),d.scale.set(4.38,5.441,.088),this.add(d);const p=new he(e,this.createAreaLightMaterial(20));p.position.set(3.235,11.486,-12.541),p.scale.set(2.5,2,.1),this.add(p);const m=new he(e,this.createAreaLightMaterial(100));m.position.set(0,20,0),m.scale.set(1,.1,1),this.add(m)}createAreaLightMaterial(e){const t=new f;return t.color.setScalar(e),t}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA extends _e{constructor(){super(),this.position.y=-3.5;const e=new ke;e.deleteAttribute("uv");const t=new oe({metalness:0,side:Ge}),s=new oe({metalness:0}),i=new $(16777215,400,28,2);i.position.set(.5,14,.5),this.add(i);const n=new he(e,t);n.position.set(0,13.2,0),n.scale.set(31.5,28.5,31.5),this.add(n);const r=new he(e,s);r.position.set(-10.906,-1,1.846),r.rotation.set(0,-.195,0),r.scale.set(2.328,7.905,4.651),this.add(r);const o=new he(e,s);o.position.set(-5.607,-.754,-.758),o.rotation.set(0,.994,0),o.scale.set(1.97,1.534,3.955),this.add(o);const a=new he(e,s);a.position.set(6.167,-.16,7.803),a.rotation.set(0,.561,0),a.scale.set(3.927,6.285,3.687),this.add(a);const A=new he(e,s);A.position.set(-2.017,.018,6.124),A.rotation.set(0,.333,0),A.scale.set(2.002,4.566,2.064),this.add(A);const l=new he(e,s);l.position.set(2.291,-.756,-2.621),l.rotation.set(0,-.286,0),l.scale.set(1.546,1.552,1.496),this.add(l);const h=new he(e,s);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const c=new he(e,this.createAreaLightMaterial(80));c.position.set(-14,10,8),c.scale.set(.1,2.5,2.5),this.add(c);const u=new he(e,this.createAreaLightMaterial(80));u.position.set(-14,14,-4),u.scale.set(.1,2.5,2.5),this.add(u);const g=new he(e,this.createAreaLightMaterial(23));g.position.set(14,12,0),g.scale.set(.1,5,5),this.add(g);const d=new he(e,this.createAreaLightMaterial(16));d.position.set(0,9,14),d.scale.set(5,5,.1),this.add(d);const p=new he(e,this.createAreaLightMaterial(80));p.position.set(7,8,-14),p.scale.set(2.5,2.5,.1),this.add(p);const m=new he(e,this.createAreaLightMaterial(80));m.position.set(-7,16,-14),m.scale.set(2.5,2.5,.1),this.add(m);const I=new he(e,this.createAreaLightMaterial(1));I.position.set(0,20,0),I.scale.set(.1,.1,.1),this.add(I)}createAreaLightMaterial(e){const t=new f;return t.color.setScalar(e),t}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA=20,el=/\.hdr(\.js)?$/;class tl extends H{constructor(e){super(),this.threeRenderer=e,this.lottieLoaderUrl="",this.withCredentials=!1,this._ldrLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}get ldrLoader(){return null==this._ldrLoader&&(this._ldrLoader=new X),this._ldrLoader.setWithCredentials(this.withCredentials),this._ldrLoader}get hdrLoader(){return null==this._hdrLoader&&(this._hdrLoader=new jA,this._hdrLoader.setDataType(_)),this._hdrLoader.setWithCredentials(this.withCredentials),this._hdrLoader}async getLottieLoader(){if(null==this._lottieLoader){const{LottieLoader:e}=await import(this.lottieLoaderUrl);this._lottieLoader=new e}return this._lottieLoader.setWithCredentials(this.withCredentials),this._lottieLoader}async loadImage(e){const t=await new Promise(((t,s)=>this.ldrLoader.load(e,t,(()=>{}),s)));return t.name=e,t.flipY=!1,t}async loadLottie(e,t){const s=await this.getLottieLoader();s.setQuality(t);const i=await new Promise(((t,i)=>s.load(e,t,(()=>{}),i)));return i.name=e,i}async loadEquirect(e,t=(()=>{})){try{const s=el.test(e),i=s?this.hdrLoader:this.ldrLoader,n=await new Promise(((s,n)=>i.load(e,s,(e=>{t(e.loaded/e.total*.9)}),n)));return t(1),n.name=e,n.mapping=Re,s||(n.encoding=De),n}finally{t&&t(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,s=(()=>{})){const i="legacy"!==t;"legacy"!==t&&"neutral"!==t||(t=null),t=Ws(t);let n,r=Promise.resolve(null);e&&(r=this.loadEquirectFromUrl(e,s)),n=t?this.loadEquirectFromUrl(t,s):e?this.loadEquirectFromUrl(e,s):i?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,a]=await Promise.all([n,r]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:a}}async loadEquirectFromUrl(e,t){if(!this.skyboxCache.has(e)){const s=this.loadEquirect(e,t);this.skyboxCache.set(e,s)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,t){await((e=0)=>new Promise((t=>setTimeout(t,e))))();const s=this.threeRenderer,n=new Te(256,{generateMipmaps:!1,type:_,format:i,colorSpace:b,depthBuffer:!0}),r=new Le(.1,100,n),o=r.renderTarget.texture;o.name=t;const a=s.outputColorSpace,A=s.toneMapping;return s.toneMapping=Fe,s.outputColorSpace=b,r.update(s,e),this.blurCubemap(n,.04),s.toneMapping=A,s.outputColorSpace=a,o}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new WA,"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new XA,"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,t){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(ZA);const e=new ke,t=new he(e,this.blurMaterial);this.blurScene=new _e,this.blurScene.add(t)}const s=e.clone();this.halfblur(e,s,t,"latitudinal"),this.halfblur(s,e,t,"longitudinal")}halfblur(e,t,s,i){const n=e.width,r=isFinite(s)?Math.PI/(2*n):2*Math.PI/39,o=s/r,a=isFinite(s)?1+Math.floor(3*o):ZA;a>ZA&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${a} samples when the maximum is set to 20`);const A=[];let l=0;for(let e=0;e<ZA;++e){const t=e/o,s=Math.exp(-t*t/2);A.push(s),0==e?l+=s:e<a&&(l+=2*s)}for(let e=0;e<A.length;e++)A[e]=A[e]/l;const h=this.blurMaterial.uniforms;h.envMap.value=e.texture,h.samples.value=a,h.weights.value=A,h.latitudinal.value="latitudinal"===i,h.dTheta.value=r;new Le(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),s=new d(0,1,0);return new Ue({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:s}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:Ne,depthTest:!1,depthWrite:!1,side:Ge})}async dispose(){for(const[,e]of this.skyboxCache){(await e).dispose()}null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl=[1,.79,.62,.5,.4,.31,.25],il="high-performance";class nl extends H{constructor(e){super(),this.loader=new sr(zA),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;null===(e=this.textureUtils)||void 0===e||e.dispose(),this.textureUtils=new tl(this.threeRenderer);for(const e of this.scenes)e.element[ai]()},this.dpr=si(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new q({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=V}catch(e){console.warn(e)}this.arRenderer=new RA(this),this.textureUtils=this.canRender?new tl(this.threeRenderer):null,sr.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new nl({powerPreference:(self.ModelViewerElement||{}).powerPreference||il,debug:ii()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return sl[this.scaleStep]}set minScale(e){let t=1;for(;t<sl.length&&!(sl[t]<e);)++t;this.lastStep=t-1}registerScene(e){this.scenes.add(e),e.forceRescale();const t=new m;this.threeRenderer.getSize(t),e.canvas.width=t.x,e.canvas.height=t.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((e,t)=>this.render(e,t)))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return this.multipleScenesVisible?e.element[Hc]:this.canvas3D}countVisibleScenes(){const{canvas3D:e}=this;let t=0,s=null;for(const i of this.scenes){const{element:n}=i;n.modelIsVisible&&null==i.externalRenderer&&++t,e.parentElement===i.canvas.parentElement&&(s=i)}const i=t>1;if(null!=s){const t=i&&!this.multipleScenesVisible,n=!s.element.modelIsVisible;if(t||n){const{width:t,height:i}=this.sceneSize(s);this.copyPixels(s,t,i),e.parentElement.removeChild(e)}}this.multipleScenesVisible=i}updateRendererSize(){var e;const t=si();if(t!==this.dpr)for(const e of this.scenes){const{element:t}=e;t[Mc](t.getBoundingClientRect())}let s=0,i=0;for(const e of this.scenes)s=Math.max(s,e.width),i=Math.max(i,e.height);if(s!==this.width||i!==this.height||t!==this.dpr){this.width=s,this.height=i,this.dpr=t,s=Math.ceil(s*t),i=Math.ceil(i*t),this.canRender&&this.threeRenderer.setSize(s,i,!1);for(const t of this.scenes){const{canvas:n}=t;n.width=s,n.height=i,t.forceRescale(),null===(e=t.effectRenderer)||void 0===e||e.setSize(s,i)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=ti(.2*(e-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else{if(0==e.scaleStep)return!1;e.scaleStep=0,this.rescaleCanvas(e)}return!0}rescaleCanvas(e){const t=sl[e.scaleStep],s=Math.ceil(this.width/t),i=Math.ceil(this.height/t),{style:n}=e.canvas;n.width=`${s}px`,n.height=`${i}px`,this.canvas3D.style.width=`${s}px`,this.canvas3D.style.height=`${i}px`;const r=this.dpr*t,o=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:r,minimumDpr:this.dpr*sl[this.lastStep],pixelWidth:Math.ceil(e.width*r),pixelHeight:Math.ceil(e.height*r),reason:o}}))}sceneSize(e){const{dpr:t}=this,s=sl[e.scaleStep];return{width:Math.min(Math.ceil(e.width*s*t),this.canvas3D.width),height:Math.min(Math.ceil(e.height*s*t),this.canvas3D.height)}}copyPixels(e,t,s){const i=e.context;null!=i?(i.clearRect(0,0,t,s),i.drawImage(this.canvas3D,0,0,t,s,0,0,t,s),e.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const s of this.scenes)s.element.modelIsVisible===t&&e.push(s);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,s){const{element:i,exposure:n}=e;i[Jc](t,s);const r="number"==typeof n&&!Number.isNaN(n);this.threeRenderer.toneMappingExposure=r?n:1}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const s=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(s),this.renderedLastFrame=!1);const{canvas3D:i}=this;for(const t of this.orderedScenes()){const{element:n}=t;if(!n.loaded||!n.modelIsVisible&&t.renderCount>0)continue;if(this.preRender(t,e,s),!this.shouldRender(t))continue;if(null!=t.externalRenderer){const e=t.getCamera();e.updateMatrix();const{matrix:s,projectionMatrix:i}=e,n=s.elements.slice(),r=t.getTarget();n[12]+=r.x,n[13]+=r.y,n[14]+=r.z,t.externalRenderer.render({viewMatrix:n,projectionMatrix:i.elements});continue}if(!n.modelIsVisible&&!this.multipleScenesVisible)for(const e of this.scenes)e.element.modelIsVisible&&e.queueRender();const{width:r,height:o}=this.sceneSize(t);t.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-o,r,o),null!=t.effectRenderer?t.effectRenderer.render(s):(this.threeRenderer.autoClear=!0,this.threeRenderer.render(t,t.camera)),this.multipleScenesVisible||!t.element.modelIsVisible&&0===t.renderCount?this.copyPixels(t,r,o):i.parentElement!==t.canvas.parentElement&&(t.canvas.parentElement.appendChild(i),t.canvas.classList.remove("show")),t.hasRendered(),++t.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}nl._singleton=new nl({powerPreference:(self.ModelViewerElement||{}).powerPreference||il,debug:ii()});
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const rl=Symbol("correlatedObjects"),ol=Symbol("onUpdate");class al{constructor(e,t=null){this[ol]=e,this[rl]=t}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Al=new f,ll=new C(2,2);let hl=0;const cl=Symbol("threeTexture"),ul=Symbol("threeTextures");class gl extends al{get[cl](){var e;return null===(e=this[rl])||void 0===e?void 0:e.values().next().value}get[ul](){return this[rl]}constructor(e,t){super(e,new Set(t?[t]:[])),this[cl].image.src||(this[cl].image.src="adhoc_image"+hl++),this[cl].image.name||(this[cl].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[cl].image.name||""}get uri(){return this[cl].image.src}get bufferView(){return this[cl].image.bufferView}get element(){const e=this[cl];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[cl];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return null!=this.uri?"external":"embedded"}set name(e){for(const t of this[ul])t.image.name=e}update(){const e=this[cl];e&&e.isCanvasTexture&&!e.animation&&(this[cl].needsUpdate=!0,this[ol]())}async createThumbnail(e,t){const s=new _e;Al.map=this[cl];const i=new he(ll,Al);s.add(i);const n=new Ie(-1,1,1,-1,0,1),{threeRenderer:r}=nl.singleton,o=new ht(e,t);r.setRenderTarget(o),r.render(s,n),r.setRenderTarget(null);const a=new Uint8Array(e*t*4);r.readRenderTargetPixels(o,0,0,e,t,a),Cc.width=e,Cc.height=t;const A=Cc.getContext("2d"),l=A.createImageData(e,t);return l.data.set(a),A.putImageData(l,0,0),new Promise((async(e,t)=>{Cc.toBlob((s=>{if(!s)return t("Failed to capture thumbnail.");e(URL.createObjectURL(s))}),"image/png")}))}}var dl,pl;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(dl||(dl={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(pl||(pl={}));
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ml=(()=>{const e=[dl.Nearest,dl.Linear,dl.NearestMipmapNearest,dl.LinearMipmapLinear,dl.NearestMipmapLinear,dl.LinearMipmapLinear];return t=>e.indexOf(t)>-1})(),Il=(()=>{const e=[dl.Nearest,dl.Linear];return t=>e.indexOf(t)>-1})(),fl=(()=>{const e=[pl.ClampToEdge,pl.MirroredRepeat,pl.Repeat];return t=>e.indexOf(t)>-1})(),Cl=Symbol("threeTexture"),El=Symbol("threeTextures"),Bl=Symbol("setProperty");class yl extends al{get[Cl](){var e;return null===(e=this[rl])||void 0===e?void 0:e.values().next().value}get[El](){return this[rl]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[Cl].name||""}get minFilter(){return this[Cl].minFilter}get magFilter(){return this[Cl].magFilter}get wrapS(){return this[Cl].wrapS}get wrapT(){return this[Cl].wrapT}get rotation(){return this[Cl].rotation}get scale(){return eu(this[Cl].repeat)}get offset(){return eu(this[Cl].offset)}setMinFilter(e){this[Bl]("minFilter",e)}setMagFilter(e){this[Bl]("magFilter",e)}setWrapS(e){this[Bl]("wrapS",e)}setWrapT(e){this[Bl]("wrapT",e)}setRotation(e){null==e&&(e=0),this[Bl]("rotation",e)}setScale(e){null==e&&(e={u:1,v:1}),this[Bl]("repeat",new m(e.u,e.v))}setOffset(e){null==e&&(e={u:0,v:0}),this[Bl]("offset",new m(e.u,e.v))}[Bl](e,t){if(((e,t)=>{switch(e){case"minFilter":return ml(t);case"magFilter":return Il(t);case"wrapS":case"wrapT":return fl(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${e}" on Sampler`)}})(e,t))for(const s of this[El])s[e]=t,s.needsUpdate=!0;this[ol]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl=Symbol("image"),Ql=Symbol("sampler"),vl=Symbol("threeTexture");class bl extends al{constructor(e,t){super(e,new Set(t?[t]:[])),this[Ql]=new yl(e,t),this[wl]=new gl(e,t)}get[vl](){var e;return null===(e=this[rl])||void 0===e?void 0:e.values().next().value}get name(){return this[vl].name||""}set name(e){for(const t of this[rl])t.name=e}get sampler(){return this[Ql]}get source(){return this[wl]}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sl,xl,Ml;const Rl=Symbol("texture"),Dl=Symbol("transform"),Tl=Symbol("materials"),Ll=Symbol("usage"),Fl=Symbol("onUpdate"),kl=Symbol("activeVideo");var _l;!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive",e[e.Clearcoat=5]="Clearcoat",e[e.ClearcoatRoughness=6]="ClearcoatRoughness",e[e.ClearcoatNormal=7]="ClearcoatNormal",e[e.SheenColor=8]="SheenColor",e[e.SheenRoughness=9]="SheenRoughness",e[e.Transmission=10]="Transmission",e[e.Thickness=11]="Thickness",e[e.Specular=12]="Specular",e[e.SpecularColor=13]="SpecularColor",e[e.Iridescence=14]="Iridescence",e[e.IridescenceThickness=15]="IridescenceThickness",e[e.Anisotropy=16]="Anisotropy"}(_l||(_l={}));class Ul{constructor(e,t,s,i){this[Sl]=null,this[xl]={rotation:0,scale:new m(1,1),offset:new m(0,0)},this[Ml]=!1,s&&(this[Dl].rotation=s.rotation,this[Dl].scale.copy(s.repeat),this[Dl].offset.copy(s.offset),this[Rl]=new bl(e,s)),this[Fl]=e,this[Tl]=i,this[Ll]=t}get texture(){return this[Rl]}setTexture(e){var t,s;const i=null!=e?e.source[cl]:null,n=null===(t=this[Rl])||void 0===t?void 0:t.source[cl];if(null!=n&&n.isVideoTexture?this[kl]=!1:(null===(s=this[Rl])||void 0===s?void 0:s.source.animation)&&this[Rl].source.animation.removeEventListener("enterFrame",this[Fl]),this[Rl]=e,null!=i&&i.isVideoTexture){const e=i.image;if(this[kl]=!0,null!=e.requestVideoFrameCallback){const t=()=>{this[kl]&&(this[Fl](),e.requestVideoFrameCallback(t))};e.requestVideoFrameCallback(t)}else{const e=()=>{this[kl]&&(this[Fl](),requestAnimationFrame(e))};requestAnimationFrame(e)}}else null!=(null==e?void 0:e.source.animation)&&e.source.animation.addEventListener("enterFrame",this[Fl]);let r=v;if(this[Tl])for(const e of this[Tl]){switch(this[Ll]){case _l.Base:e.map=i;break;case _l.MetallicRoughness:r=b,e.metalnessMap=i,e.roughnessMap=i;break;case _l.Normal:r=b,e.normalMap=i;break;case _l.Occlusion:r=b,e.aoMap=i;break;case _l.Emissive:e.emissiveMap=i;break;case _l.Clearcoat:e.clearcoatMap=i;break;case _l.ClearcoatRoughness:e.clearcoatRoughnessMap=i;break;case _l.ClearcoatNormal:e.clearcoatNormalMap=i;break;case _l.SheenColor:e.sheenColorMap=i;break;case _l.SheenRoughness:e.sheenRoughnessMap=i;break;case _l.Transmission:e.transmissionMap=i;break;case _l.Thickness:e.thicknessMap=i;break;case _l.Specular:e.specularIntensityMap=i;break;case _l.SpecularColor:e.specularColorMap=i;break;case _l.Iridescence:e.iridescenceMap=i;break;case _l.IridescenceThickness:e.iridescenceThicknessMap=i;break;case _l.Anisotropy:e.anisotropyMap=i}e.needsUpdate=!0}i&&(i.colorSpace=r,i.rotation=this[Dl].rotation,i.repeat=this[Dl].scale,i.offset=this[Dl].offset),this[Fl]()}}Sl=Rl,xl=Dl,Ml=kl;
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Nl=Symbol("threeMaterial"),Gl=Symbol("threeMaterials"),Pl=Symbol("baseColorTexture"),Ol=Symbol("metallicRoughnessTexture");class Hl extends al{constructor(e,t){super(e,t);const{map:s,metalnessMap:i}=t.values().next().value;this[Pl]=new Ul(e,_l.Base,s,t),this[Ol]=new Ul(e,_l.MetallicRoughness,i,t)}get[Gl](){return this[rl]}get[Nl](){var e;return null===(e=this[rl])||void 0===e?void 0:e.values().next().value}get baseColorFactor(){const e=[0,0,0,this[Nl].opacity];return this[Nl].color.toArray(e),e}get metallicFactor(){return this[Nl].metalness}get roughnessFactor(){return this[Nl].roughness}get baseColorTexture(){return this[Pl]}get metallicRoughnessTexture(){return this[Ol]}setBaseColorFactor(e){const t=new p;e instanceof Array?t.fromArray(e):t.set(e);for(const s of this[Gl])s.color.set(t),e instanceof Array?s.opacity=e[3]:(e=[0,0,0,s.opacity],t.toArray(e));this[ol]()}setMetallicFactor(e){for(const t of this[Gl])t.metalness=e;this[ol]()}setRoughnessFactor(e){for(const t of this[Gl])t.roughness=e;this[ol]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ql,Vl;const Jl=Symbol("pbrMetallicRoughness"),Kl=Symbol("normalTexture"),$l=Symbol("occlusionTexture"),Yl=Symbol("emissiveTexture"),zl=Symbol("backingThreeMaterial"),jl=Symbol("applyAlphaCutoff"),Wl=Symbol("getAlphaMode"),Xl=Symbol("lazyLoadGLTFInfo"),Zl=Symbol("initialize"),eh=Symbol("getLoadedMaterial"),th=Symbol("ensureMaterialIsLoaded"),sh=Symbol("gltfIndex"),ih=Symbol("setActive"),nh=Symbol("variantIndices"),rh=Symbol("isActive"),oh=Symbol("variantSet"),ah=Symbol("modelVariants"),Ah=Symbol("name"),lh=Symbol("pbrTextures");class hh extends al{constructor(e,t,s,i,n,r,o=void 0){super(e,n),this[ql]=new Set,this[Vl]=new Map,this[sh]=t,this[rh]=s,this[ah]=i,this[Ah]=r,null==o?this[Zl]():this[Xl]=o}get[(ql=oh,Vl=lh,zl)](){return this[rl].values().next().value}[Zl](){const e=this[ol],t=this[rl];this[Jl]=new Hl(e,t);const{normalMap:s,aoMap:i,emissiveMap:n}=t.values().next().value;this[Kl]=new Ul(e,_l.Normal,s,t),this[$l]=new Ul(e,_l.Occlusion,i,t),this[Yl]=new Ul(e,_l.Emissive,n,t);const r=s=>{this[lh].set(s,new Ul(e,s,null,t))};r(_l.Clearcoat),r(_l.ClearcoatRoughness),r(_l.ClearcoatNormal),r(_l.SheenColor),r(_l.SheenRoughness),r(_l.Transmission),r(_l.Thickness),r(_l.Specular),r(_l.SpecularColor),r(_l.Iridescence),r(_l.IridescenceThickness),r(_l.Anisotropy)}async[eh](){if(null!=this[Xl]){const{set:e,material:t}=await this[Xl].doLazyLoad();return this[rl]=e,this[Zl](),this[Xl]=void 0,this.ensureLoaded=async()=>{},t}return this[rl].values().next().value}colorFromRgb(e){const t=new p;return e instanceof Array?t.fromArray(e):t.set(e),t}[th](){if(null!=this[Xl])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[eh]()}get isLoaded(){return null==this[Xl]}get isActive(){return this[rh]}[ih](e){this[rh]=e}get name(){return this[Ah]||""}set name(e){if(this[Ah]=e,null!=this[rl])for(const t of this[rl])t.name=e}get pbrMetallicRoughness(){return this[th](),this[Jl]}get normalTexture(){return this[th](),this[Kl]}get occlusionTexture(){return this[th](),this[$l]}get emissiveTexture(){return this[th](),this[Yl]}get emissiveFactor(){return this[th](),this[zl].emissive.toArray()}get index(){return this[sh]}[nh](){return this[oh]}hasVariant(e){const t=this[ah].get(e);return null!=t&&this[oh].has(t.index)}setEmissiveFactor(e){this[th]();const t=this.colorFromRgb(e);for(const e of this[rl])e.emissive.set(t);this[ol]()}[Wl](){return this[zl].transparent?"BLEND":this[zl].alphaTest>0?"MASK":"OPAQUE"}[jl](){this[th]();for(const e of this[rl])"MASK"===this[Wl]()?null==e.alphaTest&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[th]();for(const t of this[rl])t.alphaTest=e,t.needsUpdate=!0;this[jl](),this[ol]()}getAlphaCutoff(){return this[th](),this[zl].alphaTest}setDoubleSided(e){this[th]();for(const t of this[rl])t.side=e?ae:Me,t.needsUpdate=!0;this[ol]()}getDoubleSided(){return this[th](),this[zl].side==ae}setAlphaMode(e){this[th]();const t=(e,t)=>{e.transparent=t,e.depthWrite=!t};for(const s of this[rl])t(s,"BLEND"===e),s.alphaTest="MASK"===e?.5:void 0,s.needsUpdate=!0;this[ol]()}getAlphaMode(){return this[th](),this[Wl]()}get emissiveStrength(){return this[th](),this[zl].emissiveIntensity}setEmissiveStrength(e){this[th]();for(const t of this[rl])t.emissiveIntensity=e;this[ol]()}get clearcoatFactor(){return this[th](),this[zl].clearcoat}get clearcoatRoughnessFactor(){return this[th](),this[zl].clearcoatRoughness}get clearcoatTexture(){return this[th](),this[lh].get(_l.Clearcoat)}get clearcoatRoughnessTexture(){return this[th](),this[lh].get(_l.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[th](),this[lh].get(_l.ClearcoatNormal)}get clearcoatNormalScale(){return this[th](),this[zl].clearcoatNormalScale.x}setClearcoatFactor(e){this[th]();for(const t of this[rl])t.clearcoat=e;this[ol]()}setClearcoatRoughnessFactor(e){this[th]();for(const t of this[rl])t.clearcoatRoughness=e;this[ol]()}setClearcoatNormalScale(e){this[th]();for(const t of this[rl])t.clearcoatNormalScale=new m(e,e);this[ol]()}get ior(){return this[th](),this[zl].ior}setIor(e){this[th]();for(const t of this[rl])t.ior=e;this[ol]()}get sheenColorFactor(){return this[th](),this[zl].sheenColor.toArray()}get sheenColorTexture(){return this[th](),this[lh].get(_l.SheenColor)}get sheenRoughnessFactor(){return this[th](),this[zl].sheenRoughness}get sheenRoughnessTexture(){return this[th](),this[lh].get(_l.SheenRoughness)}setSheenColorFactor(e){this[th]();const t=this.colorFromRgb(e);for(const e of this[rl])e.sheenColor.set(t),e.sheen=1;this[ol]()}setSheenRoughnessFactor(e){this[th]();for(const t of this[rl])t.sheenRoughness=e,t.sheen=1;this[ol]()}get transmissionFactor(){return this[th](),this[zl].transmission}get transmissionTexture(){return this[th](),this[lh].get(_l.Transmission)}setTransmissionFactor(e){this[th]();for(const t of this[rl])t.transmission=e;this[ol]()}get thicknessFactor(){return this[th](),this[zl].thickness}get thicknessTexture(){return this[th](),this[lh].get(_l.Thickness)}get attenuationDistance(){return this[th](),this[zl].attenuationDistance}get attenuationColor(){return this[th](),this[zl].attenuationColor.toArray()}setThicknessFactor(e){this[th]();for(const t of this[rl])t.thickness=e;this[ol]()}setAttenuationDistance(e){this[th]();for(const t of this[rl])t.attenuationDistance=e;this[ol]()}setAttenuationColor(e){this[th]();const t=this.colorFromRgb(e);for(const e of this[rl])e.attenuationColor.set(t);this[ol]()}get specularFactor(){return this[th](),this[zl].specularIntensity}get specularTexture(){return this[th](),this[lh].get(_l.Specular)}get specularColorFactor(){return this[th](),this[zl].specularColor.toArray()}get specularColorTexture(){return this[th](),this[lh].get(_l.SheenColor)}setSpecularFactor(e){this[th]();for(const t of this[rl])t.specularIntensity=e;this[ol]()}setSpecularColorFactor(e){this[th]();const t=this.colorFromRgb(e);for(const e of this[rl])e.specularColor.set(t);this[ol]()}get iridescenceFactor(){return this[th](),this[zl].iridescence}get iridescenceTexture(){return this[th](),this[lh].get(_l.Iridescence)}get iridescenceIor(){return this[th](),this[zl].iridescenceIOR}get iridescenceThicknessMinimum(){return this[th](),this[zl].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[th](),this[zl].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[th](),this[lh].get(_l.IridescenceThickness)}setIridescenceFactor(e){this[th]();for(const t of this[rl])t.iridescence=e;this[ol]()}setIridescenceIor(e){this[th]();for(const t of this[rl])t.iridescenceIOR=e;this[ol]()}setIridescenceThicknessMinimum(e){this[th]();for(const t of this[rl])t.iridescenceThicknessRange[0]=e;this[ol]()}setIridescenceThicknessMaximum(e){this[th]();for(const t of this[rl])t.iridescenceThicknessRange[1]=e;this[ol]()}get anisotropyStrength(){return this[th](),this[zl].anisotropy}get anisotropyRotation(){return this[th](),this[zl].anisotropyRotation}get anisotropyTexture(){return this[th](),this[lh].get(_l.Anisotropy)}setAnisotropyStrength(e){this[th]();for(const t of this[rl])t.anisotropy=e;this[ol]()}setAnisotropyRotation(e){this[th]();for(const t of this[rl])t.anisotropyRotation=e;this[ol]()}}class ch{constructor(e){this.name="",this.children=new Array,this.name=e}}class uh extends ch{constructor(e,t,s,i){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:n,threeGLTF:r,threeObjectMap:o}=i;this.parser=r.parser,this.modelVariants=s,this.mesh.userData.variantData=s;const a=o.get(e.material);null!=a.materials?this.initialMaterialIdx=this.activeMaterialIdx=a.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const A=e.userData.associations||{};if(null==A.meshes)return void console.error("Mesh is missing primitive index association");const l=((n.meshes||[])[A.meshes].primitives||[])[A.primitives];if(null!=l){if(null!=l.material)this.materials.set(l.material,t[l.material]);else{const e=t.findIndex((e=>"Default"===e.name));e>=0?this.materials.set(e,t[e]):console.warn("gltfPrimitive has no material!")}if(l.extensions&&l.extensions.KHR_materials_variants){const e=l.extensions.KHR_materials_variants,i=r.parser.json.extensions.KHR_materials_variants.variants;for(const n of e.mappings){const e=t[n.material];this.materials.set(n.material,e);for(const t of n.variants){const{name:n}=i[t];this.variantToMaterialMap.set(t,e),e[nh]().add(t),s.has(n)||s.set(n,{name:n,index:t})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(e){const t=this.materials.get(e);if(null!=t&&e!==this.activeMaterialIdx){this.mesh.material=await t[eh]();const{normalScale:s}=this.mesh.material;null!=s&&s.y*s.x<0!=(null==this.mesh.geometry.attributes.tangent)&&this.parser.assignFinalMaterial(this.mesh),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(null==e)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(null!=this.variantToMaterialMap&&null!=e){const t=this.variantToMaterialMap.get(e);if(null!=t)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(null!=t.material)continue;const s=await this.enableVariantHelper(e);null!=s&&(t.material=s)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const s=this.modelVariants.get(t).index;return e[nh]().add(s),this.variantToMaterialMap.set(s,e),this.materials.set(e.index,e),this.updateVariantUserData(s,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[nh]().add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map;this.mesh.userData.variantMaterials.set(e,{material:t[rl].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gh,dh,ph,mh,Ih,fh;const Ch=Symbol("materials"),Eh=Symbol("hierarchy"),Bh=Symbol("roots"),yh=Symbol("primitives"),wh=Symbol("prepareVariantsForExport"),Qh=Symbol("switchVariant"),vh=Symbol("materialFromPoint"),bh=Symbol("nodeFromPoint"),Sh=Symbol("nodeFromIndex"),xh=Symbol("variantData"),Mh=Symbol("availableVariants"),Rh=Symbol("modelOnUpdate"),Dh=Symbol("cloneMaterial");class Th{constructor(e,t,s,i){this.gltf=e,this.gltfElementMap=t,this.mapKey=s,this.doLazyLoad=i}}class Lh{constructor(e,t=(()=>{})){this[gh]=new Array,this[dh]=new Array,this[ph]=new Array,this[mh]=new Array,this[Ih]=()=>{},this[fh]=new Map,this[Rh]=t;const{gltf:s,threeGLTF:i,gltfElementMap:n}=e;for(const[e,r]of s.materials.entries()){const o=n.get(r);if(null!=o)this[Ch].push(new hh(t,e,!0,this[xh],o,r.name));else{const a=(s.materials||[])[e],A=e,l=async()=>{const e=await i.parser.getDependency("material",A),t=new Set;return n.set(a,t),t.add(e),{set:t,material:e}};this[Ch].push(new hh(t,e,!1,this[xh],o,r.name,new Th(s,n,a,l)))}}const r=new Map,o=new Array;for(const e of i.scene.children)o.push(e);for(;o.length>0;){const t=o.pop();let s=null;t instanceof he?(s=new uh(t,this.materials,this[xh],e),this[yh].push(s)):s=new ch(t.name);const i=r.get(t);null!=i?i.children.push(s):this[Bh].push(s),this[Eh].push(s);for(const e of t.children)o.push(e),r.set(t,s)}}get materials(){return this[Ch]}[(gh=Ch,dh=Eh,ph=Bh,mh=yh,Ih=Rh,fh=xh,Mh)](){const e=Array.from(this[xh].values());return e.sort(((e,t)=>e.index-t.index)),e.map((e=>e.name))}getMaterialByName(e){const t=this[Ch].filter((t=>t.name===e));return t.length>0?t[0]:null}[Sh](e,t){const s=this[Eh].find((s=>{if(s instanceof uh){const{meshes:i,primitives:n}=s.mesh.userData.associations;if(i==e&&n==t)return!0}return!1}));return null==s?null:s}[bh](e){return this[Eh].find((t=>{if(t instanceof uh){if(t.mesh===e.object)return!0}return!1}))}[vh](e){return this[bh](e).getActiveMaterial()}async[Qh](e){for(const t of this[yh])await t.enableVariant(e);for(const e of this.materials)e[ih](!1);for(const e of this[yh])this.materials[e.getActiveMaterial().index][ih](!0)}async[wh](){const e=new Array;for(const t of this[yh])e.push(t.instantiateVariants());await Promise.all(e)}[Dh](e,t){const s=this.materials[e];s.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const i=s[rl],n=new Set;for(const[e,s]of i.entries()){const r=s.clone();r.name=t+(i.size>1?"_inst"+e:""),n.add(r)}const r=new hh(this[Rh],this[Ch].length,!1,this[xh],n,t);return this[Ch].push(r),r}createMaterialInstanceForVariant(e,t,s,i=!0){let n=null;for(const i of this[yh]){const r=this[xh].get(s);null!=r&&i.variantInfo.has(r.index)||null!=i.getMaterial(e)&&(this.hasVariant(s)||this.createVariant(s),null==n&&(n=this[Dh](e,t)),i.addVariant(n,s))}if(i&&null!=n){n[ih](!0),this.materials[e][ih](!1);for(const e of this[yh])e.enableVariant(s)}return n}createVariant(e){this[xh].has(e)?console.warn(`Variant '${e}'' already exists`):this[xh].set(e,{name:e,index:this[xh].size})}hasVariant(e){return this[xh].has(e)}setMaterialToVariant(e,t){if(null!=this[Mh]().find((e=>e===t)))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const s of this[yh]){const i=s.getMaterial(e);null!=i&&s.addVariant(i,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const s=this[xh].get(e);null!=s&&(s.name=t,this[xh].set(t,s),this[xh].delete(e))}deleteVariant(e){const t=this[xh].get(e);if(null!=t){for(const s of this.materials)s.hasVariant(e)&&s[oh].delete(t.index);for(const e of this[yh])e.deleteVariant(t.index);this[xh].delete(e)}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fh=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const kh=Symbol("currentGLTF"),_h=Symbol("originalGltfJson"),Uh=Symbol("model"),Nh=Symbol("getOnUpdateMethod"),Gh=Symbol("buildTexture"),Ph=new d,Oh=new d,Hh=new d,qh=new E,Vh=new B,Jh=new t;class Kh extends ir{constructor(e){super(document.createElement("div")),this.normal=new d(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=Bo(e)[0].terms;for(let e=0;e<3;++e)this.position.setComponent(e,To(t[e]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=Bo(e)[0].terms;for(let e=0;e<3;++e)this.normal.setComponent(e,t[e].number)}updateSurface(e){if(!e&&this.initialized)return;const{mesh:t,tri:s,bary:i}=this;if(null==t||null==s||null==i)return;t.getVertexPosition(s.x,Ph),t.getVertexPosition(s.y,Oh),t.getVertexPosition(s.z,Hh),Ph.toArray(qh.elements,0),Oh.toArray(qh.elements,3),Hh.toArray(qh.elements,6),this.position.copy(i).applyMatrix3(qh);const n=this.parent;n.worldToLocal(t.localToWorld(this.position)),Vh.set(Ph,Oh,Hh),Vh.getNormal(this.normal).transformDirection(t.matrixWorld);const r=n.parent;Jh.setFromAxisAngle(Ph.set(0,1,0),-r.yaw),this.normal.applyQuaternion(Jh)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const s=t,i=s.dataset.visibilityAttribute;if(null!=i){const t=`data-${i}`;e?s.setAttribute(t,""):s.removeAttribute(t)}s.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))})),this.initialized=!0}}const $h={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},Yh={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};function zh(e,t,s){return(1-s)*e+s*t}
/* @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh extends W{constructor(e,t,s){super(),this.camera=new Ie,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new lt,this.horizontalBlurMaterial=new Ue($h),this.verticalBlurMaterial=new Ue(Yh),this.intensity=0,this.softness=1,this.boundingBox=new He,this.size=new d,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:i}=this;i.rotation.x=Math.PI/2,i.left=-.5,i.right=.5,i.bottom=-.5,i.top=.5,this.add(i);const n=new C,r=new f({opacity:1,transparent:!0,side:Ge});this.floor=new he(n,r),this.floor.userData.shadow=!0,i.add(this.floor),this.blurPlane=new he(n),this.blurPlane.visible=!1,i.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,s)}setScene(e,t,s){const{boundingBox:i,size:n,rotation:r,position:o}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(o),"back"===s){const{min:e,max:t}=i;[e.y,e.z]=[e.z,e.y],[t.y,t.z]=[t.z,t.y],[n.y,n.z]=[n.z,n.y],r.x=Math.PI/2,r.y=Math.PI}else r.x=0,r.y=0;if(this.isAnimated){const e=i.min.y,t=i.max.y;n.y=this.maxDimension,i.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),i.min.y=e,i.max.y=t,n.set(this.maxDimension,t-e,this.maxDimension)}"bottom"===s?o.y=i.min.y:o.z=i.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:s}=this,i=this.isAnimated?2:1,n=i*Math.pow(2,9-3*e);this.setMapSize(n);const r=t.y/2,o=t.y*i;s.near=0,s.far=zh(o,r,e),this.depthMaterial.opacity=1/e,s.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=2);const s=Math.floor(t.x>t.z?e:e*t.x/t.z),n=Math.floor(t.x>t.z?e*t.z/t.x:e),r=10+s,o=10+n;if(null==this.renderTarget||this.renderTarget.width===r&&this.renderTarget.height===o||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const e={format:i};this.renderTarget=new ht(r,o,e),this.renderTargetBlur=new ht(r,o,e),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+10/s),t.z*(1+10/n),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*zh(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const s=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const i=e.xr.enabled;e.xr.enabled=!1;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=i,e.setRenderTarget(n),e.setClearAlpha(s)}blurShadow(e){const{camera:t,horizontalBlurMaterial:s,verticalBlurMaterial:i,renderTarget:n,renderTargetBlur:r,blurPlane:o}=this;o.visible=!0,o.material=s,s.uniforms.h.value=1/this.renderTarget.width,s.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(r),e.render(o,t),o.material=i,i.uniforms.v.value=1/this.renderTarget.height,i.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(n),e.render(o,t),o.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=new d,Xh=new d,Zh=new d,ec=new y,tc=new d,sc=new m;class ic extends _e{constructor({canvas:e,element:t,width:s,height:i}){super(),this.annotationRenderer=new lr,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new I(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new W,this.animationNames=[],this.boundingBox=new He,this.boundingSphere=new xe,this.size=new d,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.canScale=!0,this.isDirty=!1,this.goalTarget=new d,this.targetDamperX=new go,this.targetDamperY=new go,this.targetDamperZ=new go,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new I(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(s,i),this.target.name="Target",this.mixer=new qe(this.target);const{domElement:n}=this.annotationRenderer,{style:r}=n;r.display="none",r.pointerEvents="none",r.position="absolute",r.top="0",this.element.shadowRoot.querySelector(".default").appendChild(n),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e,t=(()=>{})){if(!e||e===this.url)return void t(1);if(this.reset(),this.url=e,null!=this.externalRenderer){const e=await this.externalRenderer.load(t);return this.boundingSphere.radius=e.framedRadius,void(this.idealAspect=e.fieldOfViewAspect)}let s;null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{s=await new Promise((async(s,i)=>{this.cancelPendingSourceChange=()=>i();try{s(await this.element[Yc].loader.load(e,this.element,t))}catch(e){i(e)}}))}catch(e){if(null==e)return;throw e}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=s,null!=s&&(this._model=s.scene,this.target.add(s.scene));const{animations:i}=s,n=new Map,r=[];for(const e of i)n.set(e.name,e),r.push(e.name);this.animations=i,this.animationsByName=n,this.animationNames=r,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity)}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;null!=e&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;null!=t&&(t.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[kh]=null,this.element[_h]=null,this.element[Uh]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const s=si();this.externalRenderer.resize(e*s,t*s)}this.queueRender()}}markBakedShadow(e){e.userData.shadow=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.shadow=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const t=new He;e.traverse((e=>{const s=e;if(!s.material)return;if(!s.material.transparent)return;t.setFromObject(s);const i=t.getSize(tc),n=Math.min(i.x,i.y,i.z);Math.max(i.x,i.y,i.z)<100*n||this.markBakedShadow(s)}))}checkBakedShadows(){const{min:e,max:t}=this.boundingBox,s=new He;this.boundingBox.getSize(this.size);for(const i of this.bakedShadows)s.setFromObject(i),s.min.y<e.y+this.size.y/100&&s.min.x<=e.x&&s.max.x>=t.x&&s.min.z<=e.z&&s.max.z>=t.z||s.min.z<e.z+this.size.z/100&&s.min.x<=e.x&&s.max.x>=t.x&&s.min.y<=e.y&&s.max.y>=t.y||this.unmarkBakedShadow(i)}applyTransform(){const{model:e}=this;if(null==e)return;const t=Bo(this.element.orientation)[0].terms,s=To(t[0]).number,i=To(t[1]).number,n=To(t[2]).number;e.quaternion.setFromEuler(new Se(i,n,s,"YXZ"));const r=Bo(this.element.scale)[0].terms;e.scale.set(r[0].number,r[1].number,r[2].number)}updateBoundingBox(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.findBakedShadows(e);const t=(e,t)=>e.expandByPoint(t);this.setBakedShadowVisibility(!1),this.boundingBox=hr(e,t,new He),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((e=>this.unmarkBakedShadow(e))),this.boundingBox=hr(e,t,new He)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget());this.boundingSphere.radius=Math.sqrt(hr(e,((e,s)=>Math.max(e,t.distanceToSquared(s))),0));this.idealAspect=hr(e,((e,s)=>{s.sub(t);const i=Math.sqrt(s.x*s.x+s.z*s.z);return Math.max(e,i/(this.idealCameraDistance()-Math.abs(s.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)sc.set(e/window.screen.width,t/window.screen.height);else{const s=this.element.getBoundingClientRect();sc.set((e-s.x)/this.width,(t-s.y)/this.height)}return sc.multiplyScalar(2).subScalar(1),sc.y*=-1,sc}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[Yc].arRenderer.presentedScene!==this&&(this.environment=e,this.background=t,this.queueRender())}setTarget(e,t,s){this.goalTarget.set(-e,-t,-s)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,s=this.target.position;if(t.equals(s))return!1;{const i=this.boundingSphere.radius/10;let{x:n,y:r,z:o}=s;return n=this.targetDamperX.update(n,t.x,e,i),r=this.targetDamperY.update(r,t.y,e,i),o=this.targetDamperZ.update(o,t.z,e,i),this.target.position.set(n,r,o),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:s,z:i}=this.position;this.yaw=Math.atan2(e-s,t-i)}get model(){return this._model}set yaw(e){this.rotation.y=e,this.queueRender()}get yaw(){return this.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===Ve&&1==(1&e)?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(e=null,t=0,s=Je,i=1/0){if(null==this._currentGLTF)return;const{animations:n}=this;if(null==n||0===n.length)return;let r=null;if(null!=e&&(r=this.animationsByName.get(e),null==r)){const t=parseInt(e);!isNaN(t)&&t>=0&&t<n.length&&(r=n[t])}null==r&&(r=n[0]);try{const{currentAnimationAction:e}=this,n=this.mixer.clipAction(r,this);this.currentAnimationAction=n,this.element.paused?this.mixer.stopAllAction():(n.paused=!1,null!=e&&n!==e?n.crossFadeFrom(e,t,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),n.setLoop(s,i),n.enabled=!0,n.clampWhenFinished=!0,n.play()}catch(e){console.error(e)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(null!=e){const t="wall"===this.element.arPlacement?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(e<=0&&null==this.shadow))){if(null==this.shadow){const e="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new jh(this,this.shadowSoftness,e)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}hitFromPoint(e,t=this){ec.setFromCamera(e,this.getCamera());return ec.intersectObject(t,!0).find((e=>e.object.visible&&!e.object.userData.shadow))}positionAndNormalFromPoint(e,t=this){var s;const i=this.hitFromPoint(e,t);if(null==i)return null;return{position:i.point,normal:null!=i.face?i.face.normal.clone().applyNormalMatrix((new E).getNormalMatrix(i.object.matrixWorld)):ec.ray.direction.clone().multiplyScalar(-1),uv:null!==(s=i.uv)&&void 0!==s?s:null}}surfaceFromPoint(e,t=this){const s=this.element.model;if(null==s)return null;const i=this.hitFromPoint(e,t);if(null==i||null==i.face)return null;const n=s[bh](i),{meshes:r,primitives:o}=n.mesh.userData.associations,a=new d,A=new d,l=new d,{a:h,b:c,c:u}=i.face,g=i.object;g.getVertexPosition(h,a),g.getVertexPosition(c,A),g.getVertexPosition(u,l);const p=new B(a,A,l),m=new d;return p.getBarycoord(g.worldToLocal(i.point),m),`${r} ${o} ${h} ${c} ${u} ${m.x.toFixed(3)} ${m.y.toFixed(3)} ${m.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let s=0,i=t.length;s<i;s++){const i=t[s];i instanceof Kh&&e(i)}}initializeSurface(e){if(null!=e.surface&&null==e.mesh){const t=Bo(e.surface)[0].terms;if(8!=t.length)return void console.warn(e.surface+" does not have exactly 8 numbers.");const s=this.element.model[Sh](t[0].number,t[1].number),i=new d(t[2].number,t[3].number,t[4].number);if(null==s)return void console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const n=s.mesh.geometry.attributes.position.count;if(i.x>=n||i.y>=n||i.z>=n)return void console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const r=new d(t[5].number,t[6].number,t[7].number);e.mesh=s.mesh,e.tri=i,e.bary=r}}updateSurfaceHotspots(){const e=!this.element.paused;this.forHotspots((t=>{this.initializeSurface(t),t.updateSurface(e)}))}updateHotspotsVisibility(e){this.forHotspots((t=>{Wh.copy(e),Xh.setFromMatrixPosition(t.matrixWorld),Wh.sub(Xh),Zh.copy(t.normal).transformDirection(this.target.matrixWorld),Wh.dot(Zh)<0?t.hide():t.show()}))}orientHotspots(e){this.forHotspots((t=>{t.orient(e)}))}setHotspotsVisibility(e){this.forHotspots((t=>{t.visible=e}))}updateSchema(e){var t;const{schemaElement:s,element:i}=this,{alt:n,poster:r,iosSrc:o}=i;if(null!=e){const i=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];o&&i.push({"@type":"MediaObject",contentUrl:o,encodingFormat:"model/vnd.usdz+zip"});const a={"@context":"http://schema.org/","@type":"3DModel",image:null!=r?r:void 0,name:null!=n?n:void 0,encoding:i};s.textContent=JSON.stringify(a),document.head.appendChild(s)}else null!=s.parentElement&&s.parentElement.removeChild(s)}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(){const e={progress:0,completed:!1};return this.ongoingActivities.add(e),1===this.ongoingActivityCount&&this.announceTotalProgress(e,0),t=>{let s;return s=Math.max(ti(t,0,1),e.progress),s!==e.progress&&this.announceTotalProgress(e,s),e.progress}}announceTotalProgress(e,t){let s=0,i=0;1==t&&(e.completed=!0);for(const e of this.ongoingActivities){const{progress:t}=e;s+=1-t,!0===e.completed&&i++}const n=e.progress;e.progress=t,this.totalProgress+=(t-n)*(1-this.totalProgress)/s;const r=i===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r}})),i===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rc,oc,ac,Ac,lc,hc,cc,uc,gc,dc,pc,mc,Ic,fc=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const Cc=document.createElement("canvas"),Ec=Symbol("fallbackResizeHandler"),Bc=Symbol("defaultAriaLabel"),yc=Symbol("resizeObserver"),wc=Symbol("clearModelTimeout"),Qc=Symbol("onContextLost"),vc=Symbol("loaded"),bc=Symbol("status"),Sc=Symbol("onFocus"),xc=Symbol("onBlur"),Mc=Symbol("updateSize"),Rc=Symbol("intersectionObserver"),Dc=Symbol("isElementInViewport"),Tc=Symbol("announceModelVisibility"),Lc=Symbol("ariaLabel"),Fc=Symbol("altDefaulted"),kc=Symbol("statusElement"),_c=Symbol("updateStatus"),Uc=Symbol("loadedTime"),Nc=Symbol("updateSource"),Gc=Symbol("markLoaded"),Pc=Symbol("container"),Oc=Symbol("input"),Hc=Symbol("canvas"),qc=Symbol("scene"),Vc=Symbol("needsRender"),Jc=Symbol("tick"),Kc=Symbol("onModelLoad"),$c=Symbol("onResize"),Yc=Symbol("renderer"),zc=Symbol("progressTracker"),jc=Symbol("getLoaded"),Wc=Symbol("getModelIsVisible"),Xc=Symbol("shouldAttemptPreload"),Zc=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),eu=e=>({u:e.x,v:e.y,toString(){return`${this.u} ${this.v}`}});class tu extends Fs{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[rc]=!1,this[oc]=!1,this[ac]=0,this[Ac]="",this[lc]=null,this[hc]=ei((()=>{const e=this.getBoundingClientRect();this[Mc](e)}),50),this[cc]=ei((e=>{const t=this.modelIsVisible;t!==e&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:t}}))}),0),this[uc]=null,this[gc]=null,this[dc]=new nc,this[pc]=()=>{this[kc].textContent=this[bc]},this[mc]=()=>{this[kc].textContent=""},this[Ic]=e=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:e.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;let t,s;if((e=>{fs(li,e)})(e),this[Pc]=e.querySelector(".container"),this[Oc]=e.querySelector(".userInput"),this[Hc]=e.querySelector("canvas"),this[kc]=e.querySelector("#status"),this[Bc]=this[Oc].getAttribute("aria-label"),this.isConnected){const e=this.getBoundingClientRect();t=e.width,s=e.height}else t=300,s=150;this[qc]=new ic({canvas:this[Hc],element:this,width:t,height:s}),Promise.resolve().then((()=>{this[Mc](this.getBoundingClientRect())})),Os&&(this[yc]=new ResizeObserver((e=>{if(!this[Yc].isPresenting)for(let t of e)t.target===this&&this[Mc](t.contentRect)}))),Hs?this[Rc]=new IntersectionObserver((e=>{for(let t of e)if(t.target===this){const e=this.modelIsVisible;this[Dc]=t.isIntersecting,this[Tc](e),this[Dc]&&!this.loaded&&this[Nc]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[Dc]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){sr[er].evictionThreshold=e}static get modelCacheSize(){return sr[er].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),nl.singleton.minScale=e}static get minimumRenderScale(){return nl.singleton.minScale}get loaded(){return this[jc]()}get[(rc=Dc,oc=vc,ac=Uc,Ac=bc,lc=wc,hc=Ec,cc=Tc,uc=yc,gc=Rc,dc=zc,Yc)](){return nl.singleton}get modelIsVisible(){return this[Wc]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Os?this[yc].observe(this):self.addEventListener("resize",this[Ec]),Hs&&this[Rc].observe(this),this.addEventListener("focus",this[Sc]),this.addEventListener("blur",this[xc]);const e=this[Yc];e.addEventListener("contextlost",this[Qc]),e.registerScene(this[qc]),null!=this[wc]&&(self.clearTimeout(this[wc]),this[wc]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Os?this[yc].unobserve(this):self.removeEventListener("resize",this[Ec]),Hs&&this[Rc].unobserve(this),this.removeEventListener("focus",this[Sc]),this.removeEventListener("blur",this[xc]);const e=this[Yc];e.removeEventListener("contextlost",this[Qc]),e.unregisterScene(this[qc]),this[wc]=self.setTimeout((()=>{this[qc].dispose(),this[wc]=null}),10)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[vc]=!1,this[Uc]=0,this[qc].reset()):this.src!==this[qc].url&&(this[vc]=!1,this[Uc]=0,this[Nc]())),e.has("alt")&&this[Oc].setAttribute("aria-label",this[Lc]),e.has("withCredentials")&&(sr.withCredentials=this.withCredentials,this[Yc].textureUtils.withCredentials=this.withCredentials),e.has("generateSchema")&&(this.generateSchema?this[qc].updateSchema(this.src):this[qc].updateSchema(null))}toDataURL(e,t){return this[Yc].displayCanvas(this[qc]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,s=e?e.qualityArgument:void 0,i=e?e.idealAspect:void 0,{width:n,height:r,idealAspect:o,aspect:a}=this[qc],{dpr:A,scaleFactor:l}=this[Yc];let h=n*l*A,c=r*l*A,u=0,g=0;if(!0===i)if(o>a){const e=c;c=Math.round(h/o),g=(e-c)/2}else{const e=h;h=Math.round(c*o),u=(e-h)/2}Cc.width=h,Cc.height=c;try{return new Promise((async(e,i)=>{Cc.getContext("2d").drawImage(this[Yc].displayCanvas(this[qc]),u,g,h,c,0,0,h,c),Cc.toBlob((t=>{if(!t)return i(new Error("Unable to retrieve canvas blob"));e(t)}),t,s)}))}finally{this[Mc]({width:n,height:r})}}registerEffectComposer(e){e.setRenderer(this[Yc].threeRenderer),e.setMainCamera(this[qc].getCamera()),e.setMainScene(this[qc]),this[qc].effectRenderer=e}unregisterEffectComposer(){this[qc].effectRenderer=null}registerRenderer(e){this[qc].externalRenderer=e}unregisterRenderer(){this[qc].externalRenderer=null}get[Lc](){return this[Fc]}get[Fc](){return null==this.alt||"null"===this.alt?this[Bc]:this.alt}[jc](){return this[vc]}[Wc](){return this.loaded&&this[Dc]}[Xc](){return!!this.src&&this[Dc]}[Mc]({width:e,height:t}){0!==e&&0!==t&&(this[Pc].style.width=`${e}px`,this[Pc].style.height=`${t}px`,this[$c]({width:e,height:t}))}[Jc](e,t){var s;null===(s=this[qc].effectRenderer)||void 0===s||s.beforeRender(e,t)}[Gc](){this[vc]||(this[vc]=!0,this[Uc]=performance.now())}[Vc](){this[qc].queueRender()}[Kc](){}[_c](e){this[bc]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[kc].textContent!=e&&(this[kc].textContent=e)}[(pc=Sc,mc=xc,$c)](e){this[qc].setSize(e.width,e.height)}async[(Ic=Qc,Nc)](){const e=this[qc];if(this.loaded||!this[Xc]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[_c]("Loading"),e.stopAnimation();const t=this[zc].beginActivity(),s=this.src;try{const i=e.setSource(s,(e=>t(.95*ti(e,0,1)))),n=this[ai]();await Promise.all([i,n]),this[Gc](),this[Kc](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:s}})),e()}))}))}))}catch(e){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:e}}))}finally{t(1)}}}fc([mt({type:String})],tu.prototype,"alt",void 0),fc([mt({type:String})],tu.prototype,"src",void 0),fc([mt({type:Boolean,attribute:"with-credentials"})],tu.prototype,"withCredentials",void 0),fc([mt({type:Boolean,attribute:"generate-schema"})],tu.prototype,"generateSchema",void 0);
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var su=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const iu=Symbol("changeAnimation"),nu=Symbol("paused"),ru={repetitions:1/0,pingpong:!1},ou=Symbol("hotspotMap"),au=Symbol("mutationCallback"),Au=Symbol("observer"),lu=Symbol("addHotspot"),hu=Symbol("removeHotspot"),cu=new s;
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
var uu=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(uu(""))}catch(bs){uu=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var gu=Uint8Array,du=Uint16Array,pu=Uint32Array,mu=new gu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Iu=new gu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fu=new gu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cu=function(e,t){for(var s=new du(31),i=0;i<31;++i)s[i]=t+=1<<e[i-1];var n=new pu(s[30]);for(i=1;i<30;++i)for(var r=s[i];r<s[i+1];++r)n[r]=r-s[i]<<5|i;return[s,n]},Eu=Cu(mu,2),Bu=Eu[0],yu=Eu[1];Bu[28]=258,yu[258]=28;for(var wu=Cu(Iu,0)[1],Qu=new du(32768),vu=0;vu<32768;++vu){var bu=(43690&vu)>>>1|(21845&vu)<<1;bu=(61680&(bu=(52428&bu)>>>2|(13107&bu)<<2))>>>4|(3855&bu)<<4,Qu[vu]=((65280&bu)>>>8|(255&bu)<<8)>>>1}var Su=function(e,t,s){for(var i=e.length,n=0,r=new du(t);n<i;++n)++r[e[n]-1];var o,a=new du(t);for(n=0;n<t;++n)a[n]=a[n-1]+r[n-1]<<1;if(s){o=new du(1<<t);var A=15-t;for(n=0;n<i;++n)if(e[n])for(var l=n<<4|e[n],h=t-e[n],c=a[e[n]-1]++<<h,u=c|(1<<h)-1;c<=u;++c)o[Qu[c]>>>A]=l}else for(o=new du(i),n=0;n<i;++n)e[n]&&(o[n]=Qu[a[e[n]-1]++]>>>15-e[n]);return o},xu=new gu(288);for(vu=0;vu<144;++vu)xu[vu]=8;for(vu=144;vu<256;++vu)xu[vu]=9;for(vu=256;vu<280;++vu)xu[vu]=7;for(vu=280;vu<288;++vu)xu[vu]=8;var Mu=new gu(32);for(vu=0;vu<32;++vu)Mu[vu]=5;var Ru=Su(xu,9,0),Du=Su(Mu,5,0),Tu=function(e){return(e/8|0)+(7&e&&1)},Lu=function(e,t,s){(null==t||t<0)&&(t=0),(null==s||s>e.length)&&(s=e.length);var i=new(e instanceof du?du:e instanceof pu?pu:gu)(s-t);return i.set(e.subarray(t,s)),i},Fu=function(e,t,s){s<<=7&t;var i=t/8|0;e[i]|=s,e[i+1]|=s>>>8},ku=function(e,t,s){s<<=7&t;var i=t/8|0;e[i]|=s,e[i+1]|=s>>>8,e[i+2]|=s>>>16},_u=function(e,t){for(var s=[],i=0;i<e.length;++i)e[i]&&s.push({s:i,f:e[i]});var n=s.length,r=s.slice();if(!n)return[qu,0];if(1==n){var o=new gu(s[0].s+1);return o[s[0].s]=1,[o,1]}s.sort((function(e,t){return e.f-t.f})),s.push({s:-1,f:25001});var a=s[0],A=s[1],l=0,h=1,c=2;for(s[0]={s:-1,f:a.f+A.f,l:a,r:A};h!=n-1;)a=s[s[l].f<s[c].f?l++:c++],A=s[l!=h&&s[l].f<s[c].f?l++:c++],s[h++]={s:-1,f:a.f+A.f,l:a,r:A};var u=r[0].s;for(i=1;i<n;++i)r[i].s>u&&(u=r[i].s);var g=new du(u+1),d=Uu(s[h-1],g,0);if(d>t){i=0;var p=0,m=d-t,I=1<<m;for(r.sort((function(e,t){return g[t.s]-g[e.s]||e.f-t.f}));i<n;++i){var f=r[i].s;if(!(g[f]>t))break;p+=I-(1<<d-g[f]),g[f]=t}for(p>>>=m;p>0;){var C=r[i].s;g[C]<t?p-=1<<t-g[C]++-1:++i}for(;i>=0&&p;--i){var E=r[i].s;g[E]==t&&(--g[E],++p)}d=t}return[new gu(g),d]},Uu=function(e,t,s){return-1==e.s?Math.max(Uu(e.l,t,s+1),Uu(e.r,t,s+1)):t[e.s]=s},Nu=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new du(++t),i=0,n=e[0],r=1,o=function(e){s[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=e[a]}return[s.subarray(0,i),t]},Gu=function(e,t){for(var s=0,i=0;i<t.length;++i)s+=e[i]*t[i];return s},Pu=function(e,t,s){var i=s.length,n=Tu(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var r=0;r<i;++r)e[n+r+4]=s[r];return 8*(n+4+i)},Ou=function(e,t,s,i,n,r,o,a,A,l,h){Fu(t,h++,s),++n[256];for(var c=_u(n,15),u=c[0],g=c[1],d=_u(r,15),p=d[0],m=d[1],I=Nu(u),f=I[0],C=I[1],E=Nu(p),B=E[0],y=E[1],w=new du(19),Q=0;Q<f.length;++Q)w[31&f[Q]]++;for(Q=0;Q<B.length;++Q)w[31&B[Q]]++;for(var v=_u(w,7),b=v[0],S=v[1],x=19;x>4&&!b[fu[x-1]];--x);var M,R,D,T,L=l+5<<3,F=Gu(n,xu)+Gu(r,Mu)+o,k=Gu(n,u)+Gu(r,p)+o+14+3*x+Gu(w,b)+(2*w[16]+3*w[17]+7*w[18]);if(L<=F&&L<=k)return Pu(t,h,e.subarray(A,A+l));if(Fu(t,h,1+(k<F)),h+=2,k<F){M=Su(u,g,0),R=u,D=Su(p,m,0),T=p;var _=Su(b,S,0);Fu(t,h,C-257),Fu(t,h+5,y-1),Fu(t,h+10,x-4),h+=14;for(Q=0;Q<x;++Q)Fu(t,h+3*Q,b[fu[Q]]);h+=3*x;for(var U=[f,B],N=0;N<2;++N){var G=U[N];for(Q=0;Q<G.length;++Q){var P=31&G[Q];Fu(t,h,_[P]),h+=b[P],P>15&&(Fu(t,h,G[Q]>>>5&127),h+=G[Q]>>>12)}}}else M=Ru,R=xu,D=Du,T=Mu;for(Q=0;Q<a;++Q)if(i[Q]>255){P=i[Q]>>>18&31;ku(t,h,M[P+257]),h+=R[P+257],P>7&&(Fu(t,h,i[Q]>>>23&31),h+=mu[P]);var O=31&i[Q];ku(t,h,D[O]),h+=T[O],O>3&&(ku(t,h,i[Q]>>>5&8191),h+=Iu[O])}else ku(t,h,M[i[Q]]),h+=R[i[Q]];return ku(t,h,M[256]),h+R[256]},Hu=new pu([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),qu=new gu(0),Vu=function(){for(var e=new pu(256),t=0;t<256;++t){for(var s=t,i=9;--i;)s=(1&s&&3988292384)^s>>>1;e[t]=s}return e}(),Ju=function(){var e=-1;return{p:function(t){for(var s=e,i=0;i<t.length;++i)s=Vu[255&s^t[i]]^s>>>8;e=s},d:function(){return~e}}},Ku=function(e,t,s,i,n){return function(e,t,s,i,n,r){var o=e.length,a=new gu(i+o+5*(1+Math.ceil(o/7e3))+n),A=a.subarray(i,a.length-n),l=0;if(!t||o<8)for(var h=0;h<=o;h+=65535){var c=h+65535;c<o?l=Pu(A,l,e.subarray(h,c)):(A[h]=r,l=Pu(A,l,e.subarray(h,o)))}else{for(var u=Hu[t-1],g=u>>>13,d=8191&u,p=(1<<s)-1,m=new du(32768),I=new du(p+1),f=Math.ceil(s/3),C=2*f,E=function(t){return(e[t]^e[t+1]<<f^e[t+2]<<C)&p},B=new pu(25e3),y=new du(288),w=new du(32),Q=0,v=0,b=(h=0,0),S=0,x=0;h<o;++h){var M=E(h),R=32767&h,D=I[M];if(m[R]=D,I[M]=R,S<=h){var T=o-h;if((Q>7e3||b>24576)&&T>423){l=Ou(e,A,0,B,y,w,v,b,x,h-x,l),b=Q=v=0,x=h;for(var L=0;L<286;++L)y[L]=0;for(L=0;L<30;++L)w[L]=0}var F=2,k=0,_=d,U=R-D&32767;if(T>2&&M==E(h-U))for(var N=Math.min(g,T)-1,G=Math.min(32767,h),P=Math.min(258,T);U<=G&&--_&&R!=D;){if(e[h+F]==e[h+F-U]){for(var O=0;O<P&&e[h+O]==e[h+O-U];++O);if(O>F){if(F=O,k=U,O>N)break;var H=Math.min(U,O-2),q=0;for(L=0;L<H;++L){var V=h-U+L+32768&32767,J=V-m[V]+32768&32767;J>q&&(q=J,D=V)}}}U+=(R=D)-(D=m[R])+32768&32767}if(k){B[b++]=268435456|yu[F]<<18|wu[k];var K=31&yu[F],$=31&wu[k];v+=mu[K]+Iu[$],++y[257+K],++w[$],S=h+F,++Q}else B[b++]=e[h],++y[e[h]]}}l=Ou(e,A,r,B,y,w,v,b,x,h-x,l),!r&&7&l&&(l=Pu(A,l+1,qu))}return Lu(a,0,i+Tu(l)+n)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,s,i,!n)},$u=function(e,t){var s={};for(var i in e)s[i]=e[i];for(var i in t)s[i]=t[i];return s},Yu=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8};function zu(e,t){return Ku(e,t||{},0,0)}var ju=function(e,t,s,i){for(var n in e){var r=e[n],o=t+n;r instanceof gu?s[o]=[r,i]:Array.isArray(r)?s[o]=[r[0],$u(i,r[1])]:ju(r,o+"/",s,i)}},Wu="undefined"!=typeof TextEncoder&&new TextEncoder,Xu="undefined"!=typeof TextDecoder&&new TextDecoder;try{Xu.decode(qu,{stream:!0}),1}catch(bs){}function Zu(e,t){if(t){for(var s=new gu(e.length),i=0;i<e.length;++i)s[i]=e.charCodeAt(i);return s}if(Wu)return Wu.encode(e);var n=e.length,r=new gu(e.length+(e.length>>1)),o=0,a=function(e){r[o++]=e};for(i=0;i<n;++i){if(o+5>r.length){var A=new gu(o+8+(n-i<<1));A.set(r),r=A}var l=e.charCodeAt(i);l<128||t?a(l):l<2048?(a(192|l>>6),a(128|63&l)):l>55295&&l<57344?(a(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++i))>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|63&l)):(a(224|l>>12),a(128|l>>6&63),a(128|63&l))}return Lu(r,0,o)}var eg=function(e){var t=0;if(e)for(var s in e){var i=e[s].length;if(i>65535)throw"extra field too long";t+=i+4}return t},tg=function(e,t,s,i,n,r,o,a){var A=i.length,l=s.extra,h=a&&a.length,c=eg(l);Yu(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=s.os),e[t]=20,t+=2,e[t++]=s.flag<<1|(null==r&&8),e[t++]=n&&8,e[t++]=255&s.compression,e[t++]=s.compression>>8;var u=new Date(null==s.mtime?Date.now():s.mtime),g=u.getFullYear()-1980;if(g<0||g>119)throw"date not in range 1980-2099";if(Yu(e,t,g<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>>1),t+=4,null!=r&&(Yu(e,t,s.crc),Yu(e,t+4,r),Yu(e,t+8,s.size)),Yu(e,t+12,A),Yu(e,t+14,c),t+=16,null!=o&&(Yu(e,t,h),Yu(e,t+6,s.attrs),Yu(e,t+10,o),t+=14),e.set(i,t),t+=A,c)for(var d in l){var p=l[d],m=p.length;Yu(e,t,+d),Yu(e,t+2,m),e.set(p,t+4),t+=4+m}return h&&(e.set(a,t),t+=h),t};function sg(e,t){t||(t={});var s={},i=[];ju(e,"",s,t);var n=0,r=0;for(var o in s){var a=s[o],A=a[0],l=a[1],h=0==l.level?0:8,c=(w=Zu(o)).length,u=l.comment,g=u&&Zu(u),d=g&&g.length,p=eg(l.extra);if(c>65535)throw"filename too long";var m=h?zu(A,l):A,I=m.length,f=Ju();f.p(A),i.push($u(l,{size:A.length,crc:f.d(),c:m,f:w,m:g,u:c!=o.length||g&&u.length!=d,o:n,compression:h})),n+=30+c+p+I,r+=76+2*(c+p)+(d||0)+I}for(var C=new gu(r+22),E=n,B=r-n,y=0;y<i.length;++y){var w=i[y];tg(C,w.o,w,w.f,w.u,w.c.length);var Q=30+w.f.length+eg(w.extra);C.set(w.c,w.o+Q),tg(C,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+Q+(w.m?w.m.length:0)}return function(e,t,s,i,n){Yu(e,t,101010256),Yu(e,t+8,s),Yu(e,t+10,s),Yu(e,t+12,i),Yu(e,t+16,n)}(C,n,i.length,B,E),C}class ig{async parse(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!1},t);const s={},i="model.usda";s[i]=null;let n=og();n+=function(e){return`def Xform "Root"\n{\n\tdef Scope "Scenes" (\n\t\tkind = "sceneLibrary"\n\t)\n\t{\n\t\tdef Xform "Scene" (\n\t\t\tcustomData = {\n\t\t\t\tbool preliminary_collidesWithEnvironment = 0\n\t\t\t\tstring sceneName = "Scene"\n\t\t\t}\n\t\t\tsceneName = "Scene"\n\t\t)\n\t\t{\n\t\ttoken preliminary:anchoring:type = "${e.ar.anchoring.type}"\n\t\ttoken preliminary:planeAnchoring:alignment = "${e.ar.planeAnchoring.alignment}"\n\n`}(t);const r={},o={};e.traverseVisible((e=>{if(e.isMesh){const t=e.geometry,i=e.material;if(i.isMeshStandardMaterial){const o="geometries/Geometry_"+t.id+".usda";if(!(o in s)){const e=function(e){const t=function(e){const t="Geometry",s=e.attributes,i=s.position.count;return`\n\tdef Mesh "${t}"\n\t{\n\t\tint[] faceVertexCounts = [${function(e){const t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e)}]\n\t\tint[] faceVertexIndices = [${function(e){const t=e.index,s=[];if(null!==t)for(let e=0;e<t.count;e++)s.push(t.getX(e));else{const t=e.attributes.position.count;for(let e=0;e<t;e++)s.push(e)}return s.join(", ")}(e)}]\n\t\tnormal3f[] normals = [${lg(s.normal,i)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)\n\t\tpoint3f[] points = [${lg(s.position,i)}]\n${function(e,t){let s="";for(let i=0;i<4;i++){const n=i>0?i:"",r=e["uv"+n];void 0!==r&&(s+=`\n\t\ttexCoord2f[] primvars:st${n} = [${hg(r,t)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)`)}return s}(s,i)}\n\t\tuniform token subdivisionScheme = "none"\n\t}\n`}(e);return`\ndef "Geometry"\n{\n${t}\n}\n`}(t);s[o]=function(e){let t=og();return t+=e,Zu(t)}(e)}i.uuid in r||(r[i.uuid]=i),n+=function(e,t,s){const i="Object_"+e.id,n=ag(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return`def Xform "${i}" (\n\tprepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>\n\tprepend apiSchemas = ["MaterialBindingAPI"]\n)\n{\n\tmatrix4d xformOp:transform = ${n}\n\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\trel material:binding = </Materials/Material_${s.id}>\n}\n\n`}(e,t,i)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(n+=function(e){const t=e.name?e.name:"Camera_"+e.id,s=ag(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return e.isOrthographicCamera?`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${s}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(rg)}, ${e.far.toPrecision(rg)})\n\t\t\tfloat horizontalAperture = ${(10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision(rg)}\n\t\t\tfloat verticalAperture = ${(10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision(rg)}\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\t\n\t`:`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${s}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(rg)}, ${e.far.toPrecision(rg)})\n\t\t\tfloat focalLength = ${e.getFocalLength().toPrecision(rg)}\n\t\t\tfloat focusDistance = ${e.focus.toPrecision(rg)}\n\t\t\tfloat horizontalAperture = ${e.getFilmWidth().toPrecision(rg)}\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ${e.getFilmHeight().toPrecision(rg)}\n\t\t}\n\t\n\t`}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))})),n+="\n\t\t}\n\t}\n}\n\n",n+=function(e,t,s=!1){const i=[];for(const n in e){const r=e[n];i.push(cg(r,t,s))}return`def "Materials"\n{\n${i.join("")}\n}\n\n`}(r,o,t.quickLookCompatible),s[i]=Zu(n),n=null;for(const e in o){const t=o[e],i=ng(t.image,t.flipY),n=await new Promise((e=>i.toBlob(e,"image/png",1)));s[`textures/Texture_${e}.png`]=new Uint8Array(await n.arrayBuffer())}let a=0;for(const e in s){const t=s[e];a+=34+e.length;const i=63&a;if(4!==i){const n=new Uint8Array(64-i);s[e]=[t,{extra:{12345:n}}]}a=t.length}return sg(s,{level:0})}}function ng(e,t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const s=1024/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=e.width*Math.min(1,s),i.height=e.height*Math.min(1,s);const n=i.getContext("2d");return!0===t&&(n.translate(0,i.height),n.scale(1,-1)),n.drawImage(e,0,0,i.width,i.height),i}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const rg=7;function og(){return'#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n'}function ag(e){const t=e.elements;return`( ${Ag(t,0)}, ${Ag(t,4)}, ${Ag(t,8)}, ${Ag(t,12)} )`}function Ag(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function lg(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const s=[];for(let t=0;t<e.count;t++){const i=e.getX(t),n=e.getY(t),r=e.getZ(t);s.push(`(${i.toPrecision(rg)}, ${n.toPrecision(rg)}, ${r.toPrecision(rg)})`)}return s.join(", ")}function hg(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const s=[];for(let t=0;t<e.count;t++){const i=e.getX(t),n=e.getY(t);s.push(`(${i.toPrecision(rg)}, ${1-n.toPrecision(rg)})`)}return s.join(", ")}function cg(t,s,i=!1){const n="\t\t\t",r=[],o=[];function a(n,r,o){const a=n.source.id+"_"+n.flipY;s[a]=n;const A=n.channel>0?"st"+n.channel:"st",l={1e3:"repeat",1001:"clamp",1002:"mirror"},h=n.repeat.clone(),c=n.offset.clone(),u=n.rotation,g=Math.sin(u),d=Math.cos(u);return c.y=1-c.y-h.y,i?(c.x=c.x/h.x,c.y=c.y/h.y,c.x+=g/h.x,c.y+=d-1):(c.x+=g*h.x,c.y+=(1-d)*h.y),`\n\t\tdef Shader "PrimvarReader_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdPrimvarReader_float2"\n\t\t\tfloat2 inputs:fallback = (0.0, 0.0)\n\t\t\ttoken inputs:varname = "${A}"\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Transform2d_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdTransform2d"\n\t\t\ttoken inputs:in.connect = </Materials/Material_${t.id}/PrimvarReader_${r}.outputs:result>\n\t\t\tfloat inputs:rotation = ${(u*(180/Math.PI)).toFixed(rg)}\n\t\t\tfloat2 inputs:scale = ${gg(h)}\n\t\t\tfloat2 inputs:translation = ${gg(c)}\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Texture_${n.id}_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdUVTexture"\n\t\t\tasset inputs:file = @textures/Texture_${a}.png@\n\t\t\tfloat2 inputs:st.connect = </Materials/Material_${t.id}/Transform2d_${r}.outputs:result>\n\t\t\t${void 0!==o?"float4 inputs:scale = "+function(e){return`(${e.r}, ${e.g}, ${e.b}, 1.0)`}(o):""}\n\t\t\ttoken inputs:sourceColorSpace = "${n.colorSpace===e.NoColorSpace?"raw":"sRGB"}"\n\t\t\ttoken inputs:wrapS = "${l[n.wrapS]}"\n\t\t\ttoken inputs:wrapT = "${l[n.wrapT]}"\n\t\t\tfloat outputs:r\n\t\t\tfloat outputs:g\n\t\t\tfloat outputs:b\n\t\t\tfloat3 outputs:rgb\n\t\t\t${t.transparent||t.alphaTest>0?"float outputs:a":""}\n\t\t}`}return t.side===e.DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",t),null!==t.map?(r.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:rgb>`),t.transparent?r.push(`${n}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:a>`):t.alphaTest>0&&(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:a>`),r.push(`${n}float inputs:opacityThreshold = ${t.alphaTest}`)),o.push(a(t.map,"diffuse",t.color))):r.push(`${n}color3f inputs:diffuseColor = ${ug(t.color)}`),null!==t.emissiveMap?(r.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${t.id}/Texture_${t.emissiveMap.id}_emissive.outputs:rgb>`),o.push(a(t.emissiveMap,"emissive"))):t.emissive.getHex()>0&&r.push(`${n}color3f inputs:emissiveColor = ${ug(t.emissive)}`),null!==t.normalMap&&(r.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${t.id}/Texture_${t.normalMap.id}_normal.outputs:rgb>`),o.push(a(t.normalMap,"normal"))),null!==t.aoMap&&(r.push(`${n}float inputs:occlusion.connect = </Materials/Material_${t.id}/Texture_${t.aoMap.id}_occlusion.outputs:r>`),o.push(a(t.aoMap,"occlusion"))),null!==t.roughnessMap&&1===t.roughness?(r.push(`${n}float inputs:roughness.connect = </Materials/Material_${t.id}/Texture_${t.roughnessMap.id}_roughness.outputs:g>`),o.push(a(t.roughnessMap,"roughness"))):r.push(`${n}float inputs:roughness = ${t.roughness}`),null!==t.metalnessMap&&1===t.metalness?(r.push(`${n}float inputs:metallic.connect = </Materials/Material_${t.id}/Texture_${t.metalnessMap.id}_metallic.outputs:b>`),o.push(a(t.metalnessMap,"metallic"))):r.push(`${n}float inputs:metallic = ${t.metalness}`),null!==t.alphaMap?(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.alphaMap.id}_opacity.outputs:r>`),r.push(`${n}float inputs:opacityThreshold = 0.0001`),o.push(a(t.alphaMap,"opacity"))):r.push(`${n}float inputs:opacity = ${t.opacity}`),t.isMeshPhysicalMaterial&&(r.push(`${n}float inputs:clearcoat = ${t.clearcoat}`),r.push(`${n}float inputs:clearcoatRoughness = ${t.clearcoatRoughness}`),r.push(`${n}float inputs:ior = ${t.ior}`)),`\n\tdef Material "Material_${t.id}"\n\t{\n\t\tdef Shader "PreviewSurface"\n\t\t{\n\t\t\tuniform token info:id = "UsdPreviewSurface"\n${r.join("\n")}\n\t\t\tint inputs:useSpecularWorkflow = 0\n\t\t\ttoken outputs:surface\n\t\t}\n\n\t\ttoken outputs:surface.connect = </Materials/Material_${t.id}/PreviewSurface.outputs:surface>\n\n${o.join("\n")}\n\n\t}\n`}function ug(e){return`(${e.r}, ${e.g}, ${e.b})`}function gg(e){return`(${e.x}, ${e.y})`}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var dg=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};let pg=!1,mg=!1;const Ig="#model-viewer-no-ar-fallback",fg=(Cg=["quick-look","scene-viewer","webxr","none"],e=>{try{const t=Bo(e),s=(t.length?t[0].terms:[]).filter((e=>e&&"ident"===e.type)).map((e=>e.value)).filter((e=>Cg.indexOf(e)>-1)),i=new Set;for(const e of s)i.add(e);return i}catch(e){}return new Set});var Cg;const Eg="quick-look",Bg="scene-viewer",yg="webxr",wg="none",Qg=Symbol("arButtonContainer"),vg=Symbol("enterARWithWebXR"),bg=Symbol("openSceneViewer"),Sg=Symbol("openIOSARQuickLook"),xg=Symbol("canActivateAR"),Mg=Symbol("arMode"),Rg=Symbol("arModes"),Dg=Symbol("arAnchor"),Tg=Symbol("preload"),Lg=Symbol("onARButtonContainerClick"),Fg=Symbol("onARStatus"),kg=Symbol("onARTracking"),_g=Symbol("onARTap"),Ug=Symbol("selectARMode"),Ng=Symbol("triggerLoad");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Gg=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const Pg="auto",Og="auto",Hg="eager",qg=Symbol("defaultProgressBarElement"),Vg=Symbol("posterContainerElement"),Jg=Symbol("defaultPosterElement"),Kg=Symbol("shouldDismissPoster"),$g=Symbol("hidePoster"),Yg=Symbol("modelIsRevealed"),zg=Symbol("updateProgressBar"),jg=Symbol("ariaLabelCallToAction"),Wg=Symbol("onProgress");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xg=function(e,t,s,i){for(var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,s,o):n(t,s))||o);return r>3&&o&&Object.defineProperty(t,s,o),o};const Zg=Math.PI/32,ed={basis:[Ro(Eo(Zg,"rad"))],keywords:{auto:[null]}},td=Symbol("autoRotateStartTime"),sd=Symbol("radiansPerSecond"),id=Symbol("syncRotationRate"),nd=Symbol("onCameraChange"),rd=(e=>{var t,s,i;class n extends e{constructor(){super(...arguments),this[t]=new Map,this[s]=e=>{e.forEach((e=>{e instanceof MutationRecord&&"childList"!==e.type||(e.addedNodes.forEach((e=>{this[lu](e)})),e.removedNodes.forEach((e=>{this[hu](e)})),this[Vc]())}))},this[i]=new MutationObserver(this[au])}connectedCallback(){super.connectedCallback();for(let e=0;e<this.children.length;++e)this[lu](this.children[e]);const{ShadyDOM:e}=self;null==e?this[Au].observe(this,{childList:!0}):this[Au]=e.observeChildren(this,this[au])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:e}=self;null==e?this[Au].disconnect():e.unobserveChildren(this[Au])}[(t=ou,s=au,i=Au,Jc)](e,t){super[Jc](e,t);const s=this[qc],{annotationRenderer:i}=s,n=s.getCamera();s.shouldRender()&&(s.updateSurfaceHotspots(),s.updateHotspotsVisibility(n.position),i.domElement.style.display="",i.render(s,n))}updateHotspot(e){const t=this[ou].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),t.surface=e.surface,this[Vc]())}queryHotspot(e){const t=this[ou].get(e);if(null==t)return null;const s=Zc(t.position),i=Zc(t.normal),n=t.facingCamera,r=this[qc],o=r.getCamera(),a=new d;a.setFromMatrixPosition(t.matrixWorld),a.project(o);const A=r.width/2,l=r.height/2;a.x=a.x*A+A,a.y=-a.y*l+l;const h=Zc(new d(a.x,a.y,a.z));return Number.isFinite(h.x)&&Number.isFinite(h.y)?{position:s,normal:i,canvasPosition:h,facingCamera:n}:null}positionAndNormalFromPoint(e,t){const s=this[qc],i=s.getNDC(e,t),n=s.positionAndNormalFromPoint(i);if(null==n)return null;cu.copy(s.target.matrixWorld).invert();const r=Zc(n.position.applyMatrix4(cu)),o=Zc(n.normal.transformDirection(cu));let a=null;return null!=n.uv&&(a=eu(n.uv)),{position:r,normal:o,uv:a}}surfaceFromPoint(e,t){const s=this[qc],i=s.getNDC(e,t);return s.surfaceFromPoint(i)}[lu](e){if(!(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")))return;let t=this[ou].get(e.slot);null!=t?t.increment():(t=new Kh({name:e.slot,position:e.dataset.position,normal:e.dataset.normal,surface:e.dataset.surface}),this[ou].set(e.slot,t),this[qc].addHotspot(t)),this[qc].queueRender()}[hu](e){if(!(e instanceof HTMLElement))return;const t=this[ou].get(e.slot);t&&(t.decrement()&&(this[qc].removeHotspot(t),this[ou].delete(e.slot)),this[qc].queueRender())}}return n})((e=>{var t,s,i;class n extends e{constructor(){super(...arguments),this[t]=void 0,this[s]=null,this[i]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Uh]}get availableVariants(){return this.model?this.model[Mh]():[]}get originalGltfJson(){return this[_h]}[(t=Uh,s=kh,i=_h,Nh)](){return()=>{this[Vc]()}}[Gh](e){return e.encoding=De,e.wrapS=se,e.wrapT=se,new bl(this[Nh](),e)}async createTexture(e,t="image/png"){const{textureUtils:s}=this[Yc],i=await s.loadImage(e);return i.userData.mimeType=t,this[Gh](i)}async createLottieTexture(e,t=1){const{textureUtils:s}=this[Yc],i=await s.loadLottie(e,t);return this[Gh](i)}createVideoTexture(e){const t=document.createElement("video");t.src=e,t.muted=!0,t.playsInline=!0,t.loop=!0,t.play();const s=new Pe(t);return this[Gh](s)}createCanvasTexture(){const e=document.createElement("canvas"),t=new Oe(e);return this[Gh](t)}async updated(e){if(super.updated(e),e.has("variantName")){const e=this[zc].beginActivity();e(.1);const t=this[Uh],{variantName:s}=this;null!=t&&(await t[Qh](s),this[Vc](),this.dispatchEvent(new CustomEvent("variant-applied"))),e(1)}if(e.has("orientation")||e.has("scale")){if(!this.loaded)return;const e=this[qc];e.applyTransform(),e.updateBoundingBox(),e.updateShadow(),this[Yc].arRenderer.onUpdateScene(),this[Vc]()}}[Kc](){super[Kc]();const{currentGLTF:e}=this[qc];if(null!=e){const{correlatedSceneGraph:t}=e;null!=t&&e!==this[kh]&&(this[Uh]=new Lh(t,this[Nh]()),this[_h]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&this.requestUpdate("variantName")}this[kh]=e}async exportScene(e){const t=this[qc];return new Promise((async(s,i)=>{const n={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(n,e),n.animations=t.animations,n.truncateDrawRange=!0;const r=t.shadow;let o=!1;null!=r&&(o=r.visible,r.visible=!1),await this[Uh][wh]();(new Ir).register((e=>new ho(e))).parse(t.model,(e=>s(new Blob([n.binary?e:JSON.stringify(e)],{type:n.binary?"application/octet-stream":"application/json"}))),(()=>i("glTF export failed")),n),null!=r&&(r.visible=o)}))}materialFromPoint(e,t){const s=this[Uh];if(null==s)return null;const i=this[qc],n=i.getNDC(e,t),r=i.hitFromPoint(n);return null==r||null==r.face?null:s[vh](r)}}return Fh([mt({type:String,attribute:"variant-name"})],n.prototype,"variantName",void 0),Fh([mt({type:String,attribute:"orientation"})],n.prototype,"orientation",void 0),Fh([mt({type:String,attribute:"scale"})],n.prototype,"scale",void 0),n})((e=>{var t,s,i;class n extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[s]=0,this[i]=e=>{this.autoRotate&&"user-interaction"===e.detail.source&&(this[td]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[nd]),this[td]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[nd]),this[td]=performance.now()}updated(e){super.updated(e),e.has("autoRotate")&&(this[td]=performance.now())}[(t=td,s=sd,id)](e){this[sd]=e[0]}[Jc](e,t){if(super[Jc](e,t),!this.autoRotate||!this[Wc]()||this[Yc].isPresenting)return;const s=Math.min(t,e-this[td]-this.autoRotateDelay);s>0&&(this[qc].yaw=this.turntableRotation+this[sd]*s*.001)}get turntableRotation(){return this[qc].yaw}resetTurntableRotation(e=0){this[qc].yaw=e}}return i=nd,Xg([mt({type:Boolean,attribute:"auto-rotate"})],n.prototype,"autoRotate",void 0),Xg([mt({type:Number,attribute:"auto-rotate-delay"})],n.prototype,"autoRotateDelay",void 0),Xg([ma({intrinsics:ed,updateHandler:id}),mt({type:String,attribute:"rotation-per-second"})],n.prototype,"rotationPerSecond",void 0),n})((e=>{var t,s,i;class n extends e{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this[t]=null,this[s]=null,this[i]=null}updated(e){super.updated(e),e.has("shadowIntensity")&&(this[qc].setShadowIntensity(.5*this.shadowIntensity),this[Vc]()),e.has("shadowSoftness")&&(this[qc].setShadowSoftness(this.shadowSoftness),this[Vc]()),e.has("exposure")&&(this[qc].exposure=this.exposure,this[Vc]()),(e.has("environmentImage")||e.has("skyboxImage"))&&this[Xc]()&&this[ai]()}hasBakedShadow(){return this[qc].bakedShadows.size>0}async[(t=ri,s=oi,i=Ai,ai)](){const{skyboxImage:e,environmentImage:t}=this;null!=this[Ai]&&(this[Ai](),this[Ai]=null);const{textureUtils:s}=this[Yc];if(null==s)return;const i=this[zc].beginActivity();try{const{environmentMap:n,skybox:r}=await s.generateEnvironmentMapAndSkybox(Ws(e),t,(e=>i(ti(e,0,1))));this[ri]!==n&&(this[ri]=n,this.dispatchEvent(new CustomEvent("environment-change"))),this[oi]=null!=r?r.name===n.name?n:r:null,this[qc].setEnvironmentAndSkybox(this[ri],this[oi]),this[qc].dispatchEvent({type:"envmap-update"})}catch(e){if(e instanceof Error)throw this[qc].setEnvironmentAndSkybox(null,null),e}finally{i(1)}}}return ni([mt({type:String,attribute:"environment-image"})],n.prototype,"environmentImage",void 0),ni([mt({type:String,attribute:"skybox-image"})],n.prototype,"skyboxImage",void 0),ni([mt({type:Number,attribute:"shadow-intensity"})],n.prototype,"shadowIntensity",void 0),ni([mt({type:Number,attribute:"shadow-softness"})],n.prototype,"shadowSoftness",void 0),ni([mt({type:Number})],n.prototype,"exposure",void 0),n})((e=>{var t,s,i,n,r,o,a,A,l,h,c,u,g,d,p,m,I;class f extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=wa,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=ba,this.interactionPromptStyle=xa,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=Ma,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[s]=this.shadowRoot.querySelector("#prompt"),this[i]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[n]=this.shadowRoot.querySelector(".pan-target"),this[r]=0,this[o]=1/0,this[a]=!1,this[A]=!1,this[l]=fA.AUTOMATIC,this[h]=new CA(this[qc].camera,this[Oc],this[qc]),this[c]=new be,this[u]=!1,this[g]=!1,this[d]=!1,this[p]=()=>{const e=this[Pa].changeSource;this[tA]=e,e===fA.USER_INTERACTION&&(this[Xa]=!0,this[Ja]())},this[m]=()=>{this[Ka](),this[Vc]();const e=this[Pa].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:e}}))},this[I]=e=>{"pointer-change-start"===e.type?this[Pc].classList.add("pointer-tumbling"):this[Pc].classList.remove("pointer-tumbling")}}get inputSensitivity(){return this[Pa].inputSensitivity}set inputSensitivity(e){this[Pa].inputSensitivity=e}getCameraOrbit(){const{theta:e,phi:t,radius:s}=this[sA];return{theta:e,phi:t,radius:s,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Zc(this[Yc].isPresenting?this[Yc].arRenderer.target:this[qc].getTarget())}getFieldOfView(){return this[Pa].getFieldOfView()}getMinimumFieldOfView(){return this[Pa].options.minimumFieldOfView}getMaximumFieldOfView(){return this[Pa].options.maximumFieldOfView}getIdealAspect(){return this[qc].idealAspect}jumpCameraToGoal(){this[iA]=!0,this.requestUpdate(iA,!1)}resetInteractionPrompt(){this[eA]=0,this[Za]=1/0,this[Xa]=!1,this[Wa]=this.interactionPrompt===ba&&this.cameraControls}zoom(e){const t=new WheelEvent("wheel",{deltaY:-30*e});this[Oc].dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this[Pa].addEventListener("user-interaction",this[Ya]),this[Pa].addEventListener("pointer-change-start",this[ja]),this[Pa].addEventListener("pointer-change-end",this[ja])}disconnectedCallback(){super.disconnectedCallback(),this[Pa].removeEventListener("user-interaction",this[Ya]),this[Pa].removeEventListener("pointer-change-start",this[ja]),this[Pa].removeEventListener("pointer-change-end",this[ja])}updated(e){super.updated(e);const t=this[Pa],s=this[qc];if(e.has("cameraControls")&&(this.cameraControls?(t.enableInteraction(),this.interactionPrompt===ba&&(this[Wa]=!0)):(t.disableInteraction(),this[Ja]()),this[Oc].setAttribute("aria-label",this[Lc])),e.has("disableZoom")&&(t.disableZoom=this.disableZoom),e.has("disablePan")&&(t.enablePan=!this.disablePan),e.has("disableTap")&&(t.enableTap=!this.disableTap),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===ba&&this.cameraControls&&!this[Xa]?this[Wa]=!0:this[Ja]()),e.has("interactionPromptStyle")&&(this[qa].style.opacity=this.interactionPromptStyle==Sa?"1":"0"),e.has("touchAction")){const e=this.touchAction;t.applyOptions({touchAction:e}),t.updateTouchActionStyle()}e.has("orbitSensitivity")&&(t.orbitSensitivity=this.orbitSensitivity),e.has("zoomSensitivity")&&(t.zoomSensitivity=this.zoomSensitivity),e.has("panSensitivity")&&(t.panSensitivity=this.panSensitivity),e.has("interpolationDecay")&&(t.setDamperDecayTime(this.interpolationDecay),s.setTargetDamperDecayTime(this.interpolationDecay)),!0===this[iA]&&Promise.resolve().then((()=>{t.jumpToGoal(),s.jumpToGoal(),this[za](),this[iA]=!1}))}async updateFraming(){const e=this[qc],t=e.adjustedFoV(e.framedFoVDeg);await e.updateFraming();const s=e.adjustedFoV(e.framedFoVDeg),i=this[Pa].getFieldOfView()/t;this[Pa].setFieldOfView(s*i),this[rA]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(e,t,s){const i=this[Oc],n=this[Va];if("1"===n[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const r=new Array;r.push({x:Ca(t.x),y:Ca(t.y)});const o=[{x:r[0].x(0),y:r[0].y(0)}];null!=s&&(r.push({x:Ca(s.x),y:Ca(s.y)}),o.push({x:r[1].x(0),y:r[1].y(0)}));let a=performance.now();const{width:A,height:l}=this[qc],h=this.getBoundingClientRect(),c=e=>{for(const[t,s]of o.entries()){const{style:r}=n[t];r.transform=`translateX(${A*s.x}px) translateY(${l*s.y}px)`,"pointerdown"===e?r.opacity="1":"pointerup"===e&&(r.opacity="0");const o={pointerId:t-5678,pointerType:"touch",target:i,clientX:A*s.x+h.x,clientY:l*s.y+h.y,altKey:!0};i.dispatchEvent(new PointerEvent(e,o))}},u=()=>{const t=this[tA];if(t!==fA.AUTOMATIC||!i.isConnected){for(const e of this[Va])e.style.opacity="0";return c("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:t}})),void document.removeEventListener("visibilitychange",g)}const s=Math.min(1,(performance.now()-a)/e);for(const[e,t]of o.entries())t.x=r[e].x(s),t.y=r[e].y(s);c("pointermove"),s<1?requestAnimationFrame(u):(c("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:fA.AUTOMATIC}})),document.removeEventListener("visibilitychange",g))},g=()=>{let e=0;"hidden"===document.visibilityState?e=performance.now()-a:a=performance.now()-e};document.addEventListener("visibilitychange",g),c("pointerdown"),this[tA]=fA.AUTOMATIC,requestAnimationFrame(u)}[(t=Ha,s=qa,i=Va,n=Oa,r=eA,o=Za,a=Xa,A=Wa,l=tA,h=Pa,c=sA,u=iA,g=nA,d=rA,aA)](e){const t=this[Pa],s=this[qc];s.framedFoVDeg=180*e[0]/Math.PI,t.changeSource=fA.NONE,t.setFieldOfView(s.adjustedFoV(s.framedFoVDeg)),this[Ya]()}[oA](e){const t=this[Pa];if(this[rA]){const{theta:t,phi:s}=this.getCameraOrbit();e[0]=t,e[1]=s,this[rA]=!1}t.changeSource=fA.NONE,t.setOrbit(e[0],e[1],e[2]),this[Ya]()}[lA](e){this[Pa].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}[hA](e){this[Pa].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[$a](e[2]),this.jumpCameraToGoal()}[cA](e){this[Pa].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}[uA](e){const t=this[qc].adjustedFoV(180*e[0]/Math.PI);this[Pa].applyOptions({maximumFieldOfView:t}),this.jumpCameraToGoal()}[AA](e){const[t,s,i]=e;this[Yc].arRenderer.isPresenting||this[qc].setTarget(t,s,i),this[Pa].changeSource=fA.NONE,this[Yc].arRenderer.updateTarget(),this[Ya]()}[Jc](e,t){if(super[Jc](e,t),this[Yc].isPresenting||!this[Wc]())return;const s=this[Pa],i=this[qc],n=performance.now();if(this[Wa]&&this.loaded&&n>this[Uc]+this.interactionPromptThreshold&&(this[Wa]=!1,this[Za]=n,this[Ha].classList.add("visible")),isFinite(this[Za])&&this.interactionPromptStyle===xa){const e=(n-this[Za])/5e3%1,t=Ba(e),r=ya(e);if(this[qa].style.opacity=`${r}`,t!==this[eA]){const e=t*i.width*.05,n=(t-this[eA])*Math.PI/16;this[qa].style.transform=`translateX(${e}px)`,s.changeSource=fA.AUTOMATIC,s.adjustOrbit(n,0,0),this[eA]=t}}const r=s.update(e,t),o=i.updateTarget(t);(r||o)&&this[za]()}[Ja](){this[Wa]=!1,this[Ha].classList.remove("visible"),this[Za]=1/0}[$a](e){const t=Math.max(this[qc].boundingSphere.radius,e),s=Math.abs(2*t);this[Pa].updateNearFar(0,s)}[Ka](){const{theta:e,phi:t}=this[Pa].getCameraSpherical(this[sA]),s=(4+Math.floor((e%Ga+Na)/_a))%4,i=Math.floor(t/Ua),n=Qa[s],r=va[i];this[_c](`View from stage ${r}${n}`)}get[Lc](){return super[Lc].replace(/\.$/,"")+(this.cameraControls?". Use mouse, touch or arrow keys to move.":"")}async[$c](e){const t=this[Pa],s=this[qc],i=s.adjustedFoV(s.framedFoVDeg);super[$c](e);const n=s.adjustedFoV(s.framedFoVDeg)/i,r=t.getFieldOfView()*(isFinite(n)?n:1);t.updateAspect(this[qc].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[Pa].setFieldOfView(r),this.jumpCameraToGoal()}[Kc](){super[Kc](),this[nA]?this[rA]=!0:this[nA]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return p=Ya,m=za,I=ja,Ea([mt({type:Boolean,attribute:"camera-controls"})],f.prototype,"cameraControls",void 0),Ea([ma({intrinsics:Ta,observeEffects:!0,updateHandler:oA}),mt({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],f.prototype,"cameraOrbit",void 0),Ea([ma({intrinsics:ka,observeEffects:!0,updateHandler:AA}),mt({type:String,attribute:"camera-target",hasChanged:()=>!0})],f.prototype,"cameraTarget",void 0),Ea([ma({intrinsics:Ra,observeEffects:!0,updateHandler:aA}),mt({type:String,attribute:"field-of-view",hasChanged:()=>!0})],f.prototype,"fieldOfView",void 0),Ea([ma({intrinsics:La,updateHandler:lA}),mt({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],f.prototype,"minCameraOrbit",void 0),Ea([ma({intrinsics:Fa,updateHandler:hA}),mt({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],f.prototype,"maxCameraOrbit",void 0),Ea([ma({intrinsics:Da,updateHandler:cA}),mt({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],f.prototype,"minFieldOfView",void 0),Ea([ma({intrinsics:Ra,updateHandler:uA}),mt({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],f.prototype,"maxFieldOfView",void 0),Ea([mt({type:Number,attribute:"interaction-prompt-threshold"})],f.prototype,"interactionPromptThreshold",void 0),Ea([mt({type:String,attribute:"interaction-prompt"})],f.prototype,"interactionPrompt",void 0),Ea([mt({type:String,attribute:"interaction-prompt-style"})],f.prototype,"interactionPromptStyle",void 0),Ea([mt({type:Number,attribute:"orbit-sensitivity"})],f.prototype,"orbitSensitivity",void 0),Ea([mt({type:Number,attribute:"zoom-sensitivity"})],f.prototype,"zoomSensitivity",void 0),Ea([mt({type:Number,attribute:"pan-sensitivity"})],f.prototype,"panSensitivity",void 0),Ea([mt({type:String,attribute:"touch-action"})],f.prototype,"touchAction",void 0),Ea([mt({type:Boolean,attribute:"disable-zoom"})],f.prototype,"disableZoom",void 0),Ea([mt({type:Boolean,attribute:"disable-pan"})],f.prototype,"disablePan",void 0),Ea([mt({type:Boolean,attribute:"disable-tap"})],f.prototype,"disableTap",void 0),Ea([mt({type:Number,attribute:"interpolation-decay"})],f.prototype,"interpolationDecay",void 0),f})((e=>{var t,s,i,n,r,o,a,A,l,h;class c extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[s]=this.shadowRoot.querySelector(".ar-button"),this[i]=document.createElement("a"),this[n]=new Set,this[r]=wg,this[o]=!1,this[a]=e=>{e.preventDefault(),this.activateAR()},this[A]=({status:e})=>{e!==EA&&this[Yc].arRenderer.presentedScene!==this[qc]||(this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}})),e===EA?this.removeAttribute("ar-tracking"):e===BA&&this.setAttribute("ar-tracking",QA))},this[l]=({status:e})=>{this.setAttribute("ar-tracking",e),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:e}}))},this[h]=e=>{"_apple_ar_quicklook_button_tapped"==e.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[Mg]!==wg}connectedCallback(){super.connectedCallback(),this[Yc].arRenderer.addEventListener("status",this[Fg]),this.setAttribute("ar-status",EA),this[Yc].arRenderer.addEventListener("tracking",this[kg]),this[Dg].addEventListener("message",this[_g])}disconnectedCallback(){super.disconnectedCallback(),this[Yc].arRenderer.removeEventListener("status",this[Fg]),this[Yc].arRenderer.removeEventListener("tracking",this[kg]),this[Dg].removeEventListener("message",this[_g])}update(e){super.update(e),e.has("arScale")&&(this[qc].canScale="fixed"!==this.arScale),e.has("arPlacement")&&(this[qc].updateShadow(),this[Vc]()),e.has("arModes")&&(this[Rg]=fg(this.arModes)),(e.has("ar")||e.has("arModes")||e.has("src")||e.has("iosSrc"))&&this[Ug]()}async activateAR(){switch(this[Mg]){case Eg:await this[Sg]();break;case yg:await this[vg]();break;case Bg:this[bg]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=xg,s=Qg,i=Dg,n=Rg,r=Mg,o=Tg,a=Lg,A=Fg,l=kg,h=_g,Ug)](){let e=wg;if(this.ar){if(null!=this.src)for(const t of this[Rg]){if("webxr"===t&&qs&&!pg&&await this[Yc].arRenderer.supportsPresentation()){e=yg;break}if("scene-viewer"===t&&Ys&&!mg){e=Bg;break}if("quick-look"===t&&js){e=Eg;break}}e===wg&&null!=this.iosSrc&&js&&(e=Eg)}if(e!==wg)this[Qg].classList.add("enabled"),this[Qg].addEventListener("click",this[Lg]);else if(this[Qg].classList.contains("enabled")){this[Qg].removeEventListener("click",this[Lg]),this[Qg].classList.remove("enabled");const e=wA;this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}}))}this[Mg]=e}async[vg](){console.log("Attempting to present in AR with WebXR..."),await this[Ng]();try{this[Qg].removeEventListener("click",this[Lg]);const{arRenderer:e}=this[Yc];e.placeOnWall="wall"===this.arPlacement,await e.present(this[qc],this.xrEnvironment)}catch(e){console.warn("Error while trying to present in AR with WebXR"),console.error(e),await this[Yc].arRenderer.stopPresenting(),pg=!0,console.warn("Falling back to next ar-mode"),await this[Ug](),this.activateAR()}finally{this[Ug]()}}async[Ng](){this.loaded||(this[Tg]=!0,this[Nc](),await((e,t,s=null)=>new Promise((i=>{e.addEventListener(t,(function n(r){s&&!s(r)||(i(r),e.removeEventListener(t,n))}))})))(this,"load"),this[Tg]=!1)}[Xc](){return super[Xc]()||this[Tg]}[bg](){const e=self.location.toString(),t=new URL(e),s=new URL(this.src,e);s.hash&&(s.hash="");const i=new URLSearchParams(s.search);if(t.hash=Ig,i.set("mode","ar_preferred"),i.has("disable_occlusion")||i.set("disable_occlusion","true"),"fixed"===this.arScale&&i.set("resizable","false"),"wall"===this.arPlacement&&i.set("enable_vertical_placement","true"),i.has("sound")){const t=new URL(i.get("sound"),e);i.set("sound",t.toString())}if(i.has("link")){const t=new URL(i.get("link"),e);i.set("link",t.toString())}const n=`intent://arvr.google.com/scene-viewer/1.0?${i.toString()+"&file="+encodeURIComponent(s.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(t.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===Ig&&(mg=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Ug]())}),{once:!0}),this[Dg].setAttribute("href",n),console.log("Attempting to present in AR with Scene Viewer..."),this[Dg].click()}async[Sg](){const e=!this.iosSrc;this[Qg].classList.remove("enabled");const t=e?await this.prepareUSDZ():this.iosSrc,s=new URL(t,self.location.toString());if(e){const e=self.location.toString(),t=new URL(e),i=new URL(this.src,t);i.hash&&(s.hash=i.hash)}"fixed"===this.arScale&&(s.hash&&(s.hash+="&"),s.hash+="allowsContentScaling=0");const i=this[Dg];i.setAttribute("rel","ar");const n=document.createElement("img");i.appendChild(n),i.setAttribute("href",s.toString()),e&&i.setAttribute("download","model.usdz"),i.style.display="none",i.isConnected||this.shadowRoot.appendChild(i),console.log("Attempting to present in AR with Quick Look..."),i.click(),i.removeChild(n),e&&URL.revokeObjectURL(t),this[Qg].classList.add("enabled")}async prepareUSDZ(){const e=this[zc].beginActivity();await this[Ng]();const{model:t,shadow:s}=this[qc];if(null==t)return"";let i=!1;null!=s&&(i=s.visible,s.visible=!1),e(.2);const n=new ig,r=await n.parse(t),o=new Blob([r],{type:"model/vnd.usdz+zip"}),a=URL.createObjectURL(o);return e(1),null!=s&&(s.visible=i),a}}return dg([mt({type:Boolean,attribute:"ar"})],c.prototype,"ar",void 0),dg([mt({type:String,attribute:"ar-scale"})],c.prototype,"arScale",void 0),dg([mt({type:String,attribute:"ar-placement"})],c.prototype,"arPlacement",void 0),dg([mt({type:String,attribute:"ar-modes"})],c.prototype,"arModes",void 0),dg([mt({type:String,attribute:"ios-src"})],c.prototype,"iosSrc",void 0),dg([mt({type:Boolean,attribute:"xr-environment"})],c.prototype,"xrEnvironment",void 0),c})((e=>{var t,s,i,n,r,o,a,A;class l extends e{constructor(...e){super(...e),this.poster=null,this.reveal=Pg,this.loading=Og,this[t]=!1,this[s]=!1,this[i]=this.shadowRoot.querySelector(".slot.poster"),this[n]=this.shadowRoot.querySelector("#default-poster"),this[r]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[o]=this[Jg].getAttribute("aria-label"),this[a]=((e,t)=>{let s=null;const i=(...i)=>{null==s&&(e(...i),s=self.setTimeout((()=>s=null),t))};return i.flush=()=>{null!=s&&(self.clearTimeout(s),s=null)},i})((e=>{const t=this[qg].parentNode;requestAnimationFrame((()=>{this[qg].style.transform=`scaleX(${e})`,0===e&&(t.removeChild(this[qg]),t.appendChild(this[qg])),1===e?this[qg].classList.add("hide"):this[qg].classList.remove("hide")}))}),100),this[A]=e=>{const t=e.detail.totalProgress;1===t&&(this[zg].flush(),this.loaded&&(this[Kg]||this.reveal===Pg)&&this[$g]()),this[zg](t),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t}}))};const l=self.ModelViewerElement||{},h=l.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";sr.setDRACODecoderLocation(h);const c=l.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";sr.setKTX2TranscoderLocation(c),l.meshoptDecoderLocation&&sr.setMeshoptDecoderLocation(l.meshoptDecoderLocation);const u=l.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";nl.singleton.textureUtils.lottieLoaderUrl=u}static set dracoDecoderLocation(e){sr.setDRACODecoderLocation(e)}static get dracoDecoderLocation(){return sr.getDRACODecoderLocation()}static set ktx2TranscoderLocation(e){sr.setKTX2TranscoderLocation(e)}static get ktx2TranscoderLocation(){return sr.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(e){sr.setMeshoptDecoderLocation(e)}static get meshoptDecoderLocation(){return sr.getMeshoptDecoderLocation()}static set lottieLoaderLocation(e){nl.singleton.textureUtils.lottieLoaderUrl=e}static get lottieLoaderLocation(){return nl.singleton.textureUtils.lottieLoaderUrl}static mapURLs(e){nl.singleton.loader[Zn].manager.setURLModifier(e)}dismissPoster(){this.loaded?this[$g]():(this[Kg]=!0,this[Nc]())}showPoster(){const e=this[Vg];if(e.classList.contains("show"))return;e.classList.add("show"),this[Oc].classList.remove("show");const t=this[Jg];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden");const s=this.modelIsVisible;this[Yg]=!1,this[Tc](s)}getDimensions(){return Zc(this[qc].size)}getBoundingBoxCenter(){return Zc(this[qc].boundingBox.getCenter(new d))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[zc].addEventListener("progress",this[Wg])}disconnectedCallback(){super.disconnectedCallback(),this[zc].removeEventListener("progress",this[Wg])}async updated(e){super.updated(e),e.has("poster")&&null!=this.poster&&(this[Jg].style.backgroundImage=`url(${this.poster})`),e.has("alt")&&this[Jg].setAttribute("aria-label",this[Fc]),(e.has("reveal")||e.has("loading"))&&this[Nc]()}[(t=Yg,s=Kg,i=Vg,n=Jg,r=qg,o=jg,a=zg,A=Wg,Xc)](){return!!this.src&&(this[Kg]||this.loading===Hg||this.reveal===Pg&&this[Dc])}[$g](){this[Kg]=!1;const e=this[Vg];if(!e.classList.contains("show"))return;e.classList.remove("show"),this[Oc].classList.add("show");const t=this.modelIsVisible;this[Yg]=!0,this[Tc](t);const s=this.getRootNode();s&&s.activeElement===this&&this[Oc].focus();const i=this[Jg];i.setAttribute("aria-hidden","true"),i.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Wc](){return super[Wc]()&&this[Yg]}}return Gg([mt({type:String})],l.prototype,"poster",void 0),Gg([mt({type:String})],l.prototype,"reveal",void 0),Gg([mt({type:String})],l.prototype,"loading",void 0),l})((e=>{var t;class s extends e{constructor(...e){super(e),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0,this[qc].subscribeMixerEvent("loop",(e=>{const t=e.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:t}}))})),this[qc].subscribeMixerEvent("finished",(()=>{this[nu]=!0,this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[qc].animationNames:[]}get duration(){return this[qc].duration}get paused(){return this[nu]}get currentTime(){return this[qc].animationTime}set currentTime(e){this[qc].animationTime=e,this[Vc]()}get timeScale(){return this[qc].animationTimeScale}set timeScale(e){this[qc].animationTimeScale=e}pause(){this[nu]||(this[nu]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(e){this.availableAnimations.length>0&&(this[nu]=!1,this[iu](e),this.dispatchEvent(new CustomEvent("play")))}[(t=nu,Kc)](){super[Kc](),this[nu]=!0,null!=this.animationName&&this[iu](),this.autoplay&&this.play()}[Jc](e,t){super[Jc](e,t),this[nu]||!this[Wc]()&&!this[Yc].isPresenting||(this[qc].updateAnimation(t/1e3),this[Vc]())}updated(e){super.updated(e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[iu]()}[iu](e=ru){var t;const s=null!==(t=e.repetitions)&&void 0!==t?t:1/0,i=e.pingpong?Ve:1===s?Ke:Je;this[qc].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,i,s),this[nu]&&(this[qc].updateAnimation(0),this[Vc]())}}return su([mt({type:Boolean})],s.prototype,"autoplay",void 0),su([mt({type:String,attribute:"animation-name"})],s.prototype,"animationName",void 0),su([mt({type:Number,attribute:"animation-crossfade-duration"})],s.prototype,"animationCrossfadeDuration",void 0),s})(tu))))))));customElements.define("model-viewer",rd);export{rd as ModelViewerElement};
//# sourceMappingURL=model-viewer-module.min.js.map
