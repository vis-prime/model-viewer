!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t;e=void 0,t=function(e,t){function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var s=i(t);
/**
       * @license
       * Copyright 2017 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */const n=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(i){i.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}};function r(e){return(t,i)=>void 0!==i?((e,t,i)=>{t.constructor.createProperty(i,e)})(e,t,i):n(e,t)
/**
       * @license
       * Copyright 2021 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */}var o;null===(o=window.HTMLSlotElement)||void 0===o||o.prototype.assignedElements;
/**
       * @license
       * Copyright 2019 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */
const a=window,A=a.ShadowRoot&&(void 0===a.ShadyCSS||a.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,l=Symbol(),h=new WeakMap;class c{constructor(e,t,i){if(this._$cssResult$=!0,i!==l)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(A&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=h.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&h.set(t,e))}return e}toString(){return this.cssText}}const u=A?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new c("string"==typeof e?e:e+"",void 0,l))(t)})(e):e
/**
       * @license
       * Copyright 2017 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */;var g;const d=window,p=d.trustedTypes,m=p?p.emptyScript:"",I=d.reactiveElementPolyfillSupport,f={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},C=(e,t)=>t!==e&&(t==t||e==e),E={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:C},B="finalized";class y extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const s=this._$Ep(i,t);void 0!==s&&(this._$Ev.set(s,i),e.push(s))})),e}static createProperty(e,t=E){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i="symbol"==typeof e?Symbol():"__"+e,s=this.getPropertyDescriptor(e,i,t);void 0!==s&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(s){const n=this[e];this[t]=s,this.requestUpdate(e,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||E}static finalize(){if(this.hasOwnProperty(B))return!1;this[B]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(u(e))}else void 0!==e&&t.push(u(e));return t}static _$Ep(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,i;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(i=e.hostConnected)||void 0===i||i.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{A?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const i=document.createElement("style"),s=a.litNonce;void 0!==s&&i.setAttribute("nonce",s),i.textContent=t.cssText,e.appendChild(i)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=E){var s;const n=this.constructor._$Ep(e,i);if(void 0!==n&&!0===i.reflect){const r=(void 0!==(null===(s=i.converter)||void 0===s?void 0:s.toAttribute)?i.converter:f).toAttribute(t,i.type);this._$El=e,null==r?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(e,t){var i;const s=this.constructor,n=s._$Ev.get(e);if(void 0!==n&&this._$El!==n){const e=s.getPropertyOptions(n),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(i=e.converter)||void 0===i?void 0:i.fromAttribute)?e.converter:f;this._$El=n,this[n]=r.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,i){let s=!0;void 0!==e&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||C)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===i.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,i))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(i)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
       * @license
       * Copyright 2017 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */
var w;y[B]=!0,y.elementProperties=new Map,y.elementStyles=[],y.shadowRootOptions={mode:"open"},null==I||I({ReactiveElement:y}),(null!==(g=d.reactiveElementVersions)&&void 0!==g?g:d.reactiveElementVersions=[]).push("1.6.3");const Q=window,v=Q.trustedTypes,S=v?v.createPolicy("lit-html",{createHTML:e=>e}):void 0,b="$lit$",x=`lit$${(Math.random()+"").slice(9)}$`,M="?"+x,R=`<${M}>`,T=document,D=()=>T.createComment(""),L=e=>null===e||"object"!=typeof e&&"function"!=typeof e,F=Array.isArray,k="[ \t\n\f\r]",_=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,U=/-->/g,G=/>/g,N=RegExp(`>|${k}(?:([^\\s"'>=/]+)(${k}*=${k}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),P=/'/g,O=/"/g,H=/^(?:script|style|textarea|title)$/i,q=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),V=Symbol.for("lit-noChange"),K=Symbol.for("lit-nothing"),J=new WeakMap,$=T.createTreeWalker(T,129,null,!1);function Y(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==S?S.createHTML(t):t}const z=(e,t)=>{const i=e.length-1,s=[];let n,r=2===t?"<svg>":"",o=_;for(let t=0;t<i;t++){const i=e[t];let a,A,l=-1,h=0;for(;h<i.length&&(o.lastIndex=h,A=o.exec(i),null!==A);)h=o.lastIndex,o===_?"!--"===A[1]?o=U:void 0!==A[1]?o=G:void 0!==A[2]?(H.test(A[2])&&(n=RegExp("</"+A[2],"g")),o=N):void 0!==A[3]&&(o=N):o===N?">"===A[0]?(o=null!=n?n:_,l=-1):void 0===A[1]?l=-2:(l=o.lastIndex-A[2].length,a=A[1],o=void 0===A[3]?N:'"'===A[3]?O:P):o===O||o===P?o=N:o===U||o===G?o=_:(o=N,n=void 0);const c=o===N&&e[t+1].startsWith("/>")?" ":"";r+=o===_?i+R:l>=0?(s.push(a),i.slice(0,l)+b+i.slice(l)+x+c):i+x+(-2===l?(s.push(void 0),t):c)}return[Y(e,r+(e[i]||"<?>")+(2===t?"</svg>":"")),s]};class j{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let n=0,r=0;const o=e.length-1,a=this.parts,[A,l]=z(e,t);if(this.el=j.createElement(A,i),$.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(s=$.nextNode())&&a.length<o;){if(1===s.nodeType){if(s.hasAttributes()){const e=[];for(const t of s.getAttributeNames())if(t.endsWith(b)||t.startsWith(x)){const i=l[r++];if(e.push(t),void 0!==i){const e=s.getAttribute(i.toLowerCase()+b).split(x),t=/([.?@])?(.*)/.exec(i);a.push({type:1,index:n,name:t[2],strings:e,ctor:"."===t[1]?te:"?"===t[1]?se:"@"===t[1]?ne:ee})}else a.push({type:6,index:n})}for(const t of e)s.removeAttribute(t)}if(H.test(s.tagName)){const e=s.textContent.split(x),t=e.length-1;if(t>0){s.textContent=v?v.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],D()),$.nextNode(),a.push({type:2,index:++n});s.append(e[t],D())}}}else if(8===s.nodeType)if(s.data===M)a.push({type:2,index:n});else{let e=-1;for(;-1!==(e=s.data.indexOf(x,e+1));)a.push({type:7,index:n}),e+=x.length-1}n++}}static createElement(e,t){const i=T.createElement("template");return i.innerHTML=e,i}}function W(e,t,i=e,s){var n,r,o,a;if(t===V)return t;let A=void 0!==s?null===(n=i._$Co)||void 0===n?void 0:n[s]:i._$Cl;const l=L(t)?void 0:t._$litDirective$;return(null==A?void 0:A.constructor)!==l&&(null===(r=null==A?void 0:A._$AO)||void 0===r||r.call(A,!1),void 0===l?A=void 0:(A=new l(e),A._$AT(e,i,s)),void 0!==s?(null!==(o=(a=i)._$Co)&&void 0!==o?o:a._$Co=[])[s]=A:i._$Cl=A),void 0!==A&&(t=W(e,A._$AS(e,t.values),A,s)),t}class X{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:i},parts:s}=this._$AD,n=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:T).importNode(i,!0);$.currentNode=n;let r=$.nextNode(),o=0,a=0,A=s[0];for(;void 0!==A;){if(o===A.index){let t;2===A.type?t=new Z(r,r.nextSibling,this,e):1===A.type?t=new A.ctor(r,A.name,A.strings,this,e):6===A.type&&(t=new re(r,this,e)),this._$AV.push(t),A=s[++a]}o!==(null==A?void 0:A.index)&&(r=$.nextNode(),o++)}return $.currentNode=T,n}v(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class Z{constructor(e,t,i,s){var n;this.type=2,this._$AH=K,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cp=null===(n=null==s?void 0:s.isConnected)||void 0===n||n}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=W(this,e,t),L(e)?e===K||null==e||""===e?(this._$AH!==K&&this._$AR(),this._$AH=K):e!==this._$AH&&e!==V&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):(e=>F(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==K&&L(this._$AH)?this._$AA.nextSibling.data=e:this.$(T.createTextNode(e)),this._$AH=e}g(e){var t;const{values:i,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=j.createElement(Y(s.h,s.h[0]),this.options)),s);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===n)this._$AH.v(i);else{const e=new X(n,this),t=e.u(this.options);e.v(i),this.$(t),this._$AH=e}}_$AC(e){let t=J.get(e.strings);return void 0===t&&J.set(e.strings,t=new j(e)),t}T(e){F(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,s=0;for(const n of e)s===t.length?t.push(i=new Z(this.k(D()),this.k(D()),this,this.options)):i=t[s],i._$AI(n),s++;s<t.length&&(this._$AR(i&&i._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class ee{constructor(e,t,i,s,n){this.type=1,this._$AH=K,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=K}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,s){const n=this.strings;let r=!1;if(void 0===n)e=W(this,e,t,0),r=!L(e)||e!==this._$AH&&e!==V,r&&(this._$AH=e);else{const s=e;let o,a;for(e=n[0],o=0;o<n.length-1;o++)a=W(this,s[i+o],t,o),a===V&&(a=this._$AH[o]),r||(r=!L(a)||a!==this._$AH[o]),a===K?e=K:e!==K&&(e+=(null!=a?a:"")+n[o+1]),this._$AH[o]=a}r&&!s&&this.j(e)}j(e){e===K?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class te extends ee{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===K?void 0:e}}const ie=v?v.emptyScript:"";class se extends ee{constructor(){super(...arguments),this.type=4}j(e){e&&e!==K?this.element.setAttribute(this.name,ie):this.element.removeAttribute(this.name)}}class ne extends ee{constructor(e,t,i,s,n){super(e,t,i,s,n),this.type=5}_$AI(e,t=this){var i;if((e=null!==(i=W(this,e,t,0))&&void 0!==i?i:K)===V)return;const s=this._$AH,n=e===K&&s!==K||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,r=e!==K&&(s===K||n);n&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==i?i:this.element,e):this._$AH.handleEvent(e)}}class re{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){W(this,e)}}const oe=Q.litHtmlPolyfillSupport;null==oe||oe(j,Z),(null!==(w=Q.litHtmlVersions)&&void 0!==w?w:Q.litHtmlVersions=[]).push("2.8.0");const ae=(e,t,i)=>{var s,n;const r=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:t;let o=r._$litPart$;if(void 0===o){const e=null!==(n=null==i?void 0:i.renderBefore)&&void 0!==n?n:null;r._$litPart$=o=new Z(t.insertBefore(D(),e),e,void 0,null!=i?i:{})}return o._$AI(e),o
/**
       * @license
       * Copyright 2019 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */},Ae=window,le=Ae.ShadowRoot&&(void 0===Ae.ShadyCSS||Ae.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,he=Symbol(),ce=new WeakMap;class ue{constructor(e,t,i){if(this._$cssResult$=!0,i!==he)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(le&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=ce.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&ce.set(t,e))}return e}toString(){return this.cssText}}const ge=le?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new ue("string"==typeof e?e:e+"",void 0,he))(t)})(e):e
/**
       * @license
       * Copyright 2017 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */;var de;const pe=window,me=pe.trustedTypes,Ie=me?me.emptyScript:"",fe=pe.reactiveElementPolyfillSupport,Ce={toAttribute(e,t){switch(t){case Boolean:e=e?Ie:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},Ee=(e,t)=>t!==e&&(t==t||e==e),Be={attribute:!0,type:String,converter:Ce,reflect:!1,hasChanged:Ee},ye="finalized";class we extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const s=this._$Ep(i,t);void 0!==s&&(this._$Ev.set(s,i),e.push(s))})),e}static createProperty(e,t=Be){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i="symbol"==typeof e?Symbol():"__"+e,s=this.getPropertyDescriptor(e,i,t);void 0!==s&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(s){const n=this[e];this[t]=s,this.requestUpdate(e,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Be}static finalize(){if(this.hasOwnProperty(ye))return!1;this[ye]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(ge(e))}else void 0!==e&&t.push(ge(e));return t}static _$Ep(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,i;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(i=e.hostConnected)||void 0===i||i.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{le?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const i=document.createElement("style"),s=Ae.litNonce;void 0!==s&&i.setAttribute("nonce",s),i.textContent=t.cssText,e.appendChild(i)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=Be){var s;const n=this.constructor._$Ep(e,i);if(void 0!==n&&!0===i.reflect){const r=(void 0!==(null===(s=i.converter)||void 0===s?void 0:s.toAttribute)?i.converter:Ce).toAttribute(t,i.type);this._$El=e,null==r?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(e,t){var i;const s=this.constructor,n=s._$Ev.get(e);if(void 0!==n&&this._$El!==n){const e=s.getPropertyOptions(n),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(i=e.converter)||void 0===i?void 0:i.fromAttribute)?e.converter:Ce;this._$El=n,this[n]=r.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,i){let s=!0;void 0!==e&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||Ee)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===i.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,i))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(i)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
       * @license
       * Copyright 2017 Google LLC
       * SPDX-License-Identifier: BSD-3-Clause
       */
var Qe,ve;we[ye]=!0,we.elementProperties=new Map,we.elementStyles=[],we.shadowRootOptions={mode:"open"},null==fe||fe({ReactiveElement:we}),(null!==(de=pe.reactiveElementVersions)&&void 0!==de?de:pe.reactiveElementVersions=[]).push("1.6.3");class Se extends we{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=ae(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return V}}Se.finalized=!0,Se._$litElement$=!0,null===(Qe=globalThis.litElementHydrateSupport)||void 0===Qe||Qe.call(globalThis,{LitElement:Se});const be=globalThis.litElementPolyfillSupport;null==be||be({LitElement:Se}),(null!==(ve=globalThis.litElementVersions)&&void 0!==ve?ve:globalThis.litElementVersions=[]).push("3.3.3");const xe=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,Me=xe&&null!=self.XRSession.prototype.requestHitTestSource,Re=null!=self.ResizeObserver,Te=null!=self.IntersectionObserver,De=Me;(()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})(),/\bCrOS\b/.test(navigator.userAgent);const Le=/android/i.test(navigator.userAgent),Fe=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const ke=/firefox/i.test(navigator.userAgent),_e=/OculusBrowser/.test(navigator.userAgent);Fe&&/CriOS\//.test(navigator.userAgent);const Ue=Le&&!ke&&!_e,Ge=Boolean(window.webkit&&window.webkit.messageHandlers),Ne=(()=>{if(Fe){if(Ge)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}}return!1})(),Pe=e=>e&&"null"!==e?He(e):null,Oe=()=>{if(De)return;const e=[];throw xe||e.push("WebXR Device API"),Me||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},He=e=>new URL(e,window.location.toString()).toString(),qe=(e,t)=>{let i=null;return(...s)=>{null!=i&&self.clearTimeout(i),i=self.setTimeout((()=>{i=null,e(...s)}),t)}},Ve=(e,t,i)=>Math.max(t,Math.min(i,e)),Ke=(()=>{const e=(()=>{var e;if(null===(e=document.documentElement.getAttribute("itemtype"))||void 0===e?void 0:e.includes("schema.org/SearchResultsPage"))return!0;const t=null!=document.head?Array.from(document.head.querySelectorAll("meta")):[];for(const e of t)if("viewport"===e.name)return!0;return!1})();return e||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>e?window.devicePixelRatio:1})(),Je=(()=>{const e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})();var $e=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Ye=Symbol("currentEnvironmentMap"),ze=Symbol("currentBackground"),je=Symbol("updateEnvironment"),We=Symbol("cancelEnvironmentUpdate"),Xe=q`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View in your space">
        ${q`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${q`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${q`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,Ze=new WeakMap;class et extends t.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,n){const r=new t.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,i,n)}),s,n)}parse(e,i,s){this.decodeDracoFile(e,i,null,null,t.SRGBColorSpace).catch(s)}decodeDracoFile(e,i,s,n,r=t.LinearSRGBColorSpace){const o={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:r};return this.decodeGeometry(e,o).then(i)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Ze.has(e)){const t=Ze.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,r=e.byteLength,o=this._getWorker(n,r).then((i=>(s=i,new Promise(((i,r)=>{s._callbacks[n]={resolve:i,reject:r},s.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return o.catch((()=>!0)).then((()=>{s&&n&&this._releaseTask(s,n)})),Ze.set(e,{key:i,promise:o}),o}_createGeometry(e){const i=new t.BufferGeometry;e.index&&i.setIndex(new t.BufferAttribute(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],r=n.name,o=n.array,a=n.itemSize,A=new t.BufferAttribute(o,a);"color"===r&&(this._assignVertexColorSpace(A,n.vertexColorSpace),A.normalized=o instanceof Float32Array==0),i.setAttribute(r,A)}return i}_assignVertexColorSpace(e,i){if(i!==t.SRGBColorSpace)return;const s=new t.Color;for(let t=0,i=e.count;t<i;t++)s.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,s.r,s.g,s.b)}_loadLibrary(e,i){const s=new t.FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{s.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const s=tt.toString(),n=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function tt(){let e,t;function i(e,t,i,s,n,r){const o=r.num_components(),a=i.num_points()*o,A=a*n.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),h=e._malloc(A);t.GetAttributeDataArrayForAllPoints(i,r,l,A,h);const c=new n(e.HEAPF32.buffer,h,a).slice();return e._free(h),{name:s,array:c,itemSize:o}}onmessage=function(s){const n=s.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const s=n.buffer,r=n.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder;try{const e=function(e,t,s,n){const r=n.attributeIDs,o=n.attributeTypes;let a,A;const l=t.GetEncodedGeometryType(s);if(l===e.TRIANGULAR_MESH)a=new e.Mesh,A=t.DecodeArrayToMesh(s,s.byteLength,a);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,A=t.DecodeArrayToPointCloud(s,s.byteLength,a)}if(!A.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const h={index:null,attributes:[]};for(const s in r){const A=self[o[s]];let l,c;if(n.useUniqueIDs)c=r[s],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[r[s]]),-1===c)continue;l=t.GetAttribute(a,c)}const u=i(e,t,a,s,A,l);"color"===s&&(u.vertexColorSpace=n.vertexColorSpace),h.attributes.push(u)}return l===e.TRIANGULAR_MESH&&(h.index=function(e,t,i){const s=i.num_faces(),n=3*s,r=4*n,o=e._malloc(r);t.GetTrianglesUInt32Array(i,r,o);const a=new Uint32Array(e.HEAPF32.buffer,o,n).slice();return e._free(o),{array:a,itemSize:1}}(e,t,a)),e.destroy(a),h}(t,o,new Int8Array(s),r),a=e.attributes.map((e=>e.array.buffer));e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},a)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(o)}}))}}}function it(e,i){if(i===t.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(i===t.TriangleFanDrawMode||i===t.TriangleStripDrawMode){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,r=[];if(i===t.TriangleFanDrawMode)for(let e=1;e<=n;e++)r.push(s.getX(0)),r.push(s.getX(e)),r.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(r.push(s.getX(e)),r.push(s.getX(e+1)),r.push(s.getX(e+2))):(r.push(s.getX(e+2)),r.push(s.getX(e+1)),r.push(s.getX(e)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(r),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),e}class st extends t.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new lt(e)})),this.register((function(e){return new It(e)})),this.register((function(e){return new ft(e)})),this.register((function(e){return new Ct(e)})),this.register((function(e){return new ct(e)})),this.register((function(e){return new ut(e)})),this.register((function(e){return new gt(e)})),this.register((function(e){return new dt(e)})),this.register((function(e){return new At(e)})),this.register((function(e){return new pt(e)})),this.register((function(e){return new ht(e)})),this.register((function(e){return new mt(e)})),this.register((function(e){return new ot(e)})),this.register((function(e){return new Et(e)})),this.register((function(e){return new Bt(e)}))}load(e,i,s,n){const r=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){n?n(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},A=new t.FileLoader(this.manager);A.setPath(this.path),A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(e,(function(t){try{r.parse(t,o,(function(t){i(t),r.manager.itemEnd(e)}),a)}catch(e){a(e)}}),s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let n;const r={},o={},a=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===yt){try{r[rt.KHR_BINARY_GLTF]=new vt(e)}catch(e){return void(s&&s(e))}n=JSON.parse(r[rt.KHR_BINARY_GLTF].content)}else n=JSON.parse(a.decode(e));else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const A=new Wt(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});A.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](A);o[t.name]=t,r[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){const t=n.extensionsUsed[e],i=n.extensionsRequired||[];switch(t){case rt.KHR_MATERIALS_UNLIT:r[t]=new at;break;case rt.KHR_DRACO_MESH_COMPRESSION:r[t]=new St(n,this.dracoLoader);break;case rt.KHR_TEXTURE_TRANSFORM:r[t]=new bt;break;case rt.KHR_MESH_QUANTIZATION:r[t]=new xt;break;default:i.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}A.setExtensions(r),A.setPlugins(o),A.parse(i,s)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,t,s,n)}))}}function nt(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const rt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ot{constructor(e){this.parser=e,this.name=rt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let n=i.cache.get(s);if(n)return n;const r=i.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let a;const A=new t.Color(16777215);void 0!==o.color&&A.setRGB(o.color[0],o.color[1],o.color[2],t.LinearSRGBColorSpace);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new t.DirectionalLight(A),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new t.PointLight(A),a.distance=l;break;case"spot":a=new t.SpotLight(A),a.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,Kt(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=i.createUniqueName(o.name||"light_"+e),n=Promise.resolve(a),i.cache.add(s,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],n=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return i._getNodeRef(t.cache,n,e)}))}}class at{constructor(){this.name=rt.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,i,s){const n=[];e.color=new t.Color(1,1,1),e.opacity=1;const r=i.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const i=r.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],t.LinearSRGBColorSpace),e.opacity=i[3]}void 0!==r.baseColorTexture&&n.push(s.assignTexture(e,"map",r.baseColorTexture,t.SRGBColorSpace))}return Promise.all(n)}}class At{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class lt{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(i.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(s.assignTexture(i,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(i.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(s.assignTexture(i,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(s.assignTexture(i,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new t.Vector2(e,e)}return Promise.all(r)}}class ht{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class ct{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];i.sheenColor=new t.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;const o=n.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;i.sheenColor.setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace)}return void 0!==o.sheenRoughnessFactor&&(i.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(s.assignTexture(i,"sheenColorMap",o.sheenColorTexture,t.SRGBColorSpace)),void 0!==o.sheenRoughnessTexture&&r.push(s.assignTexture(i,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class ut{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class gt{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];i.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(s.assignTexture(i,"thicknessMap",o.thicknessTexture)),i.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return i.attenuationColor=(new t.Color).setRGB(a[0],a[1],a[2],t.LinearSRGBColorSpace),Promise.all(r)}}class dt{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class pt{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];i.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(s.assignTexture(i,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return i.specularColor=(new t.Color).setRGB(a[0],a[1],a[2],t.LinearSRGBColorSpace),void 0!==o.specularColorTexture&&r.push(s.assignTexture(i,"specularColorMap",o.specularColorTexture,t.SRGBColorSpace)),Promise.all(r)}}class mt{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&n.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}}class It{constructor(e){this.parser=e,this.name=rt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class ft{constructor(e){this.parser=e,this.name=rt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],o=s.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ct{constructor(e){this.parser=e,this.name=rt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],o=s.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Et{constructor(e){this.name=rt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){const i=e.byteOffset||0,s=e.byteLength||0,r=e.count,o=e.byteStride,a=new Uint8Array(t,i,s);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(r,o,a,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){const t=new ArrayBuffer(r*o);return n.decodeGltfBuffer(new Uint8Array(t),r,o,a,e.mode,e.filter),t}))}))}return null}}class Bt{constructor(e){this.name=rt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,s=i.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const n=i.meshes[s.mesh];for(const e of n.primitives)if(e.mode!==Dt.TRIANGLES&&e.mode!==Dt.TRIANGLE_STRIP&&e.mode!==Dt.TRIANGLE_FAN&&void 0!==e.mode)return null;const r=s.extensions[this.name].attributes,o=[],a={};for(const e in r)o.push(this.parser.getDependency("accessor",r[e]).then((t=>(a[e]=t,a[e]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const i=e.pop(),s=i.isGroup?i.children:[i],n=e[0].count,r=[];for(const e of s){const i=new t.Matrix4,s=new t.Vector3,o=new t.Quaternion,A=new t.Vector3(1,1,1),l=new t.InstancedMesh(e.geometry,e.material,n);for(let e=0;e<n;e++)a.TRANSLATION&&s.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&A.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,i.compose(s,o,A));for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);t.Object3D.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),r.push(l)}return i.isGroup?(i.clear(),i.add(...r),i):r[0]})))}}const yt="glTF",wt=1313821514,Qt=5130562;class vt{constructor(e){this.name=rt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==yt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let r=0;for(;r<s;){const t=n.getUint32(r,!0);r+=4;const s=n.getUint32(r,!0);if(r+=4,s===wt){const s=new Uint8Array(e,12+r,t);this.content=i.decode(s)}else if(s===Qt){const i=12+r;this.body=e.slice(i,i+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class St{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=rt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},A={};for(const e in r){const t=Ut[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const s=Ut[t]||t.toLowerCase();if(void 0!==r[t]){const n=i.accessors[e.attributes[t]],r=Lt[n.componentType];A[s]=r.name,a[s]=!0===n.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){s.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],s=a[t];void 0!==s&&(i.normalized=s)}t(e)}),o,A)}))}))}}class bt{constructor(){this.name=rt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class xt{constructor(){this.name=rt.KHR_MESH_QUANTIZATION}}class Mt extends t.Interpolant{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s*3+s;for(let e=0;e!==s;e++)t[e]=i[n+e];return t}interpolate_(e,t,i,s){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,A=3*o,l=s-t,h=(i-t)/l,c=h*h,u=c*h,g=e*A,d=g-A,p=-2*u+3*c,m=u-c,I=1-p,f=m-c+h;for(let e=0;e!==o;e++){const t=r[d+e+o],i=r[d+e+a]*l,s=r[g+e+o],A=r[g+e]*l;n[e]=I*t+f*i+p*s+m*A}return n}}const Rt=new t.Quaternion;class Tt extends Mt{interpolate_(e,t,i,s){const n=super.interpolate_(e,t,i,s);return Rt.fromArray(n).normalize().toArray(n),n}}const Dt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Lt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ft={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},kt={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},_t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ut={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Nt={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},Pt="OPAQUE",Ot="MASK",Ht="BLEND";function qt(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),e.DefaultMaterial}function Vt(e,t,i){for(const s in i.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=i.extensions[s])}function Kt(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Jt(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,s=t.weights.length;i<s;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,s=i.length;t<s;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $t(e){let t;const i=e.extensions&&e.extensions[rt.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+Yt(i.attributes):e.indices+":"+Yt(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+Yt(e.targets[i]);return t}function Yt(e){let t="";const i=Object.keys(e).sort();for(let s=0,n=i.length;s<n;s++)t+=i[s]+":"+e[i[s]]+";";return t}function zt(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const jt=new t.Matrix4;class Wt{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new nt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=!1,r=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||n&&r<98?this.textureLoader=new t.TextureLoader(this.options.manager):this.textureLoader=new t.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const r={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:i,userData:{}};Vt(n,r,s),Kt(r,s),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),n=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,s]of e.children.entries())n(s,t.children[i])};return n(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const n=e(t[s]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return i.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===e)return Promise.resolve(this.extensions[rt.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,r){s.load(t.LoaderUtils.resolveURL(i.uri,n.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+i)}))}loadAccessor(e){const i=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=_t[n.type],i=Lt[n.componentType],s=!0===n.normalized,r=new i(n.count*e);return Promise.resolve(new t.BufferAttribute(r,e,s))}const r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],o=_t[n.type],a=Lt[n.componentType],A=a.BYTES_PER_ELEMENT,l=A*o,h=n.byteOffset||0,c=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let g,d;if(c&&c!==l){const e=Math.floor(h/c),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=i.cache.get(s);l||(g=new a(r,e*c,n.count*c/A),l=new t.InterleavedBuffer(g,c/A),i.cache.add(s,l)),d=new t.InterleavedBufferAttribute(l,o,h%c/A,u)}else g=null===r?new a(n.count*o):new a(r,h,n.count*o),d=new t.BufferAttribute(g,o,u);if(void 0!==n.sparse){const i=_t.SCALAR,s=Lt[n.sparse.indices.componentType],A=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,h=new s(e[1],A,n.sparse.count*i),c=new a(e[2],l,n.sparse.count*o);null!==r&&(d=new t.BufferAttribute(d.array.slice(),d.itemSize,d.normalized));for(let e=0,t=h.length;e<t;e++){const t=h[e];if(d.setX(t,c[e*o]),o>=2&&d.setY(t,c[e*o+1]),o>=3&&d.setZ(t,c[e*o+2]),o>=4&&d.setW(t,c[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,n=t.images[s];let r=this.textureLoader;if(n.uri){const e=i.manager.getHandler(n.uri);null!==e&&(r=e)}return this.loadTextureImage(e,s,r)}loadTextureImage(e,i,s){const n=this,r=this.json,o=r.textures[e],a=r.images[i],A=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[A])return this.textureCache[A];const l=this.loadImageSource(i,s).then((function(i){i.flipY=!1,i.name=o.name||a.name||"",""===i.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(i.name=a.uri);const s=(r.samplers||{})[o.sampler]||{};return i.magFilter=Ft[s.magFilter]||t.LinearFilter,i.minFilter=Ft[s.minFilter]||t.LinearMipmapLinearFilter,i.wrapS=kt[s.wrapS]||t.RepeatWrapping,i.wrapT=kt[s.wrapT]||t.RepeatWrapping,n.associations.set(i,{textures:e}),i})).catch((function(){return null}));return this.textureCache[A]=l,l}loadImageSource(e,i){const s=this,n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const o=n.images[e],a=self.URL||self.webkitURL;let A=o.uri||"",l=!1;if(void 0!==o.bufferView)A=s.getDependency("bufferView",o.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return A=a.createObjectURL(t),A}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(A).then((function(e){return new Promise((function(s,n){let o=s;!0===i.isImageBitmapLoader&&(o=function(e){const i=new t.Texture(e);i.needsUpdate=!0,s(i)}),i.load(t.LoaderUtils.resolveURL(e,r.path),o,void 0,n)}))})).then((function(e){var t;return!0===l&&a.revokeObjectURL(A),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",A),e}));return this.sourceCache[e]=h,h}assignTexture(e,t,i,s){const n=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),n.extensions[rt.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[rt.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(r);r=n.extensions[rt.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),n.associations.set(r,t)}}return void 0!==s&&(r.colorSpace=s),e[t]=r,r}))}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const n=void 0===i.attributes.tangent,r=void 0!==i.attributes.color,o=void 0===i.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let i=this.cache.get(e);i||(i=new t.PointsMaterial,t.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(e,i)),s=i}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let i=this.cache.get(e);i||(i=new t.LineBasicMaterial,t.Material.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,this.cache.add(e,i)),s=i}if(n||r||o){let e="ClonedMaterial:"+s.uuid+":";n&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),r&&(t.vertexColors=!0),o&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const i=this,s=this.json,n=this.extensions,r=s.materials[e];let o;const a={},A=[];if((r.extensions||{})[rt.KHR_MATERIALS_UNLIT]){const e=n[rt.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),A.push(e.extendParams(a,r,i))}else{const s=r.pbrMetallicRoughness||{};if(a.color=new t.Color(1,1,1),a.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace),a.opacity=e[3]}void 0!==s.baseColorTexture&&A.push(i.assignTexture(a,"map",s.baseColorTexture,t.SRGBColorSpace)),a.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,a.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(A.push(i.assignTexture(a,"metalnessMap",s.metallicRoughnessTexture)),A.push(i.assignTexture(a,"roughnessMap",s.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),A.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=t.DoubleSide);const l=r.alphaMode||Pt;if(l===Ht?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===Ot&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==t.MeshBasicMaterial&&(A.push(i.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new t.Vector2(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&o!==t.MeshBasicMaterial&&(A.push(i.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==t.MeshBasicMaterial){const e=r.emissiveFactor;a.emissive=(new t.Color).setRGB(e[0],e[1],e[2],t.LinearSRGBColorSpace)}return void 0!==r.emissiveTexture&&o!==t.MeshBasicMaterial&&A.push(i.assignTexture(a,"emissiveMap",r.emissiveTexture,t.SRGBColorSpace)),Promise.all(A).then((function(){const t=new o(a);return r.name&&(t.name=r.name),Kt(t,r),i.associations.set(t,{materials:e}),r.extensions&&Vt(n,t,r),t}))}createUniqueName(e){const i=t.PropertyBinding.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,s=this.extensions,n=this.primitiveCache;function r(e){return s[rt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then((function(t){return Xt(t,e,i)}))}const o=[];for(let s=0,a=e.length;s<a;s++){const a=e[s],A=$t(a),l=n[A];if(l)o.push(l.promise);else{let e;e=a.extensions&&a.extensions[rt.KHR_DRACO_MESH_COMPRESSION]?r(a):Xt(new t.BufferGeometry,a,i),n[A]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const i=this,s=this.json,n=this.extensions,r=s.meshes[e],o=r.primitives,a=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?qt(this.cache):this.getDependency("material",o[e].material);a.push(t)}return a.push(i.loadGeometries(o)),Promise.all(a).then((function(s){const a=s.slice(0,s.length-1),A=s[s.length-1],l=[];for(let s=0,h=A.length;s<h;s++){const h=A[s],c=o[s];let u;const g=a[s];if(c.mode===Dt.TRIANGLES||c.mode===Dt.TRIANGLE_STRIP||c.mode===Dt.TRIANGLE_FAN||void 0===c.mode)u=!0===r.isSkinnedMesh?new t.SkinnedMesh(h,g):new t.Mesh(h,g),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===Dt.TRIANGLE_STRIP?u.geometry=it(u.geometry,t.TriangleStripDrawMode):c.mode===Dt.TRIANGLE_FAN&&(u.geometry=it(u.geometry,t.TriangleFanDrawMode));else if(c.mode===Dt.LINES)u=new t.LineSegments(h,g);else if(c.mode===Dt.LINE_STRIP)u=new t.Line(h,g);else if(c.mode===Dt.LINE_LOOP)u=new t.LineLoop(h,g);else{if(c.mode!==Dt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new t.Points(h,g)}Object.keys(u.geometry.morphAttributes).length>0&&Jt(u,r),u.name=i.createUniqueName(r.name||"mesh_"+e),Kt(u,r),c.extensions&&Vt(n,u,c),i.assignFinalMaterial(u),l.push(u)}for(let t=0,s=l.length;t<s;t++)i.associations.set(l[t],{meshes:e,primitives:t});if(1===l.length)return r.extensions&&Vt(n,l[0],r),l[0];const h=new t.Group;r.extensions&&Vt(n,h,r),i.associations.set(h,{meshes:e});for(let e=0,t=l.length;e<t;e++)h.add(l[e]);return h}))}loadCamera(e){let i;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?i=new t.PerspectiveCamera(t.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(i=new t.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Kt(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s=[];for(let e=0,t=i.joints.length;e<t;e++)s.push(this._loadNodeShallow(i.joints[e]));return void 0!==i.inverseBindMatrices?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(e){const s=e.pop(),n=e,r=[],o=[];for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a){r.push(a);const i=new t.Matrix4;null!==s&&i.fromArray(s.array,16*e),o.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[e])}return new t.Skeleton(r,o)}))}loadAnimation(e){const i=this.json,s=this,n=i.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],A=[],l=[],h=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],i=n.samplers[t.sampler],s=t.target,r=s.node,c=void 0!==n.parameters?n.parameters[i.input]:i.input,u=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(o.push(this.getDependency("node",r)),a.push(this.getDependency("accessor",c)),A.push(this.getDependency("accessor",u)),l.push(i),h.push(s))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(A),Promise.all(l),Promise.all(h)]).then((function(e){const i=e[0],n=e[1],o=e[2],a=e[3],A=e[4],l=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],r=n[e],h=o[e],c=a[e],u=A[e];if(void 0===t)continue;t.updateMatrix&&t.updateMatrix();const g=s._createAnimationTracks(t,r,h,c,u);if(g)for(let e=0;e<g.length;e++)l.push(g[e])}return new t.AnimationClip(r,void 0,l)}))}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return void 0===s.mesh?null:i.getDependency("mesh",s.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),n=[],r=i.children||[];for(let e=0,i=r.length;e<i;e++)n.push(t.getDependency("node",r[e]));const o=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(n),o]).then((function(e){const t=e[0],i=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,jt)}));for(let e=0,s=i.length;e<s;e++)t.add(i[e]);return t}))}_loadNodeShallow(e){const i=this.json,s=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=i.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],A=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return A&&a.push(A),void 0!==r.camera&&a.push(n.getDependency("camera",r.camera).then((function(e){return n._getNodeRef(n.cameraCache,r.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(i){let a;if(a=!0===r.isBone?new t.Bone:i.length>1?new t.Group:1===i.length?i[0]:new t.Object3D,a!==i[0])for(let e=0,t=i.length;e<t;e++)a.add(i[e]);if(r.name&&(a.userData.name=r.name,a.name=o),Kt(a,r),r.extensions&&Vt(s,a,r),void 0!==r.matrix){const e=new t.Matrix4;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],n=this,r=new t.Group;s.name&&(r.name=n.createUniqueName(s.name)),Kt(r,s),s.extensions&&Vt(i,r,s);const o=s.nodes||[],a=[];for(let e=0,t=o.length;e<t;e++)a.push(n.getDependency("node",o[e]));return Promise.all(a).then((function(e){for(let t=0,i=e.length;t<i;t++)r.add(e[t]);return n.associations=(e=>{const i=new Map;for(const[e,s]of n.associations)(e instanceof t.Material||e instanceof t.Texture)&&i.set(e,s);return e.traverse((e=>{const t=n.associations.get(e);null!=t&&i.set(e,t)})),i})(r),r}))}_createAnimationTracks(e,i,s,n,r){const o=[],a=e.name?e.name:e.uuid,A=[];let l;switch(Gt[r.path]===Gt.weights?e.traverse((function(e){e.morphTargetInfluences&&A.push(e.name?e.name:e.uuid)})):A.push(a),Gt[r.path]){case Gt.weights:l=t.NumberKeyframeTrack;break;case Gt.rotation:l=t.QuaternionKeyframeTrack;break;case Gt.position:case Gt.scale:l=t.VectorKeyframeTrack;break;default:l=1===s.itemSize?t.NumberKeyframeTrack:t.VectorKeyframeTrack}const h=void 0!==n.interpolation?Nt[n.interpolation]:t.InterpolateLinear,c=this._getArrayFromAccessor(s);for(let e=0,t=A.length;e<t;e++){const t=new l(A[e]+"."+Gt[r.path],i.array,c,h);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(t),o.push(t)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=zt(t.constructor),i=new Float32Array(t.length);for(let s=0,n=t.length;s<n;s++)i[s]=t[s]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof t.QuaternionKeyframeTrack?Tt:Mt)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Xt(e,i,s){const n=i.attributes,r=[];function o(t,i){return s.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in n){const i=Ut[t]||t.toLowerCase();i in e.attributes||r.push(o(n[t],i))}if(void 0!==i.indices&&!e.index){const t=s.getDependency("accessor",i.indices).then((function(t){e.setIndex(t)}));r.push(t)}return t.ColorManagement.workingColorSpace!==t.LinearSRGBColorSpace&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${t.ColorManagement.workingColorSpace}" not supported.`),Kt(e,i),function(e,i,s){const n=i.attributes,r=new t.Box3;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],i=e.min,o=e.max;if(void 0===i||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new t.Vector3(i[0],i[1],i[2]),new t.Vector3(o[0],o[1],o[2])),e.normalized){const t=zt(Lt[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const o=i.targets;if(void 0!==o){const e=new t.Vector3,i=new t.Vector3;for(let t=0,n=o.length;t<n;t++){const n=o[t];if(void 0!==n.POSITION){const t=s.json.accessors[n.POSITION],r=t.min,o=t.max;if(void 0!==r&&void 0!==o){if(i.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),i.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),i.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),t.normalized){const e=zt(Lt[t.componentType]);i.multiplyScalar(e)}e.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new t.Sphere;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}(e,i,s),Promise.all(r).then((function(){return void 0!==i.targets?function(e,t,i){let s=!1,n=!1,r=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(r=!0),s&&n&&r)break}if(!s&&!n&&!r)return Promise.resolve(e);const o=[],a=[],A=[];for(let l=0,h=t.length;l<h;l++){const h=t[l];if(s){const t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(n){const t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(r){const t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;A.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(A)]).then((function(t){const i=t[0],o=t[1],a=t[2];return s&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,i.targets,s):e}))}class Zt{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:t,msg:i,transfer:s}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,s)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{const s=this._getIdleWorker();-1!==s?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ei=2,ti=0,ii=1,si=10;class ni{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class ri{constructor(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const oi=[171,75,84,88,32,50,48,187,13,10,26,10];function ai(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let Ai,li,hi;const ci={env:{emscripten_notify_memory_growth:function(e){hi=new Uint8Array(li.exports.memory.buffer)}}};class ui{init(){return Ai||(Ai="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+gi).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,ci))).then(this._init):WebAssembly.instantiate(Buffer.from(gi,"base64"),ci).then(this._init),Ai)}_init(e){li=e.instance,ci.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!li)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=li.exports.malloc(i);hi.set(e,s),t=t||Number(li.exports.ZSTD_findDecompressedSize(s,i));const n=li.exports.malloc(t),r=li.exports.ZSTD_decompress(n,t,s,i),o=hi.slice(n,n+r);return li.exports.free(s),li.exports.free(n),o}}const gi="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",di=new WeakMap;let pi,mi=0;class Ii extends t.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Zt,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new t.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new t.FileLoader(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const n=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,n]).then((([e,t])=>{const i=Ii.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(Ii.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ii.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ii.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),mi>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),mi++}return this.transcoderPending}load(e,i,s,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new t.FileLoader(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{if(di.has(e))return di.get(e).promise.then(i).catch(n);this._createTexture(e).then((e=>i?i(e):null)).catch(n)}),s,n)}_createTextureFrom(e,i){const{faces:s,width:n,height:r,format:o,type:a,error:A,dfdFlags:l}=e;if("error"===a)return Promise.reject(A);let h;if(6===i.faceCount)h=new t.CompressedCubeTexture(s,o,t.UnsignedByteType);else{const e=s[0].mipmaps;h=i.layerCount>1?new t.CompressedArrayTexture(e,n,r,i.layerCount,o,t.UnsignedByteType):new t.CompressedTexture(e,n,r,o,t.UnsignedByteType)}return h.minFilter=1===s[0].mipmaps.length?t.LinearFilter:t.LinearMipmapLinearFilter,h.magFilter=t.LinearFilter,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=Bi(i),h.premultiplyAlpha=!!(1&l),h}async _createTexture(e,i={}){const s=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,oi.length);if(t[0]!==oi[0]||t[1]!==oi[1]||t[2]!==oi[2]||t[3]!==oi[3]||t[4]!==oi[4]||t[5]!==oi[5]||t[6]!==oi[6]||t[7]!==oi[7]||t[8]!==oi[8]||t[9]!==oi[9]||t[10]!==oi[10]||t[11]!==oi[11])throw new Error("Missing KTX 2.0 identifier.");const i=new ni,s=17*Uint32Array.BYTES_PER_ELEMENT,n=new ri(e,oi.length,s,!0);i.vkFormat=n._nextUint32(),i.typeSize=n._nextUint32(),i.pixelWidth=n._nextUint32(),i.pixelHeight=n._nextUint32(),i.pixelDepth=n._nextUint32(),i.layerCount=n._nextUint32(),i.faceCount=n._nextUint32();const r=n._nextUint32();i.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),A=n._nextUint32(),l=n._nextUint32(),h=n._nextUint64(),c=n._nextUint64(),u=new ri(e,oi.length+s,3*r*8,!0);for(let t=0;t<r;t++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const g=new ri(e,o,a,!0),d={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},p=(d.descriptorBlockSize/4-6)/4;for(let e=0;e<p;e++){const t={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=g._nextInt32(),t.sampleUpper=g._nextInt32()):(t.sampleLower=g._nextUint32(),t.sampleUpper=g._nextUint32()),d.samples[e]=t}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(d);const m=new ri(e,A,l,!0);for(;m._offset<l;){const e=m._nextUint32(),t=m._scan(e),s=ai(t),n=m._scan(e-t.byteLength);i.keyValue[s]=s.match(/^ktx/i)?ai(n):n,m._offset%4&&m._skip(4-m._offset%4)}if(c<=0)return i;const I=new ri(e,h,c,!0),f=I._nextUint16(),C=I._nextUint16(),E=I._nextUint32(),B=I._nextUint32(),y=I._nextUint32(),w=I._nextUint32(),Q=[];for(let e=0;e<r;e++)Q.push({imageFlags:I._nextUint32(),rgbSliceByteOffset:I._nextUint32(),rgbSliceByteLength:I._nextUint32(),alphaSliceByteOffset:I._nextUint32(),alphaSliceByteLength:I._nextUint32()});const v=h+I._offset,S=v+E,b=S+B,x=b+y,M=new Uint8Array(e.buffer,e.byteOffset+v,E),R=new Uint8Array(e.buffer,e.byteOffset+S,B),T=new Uint8Array(e.buffer,e.byteOffset+b,y),D=new Uint8Array(e.buffer,e.byteOffset+x,w);return i.globalData={endpointCount:f,selectorCount:C,imageDescs:Q,endpointsData:M,selectorsData:R,tablesData:T,extendedData:D},i}(new Uint8Array(e));if(0!==s.vkFormat)return async function(e){const{vkFormat:i}=e;if(void 0===Ci[i])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let s;2===e.supercompressionScheme&&(pi||(pi=new Promise((async e=>{const t=new ui;await t.init(),e(t)}))),s=await pi);const n=[];for(let r=0;r<e.levels.length;r++){const o=Math.max(1,e.pixelWidth>>r),a=Math.max(1,e.pixelHeight>>r),A=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,l=e.levels[r];let h,c;if(0===e.supercompressionScheme)h=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");h=s.decode(l.levelData,l.uncompressedByteLength)}c=Ei[i]===t.FloatType?new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):Ei[i]===t.HalfFloatType?new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):h,n.push({data:c,width:o,height:a,depth:A})}let r;if(fi.has(Ci[i]))r=0===e.pixelDepth?new t.DataTexture(n[0].data,e.pixelWidth,e.pixelHeight):new t.Data3DTexture(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new t.CompressedTexture(n,e.pixelWidth,e.pixelHeight)}return r.mipmaps=n,r.type=Ei[i],r.format=Ci[i],r.colorSpace=Bi(e),r.needsUpdate=!0,Promise.resolve(r)}(s);const n=i,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e]))).then((e=>this._createTextureFrom(e.data,s)));return di.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),mi--,this}}Ii.BasisFormat={ETC1S:0,UASTC_4x4:1},Ii.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ii.EngineFormat={RGBAFormat:t.RGBAFormat,RGBA_ASTC_4x4_Format:t.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:t.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:t.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:t.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:t.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:t.RGB_ETC1_Format,RGB_ETC2_Format:t.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:t.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:t.RGB_S3TC_DXT1_Format},Ii.BasisWorker=function(){let e,t,i;const s=_EngineFormat,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",(function(o){const c=o.data;switch(c.type){case"init":e=c.config,u=c.transcoderBinary,t=new Promise((e=>{i={wasmBinary:u,onRuntimeInitialized:e},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:o,width:u,height:g,hasAlpha:d,format:p,dfdFlags:m}=function(t){const o=new i.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const u=o.isUASTC()?r.UASTC_4x4:r.ETC1S,g=o.getWidth(),d=o.getHeight(),p=o.getLayers()||1,m=o.getLevels(),I=o.getFaces(),f=o.getHasAlpha(),C=o.getDFDFlags(),{transcoderFormat:E,engineFormat:B}=function(t,i,o,h){let c,u;const g=t===r.ETC1S?a:A;for(let s=0;s<g.length;s++){const n=g[s];if(e[n.if]&&n.basisFormat.includes(t)&&!(h&&n.transcoderFormat.length<2)&&(!n.needsPowerOfTwo||l(i)&&l(o)))return c=n.transcoderFormat[h?1:0],u=n.engineFormat[h?1:0],{transcoderFormat:c,engineFormat:u}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),c=n.RGBA32,u=s.RGBAFormat,{transcoderFormat:c,engineFormat:u}}(u,g,d,f);if(!g||!d||!m)throw c(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw c(),new Error("THREE.KTX2Loader: .startTranscoding failed");const y=[],w=[];for(let e=0;e<I;e++){const t=[];for(let i=0;i<m;i++){const s=[];let n,r;for(let t=0;t<p;t++){const a=o.getImageLevelInfo(i,t,e);0!==e||0!==i||0!==t||a.origWidth%4==0&&a.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(n=a.origWidth,r=a.origHeight):(n=a.width,r=a.height);const A=new Uint8Array(o.getImageTranscodedSizeInBytes(i,t,0,E));if(!o.transcodeImage(A,i,t,e,E,0,-1,-1))throw c(),new Error("THREE.KTX2Loader: .transcodeImage failed.");s.push(A)}const a=h(s);t.push({data:a,width:n,height:r}),w.push(a.buffer)}y.push({mipmaps:t,width:g,height:d,format:B})}return c(),{faces:y,buffers:w,width:g,height:d,hasAlpha:f,format:B,dfdFlags:C}}(c.buffer);self.postMessage({type:"transcode",id:c.id,faces:t,width:u,height:g,hasAlpha:d,format:p,dfdFlags:m},o)}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}}))}var u}));const o=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),A=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(e){return e<=2||0==(e&e-1)&&0!==e}function h(e){if(1===e.length)return e[0];let t=0;for(let i=0;i<e.length;i++)t+=e[i].byteLength;const i=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];i.set(n,s),s+=n.byteLength}return i}};const fi=new Set([t.RGBAFormat,t.RGFormat,t.RedFormat]),Ci={109:t.RGBAFormat,97:t.RGBAFormat,37:t.RGBAFormat,43:t.RGBAFormat,103:t.RGFormat,83:t.RGFormat,16:t.RGFormat,22:t.RGFormat,100:t.RedFormat,76:t.RedFormat,15:t.RedFormat,9:t.RedFormat,166:t.RGBA_ASTC_6x6_Format,165:t.RGBA_ASTC_6x6_Format},Ei={109:t.FloatType,97:t.HalfFloatType,37:t.UnsignedByteType,43:t.UnsignedByteType,103:t.FloatType,83:t.HalfFloatType,16:t.UnsignedByteType,22:t.UnsignedByteType,100:t.FloatType,76:t.HalfFloatType,15:t.UnsignedByteType,9:t.UnsignedByteType,166:t.UnsignedByteType,165:t.UnsignedByteType};function Bi(e){const i=e.dataFormatDescriptor[0];return i.colorPrimaries===ii?i.transferFunction===ei?t.SRGBColorSpace:t.LinearSRGBColorSpace:i.colorPrimaries===si?i.transferFunction===ei?t.DisplayP3ColorSpace:t.LinearDisplayP3ColorSpace:(i.colorPrimaries===ti||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${i.colorPrimaries}"`),t.NoColorSpace)}var yi,wi;const Qi=Symbol("retainerCount"),vi=Symbol("recentlyUsed"),Si=Symbol("evict"),bi=Symbol("evictionThreshold"),xi=Symbol("cache");class Mi{constructor(e,t=5){this[yi]=new Map,this[wi]=[],this[xi]=e,this[bi]=t}set evictionThreshold(e){this[bi]=e,this[Si]()}get evictionThreshold(){return this[bi]}get cache(){return this[xi]}retainerCount(e){return this[Qi].get(e)||0}reset(){this[Qi].clear(),this[vi]=[]}retain(e){this[Qi].has(e)||this[Qi].set(e,0),this[Qi].set(e,this[Qi].get(e)+1);const t=this[vi].indexOf(e);-1!==t&&this[vi].splice(t,1),this[vi].unshift(e),this[Si]()}release(e){this[Qi].has(e)&&this[Qi].set(e,Math.max(this[Qi].get(e)-1,0)),this[Si]()}[(yi=Qi,wi=vi,Si)](){if(!(this[vi].length<this[bi]))for(let e=this[vi].length-1;e>=this[bi];--e){const t=this[vi][e];0===this[Qi].get(t)&&(this[xi].delete(t),this[vi].splice(e,1))}}}const Ri=e=>{const t=new Map;for(const i of e.mappings)for(const e of i.variants)t.set(e,{material:null,gltfMaterialIndex:i.material});return t};class Ti{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,i=t.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;const s=(e=>{const t=[],i=new Set;for(const s of e){let e=s,n=0;for(;i.has(e);)e=s+"."+ ++n;i.add(e),t.push(e)}return t})((i.extensions[this.name].variants||[]).map((e=>e.name)));for(const s of e.scenes)s.traverse((e=>{const s=e;if(!s.material)return;const n=t.associations.get(s);if(null==n||null==n.meshes||null==n.primitives)return;const r=i.meshes[n.meshes].primitives[n.primitives].extensions;r&&r[this.name]&&(s.userData.variantMaterials=Ri(r[this.name]))}));return e.userData.variants=s,Promise.resolve()}}var Di,Li;t.Texture.DEFAULT_ANISOTROPY=4;const Fi=new Map,ki=new Map;let _i;const Ui=new et;let Gi;const Ni=new Ii;let Pi,Oi;const Hi=Symbol("loader"),qi=Symbol("evictionPolicy"),Vi=Symbol("GLTFInstance");class Ki extends t.EventDispatcher{constructor(e){super(),this[Li]=(new st).register((e=>new Ti(e))),this[Vi]=e,this[Hi].setDRACOLoader(Ui),this[Hi].setKTX2Loader(Ni)}static setDRACODecoderLocation(e){_i=e,Ui.setDecoderPath(e)}static getDRACODecoderLocation(){return _i}static setKTX2TranscoderLocation(e){Gi=e,Ni.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return Gi}static setMeshoptDecoderLocation(e){var t;Pi!==e&&(Pi=e,Oi=(t=e,new Promise(((e,i)=>{const s=document.createElement("script");document.body.appendChild(s),s.onload=e,s.onerror=i,s.async=!0,s.src=t}))).then((()=>MeshoptDecoder.ready)).then((()=>MeshoptDecoder)))}static getMeshoptDecoderLocation(){return Pi}static initializeKTX2Loader(e){Ni.detectSupport(e)}static get cache(){return Fi}static clearCache(){Fi.forEach(((e,t)=>{this.delete(t)})),this[qi].reset()}static has(e){return Fi.has(e)}static async delete(e){if(!this.has(e))return;const t=Fi.get(e);ki.delete(e),Fi.delete(e),(await t).dispose()}static hasFinishedLoading(e){return!!ki.get(e)}get[(Di=qi,Li=Hi,qi)](){return this.constructor[qi]}async preload(e,t,i=(()=>{})){if(this[Hi].setWithCredentials(Ki.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Fi.has(e)){null!=Oi&&this[Hi].setMeshoptDecoder(await Oi);const t=((e,t,i=(()=>{}))=>{const s=e=>{const t=e.loaded/e.total;i(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(((i,n)=>{t.load(e,i,s,n)}))})(e,this[Hi],(e=>{i(.8*e)})),s=this[Vi],n=t.then((e=>s.prepare(e))).then((e=>(i(.9),new s(e)))).catch((e=>(console.error(e),new s)));Fi.set(e,n)}await Fi.get(e),ki.set(e,!0),i&&i(1)}async load(e,t,i=(()=>{})){await this.preload(e,t,i);const s=await Fi.get(e),n=await s.clone();return this[qi].retain(e),n.dispose=()=>{this[qi].release(e)},n}}Ki[Di]=new Mi(Ki);class Ji extends t.Object3D{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new t.Vector2(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const $i=new t.Vector3,Yi=new t.Matrix4,zi=new t.Matrix4,ji=new t.Vector3,Wi=new t.Vector3;class Xi{constructor(e={}){const t=this;let i,s,n,r;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function A(e,i,s){if(e.isCSS2DObject){$i.setFromMatrixPosition(e.matrixWorld),$i.applyMatrix4(zi);const A=!0===e.visible&&$i.z>=-1&&$i.z<=1&&!0===e.layers.test(s.layers);if(e.element.style.display=!0===A?"":"none",!0===A){e.onBeforeRender(t,i,s);const o=e.element;o.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+($i.x*n+n)+"px,"+(-$i.y*r+r)+"px)",o.parentNode!==a&&a.appendChild(o),e.onAfterRender(t,i,s)}const c={distanceToCameraSquared:(l=s,h=e,ji.setFromMatrixPosition(l.matrixWorld),Wi.setFromMatrixPosition(h.matrixWorld),ji.distanceToSquared(Wi))};o.objects.set(e,c)}var l,h;for(let t=0,n=e.children.length;t<n;t++)A(e.children[t],i,s)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:i,height:s}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Yi.copy(t.matrixWorldInverse),zi.multiplyMatrices(t.projectionMatrix,Yi),A(e,e,t),function(e){const t=function(e){const t=[];return e.traverse((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared})),i=t.length;for(let e=0,s=t.length;e<s;e++)t[e].element.style.zIndex=i-e}(e)},this.setSize=function(e,t){i=e,s=t,n=i/2,r=s/2,a.style.width=e+"px",a.style.height=t+"px"}}}function Zi(e,i,s){let n=s;const r=new t.Vector3;return e.updateWorldMatrix(!0,!0),e.traverseVisible((e=>{const{geometry:t}=e;if(void 0!==t){const{position:s}=t.attributes;if(void 0!==s)for(let t=0,o=s.count;t<o;t++)e.isMesh?e.getVertexPosition(t,r):r.fromBufferAttribute(s,t),e.isSkinnedMesh||r.applyMatrix4(e.matrixWorld),n=i(n,r)}})),n}let es,ts,is,ss;function ns(e,i=1/0,s=null){ts||(ts=new t.PlaneGeometry(2,2,1,1)),is||(is=new t.ShaderMaterial({uniforms:{blitTexture:new t.Uniform(e)},vertexShader:"\n            varying vec2 vUv;\n            void main(){\n                vUv = uv;\n                gl_Position = vec4(position.xy * 1.0,0.,.999999);\n            }",fragmentShader:"\n            uniform sampler2D blitTexture; \n            varying vec2 vUv;\n\n            void main(){ \n                gl_FragColor = vec4(vUv.xy, 0, 1);\n                \n                #ifdef IS_SRGB\n                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n                #else\n                gl_FragColor = texture2D( blitTexture, vUv);\n                #endif\n            }"})),is.uniforms.blitTexture.value=e,is.defines.IS_SRGB=e.colorSpace==t.SRGBColorSpace,is.needsUpdate=!0,ss||(ss=new t.Mesh(ts,is),ss.frustrumCulled=!1);const n=new t.PerspectiveCamera,r=new t.Scene;r.add(ss),s||(s=es=new t.WebGLRenderer({antialias:!1})),s.setSize(Math.min(e.image.width,i),Math.min(e.image.height,i)),s.clear(),s.render(r,n);const o=new t.Texture(s.domElement);return o.minFilter=e.minFilter,o.magFilter=e.magFilter,o.wrapS=e.wrapS,o.wrapT=e.wrapT,o.name=e.name,es&&(es.dispose(),es=null),o}const rs={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class os{constructor(){this.pluginCallbacks=[],this.register((function(e){return new Ps(e)})),this.register((function(e){return new Os(e)})),this.register((function(e){return new Vs(e)})),this.register((function(e){return new Ks(e)})),this.register((function(e){return new Js(e)})),this.register((function(e){return new $s(e)})),this.register((function(e){return new Hs(e)})),this.register((function(e){return new qs(e)})),this.register((function(e){return new Ys(e)})),this.register((function(e){return new zs(e)})),this.register((function(e){return new js(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const n=new Ns,r=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)r.push(this.pluginCallbacks[e](n));n.setPlugins(r),n.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(s,n){i.parse(e,s,n,t)}))}}const as=0,As=1,ls=2,hs=3,cs=4,us=5120,gs=5121,ds=5122,ps=5123,ms=5124,Is=5125,fs=5126,Cs=34962,Es=34963,Bs=9728,ys=9729,ws=9984,Qs=9985,vs=9986,Ss=9987,bs=33071,xs=33648,Ms=10497,Rs="KHR_mesh_quantization",Ts={};Ts[t.NearestFilter]=Bs,Ts[t.NearestMipmapNearestFilter]=ws,Ts[t.NearestMipmapLinearFilter]=vs,Ts[t.LinearFilter]=ys,Ts[t.LinearMipmapNearestFilter]=Qs,Ts[t.LinearMipmapLinearFilter]=Ss,Ts[t.ClampToEdgeWrapping]=bs,Ts[t.RepeatWrapping]=Ms,Ts[t.MirroredRepeatWrapping]=xs;const Ds={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Ls=new t.Color;function Fs(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function ks(e){return 4*Math.ceil(e/4)}function _s(e,t=0){const i=ks(e.byteLength);if(i!==e.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)s[n]=t;return s.buffer}return e}function Us(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Gs(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}class Ns{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,n=s.buffers,r=s.json;i=s.options;const o=s.extensionsUsed,a=s.extensionsRequired,A=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(o),h=Object.keys(a);if(l.length>0&&(r.extensionsUsed=l),h.length>0&&(r.extensionsRequired=h),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=A.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(A),e.onloadend=function(){const i=_s(e.result),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,5130562,!0);const n=_s((o=JSON.stringify(r),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,n.byteLength,!0),a.setUint32(4,1313821514,!0);const A=new ArrayBuffer(12),l=new DataView(A);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const h=12+a.byteLength+n.byteLength+s.byteLength+i.byteLength;l.setUint32(8,h,!0);const c=new Blob([A,a,n,s,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){t(u.result)}}}else if(r.buffers&&r.buffers.length>0){const e=new FileReader;e.readAsDataURL(A),e.onloadend=function(){const i=e.result;r.buffers[0].uri=i,t(r)}}else t(r)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],s[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new t.Vector3;for(let t=0,s=e.count;t<s;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),n=new t.Vector3;for(let e=0,t=s.count;e<t;e++)n.fromBufferAttribute(s,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),s.setXYZ(e,n.x,n.y,n.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let i=!1;const s={};0===t.offset.x&&0===t.offset.y||(s.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(s.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(e){return e.colorSpace===t.SRGBColorSpace?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof t.CompressedTexture&&(e=ns(e)),i instanceof t.CompressedTexture&&(i=ns(i));const n=e?e.image:null,r=i?i.image:null,o=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),A=Us();A.width=o,A.height=a;const l=A.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,o,a);const h=l.getImageData(0,0,o,a);if(n){l.drawImage(n,0,0,o,a);const t=s(e),i=l.getImageData(0,0,o,a).data;for(let e=2;e<i.length;e+=4)h.data[e]=256*t(i[e]/256)}if(r){l.drawImage(r,0,0,o,a);const e=s(i),t=l.getImageData(0,0,o,a).data;for(let i=1;i<t.length;i+=4)h.data[i]=256*e(t[i]/256)}l.putImageData(h,0,0);const c=(e||i).clone();return c.source=new t.Source(A),c.colorSpace=t.NoColorSpace,c.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),c}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,i,s,n,r){const o=this.json;let a;switch(o.bufferViews||(o.bufferViews=[]),i){case us:case gs:a=1;break;case ds:case ps:a=2;break;default:a=4}const A=ks(n*e.itemSize*a),l=new DataView(new ArrayBuffer(A));let h=0;for(let r=s;r<s+n;r++)for(let s=0;s<e.itemSize;s++){let n;e.itemSize>4?n=e.array[r*e.itemSize+s]:(0===s?n=e.getX(r):1===s?n=e.getY(r):2===s?n=e.getZ(r):3===s&&(n=e.getW(r)),!0===e.normalized&&(n=t.MathUtils.normalize(n,e.array))),i===fs?l.setFloat32(h,n,!0):i===ms?l.setInt32(h,n,!0):i===Is?l.setUint32(h,n,!0):i===ds?l.setInt16(h,n,!0):i===ps?l.setUint16(h,n,!0):i===us?l.setInt8(h,n):i===gs&&l.setUint8(h,n),h+=a}const c={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:A};return void 0!==r&&(c.target=r),r===Cs&&(c.byteStride=e.itemSize*a),this.byteOffset+=A,o.bufferViews.push(c),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(s){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=_s(n.result),r={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,s(i.bufferViews.push(r)-1)}}))}processAccessor(e,i,s,n){const r=this.json;let o;if(e.array.constructor===Float32Array)o=fs;else if(e.array.constructor===Int32Array)o=ms;else if(e.array.constructor===Uint32Array)o=Is;else if(e.array.constructor===Int16Array)o=ds;else if(e.array.constructor===Uint16Array)o=ps;else if(e.array.constructor===Int8Array)o=us;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);o=gs}if(void 0===s&&(s=0),void 0===n&&(n=e.count),0===n)return null;const a=function(e,i,s){const n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=i;r<i+s;r++)for(let i=0;i<e.itemSize;i++){let s;e.itemSize>4?s=e.array[r*e.itemSize+i]:(0===i?s=e.getX(r):1===i?s=e.getY(r):2===i?s=e.getZ(r):3===i&&(s=e.getW(r)),!0===e.normalized&&(s=t.MathUtils.normalize(s,e.array))),n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}(e,s,n);let A;void 0!==i&&(A=e===i.index?Es:Cs);const l=this.processBufferView(e,o,s,n,A),h={bufferView:l.id,byteOffset:l.byteOffset,componentType:o,count:n,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(h.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(h)-1}processImage(e,i,s,n="image/png"){if(null!==e){const r=this,o=r.cache,a=r.json,A=r.options,l=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),c=n+":flipY/"+s.toString();if(void 0!==h[c])return h[c];a.images||(a.images=[]);const u={mimeType:n},g=Us();g.width=Math.min(e.width,A.maxTextureSize),g.height=Math.min(e.height,A.maxTextureSize);const d=g.getContext("2d");if(!0===s&&(d.translate(0,g.height),d.scale(1,-1)),void 0!==e.data){i!==t.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(e.width>A.maxTextureSize||e.height>A.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const s=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<s.length;t+=4)s[t+0]=e.data[t+0],s[t+1]=e.data[t+1],s[t+2]=e.data[t+2],s[t+3]=e.data[t+3];d.putImageData(new ImageData(s,e.width,e.height),0,0)}else d.drawImage(e,0,0,g.width,g.height);!0===A.binary?l.push(Gs(g,n).then((e=>r.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==g.toDataURL?u.uri=g.toDataURL(n):l.push(Gs(g,n).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{u.uri=e})));const p=a.images.push(u)-1;return h[c]=p,p}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Ts[e.magFilter],minFilter:Ts[e.minFilter],wrapS:Ts[e.wrapS],wrapT:Ts[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,s=this.cache,n=this.json;if(s.textures.has(e))return s.textures.get(e);n.textures||(n.textures=[]),e instanceof t.CompressedTexture&&(e=ns(e,i.maxTextureSize));let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");const o={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(o.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,o)}));const a=n.textures.push(o)-1;return s.textures.set(e,a),a}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(Fs(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(i,t),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===t.DoubleSide&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,n)}));const o=s.materials.push(n)-1;return i.materials.set(e,o),o}processMesh(e){const i=this.cache,s=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)n.push(e.material[t].uuid);else n.push(e.material.uuid);const r=n.join(":");if(i.meshes.has(r))return i.meshes.get(r);const o=e.geometry;let a;a=e.isLineSegments?As:e.isLineLoop?ls:e.isLine?hs:e.isPoints?as:e.material.wireframe?As:cs;const A={},l={},h=[],c=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=o.getAttribute("normal");void 0===g||this.isNormalizedNormalAttribute(g)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let d=null;for(let e in o.attributes){if("morph"===e.slice(0,5))continue;const s=o.attributes[e];if(e=u[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),i.attributes.has(this.getUID(s))){l[e]=i.attributes.get(this.getUID(s));continue}d=null;const n=s.array;"JOINTS_0"!==e||n instanceof Uint16Array||n instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),d=new t.BufferAttribute(new Uint16Array(n),s.itemSize,s.normalized));const r=this.processAccessor(d||s,o);null!==r&&(e.startsWith("_")||this.detectMeshQuantization(e,s),l[e]=r,i.attributes.set(this.getUID(s),r))}if(void 0!==g&&o.setAttribute("normal",g),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const t=[],s=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const a={};let A=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){A||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),A=!0);continue}const t=o.morphAttributes[e][r],s=e.toUpperCase(),n=o.attributes[e];if(i.attributes.has(this.getUID(t,!0))){a[s]=i.attributes.get(this.getUID(t,!0));continue}const l=t.clone();if(!o.morphTargetsRelative)for(let e=0,i=t.count;e<i;e++)for(let i=0;i<t.itemSize;i++)0===i&&l.setX(e,t.getX(e)-n.getX(e)),1===i&&l.setY(e,t.getY(e)-n.getY(e)),2===i&&l.setZ(e,t.getZ(e)-n.getZ(e)),3===i&&l.setW(e,t.getW(e)-n.getW(e));a[s]=this.processAccessor(l,o),i.attributes.set(this.getUID(n,!0),a[s])}c.push(a),t.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&s.push(n[r])}A.weights=t,s.length>0&&(A.extras={},A.extras.targetNames=s)}const p=Array.isArray(e.material);if(p&&0===o.groups.length)return null;const m=p?e.material:[e.material],I=p?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,t=I.length;e<t;e++){const t={mode:a,attributes:l};if(this.serializeUserData(o,t),c.length>0&&(t.targets=c),null!==o.index){let s=this.getUID(o.index);void 0===I[e].start&&void 0===I[e].count||(s+=":"+I[e].start+":"+I[e].count),i.attributes.has(s)?t.indices=i.attributes.get(s):(t.indices=this.processAccessor(o.index,o,I[e].start,I[e].count),i.attributes.set(s,t.indices)),null===t.indices&&delete t.indices}const s=this.processMaterial(m[I[e].materialIndex]);null!==s&&(t.material=s),h.push(t)}A.primitives=h,s.meshes||(s.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,A)}));const f=s.meshes.push(A)-1;return i.meshes.set(r,f),f}detectMeshQuantization(e,t){if(this.extensionsUsed[Rs])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];rs[s]&&rs[s].includes(i)&&(this.extensionsUsed[Rs]=!0,this.extensionsRequired[Rs]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:t.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),i.cameras.push(n)-1}processAnimation(e,i){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]);const r=(e=os.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,o=[],a=[];for(let e=0;e<r.length;++e){const s=r[e],A=t.PropertyBinding.parseTrackName(s.name);let l=t.PropertyBinding.findNode(i,A.nodeName);const h=Ds[A.propertyName];if("bones"===A.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(A.objectIndex):void 0),!l||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;const c=1;let u,g=s.values.length/s.times.length;h===Ds.morphTargetInfluences&&(g/=l.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(u="CUBICSPLINE",g/=3):u=s.getInterpolation()===t.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:this.processAccessor(new t.BufferAttribute(s.times,c)),output:this.processAccessor(new t.BufferAttribute(s.values,g)),interpolation:u}),o.push({sampler:a.length-1,target:{node:n.get(l),path:h}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:o}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,n=i.nodes[s.get(e)],r=e.skeleton;if(void 0===r)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],A=new Float32Array(16*r.bones.length),l=new t.Matrix4;for(let t=0;t<r.bones.length;++t)a.push(s.get(r.bones[t])),l.copy(r.boneInverses[t]),l.multiply(e.bindMatrix).toArray(A,16*t);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new t.BufferAttribute(A,16)),joints:a,skeleton:s.get(o)}),n.skin=i.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),s=e.scale.toArray();Fs(t,[0,0,0,1])||(n.rotation=t),Fs(i,[0,0,0])||(n.translation=i),Fs(s,[1,1,1])||(n.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Fs(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let s=0,n=e.children.length;s<n;s++){const n=e.children[s];if(n.visible||!1===i.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));const r=t.nodes.push(n)-1;return s.set(e,r),r}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};""!==e.name&&(s.name=e.name),t.scenes.push(s);const n=[];for(let t=0,s=e.children.length;t<s;t++){const s=e.children[t];if(s.visible||!1===i.onlyVisible){const e=this.processNode(s);null!==e&&n.push(e)}}n.length>0&&(s.nodes=n),this.serializeUserData(e,s)}processObjects(e){const i=new t.Scene;i.name="AuxScene";for(let t=0;t<e.length;t++)i.children.push(e[t]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const s=[];for(let i=0;i<e.length;i++)e[i]instanceof t.Scene?this.processScene(e[i]):s.push(e[i]);s.length>0&&this.processObjects(s);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let t=0;t<i.animations.length;++t)this.processAnimation(i.animations[t],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Ps{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,s=i.json,n=i.extensionsUsed,r={};e.name&&(r.name=e.name),r.color=e.color.toArray(),r.intensity=e.intensity,e.isDirectionalLight?r.type="directional":e.isPointLight?(r.type="point",e.distance>0&&(r.range=e.distance)):e.isSpotLight&&(r.type="spot",e.distance>0&&(r.range=e.distance),r.spot={},r.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,r.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const o=s.extensions[this.name].lights;o.push(r),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class Os{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Hs{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class qs{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Vs{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Ks{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Js{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class $s{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Ls)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class Ys{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class zs{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,s=i.extensionsUsed,n={};if(e.anisotropyMap){const t={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,s[this.name]=!0}}class js{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}os.Utils={insertKeyframe:function(e,t){const i=.001,s=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),r=new e.ValueBufferType(e.values.length+s),o=e.createInterpolant(new e.ValueBufferType(s));let a;if(0===e.times.length){n[0]=t;for(let e=0;e<s;e++)r[e]=0;a=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),r.set(o.evaluate(t),0),r.set(e.values,s),a=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),r.set(e.values,0),r.set(o.evaluate(t),e.values.length),a=n.length-1}else for(let A=0;A<e.times.length;A++){if(Math.abs(e.times[A]-t)<i)return A;if(e.times[A]<t&&e.times[A+1]>t){n.set(e.times.slice(0,A+1),0),n[A+1]=t,n.set(e.times.slice(A+1),A+2),r.set(e.values.slice(0,(A+1)*s),0),r.set(o.evaluate(t),(A+1)*s),r.set(e.values.slice((A+1)*s),(A+2)*s),a=A+1;break}}return e.times=n,e.values=r,a},mergeMorphTargetTracks:function(e,i){const s=[],n={},r=e.tracks;for(let e=0;e<r.length;++e){let o=r[e];const a=t.PropertyBinding.parseTrackName(o.name),A=t.PropertyBinding.findNode(i,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){s.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(t.InterpolateLinear)}const l=A.morphTargetInfluences.length,h=A.morphTargetDictionary[a.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let c;if(void 0===n[A.uuid]){c=o.clone();const e=new c.ValueBufferType(l*c.times.length);for(let t=0;t<c.times.length;t++)e[t*l+h]=c.values[t];c.name=(a.nodeName||"")+".morphTargetInfluences",c.values=e,n[A.uuid]=c,s.push(c);continue}const u=o.createInterpolant(new o.ValueBufferType(1));c=n[A.uuid];for(let e=0;e<c.times.length;e++)c.values[e*l+h]=u.evaluate(c.times[e]);for(let e=0;e<o.times.length;e++){const t=this.insertKeyframe(c,o.times[e]);c.values[t*l+h]=o.values[e]}}return e.tracks=s,e}};const Ws=e=>void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter((e=>Xs(e.material))),Xs=e=>e&&e.isMaterial&&!Array.isArray(e);class Zs{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set;for(const i of e)i.traverse((e=>{if(!Ws(e))return;const i=e.userData.variantMaterials,s=e.userData.variantData;for(const[e,n]of s){const s=i.get(n.index);s&&Xs(s.material)&&t.add(e)}}));t.forEach((e=>this.variantNames.push(e)))}writeMesh(e,t){if(!Ws(e))return;const i=e.userData,s=i.variantMaterials,n=i.variantData,r=new Map,o=new Map,a=Array.from(n.values()).sort(((e,t)=>e.index-t.index));for(const[e,t]of a.entries())o.set(t.index,e);for(const e of n.values()){const t=s.get(e.index);if(!t||!Xs(t.material))continue;const i=this.writer.processMaterial(t.material);r.has(i)||r.set(i,{material:i,variants:[]}),r.get(i).variants.push(o.get(e.index))}const A=Array.from(r.values()).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===A.length)return;const l=Xs(i.originalMaterial)?this.writer.processMaterial(i.originalMaterial):-1;for(const e of t.primitives)l>=0&&(e.material=l),e.extensions=e.extensions||{},e.extensions[this.name]={mappings:A}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map((e=>({name:e})));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class en{constructor(e,i,s,n,r){this.xrLight=e,this.renderer=i,this.lightProbe=s,this.xrWebGLBinding=null,this.estimationStartCallback=r,this.frameCallback=this.onXRFrame.bind(this);const o=i.xr.getSession();if(n&&"XRWebGLBinding"in window){const s=new t.WebGLCubeRenderTarget(16);e.environment=s.texture;const n=i.getContext();switch(o.preferredReflectionFormat){case"srgba8":n.getExtension("EXT_sRGB");break;case"rgba16f":n.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,n),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/e,i.primaryLightIntensity.y/e,i.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class tn extends t.Group{constructor(e,i=!0){super(),this.lightProbe=new t.LightProbe,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new t.DirectionalLight,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let s=null,n=!1;e.xr.addEventListener("sessionstart",(()=>{const t=e.xr.getSession();"requestLightProbe"in t&&t.requestLightProbe({reflectionFormat:t.preferredReflectionFormat}).then((t=>{s=new en(this,e,t,i,(()=>{n=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{s&&(s.dispose(),s=null),n&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{s&&(s.dispose(),s=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}class sn{constructor(e=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,i,s){const n=2e-4*this.naturalFrequency;if(null==e||0===s)return t;if(e===t&&0===this.velocity)return t;if(i<0)return e;const r=e-t,o=this.velocity+this.naturalFrequency*r,a=r+i*o,A=Math.exp(-this.naturalFrequency*i),l=(o-this.naturalFrequency*a)*A,h=-this.naturalFrequency*(l+o*A);return Math.abs(l)<n*Math.abs(s)&&h*r>=0?(this.velocity=0,t):(this.velocity=l,t+a*A)}}const nn=.2,rn=Math.PI/24,on=new t.Vector2,an=(e,t,i)=>{let s=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)e.push(t+.17*Math.cos(s),i+.17*Math.sin(s),0,t+nn*Math.cos(s),i+nn*Math.sin(s),0),s+=rn};class An extends t.Mesh{constructor(e,i){const s=new t.BufferGeometry,n=[],r=[],{size:o,boundingBox:a}=e,A=o.x/2,l=("back"===i?o.y:o.z)/2;an(r,A,l),an(r,-A,l),an(r,-A,-l),an(r,A,-l);const h=r.length/3;for(let e=0;e<h-2;e+=2)n.push(e,e+1,e+3,e,e+3,e+2);const c=h-2;n.push(c,c+1,1,c,1,0),s.setAttribute("position",new t.Float32BufferAttribute(r,3)),s.setIndex(n),super(s),this.side=i;const u=this.material;switch(u.side=t.DoubleSide,u.transparent=!0,u.opacity=0,this.goalOpacity=0,this.opacityDamper=new sn,this.hitPlane=new t.Mesh(new t.PlaneGeometry(2*(A+nn),2*(l+nn))),this.hitPlane.visible=!1,this.hitPlane.material.side=t.DoubleSide,this.add(this.hitPlane),a.getCenter(this.position),i){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=a.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=a.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.offsetHeight=0}getHit(e,t,i){on.set(t,-i),this.hitPlane.visible=!0;const s=e.positionAndNormalFromPoint(on,this.hitPlane);return this.hitPlane.visible=!1,null==s?null:s.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),s}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:i}=this.hitPlane;t.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}}const ln=(e,t)=>({type:"number",number:e,unit:t}),hn=(()=>{const e={};return t=>{const i=t;if(i in e)return e[i];const s=[];let n=0;for(;t;){if(++n>1e3){t="";break}const e=cn(t),i=e.nodes[0];if(null==i||0===i.terms.length)break;s.push(i),t=e.remainingInput}return e[i]=s}})(),cn=(()=>{const e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return s=>{const n=[];for(;s.length&&(s=s.trim(),!i.test(s));)if("("===s[0]){const{nodes:e,remainingInput:t}=pn(s);s=t,n.push({type:"function",name:{type:"ident",value:"calc"},arguments:e})}else if(e.test(s)){const e=un(s),t=e.nodes[0];if("("===(s=e.remainingInput)[0]){const{nodes:e,remainingInput:i}=pn(s);n.push({type:"function",name:t,arguments:e}),s=i}else n.push(t)}else if(t.test(s))n.push({type:"operator",value:s[0]}),s=s.slice(1);else{const{nodes:e,remainingInput:t}="#"===s[0]?dn(s):gn(s);if(0===e.length)break;n.push(e[0]),s=t}return{nodes:[{type:"expression",terms:n}],remainingInput:s}}})(),un=(()=>{const e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const i=t.match(e);return{nodes:[{type:"ident",value:null==i?t:t.substr(0,i.index)}],remainingInput:null==i?"":t.substr(i.index)}}})(),gn=(()=>{const e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return s=>{const n=s.match(e),r=null==n?"0":n[0],o=(s=null==r?s:s.slice(r.length)).match(t);let a=null!=o&&""!==o[0]?o[0]:null;const A=null==o?s:s.slice(a.length);return null==a||i.test(a)||(a=null),{nodes:[{type:"number",number:parseFloat(r)||0,unit:a}],remainingInput:A}}})(),dn=(()=>{const e=/^[a-f0-9]*/i;return t=>{const i=(t=t.slice(1).trim()).match(e);return{nodes:null==i?[]:[{type:"hex",value:i[0]}],remainingInput:null==i?t:t.slice(i[0].length)}}})(),pn=e=>{const t=[];for(e=e.slice(1).trim();e.length;){const i=cn(e);if(t.push(i.nodes[0]),","===(e=i.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},mn=Symbol("visitedTypes");class In{constructor(e){this[mn]=e}walk(e,t){const i=e.slice();for(;i.length;){const e=i.shift();switch(this[mn].indexOf(e.type)>-1&&t(e),e.type){case"expression":i.unshift(...e.terms);break;case"function":i.unshift(e.name,...e.arguments)}}}}const fn=Object.freeze({type:"number",number:0,unit:null}),Cn=(e,t=0)=>{let{number:i,unit:s}=e;if(isFinite(i)){if("rad"===e.unit||null==e.unit)return e}else i=t,s="rad";return{type:"number",number:("deg"===s&&null!=i?i:0)*Math.PI/180,unit:"rad"}},En=(e,t=0)=>{let i,{number:s,unit:n}=e;if(isFinite(s)){if("m"===e.unit)return e}else s=t,n="m";switch(n){default:i=1;break;case"cm":i=.01;break;case"mm":i=.001}return{type:"number",number:i*s,unit:"m"}},Bn=(()=>{const e=e=>e,t={rad:e,deg:Cn,m:e,mm:En,cm:En};return(e,i=fn)=>{isFinite(e.number)||(e.number=i.number,e.unit=i.unit);const{unit:s}=e;if(null==s)return e;const n=t[s];return null==n?i:n(e)}})();var yn,wn,Qn;const vn=Symbol("evaluate"),Sn=Symbol("lastValue");class bn{constructor(){this[yn]=null}static evaluatableFor(e,t=fn){if(e instanceof bn)return e;if("number"===e.type)return"%"===e.unit?new Rn(e,t):e;switch(e.name.value){case"calc":return new kn(e,t);case"env":return new Dn(e)}return fn}static evaluate(e){return e instanceof bn?e.evaluate():e}static isConstant(e){return!(e instanceof bn)||e.isConstant}static applyIntrinsics(e,t){const{basis:i,keywords:s}=t,{auto:n}=s;return i.map(((t,i)=>{const r=null==n[i]?t:n[i];let o=e[i]?e[i]:r;if("ident"===o.type){const e=o.value;e in s&&(o=s[e][i])}return null!=o&&"ident"!==o.type||(o=r),"%"===o.unit?ln(o.number/100*t.number,t.unit):(o=Bn(o,t),o.unit!==t.unit?t:o)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[Sn]||(this[Sn]=this[vn]()),this[Sn]}}yn=Sn;const xn=Symbol("percentage"),Mn=Symbol("basis");class Rn extends bn{constructor(e,t){super(),this[xn]=e,this[Mn]=t}get isConstant(){return!0}[vn](){return ln(this[xn].number/100*this[Mn].number,this[Mn].unit)}}const Tn=Symbol("identNode");class Dn extends bn{constructor(e){super(),this[wn]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[Tn]=t)}get isConstant(){return!1}[(wn=Tn,vn)](){return null!=this[Tn]&&"window-scroll-y"===this[Tn].value?{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}:fn}}const Ln=/[\*\/]/,Fn=Symbol("evaluator");class kn extends bn{constructor(e,t=fn){if(super(),this[Qn]=null,1!==e.arguments.length)return;const i=e.arguments[0].terms.slice(),s=[];for(;i.length;){const e=i.shift();if(s.length>0){const i=s[s.length-1];if("operator"===i.type&&Ln.test(i.value)){const i=s.pop(),n=s.pop();if(null==n)return;s.push(new Nn(i,bn.evaluatableFor(n,t),bn.evaluatableFor(e,t)));continue}}s.push("operator"===e.type?e:bn.evaluatableFor(e,t))}for(;s.length>2;){const[e,i,n]=s.splice(0,3);if("operator"!==i.type)return;s.unshift(new Nn(i,bn.evaluatableFor(e,t),bn.evaluatableFor(n,t)))}1===s.length&&(this[Fn]=s[0])}get isConstant(){return null==this[Fn]||bn.isConstant(this[Fn])}[(Qn=Fn,vn)](){return null!=this[Fn]?bn.evaluate(this[Fn]):fn}}const _n=Symbol("operator"),Un=Symbol("left"),Gn=Symbol("right");class Nn extends bn{constructor(e,t,i){super(),this[_n]=e,this[Un]=t,this[Gn]=i}get isConstant(){return bn.isConstant(this[Un])&&bn.isConstant(this[Gn])}[vn](){const e=Bn(bn.evaluate(this[Un])),t=Bn(bn.evaluate(this[Gn])),{number:i,unit:s}=e,{number:n,unit:r}=t;if(null!=r&&null!=s&&r!=s)return fn;const o=s||r;let a;switch(this[_n].value){case"+":a=i+n;break;case"-":a=i-n;break;case"/":a=i/n;break;case"*":a=i*n;break;default:return fn}return{type:"number",number:a,unit:o}}}const Pn=Symbol("evaluatables"),On=Symbol("intrinsics");class Hn extends bn{constructor(e,t){super(),this[On]=t;const i=e[0],s=null!=i?i.terms:[];this[Pn]=t.basis.map(((e,t)=>{const i=s[t];return null==i?{type:"ident",value:"auto"}:"ident"===i.type?i:bn.evaluatableFor(i,e)}))}get isConstant(){for(const e of this[Pn])if(!bn.isConstant(e))return!1;return!0}[vn](){const e=this[Pn].map((e=>bn.evaluate(e)));return bn.applyIntrinsics(e,this[On]).map((e=>e.number))}}var qn,Vn,Kn,Jn;const $n=Symbol("instances"),Yn=Symbol("activateListener"),zn=Symbol("deactivateListener"),jn=Symbol("notifyInstances"),Wn=Symbol("notify"),Xn=Symbol("callback");class Zn{constructor(e){this[Xn]=e}static[jn](){for(const e of Zn[$n])e[Wn]()}static[(qn=$n,Yn)](){window.addEventListener("scroll",this[jn],{passive:!0})}static[zn](){window.removeEventListener("scroll",this[jn])}observe(){0===Zn[$n].size&&Zn[Yn](),Zn[$n].add(this)}disconnect(){Zn[$n].delete(this),0===Zn[$n].size&&Zn[zn]()}[Wn](){this[Xn]()}}Zn[qn]=new Set;const er=Symbol("computeStyleCallback"),tr=Symbol("astWalker"),ir=Symbol("dependencies"),sr=Symbol("onScroll");class nr{constructor(e){this[Vn]={},this[Kn]=new In(["function"]),this[Jn]=()=>{this[er]({relatedState:"window-scroll"})},this[er]=e}observeEffectsFor(e){const t={},i=this[ir];this[tr].walk(e,(e=>{const{name:s}=e,n=e.arguments[0].terms[0];if("env"===s.value&&null!=n&&"ident"===n.type&&"window-scroll-y"===n.value&&null==t["window-scroll"]){const e="window-scroll"in i?i["window-scroll"]:new Zn(this[sr]);e.observe(),delete i["window-scroll"],t["window-scroll"]=e}}));for(const e in i)i[e].disconnect();this[ir]=t}dispose(){for(const e in this[ir])this[ir][e].disconnect()}}Vn=ir,Kn=tr,Jn=sr;const rr=e=>{const t=e.observeEffects||!1,i=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(s,n)=>{const r=s.updated,o=s.connectedCallback,a=s.disconnectedCallback,A=Symbol(`${n}StyleEffector`),l=Symbol(`${n}StyleEvaluator`),h=Symbol(`${n}UpdateEvaluator`),c=Symbol(`${n}EvaluateAndSync`);Object.defineProperties(s,{[A]:{value:null,writable:!0},[l]:{value:null,writable:!0},[h]:{value:function(){const e=hn(this[n]);this[l]=new Hn(e,i(this)),null==this[A]&&t&&(this[A]=new nr((()=>this[c]()))),null!=this[A]&&this[A].observeEffectsFor(e)}},[c]:{value:function(){if(null==this[l])return;const t=this[l].evaluate();this[e.updateHandler](t)}},updated:{value:function(e){e.has(n)&&(this[h](),this[c]()),r.call(this,e)}},connectedCallback:{value:function(){o.call(this),this.requestUpdate(n,this[n])}},disconnectedCallback:{value:function(){a.call(this),null!=this[A]&&(this[A].dispose(),this[A]=null)}}})}},or=e=>e<.5?2*e*e:(4-2*e)*e-1,ar=(e,t,i=or)=>s=>e+(t-e)*i(s),Ar=e=>{const t=[],i=[];let s=e.initialValue;for(let n=0;n<e.keyframes.length;++n){const r=e.keyframes[n],{value:o,frames:a}=r,A=r.ease||or,l=ar(s,o,A);t.push(l),i.push(a),s=o}return((e,t)=>{const i=t.map((s=0,e=>s+=e));var s;return t=>{t=Ve(t,0,1),t*=i[i.length-1];const s=i.findIndex((e=>e>=t)),n=s<1?0:i[s-1],r=i[s];return e[s]((t-n)/(r-n))}})(t,i)};var lr=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const hr=Ar({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),cr=Ar({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),ur="0deg 75deg 105%",gr=["front","right","back","left"],dr=["upper-","","lower-"],pr="auto",mr="basic",Ir="wiggle",fr="none",Cr=()=>({basis:[Cn(ln(30,"deg"))],keywords:{auto:[null]}}),Er=()=>({basis:[Cn(ln(12,"deg"))],keywords:{auto:[null]}}),Br=(()=>{const e=hn(ur)[0].terms,t=Bn(e[0]),i=Bn(e[1]);return e=>{const s=e[Ll].idealCameraDistance();return{basis:[t,i,ln(s,"m")],keywords:{auto:[null,null,ln(105,"%")]}}}})(),yr=e=>{const t=2.2*e[Ll].boundingSphere.radius;return{basis:[ln(-1/0,"rad"),ln(Math.PI/8,"rad"),ln(t,"m")],keywords:{auto:[null,null,null]}}},wr=e=>{const t=Br(e),i=new Hn([],t).evaluate()[2];return{basis:[ln(1/0,"rad"),ln(Math.PI-Math.PI/8,"rad"),ln(i,"m")],keywords:{auto:[null,null,null]}}},Qr=e=>{const i=e[Ll].boundingBox.getCenter(new t.Vector3);return{basis:[ln(i.x,"m"),ln(i.y,"m"),ln(i.z,"m")],keywords:{auto:[null,null,null]}}},vr=Math.PI/2,Sr=Math.PI/3,br=vr/2,xr=2*Math.PI,Mr=Symbol("controls"),Rr=Symbol("panElement"),Tr=Symbol("promptElement"),Dr=Symbol("promptAnimatedContainer"),Lr=Symbol("fingerAnimatedContainers"),Fr=Symbol("deferInteractionPrompt"),kr=Symbol("updateAria"),_r=Symbol("updateCameraForRadius"),Ur=Symbol("cancelPrompts"),Gr=Symbol("onChange"),Nr=Symbol("onPointerChange"),Pr=Symbol("waitingToPromptUser"),Or=Symbol("userHasInteracted"),Hr=Symbol("promptElementVisibleTime"),qr=Symbol("lastPromptOffset"),Vr=Symbol("cancellationSource"),Kr=Symbol("lastSpherical"),Jr=Symbol("jumpCamera"),$r=Symbol("initialized"),Yr=Symbol("maintainThetaPhi"),zr=Symbol("syncCameraOrbit"),jr=Symbol("syncFieldOfView"),Wr=Symbol("syncCameraTarget"),Xr=Symbol("syncMinCameraOrbit"),Zr=Symbol("syncMaxCameraOrbit"),eo=Symbol("syncMinFieldOfView"),to=Symbol("syncMaxFieldOfView"),io=new t.Vector2,so=new t.Vector3,no=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),ro=Math.PI/8,oo=.04,ao={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class Ao extends t.EventDispatcher{constructor(e,i,s){super(),this.camera=e,this.element=i,this.scene=s,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=ao.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new t.Matrix3,this.panPerPixel=0,this.spherical=new t.Spherical,this.goalSpherical=new t.Spherical,this.thetaDamper=new sn,this.phiDamper=new sn,this.radiusDamper=new sn,this.logFov=Math.log(no.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new sn,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=e=>{if(this.enablePan)e.preventDefault();else for(const e of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:e.id})))},this.touchModeZoom=(e,t)=>{if(!this._disableZoom){const e=this.twoTouchDistance(this.pointers[0],this.pointers[1]),t=oo*this.zoomSensitivity*(this.lastSeparation-e)*50/this.scene.height;this.lastSeparation=e,this.userAdjustOrbit(0,0,t)}this.panPerPixel>0&&this.movePan(e,t)},this.disableScroll=e=>{e.preventDefault()},this.touchModeRotate=(e,t)=>{const{touchAction:i}=this._options;if(!this.touchDecided&&"none"!==i){this.touchDecided=!0;const s=Math.abs(e),n=Math.abs(t);if(this.changeSource===ao.USER_INTERACTION&&("pan-y"===i&&n>s||"pan-x"===i&&s>n))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(e,t)},this.onPointerDown=e=>{if(this.pointers.length>2)return;const{element:t}=this;0===this.pointers.length&&(t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=e.clientX,this.startPointerPosition.clientY=e.clientY,this.startTime=performance.now());try{t.setPointerCapture(e.pointerId)}catch(e){}this.pointers.push({clientX:e.clientX,clientY:e.clientY,id:e.pointerId}),this.isUserPointing=!1,"touch"===e.pointerType?(this.changeSource=e.altKey?ao.AUTOMATIC:ao.USER_INTERACTION,this.onTouchChange(e)):(this.changeSource=ao.USER_INTERACTION,this.onMouseDown(e)),this.changeSource===ao.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=e=>{const t=this.pointers.find((t=>t.id===e.pointerId));if(null==t)return;if("mouse"===e.pointerType&&0===e.buttons)return void this.onPointerUp(e);const i=this.pointers.length,s=(e.clientX-t.clientX)/i,n=(e.clientY-t.clientY)/i;0===s&&0===n||(t.clientX=e.clientX,t.clientY=e.clientY,"touch"===e.pointerType?(this.changeSource=e.altKey?ao.AUTOMATIC:ao.USER_INTERACTION,null!==this.touchMode&&this.touchMode(s,n)):(this.changeSource=ao.USER_INTERACTION,this.panPerPixel>0?this.movePan(s,n):this.handleSinglePointerMove(s,n)))},this.onPointerUp=e=>{const{element:t}=this,i=this.pointers.findIndex((t=>t.id===e.pointerId));-1!==i&&this.pointers.splice(i,1),this.panPerPixel>0&&!e.altKey&&this.resetRadius(),0===this.pointers.length?(t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(e)):null!==this.touchMode&&this.onTouchChange(e),this.scene.element[Rr].style.opacity=0,t.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=e=>{this.changeSource=ao.USER_INTERACTION;const t=e.deltaY*(1==e.deltaMode?18:1)*oo*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,t),e.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=e=>{const{changeSource:t}=this;this.changeSource=ao.USER_INTERACTION,(e.shiftKey&&this.enablePan?this.panKeyCodeHandler(e):this.orbitZoomKeyCodeHandler(e))?(e.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=t},this._options=Object.assign({},no),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",(()=>{}),{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new t.Spherical){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=0===t?2:t,this.camera.near=Math.max(e,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:n,minimumPolarAngle:r,maximumPolarAngle:o,minimumRadius:a,maximumRadius:A}=this._options,{theta:l,phi:h,radius:c}=this.goalSpherical,u=Ve(e,s,n);isFinite(s)||isFinite(n)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const g=Ve(t,r,o),d=Ve(i,a,A);return!(u===l&&g===h&&d===c||!(isFinite(u)&&isFinite(g)&&isFinite(d))||(this.goalSpherical.theta=u,this.goalSpherical.phi=g,this.goalSpherical.radius=d,this.goalSpherical.makeSafe(),0))}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=Ve(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){const{theta:s,phi:n,radius:r}=this.goalSpherical,{minimumRadius:o,maximumRadius:a,minimumFieldOfView:A,maximumFieldOfView:l}=this._options,h=this.spherical.theta-s,c=Math.PI-.001,u=s-Ve(e,-c-h,c-h),g=n-t,d=0===i?0:((i>0?a:o)-r)/(Math.log(i>0?l:A)-this.goalLogFov),p=r+i*(isFinite(d)?d:2*(a-o));if(this.setOrbit(u,g,p),0!==i){const e=this.goalLogFov+i;this.setFieldOfView(Math.exp(e))}}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(n)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&"none"!==t?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new t.Euler(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:i,clientY:s}=e,{clientX:n,clientY:r}=t,o=n-i,a=r-s;return Math.sqrt(o*o+a*a)}handleSinglePointerMove(e,t){const i=this.pixelLengthToSphericalAngle(e),s=this.pixelLengthToSphericalAngle(t);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:e,phi:t}=this.spherical,i=e-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(t)*Math.sin(i),0,0,Math.sin(t),0,Math.sin(i),-Math.cos(t)*Math.cos(i),0)}movePan(e,t){const{scene:i}=this,s=so.set(e,t,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(n);const r=i.getTarget();r.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(r,r),i.setTarget(r.x,r.y,r.z)}recenter(e){if(performance.now()>this.startTime+300||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this,i=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==i){const{cameraTarget:e}=t.element;t.element.cameraTarget="",t.element.cameraTarget=e,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(i.position),t.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(io.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const i=e.getTarget(),{theta:s,phi:n}=this.spherical,r=s-e.yaw,o=so.set(Math.sin(n)*Math.sin(r),Math.cos(n),Math.sin(n)*Math.cos(r)),a=o.dot(t.position.sub(i));i.add(o.multiplyScalar(a)),e.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-a)}onTouchChange(e){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),e.altKey||(this.scene.element[Rr].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(2===e.button||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[Rr].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,oo*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-ro,0);break;case"ArrowDown":this.userAdjustOrbit(0,ro,0);break;case"ArrowLeft":this.userAdjustOrbit(-ro,0,0);break;case"ArrowRight":this.userAdjustOrbit(ro,0,0);break;default:t=!1}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:t=!1}return t}}const lo="not-presenting",ho="session-started",co="object-placed",uo="failed",go="tracking",po="not-tracking",mo=new t.Vector3,Io=new t.Matrix4,fo=new t.Vector3,Co=new t.PerspectiveCamera(45,1,.1,100);class Eo extends t.EventDispatcher{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new t.Vector3,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new t.Vector3,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new t.Vector3,this.goalYaw=0,this.goalScale=1,this.xDamper=new sn,this.yDamper=new sn,this.zDamper=new sn,this.yawDamper=new sn,this.scaleDamper=new sn,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new An(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const i=this.frame.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=this.placementBox;if(1===i.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,i=n.getHit(this.presentedScene,t[0],t[1]);n.show=!0,null!=i?(this.isTranslating=!0,this.lastDragPosition.copy(i)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===i.length){n.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/s.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){Oe();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return Oe(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e,t=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise(((e,t)=>{requestAnimationFrame((()=>e()))}));e.setHotspotsVisibility(!1),e.queueRender(),await i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(this.xrLight=new tn(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const e=this.presentedScene;e.add(this.xrLight),e.environment=this.xrLight.environment})));const s=await this.resolveARSession();s.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const n=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const r=await s.requestReferenceSpace("viewer");this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.background=null,this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const o=20*Math.PI/180,a=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(o),z:-Math.cos(o)});s.requestHitTestSource({space:r,offsetRay:a}).then((e=>{this.initialHitSource=e})),this.currentSession=s,this.placementBox=new An(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:ho})}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise((e=>{this.resolveCleanup=e}));try{await this.currentSession.end(),await e}catch(e){console.warn("Error while trying to end WebXR AR session"),console.warn(e),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,null!=t){const{element:e}=t;null!=this.xrLight&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowOffset(0);const i=this.turntableRotation;null!=i&&(t.yaw=i);const s=this.oldShadowIntensity;null!=s&&t.setShadowIntensity(s),t.setEnvironmentAndSkybox(e[Ye],e[ze]);const n=this.oldTarget;t.setTarget(n.x,n.y,n.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0),e.requestUpdate("cameraTarget"),e.requestUpdate("maxCameraOrbit"),e[Ul](e.getBoundingClientRect()),requestAnimationFrame((()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:ao.NONE}}))}))}this.renderer.height=0;const i=this.exitWebXRButtonContainer;null!=i&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;null!=s&&(s.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;null!=n&&(n.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:lo})}updateView(e){const t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(Co),t.xrCamera=i.getCamera();const{elements:s}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const t=e.recommendedViewportScale;e.requestViewportScale(Math.max(t,.25))}const n=i.getBaseLayer();if(null!=n){const t=n instanceof XRWebGLLayer?n.getViewport(e):i.getBinding().getViewSubImage(n,e).viewport;this.threeRenderer.setViewport(t.x,t.y,t.width,t.height)}}placeInitially(){const e=this.presentedScene,{position:t,element:i}=e,s=e.getCamera(),{width:n,height:r}=this.overlay.getBoundingClientRect();e.setSize(n,r),s.projectionMatrixInverse.copy(s.projectionMatrix).invert();const{theta:o,radius:a}=i.getCameraOrbit(),A=s.getWorldDirection(mo);e.yaw=Math.atan2(-A.x,-A.z)-o,this.goalYaw=e.yaw,t.copy(s.position).add(A.multiplyScalar(a)),this.updateTarget();const l=e.getTarget();t.add(l).sub(this.oldTarget),this.goalPosition.copy(t),e.setHotspotsVisibility(!0);const{session:h}=this.frame;h.addEventListener("selectstart",this.onSelectStart),h.addEventListener("selectend",this.onSelectEnd),h.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((e=>{this.transientHitTestSource=e}))}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(mo.copy(t).sub(this.presentedScene.getCamera().position),mo.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(null==i)return null;const s=Io.fromArray(i.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?fo.setFromMatrixPosition(s):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const i=e.getHitTestResults(t);if(0==i.length)return;const s=i[0],n=this.getHitPoint(s);null!=n&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:co}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,s=i[0]-t[0],n=i[1]-t[1],r=Math.atan2(n,s);let o=this.lastAngle-r;return o>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),this.lastAngle=r,{separation:Math.sqrt(s*s+n*n),deltaYaw:o}}processInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,n=s.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);if(!1===this.placeOnWall&&(this.goalYaw+=t),s.canScale){const t=e/this.firstRatio;this.goalScale=t<1.3&&t>.7692307692307692?1:t}}else if(2!==i.length)if(this.isRotating){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&i.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/n,this.presentedScene.setShadowOffset(e);const i=mo.copy(s.getCamera().position),r=-e/(i.y-t.y);i.multiplyScalar(r),t.multiplyScalar(1-r).add(i)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/n}}moveScene(e){const t=this.presentedScene,{position:i,yaw:s}=t,n=t.boundingSphere.radius,r=this.goalPosition,o=t.scale.x,a=this.placementBox;let A=ao.NONE;if(!r.equals(i)||this.goalScale!==o){A=ao.USER_INTERACTION;let{x:s,y:l,z:h}=i;s=this.xDamper.update(s,r.x,e,n),l=this.yDamper.update(l,r.y,e,n),h=this.zDamper.update(h,r.z,e,n),i.set(s,l,h);const c=this.scaleDamper.update(o,this.goalScale,e,1);if(t.scale.set(c,c,c),!this.isTranslating){const e=r.y-l;this.placementComplete&&!1===this.placeOnWall?(a.offsetHeight=e/c,t.setShadowOffset(e)):0===e&&(this.placementComplete=!0,a.show=!1,t.setShadowIntensity(.8))}}a.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(s,this.goalYaw,e,Math.PI),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:A}}))}onWebXRFrame(e,t){this.frame=t,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=t.getViewerPose(i);null==s&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:po}));const n=this.presentedScene;if(null==s||null==n||!n.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:go}));let r=!0;for(const i of s.views){if(this.updateView(i),r){this.moveToFloor(t),this.processInput(t);const i=e-this.lastTick;this.moveScene(i),this.renderer.preRender(n,e,i),this.lastTick=e,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),r=!1}}}function Bo(e){const t=new Map,i=new Map,s=e.clone();return yo(e,s,(function(e,s){t.set(s,e),i.set(e,s)})),s.traverse((function(e){if(!e.isSkinnedMesh)return;const s=e,n=t.get(e),r=n.skeleton.bones;s.skeleton=n.skeleton.clone(),s.bindMatrix.copy(n.bindMatrix),s.skeleton.bones=r.map((function(e){return i.get(e)})),s.bind(s.skeleton,s.bindMatrix)})),s}function yo(e,t,i){i(e,t);for(let s=0;s<e.children.length;s++)yo(e.children[s],t.children[s],i)}const wo=Symbol("prepared"),Qo=Symbol("prepare"),vo=Symbol("preparedGLTF"),So=Symbol("clone");class bo{constructor(e){this[vo]=e}static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[wo])return e;const t=this[Qo](e);return t[wo]=!0,t}static[Qo](e){const{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[vo].parser}get animations(){return this[vo].animations}get scene(){return this[vo].scene}get scenes(){return this[vo].scenes}get cameras(){return this[vo].cameras}get asset(){return this[vo].asset}get userData(){return this[vo].userData}clone(){return new(0,this.constructor)(this[So]())}dispose(){this.scenes.forEach((e=>{e.traverse((e=>{const i=e;i.material&&((Array.isArray(i.material)?i.material:[i.material]).forEach((e=>{for(const i in e){const s=e[i];if(s instanceof t.Texture){const e=s.source.data;null!=e.close&&e.close(),s.dispose()}}e.dispose()})),i.geometry.dispose())}))}))}[So](){const e=this[vo],t=Bo(this.scene);xo(t,this.scene);const i=[t],s=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:s})}}const xo=(e,t)=>{Mo(e,t,((e,t)=>{void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.variantData&&(e.userData.variantData=t.userData.variantData),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)}))},Mo=(e,t,i)=>{i(e,t);for(let s=0;s<e.children.length;s++)Mo(e.children[s],t.children[s],i)},Ro=Symbol("threeGLTF"),To=Symbol("gltf"),Do=Symbol("gltfElementMap"),Lo=Symbol("threeObjectMap"),Fo=Symbol("parallelTraverseThreeScene"),ko=Symbol("correlateOriginalThreeGLTF"),_o=Symbol("correlateCloneThreeGLTF");class Uo{constructor(e,t,i,s){this[Ro]=e,this[To]=t,this[Do]=s,this[Lo]=i}static from(e,t){return null!=t?this[_o](e,t):this[ko](e)}static[ko](e){const i=e.parser.json,s=e.parser.associations,n=new Map,r={name:"Default"},o={type:"materials",index:-1};for(const e of s.keys())e instanceof t.Material&&null==s.get(e)&&(o.index<0&&(null==i.materials&&(i.materials=[]),o.index=i.materials.length,i.materials.push(r)),e.name=r.name,s.set(e,{materials:o.index}));for(const[e,t]of s){if(t){const i=e;i.userData=i.userData||{},i.userData.associations=t}for(const s in t)if(null!=s&&"primitives"!==s){const r=s,o=(i[r]||[])[t[r]];if(null==o)continue;let a=n.get(o);null==a&&(a=new Set,n.set(o,a)),a.add(e)}}return new Uo(e,i,s,n)}static[_o](e,t){const i=t.threeGLTF,s=t.gltf,n=JSON.parse(JSON.stringify(s)),r=new Map,o=new Map;for(let s=0;s<i.scenes.length;s++)this[Fo](i.scenes[s],e.scenes[s],((e,i)=>{const s=t.threeObjectMap.get(e);if(null!=s)for(const e in s)if(null!=e&&"primitives"!==e){const t=e,a=s[t],A=n[t][a],l=r.get(i)||{};l[t]=a,r.set(i,l);const h=o.get(A)||new Set;h.add(i),o.set(A,h)}}));return new Uo(e,n,r,o)}static[Fo](e,t,i){const s=(e,t)=>{if(i(e,t),e.isObject3D){const n=e,r=t;if(n.material)if(Array.isArray(n.material))for(let e=0;e<n.material.length;++e)i(n.material[e],r.material[e]);else i(n.material,r.material);for(let i=0;i<e.children.length;++i)s(e.children[i],t.children[i])}};s(e,t)}get threeGLTF(){return this[Ro]}get gltf(){return this[To]}get gltfElementMap(){return this[Do]}get threeObjectMap(){return this[Lo]}}const Go=Symbol("correlatedSceneGraph");class No extends bo{static[Qo](e){const i=super[Qo](e);null==i[Go]&&(i[Go]=Uo.from(i));const{scene:s}=i,n=new t.Sphere(void 0,1/0);return s.traverse((e=>{e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);const s=e;if(s.material){const{geometry:e}=s;s.castShadow=!0,s.isSkinnedMesh&&(e.boundingSphere=n,e.boundingBox=null);const r=s.material;if(!0===r.isMeshBasicMaterial&&(r.toneMapped=!1),r.shadowSide=t.FrontSide,r.aoMap){const{gltf:t,threeObjectMap:s}=i[Go],n=s.get(r);if(null!=t.materials&&null!=n&&null!=n.materials){const i=t.materials[n.materials];i.occlusionTexture&&0===i.occlusionTexture.texCoord&&null!=e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv)}}}})),i}get correlatedSceneGraph(){return this[vo][Go]}[So](){const e=super[So](),t=new Map;return e.scene.traverse((e=>{const i=e;if(i.material){const e=i.material;if(null!=e){if(t.has(e.uuid))return void(i.material=t.get(e.uuid));i.material=e.clone(),t.set(e.uuid,i.material)}}const s=e;void 0!==s.target&&s.add(s.target)})),e[Go]=Uo.from(e,this.correlatedSceneGraph),e}}class Po extends t.DataTextureLoader{constructor(e){super(e),this.type=t.HalfFloatType}parse(e){const i=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,i){t=t||1024;let s=e.pos,n=-1,r=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=a.indexOf("\n"))&&r<t&&s<e.byteLength;)o+=a,r+=a.length,s+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n&&(!1!==i&&(e.pos+=r+n+1),o+a.slice(0,n))},n=function(e,t,i,s){const n=e[t+3],r=Math.pow(2,n-128)/255;i[s+0]=e[t+0]*r,i[s+1]=e[t+1]*r,i[s+2]=e[t+2]*r,i[s+3]=1},r=function(e,i,s,n){const r=e[i+3],o=Math.pow(2,r-128)/255;s[n+0]=t.DataUtils.toHalfFloat(Math.min(e[i+0]*o,65504)),s[n+1]=t.DataUtils.toHalfFloat(Math.min(e[i+1]*o,65504)),s[n+2]=t.DataUtils.toHalfFloat(Math.min(e[i+2]*o,65504)),s[n+3]=t.DataUtils.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let A,l;for((e.pos>=e.byteLength||!(A=s(e)))&&i(1,"no header found"),(l=A.match(/^#\?(\S+)/))||i(3,"bad initial token"),a.valid|=1,a.programtype=l[1],a.string+=A+"\n";A=s(e),!1!==A;)if(a.string+=A+"\n","#"!==A.charAt(0)){if((l=A.match(t))&&(a.gamma=parseFloat(l[1])),(l=A.match(n))&&(a.exposure=parseFloat(l[1])),(l=A.match(r))&&(a.valid|=2,a.format=l[1]),(l=A.match(o))&&(a.valid|=4,a.height=parseInt(l[1],10),a.width=parseInt(l[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=A+"\n";return 2&a.valid||i(3,"missing format specifier"),4&a.valid||i(3,"missing image size specifier"),a}(o),A=a.width,l=a.height,h=function(e,t,s){const n=t;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&i(3,"wrong scanline width");const r=new Uint8Array(4*t*s);r.length||i(4,"unable to allocate buffer space");let o=0,a=0;const A=4*n,l=new Uint8Array(4),h=new Uint8Array(A);let c=s;for(;c>0&&a<e.byteLength;){a+4>e.byteLength&&i(1),l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],l[3]=e[a++],2==l[0]&&2==l[1]&&(l[2]<<8|l[3])==n||i(3,"bad rgbe scanline format");let t,s=0;for(;s<A&&a<e.byteLength;){t=e[a++];const n=t>128;if(n&&(t-=128),(0===t||s+t>A)&&i(3,"bad scanline data"),n){const i=e[a++];for(let e=0;e<t;e++)h[s++]=i}else h.set(e.subarray(a,a+t),s),s+=t,a+=t}const u=n;for(let e=0;e<u;e++){let t=0;r[o]=h[e+t],t+=n,r[o+1]=h[e+t],t+=n,r[o+2]=h[e+t],t+=n,r[o+3]=h[e+t],o+=4}c--}return r}(o.subarray(o.pos),A,l);let c,u,g;switch(this.type){case t.FloatType:g=h.length/4;const e=new Float32Array(4*g);for(let t=0;t<g;t++)n(h,4*t,e,4*t);c=e,u=t.FloatType;break;case t.HalfFloatType:g=h.length/4;const i=new Uint16Array(4*g);for(let e=0;e<g;e++)r(h,4*e,i,4*e);c=i,u=t.HalfFloatType;break;default:throw new Error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:A,height:l,data:c,header:a.string,gamma:a.gamma,exposure:a.exposure,type:u}}setDataType(e){return this.type=e,this}load(e,i,s,n){return super.load(e,(function(e,s){switch(e.type){case t.FloatType:case t.HalfFloatType:e.colorSpace=t.LinearSRGBColorSpace,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}i&&i(e,s)}),s,n)}}class Oo extends t.Scene{constructor(){super(),this.position.y=-3.5;const e=new t.BoxGeometry;e.deleteAttribute("uv");const i=new t.MeshStandardMaterial({metalness:0,side:t.BackSide}),s=new t.MeshStandardMaterial({metalness:0}),n=new t.PointLight(16777215,500,28,2);n.position.set(.418,16.199,.3),this.add(n);const r=new t.Mesh(e,i);r.position.set(-.757,13.219,.717),r.scale.set(31.713,28.305,28.591),this.add(r);const o=new t.Mesh(e,s);o.position.set(-10.906,2.009,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),this.add(o);const a=new t.Mesh(e,s);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const A=new t.Mesh(e,s);A.position.set(6.167,.857,7.803),A.rotation.set(0,.561,0),A.scale.set(3.927,6.285,3.687),this.add(A);const l=new t.Mesh(e,s);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const h=new t.Mesh(e,s);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);const c=new t.Mesh(e,s);c.position.set(-2.193,-.369,-5.547),c.rotation.set(0,.516,0),c.scale.set(3.875,3.487,2.986),this.add(c);const u=new t.Mesh(e,this.createAreaLightMaterial(50));u.position.set(-16.116,14.37,8.208),u.scale.set(.1,2.428,2.739),this.add(u);const g=new t.Mesh(e,this.createAreaLightMaterial(50));g.position.set(-16.109,18.021,-8.207),g.scale.set(.1,2.425,2.751),this.add(g);const d=new t.Mesh(e,this.createAreaLightMaterial(17));d.position.set(14.904,12.198,-1.832),d.scale.set(.15,4.265,6.331),this.add(d);const p=new t.Mesh(e,this.createAreaLightMaterial(43));p.position.set(-.462,8.89,14.52),p.scale.set(4.38,5.441,.088),this.add(p);const m=new t.Mesh(e,this.createAreaLightMaterial(20));m.position.set(3.235,11.486,-12.541),m.scale.set(2.5,2,.1),this.add(m);const I=new t.Mesh(e,this.createAreaLightMaterial(100));I.position.set(0,20,0),I.scale.set(1,.1,1),this.add(I)}createAreaLightMaterial(e){const i=new t.MeshBasicMaterial;return i.color.setScalar(e),i}}class Ho extends t.Scene{constructor(){super(),this.position.y=-3.5;const e=new t.BoxGeometry;e.deleteAttribute("uv");const i=new t.MeshStandardMaterial({metalness:0,side:t.BackSide}),s=new t.MeshStandardMaterial({metalness:0}),n=new t.PointLight(16777215,400,28,2);n.position.set(.5,14,.5),this.add(n);const r=new t.Mesh(e,i);r.position.set(0,13.2,0),r.scale.set(31.5,28.5,31.5),this.add(r);const o=new t.Mesh(e,s);o.position.set(-10.906,-1,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),this.add(o);const a=new t.Mesh(e,s);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const A=new t.Mesh(e,s);A.position.set(6.167,-.16,7.803),A.rotation.set(0,.561,0),A.scale.set(3.927,6.285,3.687),this.add(A);const l=new t.Mesh(e,s);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const h=new t.Mesh(e,s);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);const c=new t.Mesh(e,s);c.position.set(-2.193,-.369,-5.547),c.rotation.set(0,.516,0),c.scale.set(3.875,3.487,2.986),this.add(c);const u=new t.Mesh(e,this.createAreaLightMaterial(80));u.position.set(-14,10,8),u.scale.set(.1,2.5,2.5),this.add(u);const g=new t.Mesh(e,this.createAreaLightMaterial(80));g.position.set(-14,14,-4),g.scale.set(.1,2.5,2.5),this.add(g);const d=new t.Mesh(e,this.createAreaLightMaterial(23));d.position.set(14,12,0),d.scale.set(.1,5,5),this.add(d);const p=new t.Mesh(e,this.createAreaLightMaterial(16));p.position.set(0,9,14),p.scale.set(5,5,.1),this.add(p);const m=new t.Mesh(e,this.createAreaLightMaterial(80));m.position.set(7,8,-14),m.scale.set(2.5,2.5,.1),this.add(m);const I=new t.Mesh(e,this.createAreaLightMaterial(80));I.position.set(-7,16,-14),I.scale.set(2.5,2.5,.1),this.add(I);const f=new t.Mesh(e,this.createAreaLightMaterial(1));f.position.set(0,20,0),f.scale.set(.1,.1,.1),this.add(f)}createAreaLightMaterial(e){const i=new t.MeshBasicMaterial;return i.color.setScalar(e),i}}const qo=20,Vo=/\.hdr(\.js)?$/;class Ko extends t.EventDispatcher{constructor(e){super(),this.threeRenderer=e,this.lottieLoaderUrl="",this.withCredentials=!1,this._ldrLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}get ldrLoader(){return null==this._ldrLoader&&(this._ldrLoader=new t.TextureLoader),this._ldrLoader.setWithCredentials(this.withCredentials),this._ldrLoader}get hdrLoader(){return null==this._hdrLoader&&(this._hdrLoader=new Po,this._hdrLoader.setDataType(t.HalfFloatType)),this._hdrLoader.setWithCredentials(this.withCredentials),this._hdrLoader}async getLottieLoader(){if(null==this._lottieLoader){const{LottieLoader:e}=await import(this.lottieLoaderUrl);this._lottieLoader=new e}return this._lottieLoader.setWithCredentials(this.withCredentials),this._lottieLoader}async loadImage(e){const t=await new Promise(((t,i)=>this.ldrLoader.load(e,t,(()=>{}),i)));return t.name=e,t.flipY=!1,t}async loadLottie(e,t){const i=await this.getLottieLoader();i.setQuality(t);const s=await new Promise(((t,s)=>i.load(e,t,(()=>{}),s)));return s.name=e,s}async loadEquirect(e,i=(()=>{})){try{const s=Vo.test(e),n=s?this.hdrLoader:this.ldrLoader,r=await new Promise(((t,s)=>n.load(e,t,(e=>{i(e.loaded/e.total*.9)}),s)));return i(1),r.name=e,r.mapping=t.EquirectangularReflectionMapping,s||(r.encoding=t.sRGBEncoding),r}finally{i&&i(1)}}async generateEnvironmentMapAndSkybox(e=null,t=null,i=(()=>{})){const s="legacy"!==t;"legacy"!==t&&"neutral"!==t||(t=null),t=Pe(t);let n,r=Promise.resolve(null);e&&(r=this.loadEquirectFromUrl(e,i)),n=t?this.loadEquirectFromUrl(t,i):e?this.loadEquirectFromUrl(e,i):s?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,a]=await Promise.all([n,r]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:a}}async loadEquirectFromUrl(e,t){if(!this.skyboxCache.has(e)){const i=this.loadEquirect(e,t);this.skyboxCache.set(e,i)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,i){await((e=0)=>new Promise((t=>setTimeout(t,e))))();const s=this.threeRenderer,n=new t.WebGLCubeRenderTarget(256,{generateMipmaps:!1,type:t.HalfFloatType,format:t.RGBAFormat,colorSpace:t.LinearSRGBColorSpace,depthBuffer:!0}),r=new t.CubeCamera(.1,100,n),o=r.renderTarget.texture;o.name=i;const a=s.outputColorSpace,A=s.toneMapping;return s.toneMapping=t.NoToneMapping,s.outputColorSpace=t.LinearSRGBColorSpace,r.update(s,e),this.blurCubemap(n,.04),s.toneMapping=A,s.outputColorSpace=a,o}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new Oo,"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new Ho,"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,i){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(qo);const e=new t.BoxGeometry,i=new t.Mesh(e,this.blurMaterial);this.blurScene=new t.Scene,this.blurScene.add(i)}const s=e.clone();this.halfblur(e,s,i,"latitudinal"),this.halfblur(s,e,i,"longitudinal")}halfblur(e,i,s,n){const r=e.width,o=isFinite(s)?Math.PI/(2*r):2*Math.PI/39,a=s/o,A=isFinite(s)?1+Math.floor(3*a):qo;A>qo&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${A} samples when the maximum is set to 20`);const l=[];let h=0;for(let e=0;e<qo;++e){const t=e/a,i=Math.exp(-t*t/2);l.push(i),0==e?h+=i:e<A&&(h+=2*i)}for(let e=0;e<l.length;e++)l[e]=l[e]/h;const c=this.blurMaterial.uniforms;c.envMap.value=e.texture,c.samples.value=A,c.weights.value=l,c.latitudinal.value="latitudinal"===n,c.dTheta.value=o,new t.CubeCamera(.1,100,i).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const i=new Float32Array(e),s=new t.Vector3(0,1,0);return new t.ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:s}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:t.NoBlending,depthTest:!1,depthWrite:!1,side:t.BackSide})}async dispose(){for(const[,e]of this.skyboxCache)(await e).dispose();null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}const Jo=[1,.79,.62,.5,.4,.31,.25],$o="high-performance";class Yo extends t.EventDispatcher{constructor(e){super(),this.loader=new Ki(No),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;null===(e=this.textureUtils)||void 0===e||e.dispose(),this.textureUtils=new Ko(this.threeRenderer);for(const e of this.scenes)e.element[je]()},this.dpr=Ke(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new t.WebGLRenderer({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=t.ACESFilmicToneMapping}catch(e){console.warn(e)}this.arRenderer=new Eo(this),this.textureUtils=this.canRender?new Ko(this.threeRenderer):null,Ki.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new Yo({powerPreference:(self.ModelViewerElement||{}).powerPreference||$o,debug:Je()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return Jo[this.scaleStep]}set minScale(e){let t=1;for(;t<Jo.length&&!(Jo[t]<e);)++t;this.lastStep=t-1}registerScene(e){this.scenes.add(e),e.forceRescale();const i=new t.Vector2;this.threeRenderer.getSize(i),e.canvas.width=i.x,e.canvas.height=i.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((e,t)=>this.render(e,t)))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return this.multipleScenesVisible?e.element[Dl]:this.canvas3D}countVisibleScenes(){const{canvas3D:e}=this;let t=0,i=null;for(const s of this.scenes){const{element:n}=s;n.modelIsVisible&&null==s.externalRenderer&&++t,e.parentElement===s.canvas.parentElement&&(i=s)}const s=t>1;if(null!=i){const t=s&&!this.multipleScenesVisible,n=!i.element.modelIsVisible;if(t||n){const{width:t,height:s}=this.sceneSize(i);this.copyPixels(i,t,s),e.parentElement.removeChild(e)}}this.multipleScenesVisible=s}updateRendererSize(){var e;const t=Ke();if(t!==this.dpr)for(const e of this.scenes){const{element:t}=e;t[Cl](t.getBoundingClientRect())}let i=0,s=0;for(const e of this.scenes)i=Math.max(i,e.width),s=Math.max(s,e.height);if(i!==this.width||s!==this.height||t!==this.dpr){this.width=i,this.height=s,this.dpr=t,i=Math.ceil(i*t),s=Math.ceil(s*t),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const t of this.scenes){const{canvas:n}=t;n.width=i,n.height=s,t.forceRescale(),null===(e=t.effectRenderer)||void 0===e||e.setSize(i,s)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=Ve(.2*(e-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else{if(0==e.scaleStep)return!1;e.scaleStep=0,this.rescaleCanvas(e)}return!0}rescaleCanvas(e){const t=Jo[e.scaleStep],i=Math.ceil(this.width/t),s=Math.ceil(this.height/t),{style:n}=e.canvas;n.width=`${i}px`,n.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const r=this.dpr*t,o=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:r,minimumDpr:this.dpr*Jo[this.lastStep],pixelWidth:Math.ceil(e.width*r),pixelHeight:Math.ceil(e.height*r),reason:o}}))}sceneSize(e){const{dpr:t}=this,i=Jo[e.scaleStep];return{width:Math.min(Math.ceil(e.width*i*t),this.canvas3D.width),height:Math.min(Math.ceil(e.height*i*t),this.canvas3D.height)}}copyPixels(e,t,i){const s=e.context;null!=s?(s.clearRect(0,0,t,i),s.drawImage(this.canvas3D,0,0,t,i,0,0,t,i),e.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,i){const{element:s,exposure:n}=e;s[kl](t,i);const r="number"==typeof n&&!Number.isNaN(n);this.threeRenderer.toneMappingExposure=r?n:1}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const t of this.orderedScenes()){const{element:n}=t;if(!n.loaded||!n.modelIsVisible&&t.renderCount>0)continue;if(this.preRender(t,e,i),!this.shouldRender(t))continue;if(null!=t.externalRenderer){const e=t.getCamera();e.updateMatrix();const{matrix:i,projectionMatrix:s}=e,n=i.elements.slice(),r=t.getTarget();n[12]+=r.x,n[13]+=r.y,n[14]+=r.z,t.externalRenderer.render({viewMatrix:n,projectionMatrix:s.elements});continue}if(!n.modelIsVisible&&!this.multipleScenesVisible)for(const e of this.scenes)e.element.modelIsVisible&&e.queueRender();const{width:r,height:o}=this.sceneSize(t);t.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-o,r,o),null!=t.effectRenderer?t.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.render(t,t.camera)),this.multipleScenesVisible||!t.element.modelIsVisible&&0===t.renderCount?this.copyPixels(t,r,o):s.parentElement!==t.canvas.parentElement&&(t.canvas.parentElement.appendChild(s),t.canvas.classList.remove("show")),t.hasRendered(),++t.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}Yo._singleton=new Yo({powerPreference:(self.ModelViewerElement||{}).powerPreference||$o,debug:Je()});const zo=Symbol("correlatedObjects"),jo=Symbol("onUpdate");class Wo{constructor(e,t=null){this[jo]=e,this[zo]=t}}const Xo=new t.MeshBasicMaterial,Zo=new t.PlaneGeometry(2,2);let ea=0;const ta=Symbol("threeTexture"),ia=Symbol("threeTextures");class sa extends Wo{get[ta](){var e;return null===(e=this[zo])||void 0===e?void 0:e.values().next().value}get[ia](){return this[zo]}constructor(e,t){super(e,new Set(t?[t]:[])),this[ta].image.src||(this[ta].image.src="adhoc_image"+ea++),this[ta].image.name||(this[ta].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[ta].image.name||""}get uri(){return this[ta].image.src}get bufferView(){return this[ta].image.bufferView}get element(){const e=this[ta];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[ta];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return null!=this.uri?"external":"embedded"}set name(e){for(const t of this[ia])t.image.name=e}update(){const e=this[ta];e&&e.isCanvasTexture&&!e.animation&&(this[ta].needsUpdate=!0,this[jo]())}async createThumbnail(e,i){const s=new t.Scene;Xo.map=this[ta];const n=new t.Mesh(Zo,Xo);s.add(n);const r=new t.OrthographicCamera(-1,1,1,-1,0,1),{threeRenderer:o}=Yo.singleton,a=new t.WebGLRenderTarget(e,i);o.setRenderTarget(a),o.render(s,r),o.setRenderTarget(null);const A=new Uint8Array(e*i*4);o.readRenderTargetPixels(a,0,0,e,i,A),ll.width=e,ll.height=i;const l=ll.getContext("2d"),h=l.createImageData(e,i);return h.data.set(A),l.putImageData(h,0,0),new Promise((async(e,t)=>{ll.toBlob((i=>{if(!i)return t("Failed to capture thumbnail.");e(URL.createObjectURL(i))}),"image/png")}))}}var na,ra;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(na||(na={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(ra||(ra={}));const oa=(()=>{const e=[na.Nearest,na.Linear,na.NearestMipmapNearest,na.LinearMipmapLinear,na.NearestMipmapLinear,na.LinearMipmapLinear];return t=>e.indexOf(t)>-1})(),aa=(()=>{const e=[na.Nearest,na.Linear];return t=>e.indexOf(t)>-1})(),Aa=(()=>{const e=[ra.ClampToEdge,ra.MirroredRepeat,ra.Repeat];return t=>e.indexOf(t)>-1})(),la=Symbol("threeTexture"),ha=Symbol("threeTextures"),ca=Symbol("setProperty");class ua extends Wo{get[la](){var e;return null===(e=this[zo])||void 0===e?void 0:e.values().next().value}get[ha](){return this[zo]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[la].name||""}get minFilter(){return this[la].minFilter}get magFilter(){return this[la].magFilter}get wrapS(){return this[la].wrapS}get wrapT(){return this[la].wrapT}get rotation(){return this[la].rotation}get scale(){return Vl(this[la].repeat)}get offset(){return Vl(this[la].offset)}setMinFilter(e){this[ca]("minFilter",e)}setMagFilter(e){this[ca]("magFilter",e)}setWrapS(e){this[ca]("wrapS",e)}setWrapT(e){this[ca]("wrapT",e)}setRotation(e){null==e&&(e=0),this[ca]("rotation",e)}setScale(e){null==e&&(e={u:1,v:1}),this[ca]("repeat",new t.Vector2(e.u,e.v))}setOffset(e){null==e&&(e={u:0,v:0}),this[ca]("offset",new t.Vector2(e.u,e.v))}[ca](e,t){if(((e,t)=>{switch(e){case"minFilter":return oa(t);case"magFilter":return aa(t);case"wrapS":case"wrapT":return Aa(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${e}" on Sampler`)}})(e,t))for(const i of this[ha])i[e]=t,i.needsUpdate=!0;this[jo]()}}const ga=Symbol("image"),da=Symbol("sampler"),pa=Symbol("threeTexture");class ma extends Wo{constructor(e,t){super(e,new Set(t?[t]:[])),this[da]=new ua(e,t),this[ga]=new sa(e,t)}get[pa](){var e;return null===(e=this[zo])||void 0===e?void 0:e.values().next().value}get name(){return this[pa].name||""}set name(e){for(const t of this[zo])t.name=e}get sampler(){return this[da]}get source(){return this[ga]}}var Ia,fa,Ca;const Ea=Symbol("texture"),Ba=Symbol("transform"),ya=Symbol("materials"),wa=Symbol("usage"),Qa=Symbol("onUpdate"),va=Symbol("activeVideo");var Sa;!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive",e[e.Clearcoat=5]="Clearcoat",e[e.ClearcoatRoughness=6]="ClearcoatRoughness",e[e.ClearcoatNormal=7]="ClearcoatNormal",e[e.SheenColor=8]="SheenColor",e[e.SheenRoughness=9]="SheenRoughness",e[e.Transmission=10]="Transmission",e[e.Thickness=11]="Thickness",e[e.Specular=12]="Specular",e[e.SpecularColor=13]="SpecularColor",e[e.Iridescence=14]="Iridescence",e[e.IridescenceThickness=15]="IridescenceThickness",e[e.Anisotropy=16]="Anisotropy"}(Sa||(Sa={}));class ba{constructor(e,i,s,n){this[Ia]=null,this[fa]={rotation:0,scale:new t.Vector2(1,1),offset:new t.Vector2(0,0)},this[Ca]=!1,s&&(this[Ba].rotation=s.rotation,this[Ba].scale.copy(s.repeat),this[Ba].offset.copy(s.offset),this[Ea]=new ma(e,s)),this[Qa]=e,this[ya]=n,this[wa]=i}get texture(){return this[Ea]}setTexture(e){var i,s;const n=null!=e?e.source[ta]:null,r=null===(i=this[Ea])||void 0===i?void 0:i.source[ta];if(null!=r&&r.isVideoTexture?this[va]=!1:(null===(s=this[Ea])||void 0===s?void 0:s.source.animation)&&this[Ea].source.animation.removeEventListener("enterFrame",this[Qa]),this[Ea]=e,null!=n&&n.isVideoTexture){const e=n.image;if(this[va]=!0,null!=e.requestVideoFrameCallback){const t=()=>{this[va]&&(this[Qa](),e.requestVideoFrameCallback(t))};e.requestVideoFrameCallback(t)}else{const e=()=>{this[va]&&(this[Qa](),requestAnimationFrame(e))};requestAnimationFrame(e)}}else null!=(null==e?void 0:e.source.animation)&&e.source.animation.addEventListener("enterFrame",this[Qa]);let o=t.SRGBColorSpace;if(this[ya])for(const e of this[ya]){switch(this[wa]){case Sa.Base:e.map=n;break;case Sa.MetallicRoughness:o=t.LinearSRGBColorSpace,e.metalnessMap=n,e.roughnessMap=n;break;case Sa.Normal:o=t.LinearSRGBColorSpace,e.normalMap=n;break;case Sa.Occlusion:o=t.LinearSRGBColorSpace,e.aoMap=n;break;case Sa.Emissive:e.emissiveMap=n;break;case Sa.Clearcoat:e.clearcoatMap=n;break;case Sa.ClearcoatRoughness:e.clearcoatRoughnessMap=n;break;case Sa.ClearcoatNormal:e.clearcoatNormalMap=n;break;case Sa.SheenColor:e.sheenColorMap=n;break;case Sa.SheenRoughness:e.sheenRoughnessMap=n;break;case Sa.Transmission:e.transmissionMap=n;break;case Sa.Thickness:e.thicknessMap=n;break;case Sa.Specular:e.specularIntensityMap=n;break;case Sa.SpecularColor:e.specularColorMap=n;break;case Sa.Iridescence:e.iridescenceMap=n;break;case Sa.IridescenceThickness:e.iridescenceThicknessMap=n;break;case Sa.Anisotropy:e.anisotropyMap=n}e.needsUpdate=!0}n&&(n.colorSpace=o,n.rotation=this[Ba].rotation,n.repeat=this[Ba].scale,n.offset=this[Ba].offset),this[Qa]()}}Ia=Ea,fa=Ba,Ca=va;const xa=Symbol("threeMaterial"),Ma=Symbol("threeMaterials"),Ra=Symbol("baseColorTexture"),Ta=Symbol("metallicRoughnessTexture");class Da extends Wo{constructor(e,t){super(e,t);const{map:i,metalnessMap:s}=t.values().next().value;this[Ra]=new ba(e,Sa.Base,i,t),this[Ta]=new ba(e,Sa.MetallicRoughness,s,t)}get[Ma](){return this[zo]}get[xa](){var e;return null===(e=this[zo])||void 0===e?void 0:e.values().next().value}get baseColorFactor(){const e=[0,0,0,this[xa].opacity];return this[xa].color.toArray(e),e}get metallicFactor(){return this[xa].metalness}get roughnessFactor(){return this[xa].roughness}get baseColorTexture(){return this[Ra]}get metallicRoughnessTexture(){return this[Ta]}setBaseColorFactor(e){const i=new t.Color;e instanceof Array?i.fromArray(e):i.set(e);for(const t of this[Ma])t.color.set(i),e instanceof Array?t.opacity=e[3]:(e=[0,0,0,t.opacity],i.toArray(e));this[jo]()}setMetallicFactor(e){for(const t of this[Ma])t.metalness=e;this[jo]()}setRoughnessFactor(e){for(const t of this[Ma])t.roughness=e;this[jo]()}}var La,Fa;const ka=Symbol("pbrMetallicRoughness"),_a=Symbol("normalTexture"),Ua=Symbol("occlusionTexture"),Ga=Symbol("emissiveTexture"),Na=Symbol("backingThreeMaterial"),Pa=Symbol("applyAlphaCutoff"),Oa=Symbol("getAlphaMode"),Ha=Symbol("lazyLoadGLTFInfo"),qa=Symbol("initialize"),Va=Symbol("getLoadedMaterial"),Ka=Symbol("ensureMaterialIsLoaded"),Ja=Symbol("gltfIndex"),$a=Symbol("setActive"),Ya=Symbol("variantIndices"),za=Symbol("isActive"),ja=Symbol("variantSet"),Wa=Symbol("modelVariants"),Xa=Symbol("name"),Za=Symbol("pbrTextures");class eA extends Wo{constructor(e,t,i,s,n,r,o=void 0){super(e,n),this[La]=new Set,this[Fa]=new Map,this[Ja]=t,this[za]=i,this[Wa]=s,this[Xa]=r,null==o?this[qa]():this[Ha]=o}get[(La=ja,Fa=Za,Na)](){return this[zo].values().next().value}[qa](){const e=this[jo],t=this[zo];this[ka]=new Da(e,t);const{normalMap:i,aoMap:s,emissiveMap:n}=t.values().next().value;this[_a]=new ba(e,Sa.Normal,i,t),this[Ua]=new ba(e,Sa.Occlusion,s,t),this[Ga]=new ba(e,Sa.Emissive,n,t);const r=i=>{this[Za].set(i,new ba(e,i,null,t))};r(Sa.Clearcoat),r(Sa.ClearcoatRoughness),r(Sa.ClearcoatNormal),r(Sa.SheenColor),r(Sa.SheenRoughness),r(Sa.Transmission),r(Sa.Thickness),r(Sa.Specular),r(Sa.SpecularColor),r(Sa.Iridescence),r(Sa.IridescenceThickness),r(Sa.Anisotropy)}async[Va](){if(null!=this[Ha]){const{set:e,material:t}=await this[Ha].doLazyLoad();return this[zo]=e,this[qa](),this[Ha]=void 0,this.ensureLoaded=async()=>{},t}return this[zo].values().next().value}colorFromRgb(e){const i=new t.Color;return e instanceof Array?i.fromArray(e):i.set(e),i}[Ka](){if(null!=this[Ha])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[Va]()}get isLoaded(){return null==this[Ha]}get isActive(){return this[za]}[$a](e){this[za]=e}get name(){return this[Xa]||""}set name(e){if(this[Xa]=e,null!=this[zo])for(const t of this[zo])t.name=e}get pbrMetallicRoughness(){return this[Ka](),this[ka]}get normalTexture(){return this[Ka](),this[_a]}get occlusionTexture(){return this[Ka](),this[Ua]}get emissiveTexture(){return this[Ka](),this[Ga]}get emissiveFactor(){return this[Ka](),this[Na].emissive.toArray()}get index(){return this[Ja]}[Ya](){return this[ja]}hasVariant(e){const t=this[Wa].get(e);return null!=t&&this[ja].has(t.index)}setEmissiveFactor(e){this[Ka]();const t=this.colorFromRgb(e);for(const e of this[zo])e.emissive.set(t);this[jo]()}[Oa](){return this[Na].transparent?"BLEND":this[Na].alphaTest>0?"MASK":"OPAQUE"}[Pa](){this[Ka]();for(const e of this[zo])"MASK"===this[Oa]()?null==e.alphaTest&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[Ka]();for(const t of this[zo])t.alphaTest=e,t.needsUpdate=!0;this[Pa](),this[jo]()}getAlphaCutoff(){return this[Ka](),this[Na].alphaTest}setDoubleSided(e){this[Ka]();for(const i of this[zo])i.side=e?t.DoubleSide:t.FrontSide,i.needsUpdate=!0;this[jo]()}getDoubleSided(){return this[Ka](),this[Na].side==t.DoubleSide}setAlphaMode(e){this[Ka]();const t=(e,t)=>{e.transparent=t,e.depthWrite=!t};for(const i of this[zo])t(i,"BLEND"===e),i.alphaTest="MASK"===e?.5:void 0,i.needsUpdate=!0;this[jo]()}getAlphaMode(){return this[Ka](),this[Oa]()}get emissiveStrength(){return this[Ka](),this[Na].emissiveIntensity}setEmissiveStrength(e){this[Ka]();for(const t of this[zo])t.emissiveIntensity=e;this[jo]()}get clearcoatFactor(){return this[Ka](),this[Na].clearcoat}get clearcoatRoughnessFactor(){return this[Ka](),this[Na].clearcoatRoughness}get clearcoatTexture(){return this[Ka](),this[Za].get(Sa.Clearcoat)}get clearcoatRoughnessTexture(){return this[Ka](),this[Za].get(Sa.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[Ka](),this[Za].get(Sa.ClearcoatNormal)}get clearcoatNormalScale(){return this[Ka](),this[Na].clearcoatNormalScale.x}setClearcoatFactor(e){this[Ka]();for(const t of this[zo])t.clearcoat=e;this[jo]()}setClearcoatRoughnessFactor(e){this[Ka]();for(const t of this[zo])t.clearcoatRoughness=e;this[jo]()}setClearcoatNormalScale(e){this[Ka]();for(const i of this[zo])i.clearcoatNormalScale=new t.Vector2(e,e);this[jo]()}get ior(){return this[Ka](),this[Na].ior}setIor(e){this[Ka]();for(const t of this[zo])t.ior=e;this[jo]()}get sheenColorFactor(){return this[Ka](),this[Na].sheenColor.toArray()}get sheenColorTexture(){return this[Ka](),this[Za].get(Sa.SheenColor)}get sheenRoughnessFactor(){return this[Ka](),this[Na].sheenRoughness}get sheenRoughnessTexture(){return this[Ka](),this[Za].get(Sa.SheenRoughness)}setSheenColorFactor(e){this[Ka]();const t=this.colorFromRgb(e);for(const e of this[zo])e.sheenColor.set(t),e.sheen=1;this[jo]()}setSheenRoughnessFactor(e){this[Ka]();for(const t of this[zo])t.sheenRoughness=e,t.sheen=1;this[jo]()}get transmissionFactor(){return this[Ka](),this[Na].transmission}get transmissionTexture(){return this[Ka](),this[Za].get(Sa.Transmission)}setTransmissionFactor(e){this[Ka]();for(const t of this[zo])t.transmission=e;this[jo]()}get thicknessFactor(){return this[Ka](),this[Na].thickness}get thicknessTexture(){return this[Ka](),this[Za].get(Sa.Thickness)}get attenuationDistance(){return this[Ka](),this[Na].attenuationDistance}get attenuationColor(){return this[Ka](),this[Na].attenuationColor.toArray()}setThicknessFactor(e){this[Ka]();for(const t of this[zo])t.thickness=e;this[jo]()}setAttenuationDistance(e){this[Ka]();for(const t of this[zo])t.attenuationDistance=e;this[jo]()}setAttenuationColor(e){this[Ka]();const t=this.colorFromRgb(e);for(const e of this[zo])e.attenuationColor.set(t);this[jo]()}get specularFactor(){return this[Ka](),this[Na].specularIntensity}get specularTexture(){return this[Ka](),this[Za].get(Sa.Specular)}get specularColorFactor(){return this[Ka](),this[Na].specularColor.toArray()}get specularColorTexture(){return this[Ka](),this[Za].get(Sa.SheenColor)}setSpecularFactor(e){this[Ka]();for(const t of this[zo])t.specularIntensity=e;this[jo]()}setSpecularColorFactor(e){this[Ka]();const t=this.colorFromRgb(e);for(const e of this[zo])e.specularColor.set(t);this[jo]()}get iridescenceFactor(){return this[Ka](),this[Na].iridescence}get iridescenceTexture(){return this[Ka](),this[Za].get(Sa.Iridescence)}get iridescenceIor(){return this[Ka](),this[Na].iridescenceIOR}get iridescenceThicknessMinimum(){return this[Ka](),this[Na].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[Ka](),this[Na].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[Ka](),this[Za].get(Sa.IridescenceThickness)}setIridescenceFactor(e){this[Ka]();for(const t of this[zo])t.iridescence=e;this[jo]()}setIridescenceIor(e){this[Ka]();for(const t of this[zo])t.iridescenceIOR=e;this[jo]()}setIridescenceThicknessMinimum(e){this[Ka]();for(const t of this[zo])t.iridescenceThicknessRange[0]=e;this[jo]()}setIridescenceThicknessMaximum(e){this[Ka]();for(const t of this[zo])t.iridescenceThicknessRange[1]=e;this[jo]()}get anisotropyStrength(){return this[Ka](),this[Na].anisotropy}get anisotropyRotation(){return this[Ka](),this[Na].anisotropyRotation}get anisotropyTexture(){return this[Ka](),this[Za].get(Sa.Anisotropy)}setAnisotropyStrength(e){this[Ka]();for(const t of this[zo])t.anisotropy=e;this[jo]()}setAnisotropyRotation(e){this[Ka]();for(const t of this[zo])t.anisotropyRotation=e;this[jo]()}}class tA{constructor(e){this.name="",this.children=new Array,this.name=e}}class iA extends tA{constructor(e,t,i,s){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:n,threeGLTF:r,threeObjectMap:o}=s;this.parser=r.parser,this.modelVariants=i,this.mesh.userData.variantData=i;const a=o.get(e.material);null!=a.materials?this.initialMaterialIdx=this.activeMaterialIdx=a.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const A=e.userData.associations||{};if(null==A.meshes)return void console.error("Mesh is missing primitive index association");const l=((n.meshes||[])[A.meshes].primitives||[])[A.primitives];if(null!=l){if(null!=l.material)this.materials.set(l.material,t[l.material]);else{const e=t.findIndex((e=>"Default"===e.name));e>=0?this.materials.set(e,t[e]):console.warn("gltfPrimitive has no material!")}if(l.extensions&&l.extensions.KHR_materials_variants){const e=l.extensions.KHR_materials_variants,s=r.parser.json.extensions.KHR_materials_variants.variants;for(const n of e.mappings){const e=t[n.material];this.materials.set(n.material,e);for(const t of n.variants){const{name:n}=s[t];this.variantToMaterialMap.set(t,e),e[Ya]().add(t),i.has(n)||i.set(n,{name:n,index:t})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(e){const t=this.materials.get(e);if(null!=t&&e!==this.activeMaterialIdx){this.mesh.material=await t[Va]();const{normalScale:i}=this.mesh.material;null!=i&&i.y*i.x<0!=(null==this.mesh.geometry.attributes.tangent)&&this.parser.assignFinalMaterial(this.mesh),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(null==e)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(null!=this.variantToMaterialMap&&null!=e){const t=this.variantToMaterialMap.get(e);if(null!=t)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(null!=t.material)continue;const i=await this.enableVariantHelper(e);null!=i&&(t.material=i)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[Ya]().add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[Ya]().add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(e,{material:t[zo].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}var sA,nA,rA,oA,aA,AA;const lA=Symbol("materials"),hA=Symbol("hierarchy"),cA=Symbol("roots"),uA=Symbol("primitives"),gA=Symbol("prepareVariantsForExport"),dA=Symbol("switchVariant"),pA=Symbol("materialFromPoint"),mA=Symbol("nodeFromPoint"),IA=Symbol("nodeFromIndex"),fA=Symbol("variantData"),CA=Symbol("availableVariants"),EA=Symbol("modelOnUpdate"),BA=Symbol("cloneMaterial");class yA{constructor(e,t,i,s){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=s}}class wA{constructor(e,i=(()=>{})){this[sA]=new Array,this[nA]=new Array,this[rA]=new Array,this[oA]=new Array,this[aA]=()=>{},this[AA]=new Map,this[EA]=i;const{gltf:s,threeGLTF:n,gltfElementMap:r}=e;for(const[e,t]of s.materials.entries()){const o=r.get(t);if(null!=o)this[lA].push(new eA(i,e,!0,this[fA],o,t.name));else{const a=(s.materials||[])[e],A=e,l=async()=>{const e=await n.parser.getDependency("material",A),t=new Set;return r.set(a,t),t.add(e),{set:t,material:e}};this[lA].push(new eA(i,e,!1,this[fA],o,t.name,new yA(s,r,a,l)))}}const o=new Map,a=new Array;for(const e of n.scene.children)a.push(e);for(;a.length>0;){const i=a.pop();let s=null;i instanceof t.Mesh?(s=new iA(i,this.materials,this[fA],e),this[uA].push(s)):s=new tA(i.name);const n=o.get(i);null!=n?n.children.push(s):this[cA].push(s),this[hA].push(s);for(const e of i.children)a.push(e),o.set(i,s)}}get materials(){return this[lA]}[(sA=lA,nA=hA,rA=cA,oA=uA,aA=EA,AA=fA,CA)](){const e=Array.from(this[fA].values());return e.sort(((e,t)=>e.index-t.index)),e.map((e=>e.name))}getMaterialByName(e){const t=this[lA].filter((t=>t.name===e));return t.length>0?t[0]:null}[IA](e,t){const i=this[hA].find((i=>{if(i instanceof iA){const{meshes:s,primitives:n}=i.mesh.userData.associations;if(s==e&&n==t)return!0}return!1}));return null==i?null:i}[mA](e){return this[hA].find((t=>t instanceof iA&&t.mesh===e.object))}[pA](e){return this[mA](e).getActiveMaterial()}async[dA](e){for(const t of this[uA])await t.enableVariant(e);for(const e of this.materials)e[$a](!1);for(const e of this[uA])this.materials[e.getActiveMaterial().index][$a](!0)}async[gA](){const e=new Array;for(const t of this[uA])e.push(t.instantiateVariants());await Promise.all(e)}[BA](e,t){const i=this.materials[e];i.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const s=i[zo],n=new Set;for(const[e,i]of s.entries()){const r=i.clone();r.name=t+(s.size>1?"_inst"+e:""),n.add(r)}const r=new eA(this[EA],this[lA].length,!1,this[fA],n,t);return this[lA].push(r),r}createMaterialInstanceForVariant(e,t,i,s=!0){let n=null;for(const s of this[uA]){const r=this[fA].get(i);null!=r&&s.variantInfo.has(r.index)||null!=s.getMaterial(e)&&(this.hasVariant(i)||this.createVariant(i),null==n&&(n=this[BA](e,t)),s.addVariant(n,i))}if(s&&null!=n){n[$a](!0),this.materials[e][$a](!1);for(const e of this[uA])e.enableVariant(i)}return n}createVariant(e){this[fA].has(e)?console.warn(`Variant '${e}'' already exists`):this[fA].set(e,{name:e,index:this[fA].size})}hasVariant(e){return this[fA].has(e)}setMaterialToVariant(e,t){if(null!=this[CA]().find((e=>e===t)))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const i of this[uA]){const s=i.getMaterial(e);null!=s&&i.addVariant(s,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const i=this[fA].get(e);null!=i&&(i.name=t,this[fA].set(t,i),this[fA].delete(e))}deleteVariant(e){const t=this[fA].get(e);if(null!=t){for(const i of this.materials)i.hasVariant(e)&&i[ja].delete(t.index);for(const e of this[uA])e.deleteVariant(t.index);this[fA].delete(e)}}}var QA=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const vA=Symbol("currentGLTF"),SA=Symbol("originalGltfJson"),bA=Symbol("model"),xA=Symbol("getOnUpdateMethod"),MA=Symbol("buildTexture"),RA=new t.Vector3,TA=new t.Vector3,DA=new t.Vector3,LA=new t.Matrix3,FA=new t.Triangle,kA=new t.Quaternion;class _A extends Ji{constructor(e){super(document.createElement("div")),this.normal=new t.Vector3(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=hn(e)[0].terms;for(let e=0;e<3;++e)this.position.setComponent(e,Bn(t[e]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=hn(e)[0].terms;for(let e=0;e<3;++e)this.normal.setComponent(e,t[e].number)}updateSurface(e){if(!e&&this.initialized)return;const{mesh:t,tri:i,bary:s}=this;if(null==t||null==i||null==s)return;t.getVertexPosition(i.x,RA),t.getVertexPosition(i.y,TA),t.getVertexPosition(i.z,DA),RA.toArray(LA.elements,0),TA.toArray(LA.elements,3),DA.toArray(LA.elements,6),this.position.copy(s).applyMatrix3(LA);const n=this.parent;n.worldToLocal(t.localToWorld(this.position)),FA.set(RA,TA,DA),FA.getNormal(this.normal).transformDirection(t.matrixWorld);const r=n.parent;kA.setFromAxisAngle(RA.set(0,1,0),-r.yaw),this.normal.applyQuaternion(kA)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,s=i.dataset.visibilityAttribute;if(null!=s){const t=`data-${s}`;e?i.setAttribute(t,""):i.removeAttribute(t)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))})),this.initialized=!0}}const UA={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},GA={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};function NA(e,t,i){return(1-i)*e+i*t}class PA extends t.Object3D{constructor(e,i,s){super(),this.camera=new t.OrthographicCamera,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new t.MeshDepthMaterial,this.horizontalBlurMaterial=new t.ShaderMaterial(UA),this.verticalBlurMaterial=new t.ShaderMaterial(GA),this.intensity=0,this.softness=1,this.boundingBox=new t.Box3,this.size=new t.Vector3,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:n}=this;n.rotation.x=Math.PI/2,n.left=-.5,n.right=.5,n.bottom=-.5,n.top=.5,this.add(n);const r=new t.PlaneGeometry,o=new t.MeshBasicMaterial({opacity:1,transparent:!0,side:t.BackSide});this.floor=new t.Mesh(r,o),this.floor.userData.shadow=!0,n.add(this.floor),this.blurPlane=new t.Mesh(r),this.blurPlane.visible=!1,n.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,i,s)}setScene(e,t,i){const{boundingBox:s,size:n,rotation:r,position:o}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(o),"back"===i){const{min:e,max:t}=s;[e.y,e.z]=[e.z,e.y],[t.y,t.z]=[t.z,t.y],[n.y,n.z]=[n.z,n.y],r.x=Math.PI/2,r.y=Math.PI}else r.x=0,r.y=0;if(this.isAnimated){const e=s.min.y,t=s.max.y;n.y=this.maxDimension,s.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=e,s.max.y=t,n.set(this.maxDimension,t-e,this.maxDimension)}"bottom"===i?o.y=s.min.y:o.z=s.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:i}=this,s=this.isAnimated?2:1,n=s*Math.pow(2,9-3*e);this.setMapSize(n);const r=t.y/2,o=t.y*s;i.near=0,i.far=NA(o,r,e),this.depthMaterial.opacity=1/e,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:i}=this;this.isAnimated&&(e*=2);const s=Math.floor(i.x>i.z?e:e*i.x/i.z),n=Math.floor(i.x>i.z?e*i.z/i.x:e),r=10+s,o=10+n;if(null==this.renderTarget||this.renderTarget.width===r&&this.renderTarget.height===o||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const e={format:t.RGBAFormat};this.renderTarget=new t.WebGLRenderTarget(r,o,e),this.renderTargetBlur=new t.WebGLRenderTarget(r,o,e),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(i.x*(1+10/s),i.z*(1+10/n),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*NA(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const i=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const s=e.xr.enabled;e.xr.enabled=!1;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=s,e.setRenderTarget(n),e.setClearAlpha(i)}blurShadow(e){const{camera:t,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:n,renderTargetBlur:r,blurPlane:o}=this;o.visible=!0,o.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(r),e.render(o,t),o.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(n),e.render(o,t),o.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}const OA=new t.Vector3,HA=new t.Vector3,qA=new t.Vector3,VA=new t.Raycaster,KA=new t.Vector3,JA=new t.Vector2;class $A extends t.Scene{constructor({canvas:e,element:i,width:s,height:n}){super(),this.annotationRenderer=new Xi,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new t.PerspectiveCamera(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new t.Object3D,this.animationNames=[],this.boundingBox=new t.Box3,this.boundingSphere=new t.Sphere,this.size=new t.Vector3,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.canScale=!0,this.isDirty=!1,this.goalTarget=new t.Vector3,this.targetDamperX=new sn,this.targetDamperY=new sn,this.targetDamperZ=new sn,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=i,this.canvas=e,this.camera=new t.PerspectiveCamera(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(s,n),this.target.name="Target",this.mixer=new t.AnimationMixer(this.target);const{domElement:r}=this.annotationRenderer,{style:o}=r;o.display="none",o.pointerEvents="none",o.position="absolute",o.top="0",this.element.shadowRoot.querySelector(".default").appendChild(r),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e,t=(()=>{})){if(!e||e===this.url)return void t(1);if(this.reset(),this.url=e,null!=this.externalRenderer){const e=await this.externalRenderer.load(t);return this.boundingSphere.radius=e.framedRadius,void(this.idealAspect=e.fieldOfViewAspect)}let i;null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{i=await new Promise((async(i,s)=>{this.cancelPendingSourceChange=()=>s();try{i(await this.element[Gl].loader.load(e,this.element,t))}catch(e){s(e)}}))}catch(e){if(null==e)return;throw e}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=i,null!=i&&(this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,n=new Map,r=[];for(const e of s)n.set(e.name,e),r.push(e.name);this.animations=s,this.animationsByName=n,this.animationNames=r,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity)}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;null!=e&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;null!=t&&(t.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[vA]=null,this.element[SA]=null,this.element[bA]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const i=Ke();this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}markBakedShadow(e){e.userData.shadow=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.shadow=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const i=new t.Box3;e.traverse((e=>{const t=e;if(!t.material)return;if(!t.material.transparent)return;i.setFromObject(t);const s=i.getSize(KA),n=Math.min(s.x,s.y,s.z);Math.max(s.x,s.y,s.z)<100*n||this.markBakedShadow(t)}))}checkBakedShadows(){const{min:e,max:i}=this.boundingBox,s=new t.Box3;this.boundingBox.getSize(this.size);for(const t of this.bakedShadows)s.setFromObject(t),s.min.y<e.y+this.size.y/100&&s.min.x<=e.x&&s.max.x>=i.x&&s.min.z<=e.z&&s.max.z>=i.z||s.min.z<e.z+this.size.z/100&&s.min.x<=e.x&&s.max.x>=i.x&&s.min.y<=e.y&&s.max.y>=i.y||this.unmarkBakedShadow(t)}applyTransform(){const{model:e}=this;if(null==e)return;const i=hn(this.element.orientation)[0].terms,s=Bn(i[0]).number,n=Bn(i[1]).number,r=Bn(i[2]).number;e.quaternion.setFromEuler(new t.Euler(n,r,s,"YXZ"));const o=hn(this.element.scale)[0].terms;e.scale.set(o[0].number,o[1].number,o[2].number)}updateBoundingBox(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.findBakedShadows(e);const i=(e,t)=>e.expandByPoint(t);this.setBakedShadowVisibility(!1),this.boundingBox=Zi(e,i,new t.Box3),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((e=>this.unmarkBakedShadow(e))),this.boundingBox=Zi(e,i,new t.Box3)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget()),this.boundingSphere.radius=Math.sqrt(Zi(e,((e,i)=>Math.max(e,t.distanceToSquared(i))),0)),this.idealAspect=Zi(e,((e,i)=>{i.sub(t);const s=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(e,s/(this.idealCameraDistance()-Math.abs(i.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)JA.set(e/window.screen.width,t/window.screen.height);else{const i=this.element.getBoundingClientRect();JA.set((e-i.x)/this.width,(t-i.y)/this.height)}return JA.multiplyScalar(2).subScalar(1),JA.y*=-1,JA}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[Gl].arRenderer.presentedScene!==this&&(this.environment=e,this.background=t,this.queueRender())}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,i=this.target.position;if(t.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:n,y:r,z:o}=i;return n=this.targetDamperX.update(n,t.x,e,s),r=this.targetDamperY.update(r,t.y,e,s),o=this.targetDamperZ.update(o,t.z,e,s),this.target.position.set(n,r,o),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:i,z:s}=this.position;this.yaw=Math.atan2(e-i,t-s)}get model(){return this._model}set yaw(e){this.rotation.y=e,this.queueRender()}get yaw(){return this.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===t.LoopPingPong&&1==(1&e)?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(e=null,i=0,s=t.LoopRepeat,n=1/0){if(null==this._currentGLTF)return;const{animations:r}=this;if(null==r||0===r.length)return;let o=null;if(null!=e&&(o=this.animationsByName.get(e),null==o)){const t=parseInt(e);!isNaN(t)&&t>=0&&t<r.length&&(o=r[t])}null==o&&(o=r[0]);try{const{currentAnimationAction:e}=this,t=this.mixer.clipAction(o,this);this.currentAnimationAction=t,this.element.paused?this.mixer.stopAllAction():(t.paused=!1,null!=e&&t!==e?t.crossFadeFrom(e,i,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),t.setLoop(s,n),t.enabled=!0,t.clampWhenFinished=!0,t.play()}catch(e){console.error(e)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(null!=e){const t="wall"===this.element.arPlacement?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(e<=0&&null==this.shadow))){if(null==this.shadow){const e="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new PA(this,this.shadowSoftness,e)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}hitFromPoint(e,t=this){return VA.setFromCamera(e,this.getCamera()),VA.intersectObject(t,!0).find((e=>e.object.visible&&!e.object.userData.shadow))}positionAndNormalFromPoint(e,i=this){var s;const n=this.hitFromPoint(e,i);return null==n?null:{position:n.point,normal:null!=n.face?n.face.normal.clone().applyNormalMatrix((new t.Matrix3).getNormalMatrix(n.object.matrixWorld)):VA.ray.direction.clone().multiplyScalar(-1),uv:null!==(s=n.uv)&&void 0!==s?s:null}}surfaceFromPoint(e,i=this){const s=this.element.model;if(null==s)return null;const n=this.hitFromPoint(e,i);if(null==n||null==n.face)return null;const r=s[mA](n),{meshes:o,primitives:a}=r.mesh.userData.associations,A=new t.Vector3,l=new t.Vector3,h=new t.Vector3,{a:c,b:u,c:g}=n.face,d=n.object;d.getVertexPosition(c,A),d.getVertexPosition(u,l),d.getVertexPosition(g,h);const p=new t.Triangle(A,l,h),m=new t.Vector3;return p.getBarycoord(d.worldToLocal(n.point),m),`${o} ${a} ${c} ${u} ${g} ${m.x.toFixed(3)} ${m.y.toFixed(3)} ${m.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let i=0,s=t.length;i<s;i++){const s=t[i];s instanceof _A&&e(s)}}initializeSurface(e){if(null!=e.surface&&null==e.mesh){const i=hn(e.surface)[0].terms;if(8!=i.length)return void console.warn(e.surface+" does not have exactly 8 numbers.");const s=this.element.model[IA](i[0].number,i[1].number),n=new t.Vector3(i[2].number,i[3].number,i[4].number);if(null==s)return void console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const r=s.mesh.geometry.attributes.position.count;if(n.x>=r||n.y>=r||n.z>=r)return void console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const o=new t.Vector3(i[5].number,i[6].number,i[7].number);e.mesh=s.mesh,e.tri=n,e.bary=o}}updateSurfaceHotspots(){const e=!this.element.paused;this.forHotspots((t=>{this.initializeSurface(t),t.updateSurface(e)}))}updateHotspotsVisibility(e){this.forHotspots((t=>{OA.copy(e),HA.setFromMatrixPosition(t.matrixWorld),OA.sub(HA),qA.copy(t.normal).transformDirection(this.target.matrixWorld),OA.dot(qA)<0?t.hide():t.show()}))}orientHotspots(e){this.forHotspots((t=>{t.orient(e)}))}setHotspotsVisibility(e){this.forHotspots((t=>{t.visible=e}))}updateSchema(e){var t;const{schemaElement:i,element:s}=this,{alt:n,poster:r,iosSrc:o}=s;if(null!=e){const s=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];o&&s.push({"@type":"MediaObject",contentUrl:o,encodingFormat:"model/vnd.usdz+zip"});const a={"@context":"http://schema.org/","@type":"3DModel",image:null!=r?r:void 0,name:null!=n?n:void 0,encoding:s};i.textContent=JSON.stringify(a),document.head.appendChild(i)}else null!=i.parentElement&&i.parentElement.removeChild(i)}}class YA extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(){const e={progress:0,completed:!1};return this.ongoingActivities.add(e),1===this.ongoingActivityCount&&this.announceTotalProgress(e,0),t=>{let i;return i=Math.max(Ve(t,0,1),e.progress),i!==e.progress&&this.announceTotalProgress(e,i),e.progress}}announceTotalProgress(e,t){let i=0,s=0;1==t&&(e.completed=!0);for(const e of this.ongoingActivities){const{progress:t}=e;i+=1-t,!0===e.completed&&s++}const n=e.progress;e.progress=t,this.totalProgress+=(t-n)*(1-this.totalProgress)/i;const r=s===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r}})),s===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}var zA,jA,WA,XA,ZA,el,tl,il,sl,nl,rl,ol,al,Al=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const ll=document.createElement("canvas"),hl=Symbol("fallbackResizeHandler"),cl=Symbol("defaultAriaLabel"),ul=Symbol("resizeObserver"),gl=Symbol("clearModelTimeout"),dl=Symbol("onContextLost"),pl=Symbol("loaded"),ml=Symbol("status"),Il=Symbol("onFocus"),fl=Symbol("onBlur"),Cl=Symbol("updateSize"),El=Symbol("intersectionObserver"),Bl=Symbol("isElementInViewport"),yl=Symbol("announceModelVisibility"),wl=Symbol("ariaLabel"),Ql=Symbol("altDefaulted"),vl=Symbol("statusElement"),Sl=Symbol("updateStatus"),bl=Symbol("loadedTime"),xl=Symbol("updateSource"),Ml=Symbol("markLoaded"),Rl=Symbol("container"),Tl=Symbol("input"),Dl=Symbol("canvas"),Ll=Symbol("scene"),Fl=Symbol("needsRender"),kl=Symbol("tick"),_l=Symbol("onModelLoad"),Ul=Symbol("onResize"),Gl=Symbol("renderer"),Nl=Symbol("progressTracker"),Pl=Symbol("getLoaded"),Ol=Symbol("getModelIsVisible"),Hl=Symbol("shouldAttemptPreload"),ql=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),Vl=e=>({u:e.x,v:e.y,toString(){return`${this.u} ${this.v}`}});class Kl extends we{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[zA]=!1,this[jA]=!1,this[WA]=0,this[XA]="",this[ZA]=null,this[el]=qe((()=>{const e=this.getBoundingClientRect();this[Cl](e)}),50),this[tl]=qe((e=>{const t=this.modelIsVisible;t!==e&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:t}}))}),0),this[il]=null,this[sl]=null,this[nl]=new YA,this[rl]=()=>{this[vl].textContent=this[ml]},this[ol]=()=>{this[vl].textContent=""},this[al]=e=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:e.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;let t,i;if((e=>{ae(Xe,e)})(e),this[Rl]=e.querySelector(".container"),this[Tl]=e.querySelector(".userInput"),this[Dl]=e.querySelector("canvas"),this[vl]=e.querySelector("#status"),this[cl]=this[Tl].getAttribute("aria-label"),this.isConnected){const e=this.getBoundingClientRect();t=e.width,i=e.height}else t=300,i=150;this[Ll]=new $A({canvas:this[Dl],element:this,width:t,height:i}),Promise.resolve().then((()=>{this[Cl](this.getBoundingClientRect())})),Re&&(this[ul]=new ResizeObserver((e=>{if(!this[Gl].isPresenting)for(let t of e)t.target===this&&this[Cl](t.contentRect)}))),Te?this[El]=new IntersectionObserver((e=>{for(let t of e)if(t.target===this){const e=this.modelIsVisible;this[Bl]=t.isIntersecting,this[yl](e),this[Bl]&&!this.loaded&&this[xl]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[Bl]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){Ki[qi].evictionThreshold=e}static get modelCacheSize(){return Ki[qi].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Yo.singleton.minScale=e}static get minimumRenderScale(){return Yo.singleton.minScale}get loaded(){return this[Pl]()}get[(zA=Bl,jA=pl,WA=bl,XA=ml,ZA=gl,el=hl,tl=yl,il=ul,sl=El,nl=Nl,Gl)](){return Yo.singleton}get modelIsVisible(){return this[Ol]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Re?this[ul].observe(this):self.addEventListener("resize",this[hl]),Te&&this[El].observe(this),this.addEventListener("focus",this[Il]),this.addEventListener("blur",this[fl]);const e=this[Gl];e.addEventListener("contextlost",this[dl]),e.registerScene(this[Ll]),null!=this[gl]&&(self.clearTimeout(this[gl]),this[gl]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Re?this[ul].unobserve(this):self.removeEventListener("resize",this[hl]),Te&&this[El].unobserve(this),this.removeEventListener("focus",this[Il]),this.removeEventListener("blur",this[fl]);const e=this[Gl];e.removeEventListener("contextlost",this[dl]),e.unregisterScene(this[Ll]),this[gl]=self.setTimeout((()=>{this[Ll].dispose(),this[gl]=null}),10)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[pl]=!1,this[bl]=0,this[Ll].reset()):this.src!==this[Ll].url&&(this[pl]=!1,this[bl]=0,this[xl]())),e.has("alt")&&this[Tl].setAttribute("aria-label",this[wl]),e.has("withCredentials")&&(Ki.withCredentials=this.withCredentials,this[Gl].textureUtils.withCredentials=this.withCredentials),e.has("generateSchema")&&(this.generateSchema?this[Ll].updateSchema(this.src):this[Ll].updateSchema(null))}toDataURL(e,t){return this[Gl].displayCanvas(this[Ll]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,s=e?e.idealAspect:void 0,{width:n,height:r,idealAspect:o,aspect:a}=this[Ll],{dpr:A,scaleFactor:l}=this[Gl];let h=n*l*A,c=r*l*A,u=0,g=0;if(!0===s)if(o>a){const e=c;c=Math.round(h/o),g=(e-c)/2}else{const e=h;h=Math.round(c*o),u=(e-h)/2}ll.width=h,ll.height=c;try{return new Promise((async(e,s)=>{ll.getContext("2d").drawImage(this[Gl].displayCanvas(this[Ll]),u,g,h,c,0,0,h,c),ll.toBlob((t=>{if(!t)return s(new Error("Unable to retrieve canvas blob"));e(t)}),t,i)}))}finally{this[Cl]({width:n,height:r})}}registerEffectComposer(e){e.setRenderer(this[Gl].threeRenderer),e.setMainCamera(this[Ll].getCamera()),e.setMainScene(this[Ll]),this[Ll].effectRenderer=e}unregisterEffectComposer(){this[Ll].effectRenderer=null}registerRenderer(e){this[Ll].externalRenderer=e}unregisterRenderer(){this[Ll].externalRenderer=null}get[wl](){return this[Ql]}get[Ql](){return null==this.alt||"null"===this.alt?this[cl]:this.alt}[Pl](){return this[pl]}[Ol](){return this.loaded&&this[Bl]}[Hl](){return!!this.src&&this[Bl]}[Cl]({width:e,height:t}){0!==e&&0!==t&&(this[Rl].style.width=`${e}px`,this[Rl].style.height=`${t}px`,this[Ul]({width:e,height:t}))}[kl](e,t){var i;null===(i=this[Ll].effectRenderer)||void 0===i||i.beforeRender(e,t)}[Ml](){this[pl]||(this[pl]=!0,this[bl]=performance.now())}[Fl](){this[Ll].queueRender()}[_l](){}[Sl](e){this[ml]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[vl].textContent!=e&&(this[vl].textContent=e)}[(rl=Il,ol=fl,Ul)](e){this[Ll].setSize(e.width,e.height)}async[(al=dl,xl)](){const e=this[Ll];if(this.loaded||!this[Hl]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[Sl]("Loading"),e.stopAnimation();const t=this[Nl].beginActivity(),i=this.src;try{const s=e.setSource(i,(e=>t(.95*Ve(e,0,1)))),n=this[je]();await Promise.all([s,n]),this[Ml](),this[_l](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),e()}))}))}))}catch(e){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:e}}))}finally{t(1)}}}Al([r({type:String})],Kl.prototype,"alt",void 0),Al([r({type:String})],Kl.prototype,"src",void 0),Al([r({type:Boolean,attribute:"with-credentials"})],Kl.prototype,"withCredentials",void 0),Al([r({type:Boolean,attribute:"generate-schema"})],Kl.prototype,"generateSchema",void 0);var Jl=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const $l=Symbol("changeAnimation"),Yl=Symbol("paused"),zl={repetitions:1/0,pingpong:!1},jl=Symbol("hotspotMap"),Wl=Symbol("mutationCallback"),Xl=Symbol("observer"),Zl=Symbol("addHotspot"),eh=Symbol("removeHotspot"),th=new t.Matrix4;
/*!
      fflate - fast JavaScript compression/decompression
      <https://101arrowz.github.io/fflate>
      Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
      version 0.6.9
      */
var ih=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(ih(""))}catch(pe){ih=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var sh=Uint8Array,nh=Uint16Array,rh=Uint32Array,oh=new sh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ah=new sh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ah=new sh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lh=function(e,t){for(var i=new nh(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var n=new rh(i[30]);for(s=1;s<30;++s)for(var r=i[s];r<i[s+1];++r)n[r]=r-i[s]<<5|s;return[i,n]},hh=lh(oh,2),ch=hh[0],uh=hh[1];ch[28]=258,uh[258]=28;for(var gh=lh(ah,0)[1],dh=new nh(32768),ph=0;ph<32768;++ph){var mh=(43690&ph)>>>1|(21845&ph)<<1;mh=(61680&(mh=(52428&mh)>>>2|(13107&mh)<<2))>>>4|(3855&mh)<<4,dh[ph]=((65280&mh)>>>8|(255&mh)<<8)>>>1}var Ih=function(e,t,i){for(var s=e.length,n=0,r=new nh(t);n<s;++n)++r[e[n]-1];var o,a=new nh(t);for(n=0;n<t;++n)a[n]=a[n-1]+r[n-1]<<1;if(i){o=new nh(1<<t);var A=15-t;for(n=0;n<s;++n)if(e[n])for(var l=n<<4|e[n],h=t-e[n],c=a[e[n]-1]++<<h,u=c|(1<<h)-1;c<=u;++c)o[dh[c]>>>A]=l}else for(o=new nh(s),n=0;n<s;++n)e[n]&&(o[n]=dh[a[e[n]-1]++]>>>15-e[n]);return o},fh=new sh(288);for(ph=0;ph<144;++ph)fh[ph]=8;for(ph=144;ph<256;++ph)fh[ph]=9;for(ph=256;ph<280;++ph)fh[ph]=7;for(ph=280;ph<288;++ph)fh[ph]=8;var Ch=new sh(32);for(ph=0;ph<32;++ph)Ch[ph]=5;var Eh=Ih(fh,9,0),Bh=Ih(Ch,5,0),yh=function(e){return(e/8|0)+(7&e&&1)},wh=function(e,t,i){(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length);var s=new(e instanceof nh?nh:e instanceof rh?rh:sh)(i-t);return s.set(e.subarray(t,i)),s},Qh=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>>8},vh=function(e,t,i){i<<=7&t;var s=t/8|0;e[s]|=i,e[s+1]|=i>>>8,e[s+2]|=i>>>16},Sh=function(e,t){for(var i=[],s=0;s<e.length;++s)e[s]&&i.push({s:s,f:e[s]});var n=i.length,r=i.slice();if(!n)return[Lh,0];if(1==n){var o=new sh(i[0].s+1);return o[i[0].s]=1,[o,1]}i.sort((function(e,t){return e.f-t.f})),i.push({s:-1,f:25001});var a=i[0],A=i[1],l=0,h=1,c=2;for(i[0]={s:-1,f:a.f+A.f,l:a,r:A};h!=n-1;)a=i[i[l].f<i[c].f?l++:c++],A=i[l!=h&&i[l].f<i[c].f?l++:c++],i[h++]={s:-1,f:a.f+A.f,l:a,r:A};var u=r[0].s;for(s=1;s<n;++s)r[s].s>u&&(u=r[s].s);var g=new nh(u+1),d=bh(i[h-1],g,0);if(d>t){s=0;var p=0,m=d-t,I=1<<m;for(r.sort((function(e,t){return g[t.s]-g[e.s]||e.f-t.f}));s<n;++s){var f=r[s].s;if(!(g[f]>t))break;p+=I-(1<<d-g[f]),g[f]=t}for(p>>>=m;p>0;){var C=r[s].s;g[C]<t?p-=1<<t-g[C]++-1:++s}for(;s>=0&&p;--s){var E=r[s].s;g[E]==t&&(--g[E],++p)}d=t}return[new sh(g),d]},bh=function(e,t,i){return-1==e.s?Math.max(bh(e.l,t,i+1),bh(e.r,t,i+1)):t[e.s]=i},xh=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new nh(++t),s=0,n=e[0],r=1,o=function(e){i[s++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=e[a]}return[i.subarray(0,s),t]},Mh=function(e,t){for(var i=0,s=0;s<t.length;++s)i+=e[s]*t[s];return i},Rh=function(e,t,i){var s=i.length,n=yh(t+2);e[n]=255&s,e[n+1]=s>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var r=0;r<s;++r)e[n+r+4]=i[r];return 8*(n+4+s)},Th=function(e,t,i,s,n,r,o,a,A,l,h){Qh(t,h++,i),++n[256];for(var c=Sh(n,15),u=c[0],g=c[1],d=Sh(r,15),p=d[0],m=d[1],I=xh(u),f=I[0],C=I[1],E=xh(p),B=E[0],y=E[1],w=new nh(19),Q=0;Q<f.length;++Q)w[31&f[Q]]++;for(Q=0;Q<B.length;++Q)w[31&B[Q]]++;for(var v=Sh(w,7),S=v[0],b=v[1],x=19;x>4&&!S[Ah[x-1]];--x);var M,R,T,D,L=l+5<<3,F=Mh(n,fh)+Mh(r,Ch)+o,k=Mh(n,u)+Mh(r,p)+o+14+3*x+Mh(w,S)+(2*w[16]+3*w[17]+7*w[18]);if(L<=F&&L<=k)return Rh(t,h,e.subarray(A,A+l));if(Qh(t,h,1+(k<F)),h+=2,k<F){M=Ih(u,g,0),R=u,T=Ih(p,m,0),D=p;var _=Ih(S,b,0);for(Qh(t,h,C-257),Qh(t,h+5,y-1),Qh(t,h+10,x-4),h+=14,Q=0;Q<x;++Q)Qh(t,h+3*Q,S[Ah[Q]]);h+=3*x;for(var U=[f,B],G=0;G<2;++G){var N=U[G];for(Q=0;Q<N.length;++Q){var P=31&N[Q];Qh(t,h,_[P]),h+=S[P],P>15&&(Qh(t,h,N[Q]>>>5&127),h+=N[Q]>>>12)}}}else M=Eh,R=fh,T=Bh,D=Ch;for(Q=0;Q<a;++Q)if(s[Q]>255){P=s[Q]>>>18&31,vh(t,h,M[P+257]),h+=R[P+257],P>7&&(Qh(t,h,s[Q]>>>23&31),h+=oh[P]);var O=31&s[Q];vh(t,h,T[O]),h+=D[O],O>3&&(vh(t,h,s[Q]>>>5&8191),h+=ah[O])}else vh(t,h,M[s[Q]]),h+=R[s[Q]];return vh(t,h,M[256]),h+R[256]},Dh=new rh([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Lh=new sh(0),Fh=function(){for(var e=new rh(256),t=0;t<256;++t){for(var i=t,s=9;--s;)i=(1&i&&3988292384)^i>>>1;e[t]=i}return e}(),kh=function(){var e=-1;return{p:function(t){for(var i=e,s=0;s<t.length;++s)i=Fh[255&i^t[s]]^i>>>8;e=i},d:function(){return~e}}},_h=function(e,t,i,s,n){return function(e,t,i,s,n,r){var o=e.length,a=new sh(s+o+5*(1+Math.ceil(o/7e3))+n),A=a.subarray(s,a.length-n),l=0;if(!t||o<8)for(var h=0;h<=o;h+=65535){var c=h+65535;c<o?l=Rh(A,l,e.subarray(h,c)):(A[h]=r,l=Rh(A,l,e.subarray(h,o)))}else{for(var u=Dh[t-1],g=u>>>13,d=8191&u,p=(1<<i)-1,m=new nh(32768),I=new nh(p+1),f=Math.ceil(i/3),C=2*f,E=function(t){return(e[t]^e[t+1]<<f^e[t+2]<<C)&p},B=new rh(25e3),y=new nh(288),w=new nh(32),Q=0,v=0,S=(h=0,0),b=0,x=0;h<o;++h){var M=E(h),R=32767&h,T=I[M];if(m[R]=T,I[M]=R,b<=h){var D=o-h;if((Q>7e3||S>24576)&&D>423){l=Th(e,A,0,B,y,w,v,S,x,h-x,l),S=Q=v=0,x=h;for(var L=0;L<286;++L)y[L]=0;for(L=0;L<30;++L)w[L]=0}var F=2,k=0,_=d,U=R-T&32767;if(D>2&&M==E(h-U))for(var G=Math.min(g,D)-1,N=Math.min(32767,h),P=Math.min(258,D);U<=N&&--_&&R!=T;){if(e[h+F]==e[h+F-U]){for(var O=0;O<P&&e[h+O]==e[h+O-U];++O);if(O>F){if(F=O,k=U,O>G)break;var H=Math.min(U,O-2),q=0;for(L=0;L<H;++L){var V=h-U+L+32768&32767,K=V-m[V]+32768&32767;K>q&&(q=K,T=V)}}}U+=(R=T)-(T=m[R])+32768&32767}if(k){B[S++]=268435456|uh[F]<<18|gh[k];var J=31&uh[F],$=31&gh[k];v+=oh[J]+ah[$],++y[257+J],++w[$],b=h+F,++Q}else B[S++]=e[h],++y[e[h]]}}l=Th(e,A,r,B,y,w,v,S,x,h-x,l),!r&&7&l&&(l=Rh(A,l+1,Lh))}return wh(a,0,s+yh(l)+n)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,i,s,!n)},Uh=function(e,t){var i={};for(var s in e)i[s]=e[s];for(var s in t)i[s]=t[s];return i},Gh=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function Nh(e,t){return _h(e,t||{},0,0)}var Ph=function(e,t,i,s){for(var n in e){var r=e[n],o=t+n;r instanceof sh?i[o]=[r,s]:Array.isArray(r)?i[o]=[r[0],Uh(s,r[1])]:Ph(r,o+"/",i,s)}},Oh="undefined"!=typeof TextEncoder&&new TextEncoder,Hh="undefined"!=typeof TextDecoder&&new TextDecoder;try{Hh.decode(Lh,{stream:!0})}catch(pe){}function qh(e,t){if(t){for(var i=new sh(e.length),s=0;s<e.length;++s)i[s]=e.charCodeAt(s);return i}if(Oh)return Oh.encode(e);var n=e.length,r=new sh(e.length+(e.length>>1)),o=0,a=function(e){r[o++]=e};for(s=0;s<n;++s){if(o+5>r.length){var A=new sh(o+8+(n-s<<1));A.set(r),r=A}var l=e.charCodeAt(s);l<128||t?a(l):l<2048?(a(192|l>>6),a(128|63&l)):l>55295&&l<57344?(a(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++s))>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|63&l)):(a(224|l>>12),a(128|l>>6&63),a(128|63&l))}return wh(r,0,o)}var Vh=function(e){var t=0;if(e)for(var i in e){var s=e[i].length;if(s>65535)throw"extra field too long";t+=s+4}return t},Kh=function(e,t,i,s,n,r,o,a){var A=s.length,l=i.extra,h=a&&a.length,c=Vh(l);Gh(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(null==r&&8),e[t++]=n&&8,e[t++]=255&i.compression,e[t++]=i.compression>>8;var u=new Date(null==i.mtime?Date.now():i.mtime),g=u.getFullYear()-1980;if(g<0||g>119)throw"date not in range 1980-2099";if(Gh(e,t,g<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>>1),t+=4,null!=r&&(Gh(e,t,i.crc),Gh(e,t+4,r),Gh(e,t+8,i.size)),Gh(e,t+12,A),Gh(e,t+14,c),t+=16,null!=o&&(Gh(e,t,h),Gh(e,t+6,i.attrs),Gh(e,t+10,o),t+=14),e.set(s,t),t+=A,c)for(var d in l){var p=l[d],m=p.length;Gh(e,t,+d),Gh(e,t+2,m),e.set(p,t+4),t+=4+m}return h&&(e.set(a,t),t+=h),t};function Jh(e,t){t||(t={});var i={},s=[];Ph(e,"",i,t);var n=0,r=0;for(var o in i){var a=i[o],A=a[0],l=a[1],h=0==l.level?0:8,c=(w=qh(o)).length,u=l.comment,g=u&&qh(u),d=g&&g.length,p=Vh(l.extra);if(c>65535)throw"filename too long";var m=h?Nh(A,l):A,I=m.length,f=kh();f.p(A),s.push(Uh(l,{size:A.length,crc:f.d(),c:m,f:w,m:g,u:c!=o.length||g&&u.length!=d,o:n,compression:h})),n+=30+c+p+I,r+=76+2*(c+p)+(d||0)+I}for(var C=new sh(r+22),E=n,B=r-n,y=0;y<s.length;++y){var w=s[y];Kh(C,w.o,w,w.f,w.u,w.c.length);var Q=30+w.f.length+Vh(w.extra);C.set(w.c,w.o+Q),Kh(C,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+Q+(w.m?w.m.length:0)}return function(e,t,i,s,n){Gh(e,t,101010256),Gh(e,t+8,i),Gh(e,t+10,i),Gh(e,t+12,s),Gh(e,t+16,n)}(C,n,s.length,B,E),C}class $h{async parse(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!1},t);const i={},s="model.usda";i[s]=null;let n='#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n';n+=function(e){return`def Xform "Root"\n{\n\tdef Scope "Scenes" (\n\t\tkind = "sceneLibrary"\n\t)\n\t{\n\t\tdef Xform "Scene" (\n\t\t\tcustomData = {\n\t\t\t\tbool preliminary_collidesWithEnvironment = 0\n\t\t\t\tstring sceneName = "Scene"\n\t\t\t}\n\t\t\tsceneName = "Scene"\n\t\t)\n\t\t{\n\t\ttoken preliminary:anchoring:type = "${e.ar.anchoring.type}"\n\t\ttoken preliminary:planeAnchoring:alignment = "${e.ar.planeAnchoring.alignment}"\n\n`}(t);const r={},o={};e.traverseVisible((e=>{if(e.isMesh){const t=e.geometry,s=e.material;if(s.isMeshStandardMaterial){const o="geometries/Geometry_"+t.id+".usda";if(!(o in i)){const e=function(e){const t=function(e){const t="Geometry",i=e.attributes,s=i.position.count;return`\n\tdef Mesh "${t}"\n\t{\n\t\tint[] faceVertexCounts = [${function(e){const t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e)}]\n\t\tint[] faceVertexIndices = [${function(e){const t=e.index,i=[];if(null!==t)for(let e=0;e<t.count;e++)i.push(t.getX(e));else{const t=e.attributes.position.count;for(let e=0;e<t;e++)i.push(e)}return i.join(", ")}(e)}]\n\t\tnormal3f[] normals = [${Xh(i.normal,s)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)\n\t\tpoint3f[] points = [${Xh(i.position,s)}]\n${function(e,t){let i="";for(let s=0;s<4;s++){const n=s>0?s:"",r=e["uv"+n];void 0!==r&&(i+=`\n\t\ttexCoord2f[] primvars:st${n} = [${Zh(r,t)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)`)}return i}(i,s)}\n\t\tuniform token subdivisionScheme = "none"\n\t}\n`}(e);return`\ndef "Geometry"\n{\n${t}\n}\n`}(t);i[o]=function(e){let t='#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n';return t+=e,qh(t)}(e)}s.uuid in r||(r[s.uuid]=s),n+=function(e,t,i){const s="Object_"+e.id,n=jh(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),`def Xform "${s}" (\n\tprepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>\n\tprepend apiSchemas = ["MaterialBindingAPI"]\n)\n{\n\tmatrix4d xformOp:transform = ${n}\n\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\trel material:binding = </Materials/Material_${i.id}>\n}\n\n`}(e,t,s)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(n+=function(e){const t=e.name?e.name:"Camera_"+e.id,i=jh(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),e.isOrthographicCamera?`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(zh)}, ${e.far.toPrecision(zh)})\n\t\t\tfloat horizontalAperture = ${(10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision(zh)}\n\t\t\tfloat verticalAperture = ${(10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision(zh)}\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\t\n\t`:`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(zh)}, ${e.far.toPrecision(zh)})\n\t\t\tfloat focalLength = ${e.getFocalLength().toPrecision(zh)}\n\t\t\tfloat focusDistance = ${e.focus.toPrecision(zh)}\n\t\t\tfloat horizontalAperture = ${e.getFilmWidth().toPrecision(zh)}\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ${e.getFilmHeight().toPrecision(zh)}\n\t\t}\n\t\n\t`}(e))})),n+="\n\t\t}\n\t}\n}\n\n",n+=function(e,t,i=!1){const s=[];for(const n in e){const r=e[n];s.push(ec(r,t,i))}return`def "Materials"\n{\n${s.join("")}\n}\n\n`}(r,o,t.quickLookCompatible),i[s]=qh(n),n=null;for(const e in o){const t=o[e],s=Yh(t.image,t.flipY),n=await new Promise((e=>s.toBlob(e,"image/png",1)));i[`textures/Texture_${e}.png`]=new Uint8Array(await n.arrayBuffer())}let a=0;for(const e in i){const t=i[e];a+=34+e.length;const s=63&a;if(4!==s){const n=new Uint8Array(64-s);i[e]=[t,{extra:{12345:n}}]}a=t.length}return Jh(i,{level:0})}}function Yh(e,t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=1024/Math.max(e.width,e.height),s=document.createElement("canvas");s.width=e.width*Math.min(1,i),s.height=e.height*Math.min(1,i);const n=s.getContext("2d");return!0===t&&(n.translate(0,s.height),n.scale(1,-1)),n.drawImage(e,0,0,s.width,s.height),s}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const zh=7;function jh(e){const t=e.elements;return`( ${Wh(t,0)}, ${Wh(t,4)}, ${Wh(t,8)}, ${Wh(t,12)} )`}function Wh(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function Xh(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const i=[];for(let t=0;t<e.count;t++){const s=e.getX(t),n=e.getY(t),r=e.getZ(t);i.push(`(${s.toPrecision(zh)}, ${n.toPrecision(zh)}, ${r.toPrecision(zh)})`)}return i.join(", ")}function Zh(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const i=[];for(let t=0;t<e.count;t++){const s=e.getX(t),n=e.getY(t);i.push(`(${s.toPrecision(zh)}, ${1-n.toPrecision(zh)})`)}return i.join(", ")}function ec(e,t,i=!1){const n="\t\t\t",r=[],o=[];function a(n,r,o){const a=n.source.id+"_"+n.flipY;t[a]=n;const A=n.channel>0?"st"+n.channel:"st",l={1e3:"repeat",1001:"clamp",1002:"mirror"},h=n.repeat.clone(),c=n.offset.clone(),u=n.rotation,g=Math.sin(u),d=Math.cos(u);return c.y=1-c.y-h.y,i?(c.x=c.x/h.x,c.y=c.y/h.y,c.x+=g/h.x,c.y+=d-1):(c.x+=g*h.x,c.y+=(1-d)*h.y),`\n\t\tdef Shader "PrimvarReader_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdPrimvarReader_float2"\n\t\t\tfloat2 inputs:fallback = (0.0, 0.0)\n\t\t\ttoken inputs:varname = "${A}"\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Transform2d_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdTransform2d"\n\t\t\ttoken inputs:in.connect = </Materials/Material_${e.id}/PrimvarReader_${r}.outputs:result>\n\t\t\tfloat inputs:rotation = ${(u*(180/Math.PI)).toFixed(zh)}\n\t\t\tfloat2 inputs:scale = ${ic(h)}\n\t\t\tfloat2 inputs:translation = ${ic(c)}\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Texture_${n.id}_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdUVTexture"\n\t\t\tasset inputs:file = @textures/Texture_${a}.png@\n\t\t\tfloat2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${r}.outputs:result>\n\t\t\t${void 0!==o?"float4 inputs:scale = "+function(e){return`(${e.r}, ${e.g}, ${e.b}, 1.0)`}(o):""}\n\t\t\ttoken inputs:sourceColorSpace = "${n.colorSpace===s.NoColorSpace?"raw":"sRGB"}"\n\t\t\ttoken inputs:wrapS = "${l[n.wrapS]}"\n\t\t\ttoken inputs:wrapT = "${l[n.wrapT]}"\n\t\t\tfloat outputs:r\n\t\t\tfloat outputs:g\n\t\t\tfloat outputs:b\n\t\t\tfloat3 outputs:rgb\n\t\t\t${e.transparent||e.alphaTest>0?"float outputs:a":""}\n\t\t}`}return e.side===s.DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",e),null!==e.map?(r.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),e.transparent?r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`):e.alphaTest>0&&(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`),r.push(`${n}float inputs:opacityThreshold = ${e.alphaTest}`)),o.push(a(e.map,"diffuse",e.color))):r.push(`${n}color3f inputs:diffuseColor = ${tc(e.color)}`),null!==e.emissiveMap?(r.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),o.push(a(e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&r.push(`${n}color3f inputs:emissiveColor = ${tc(e.emissive)}`),null!==e.normalMap&&(r.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),o.push(a(e.normalMap,"normal"))),null!==e.aoMap&&(r.push(`${n}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),o.push(a(e.aoMap,"occlusion"))),null!==e.roughnessMap&&1===e.roughness?(r.push(`${n}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),o.push(a(e.roughnessMap,"roughness"))):r.push(`${n}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap&&1===e.metalness?(r.push(`${n}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),o.push(a(e.metalnessMap,"metallic"))):r.push(`${n}float inputs:metallic = ${e.metalness}`),null!==e.alphaMap?(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.alphaMap.id}_opacity.outputs:r>`),r.push(`${n}float inputs:opacityThreshold = 0.0001`),o.push(a(e.alphaMap,"opacity"))):r.push(`${n}float inputs:opacity = ${e.opacity}`),e.isMeshPhysicalMaterial&&(r.push(`${n}float inputs:clearcoat = ${e.clearcoat}`),r.push(`${n}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),r.push(`${n}float inputs:ior = ${e.ior}`)),`\n\tdef Material "Material_${e.id}"\n\t{\n\t\tdef Shader "PreviewSurface"\n\t\t{\n\t\t\tuniform token info:id = "UsdPreviewSurface"\n${r.join("\n")}\n\t\t\tint inputs:useSpecularWorkflow = 0\n\t\t\ttoken outputs:surface\n\t\t}\n\n\t\ttoken outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>\n\n${o.join("\n")}\n\n\t}\n`}function tc(e){return`(${e.r}, ${e.g}, ${e.b})`}function ic(e){return`(${e.x}, ${e.y})`}var sc=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let nc=!1,rc=!1;const oc="#model-viewer-no-ar-fallback",ac=(Ac=["quick-look","scene-viewer","webxr","none"],e=>{try{const t=hn(e),i=(t.length?t[0].terms:[]).filter((e=>e&&"ident"===e.type)).map((e=>e.value)).filter((e=>Ac.indexOf(e)>-1)),s=new Set;for(const e of i)s.add(e);return s}catch(e){}return new Set});var Ac;const lc="quick-look",hc="scene-viewer",cc="webxr",uc="none",gc=Symbol("arButtonContainer"),dc=Symbol("enterARWithWebXR"),pc=Symbol("openSceneViewer"),mc=Symbol("openIOSARQuickLook"),Ic=Symbol("canActivateAR"),fc=Symbol("arMode"),Cc=Symbol("arModes"),Ec=Symbol("arAnchor"),Bc=Symbol("preload"),yc=Symbol("onARButtonContainerClick"),wc=Symbol("onARStatus"),Qc=Symbol("onARTracking"),vc=Symbol("onARTap"),Sc=Symbol("selectARMode"),bc=Symbol("triggerLoad");var xc=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Mc="auto",Rc="auto",Tc="eager",Dc=Symbol("defaultProgressBarElement"),Lc=Symbol("posterContainerElement"),Fc=Symbol("defaultPosterElement"),kc=Symbol("shouldDismissPoster"),_c=Symbol("hidePoster"),Uc=Symbol("modelIsRevealed"),Gc=Symbol("updateProgressBar"),Nc=Symbol("ariaLabelCallToAction"),Pc=Symbol("onProgress");var Oc=function(e,t,i,s){for(var n,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r<3?n(o):r>3?n(t,i,o):n(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Hc=Math.PI/32,qc={basis:[Cn(ln(Hc,"rad"))],keywords:{auto:[null]}},Vc=Symbol("autoRotateStartTime"),Kc=Symbol("radiansPerSecond"),Jc=Symbol("syncRotationRate"),$c=Symbol("onCameraChange"),Yc=(e=>{var i,s,n;class r extends e{constructor(){super(...arguments),this[i]=new Map,this[s]=e=>{e.forEach((e=>{e instanceof MutationRecord&&"childList"!==e.type||(e.addedNodes.forEach((e=>{this[Zl](e)})),e.removedNodes.forEach((e=>{this[eh](e)})),this[Fl]())}))},this[n]=new MutationObserver(this[Wl])}connectedCallback(){super.connectedCallback();for(let e=0;e<this.children.length;++e)this[Zl](this.children[e]);const{ShadyDOM:e}=self;null==e?this[Xl].observe(this,{childList:!0}):this[Xl]=e.observeChildren(this,this[Wl])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:e}=self;null==e?this[Xl].disconnect():e.unobserveChildren(this[Xl])}[(i=jl,s=Wl,n=Xl,kl)](e,t){super[kl](e,t);const i=this[Ll],{annotationRenderer:s}=i,n=i.getCamera();i.shouldRender()&&(i.updateSurfaceHotspots(),i.updateHotspotsVisibility(n.position),s.domElement.style.display="",s.render(i,n))}updateHotspot(e){const t=this[jl].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),t.surface=e.surface,this[Fl]())}queryHotspot(e){const i=this[jl].get(e);if(null==i)return null;const s=ql(i.position),n=ql(i.normal),r=i.facingCamera,o=this[Ll],a=o.getCamera(),A=new t.Vector3;A.setFromMatrixPosition(i.matrixWorld),A.project(a);const l=o.width/2,h=o.height/2;A.x=A.x*l+l,A.y=-A.y*h+h;const c=ql(new t.Vector3(A.x,A.y,A.z));return Number.isFinite(c.x)&&Number.isFinite(c.y)?{position:s,normal:n,canvasPosition:c,facingCamera:r}:null}positionAndNormalFromPoint(e,t){const i=this[Ll],s=i.getNDC(e,t),n=i.positionAndNormalFromPoint(s);if(null==n)return null;th.copy(i.target.matrixWorld).invert();const r=ql(n.position.applyMatrix4(th)),o=ql(n.normal.transformDirection(th));let a=null;return null!=n.uv&&(a=Vl(n.uv)),{position:r,normal:o,uv:a}}surfaceFromPoint(e,t){const i=this[Ll],s=i.getNDC(e,t);return i.surfaceFromPoint(s)}[Zl](e){if(!(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")))return;let t=this[jl].get(e.slot);null!=t?t.increment():(t=new _A({name:e.slot,position:e.dataset.position,normal:e.dataset.normal,surface:e.dataset.surface}),this[jl].set(e.slot,t),this[Ll].addHotspot(t)),this[Ll].queueRender()}[eh](e){if(!(e instanceof HTMLElement))return;const t=this[jl].get(e.slot);t&&(t.decrement()&&(this[Ll].removeHotspot(t),this[jl].delete(e.slot)),this[Ll].queueRender())}}return r})((e=>{var i,s,n;class o extends e{constructor(){super(...arguments),this[i]=void 0,this[s]=null,this[n]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[bA]}get availableVariants(){return this.model?this.model[CA]():[]}get originalGltfJson(){return this[SA]}[(i=bA,s=vA,n=SA,xA)](){return()=>{this[Fl]()}}[MA](e){return e.encoding=t.sRGBEncoding,e.wrapS=t.RepeatWrapping,e.wrapT=t.RepeatWrapping,new ma(this[xA](),e)}async createTexture(e,t="image/png"){const{textureUtils:i}=this[Gl],s=await i.loadImage(e);return s.userData.mimeType=t,this[MA](s)}async createLottieTexture(e,t=1){const{textureUtils:i}=this[Gl],s=await i.loadLottie(e,t);return this[MA](s)}createVideoTexture(e){const i=document.createElement("video");i.src=e,i.muted=!0,i.playsInline=!0,i.loop=!0,i.play();const s=new t.VideoTexture(i);return this[MA](s)}createCanvasTexture(){const e=document.createElement("canvas"),i=new t.CanvasTexture(e);return this[MA](i)}async updated(e){if(super.updated(e),e.has("variantName")){const e=this[Nl].beginActivity();e(.1);const t=this[bA],{variantName:i}=this;null!=t&&(await t[dA](i),this[Fl](),this.dispatchEvent(new CustomEvent("variant-applied"))),e(1)}if(e.has("orientation")||e.has("scale")){if(!this.loaded)return;const e=this[Ll];e.applyTransform(),e.updateBoundingBox(),e.updateShadow(),this[Gl].arRenderer.onUpdateScene(),this[Fl]()}}[_l](){super[_l]();const{currentGLTF:e}=this[Ll];if(null!=e){const{correlatedSceneGraph:t}=e;null!=t&&e!==this[vA]&&(this[bA]=new wA(t,this[xA]()),this[SA]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&this.requestUpdate("variantName")}this[vA]=e}async exportScene(e){const t=this[Ll];return new Promise((async(i,s)=>{const n={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(n,e),n.animations=t.animations,n.truncateDrawRange=!0;const r=t.shadow;let o=!1;null!=r&&(o=r.visible,r.visible=!1),await this[bA][gA](),(new os).register((e=>new Zs(e))).parse(t.model,(e=>i(new Blob([n.binary?e:JSON.stringify(e)],{type:n.binary?"application/octet-stream":"application/json"}))),(()=>s("glTF export failed")),n),null!=r&&(r.visible=o)}))}materialFromPoint(e,t){const i=this[bA];if(null==i)return null;const s=this[Ll],n=s.getNDC(e,t),r=s.hitFromPoint(n);return null==r||null==r.face?null:i[pA](r)}}return QA([r({type:String,attribute:"variant-name"})],o.prototype,"variantName",void 0),QA([r({type:String,attribute:"orientation"})],o.prototype,"orientation",void 0),QA([r({type:String,attribute:"scale"})],o.prototype,"scale",void 0),o})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[s]=e=>{this.autoRotate&&"user-interaction"===e.detail.source&&(this[Vc]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[$c]),this[Vc]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[$c]),this[Vc]=performance.now()}updated(e){super.updated(e),e.has("autoRotate")&&(this[Vc]=performance.now())}[(t=Vc,i=Kc,Jc)](e){this[Kc]=e[0]}[kl](e,t){if(super[kl](e,t),!this.autoRotate||!this[Ol]()||this[Gl].isPresenting)return;const i=Math.min(t,e-this[Vc]-this.autoRotateDelay);i>0&&(this[Ll].yaw=this.turntableRotation+this[Kc]*i*.001)}get turntableRotation(){return this[Ll].yaw}resetTurntableRotation(e=0){this[Ll].yaw=e}}return s=$c,Oc([r({type:Boolean,attribute:"auto-rotate"})],n.prototype,"autoRotate",void 0),Oc([r({type:Number,attribute:"auto-rotate-delay"})],n.prototype,"autoRotateDelay",void 0),Oc([rr({intrinsics:qc,updateHandler:Jc}),r({type:String,attribute:"rotation-per-second"})],n.prototype,"rotationPerSecond",void 0),n})((e=>{var t,i,s;class n extends e{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this[t]=null,this[i]=null,this[s]=null}updated(e){super.updated(e),e.has("shadowIntensity")&&(this[Ll].setShadowIntensity(.5*this.shadowIntensity),this[Fl]()),e.has("shadowSoftness")&&(this[Ll].setShadowSoftness(this.shadowSoftness),this[Fl]()),e.has("exposure")&&(this[Ll].exposure=this.exposure,this[Fl]()),(e.has("environmentImage")||e.has("skyboxImage"))&&this[Hl]()&&this[je]()}hasBakedShadow(){return this[Ll].bakedShadows.size>0}async[(t=Ye,i=ze,s=We,je)](){const{skyboxImage:e,environmentImage:t}=this;null!=this[We]&&(this[We](),this[We]=null);const{textureUtils:i}=this[Gl];if(null==i)return;const s=this[Nl].beginActivity();try{const{environmentMap:n,skybox:r}=await i.generateEnvironmentMapAndSkybox(Pe(e),t,(e=>s(Ve(e,0,1))));this[Ye]!==n&&(this[Ye]=n,this.dispatchEvent(new CustomEvent("environment-change"))),this[ze]=null!=r?r.name===n.name?n:r:null,this[Ll].setEnvironmentAndSkybox(this[Ye],this[ze]),this[Ll].dispatchEvent({type:"envmap-update"})}catch(e){if(e instanceof Error)throw this[Ll].setEnvironmentAndSkybox(null,null),e}finally{s(1)}}}return $e([r({type:String,attribute:"environment-image"})],n.prototype,"environmentImage",void 0),$e([r({type:String,attribute:"skybox-image"})],n.prototype,"skyboxImage",void 0),$e([r({type:Number,attribute:"shadow-intensity"})],n.prototype,"shadowIntensity",void 0),$e([r({type:Number,attribute:"shadow-softness"})],n.prototype,"shadowSoftness",void 0),$e([r({type:Number})],n.prototype,"exposure",void 0),n})((e=>{var i,s,n,o,a,A,l,h,c,u,g,d,p,m,I,f,C;class E extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=ur,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=pr,this.interactionPromptStyle=Ir,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=fr,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this[i]=this.shadowRoot.querySelector(".interaction-prompt"),this[s]=this.shadowRoot.querySelector("#prompt"),this[n]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[o]=this.shadowRoot.querySelector(".pan-target"),this[a]=0,this[A]=1/0,this[l]=!1,this[h]=!1,this[c]=ao.AUTOMATIC,this[u]=new Ao(this[Ll].camera,this[Tl],this[Ll]),this[g]=new t.Spherical,this[d]=!1,this[p]=!1,this[m]=!1,this[I]=()=>{const e=this[Mr].changeSource;this[Vr]=e,e===ao.USER_INTERACTION&&(this[Or]=!0,this[Fr]())},this[f]=()=>{this[kr](),this[Fl]();const e=this[Mr].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:e}}))},this[C]=e=>{"pointer-change-start"===e.type?this[Rl].classList.add("pointer-tumbling"):this[Rl].classList.remove("pointer-tumbling")}}get inputSensitivity(){return this[Mr].inputSensitivity}set inputSensitivity(e){this[Mr].inputSensitivity=e}getCameraOrbit(){const{theta:e,phi:t,radius:i}=this[Kr];return{theta:e,phi:t,radius:i,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return ql(this[Gl].isPresenting?this[Gl].arRenderer.target:this[Ll].getTarget())}getFieldOfView(){return this[Mr].getFieldOfView()}getMinimumFieldOfView(){return this[Mr].options.minimumFieldOfView}getMaximumFieldOfView(){return this[Mr].options.maximumFieldOfView}getIdealAspect(){return this[Ll].idealAspect}jumpCameraToGoal(){this[Jr]=!0,this.requestUpdate(Jr,!1)}resetInteractionPrompt(){this[qr]=0,this[Hr]=1/0,this[Or]=!1,this[Pr]=this.interactionPrompt===pr&&this.cameraControls}zoom(e){const t=new WheelEvent("wheel",{deltaY:-30*e});this[Tl].dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this[Mr].addEventListener("user-interaction",this[Ur]),this[Mr].addEventListener("pointer-change-start",this[Nr]),this[Mr].addEventListener("pointer-change-end",this[Nr])}disconnectedCallback(){super.disconnectedCallback(),this[Mr].removeEventListener("user-interaction",this[Ur]),this[Mr].removeEventListener("pointer-change-start",this[Nr]),this[Mr].removeEventListener("pointer-change-end",this[Nr])}updated(e){super.updated(e);const t=this[Mr],i=this[Ll];if(e.has("cameraControls")&&(this.cameraControls?(t.enableInteraction(),this.interactionPrompt===pr&&(this[Pr]=!0)):(t.disableInteraction(),this[Fr]()),this[Tl].setAttribute("aria-label",this[wl])),e.has("disableZoom")&&(t.disableZoom=this.disableZoom),e.has("disablePan")&&(t.enablePan=!this.disablePan),e.has("disableTap")&&(t.enableTap=!this.disableTap),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===pr&&this.cameraControls&&!this[Or]?this[Pr]=!0:this[Fr]()),e.has("interactionPromptStyle")&&(this[Dr].style.opacity=this.interactionPromptStyle==mr?"1":"0"),e.has("touchAction")){const e=this.touchAction;t.applyOptions({touchAction:e}),t.updateTouchActionStyle()}e.has("orbitSensitivity")&&(t.orbitSensitivity=this.orbitSensitivity),e.has("zoomSensitivity")&&(t.zoomSensitivity=this.zoomSensitivity),e.has("panSensitivity")&&(t.panSensitivity=this.panSensitivity),e.has("interpolationDecay")&&(t.setDamperDecayTime(this.interpolationDecay),i.setTargetDamperDecayTime(this.interpolationDecay)),!0===this[Jr]&&Promise.resolve().then((()=>{t.jumpToGoal(),i.jumpToGoal(),this[Gr](),this[Jr]=!1}))}async updateFraming(){const e=this[Ll],t=e.adjustedFoV(e.framedFoVDeg);await e.updateFraming();const i=e.adjustedFoV(e.framedFoVDeg),s=this[Mr].getFieldOfView()/t;this[Mr].setFieldOfView(i*s),this[Yr]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(e,t,i){const s=this[Tl],n=this[Lr];if("1"===n[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const r=new Array;r.push({x:Ar(t.x),y:Ar(t.y)});const o=[{x:r[0].x(0),y:r[0].y(0)}];null!=i&&(r.push({x:Ar(i.x),y:Ar(i.y)}),o.push({x:r[1].x(0),y:r[1].y(0)}));let a=performance.now();const{width:A,height:l}=this[Ll],h=this.getBoundingClientRect(),c=e=>{for(const[t,i]of o.entries()){const{style:r}=n[t];r.transform=`translateX(${A*i.x}px) translateY(${l*i.y}px)`,"pointerdown"===e?r.opacity="1":"pointerup"===e&&(r.opacity="0");const o={pointerId:t-5678,pointerType:"touch",target:s,clientX:A*i.x+h.x,clientY:l*i.y+h.y,altKey:!0};s.dispatchEvent(new PointerEvent(e,o))}},u=()=>{const t=this[Vr];if(t!==ao.AUTOMATIC||!s.isConnected){for(const e of this[Lr])e.style.opacity="0";return c("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:t}})),void document.removeEventListener("visibilitychange",g)}const i=Math.min(1,(performance.now()-a)/e);for(const[e,t]of o.entries())t.x=r[e].x(i),t.y=r[e].y(i);c("pointermove"),i<1?requestAnimationFrame(u):(c("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:ao.AUTOMATIC}})),document.removeEventListener("visibilitychange",g))},g=()=>{let e=0;"hidden"===document.visibilityState?e=performance.now()-a:a=performance.now()-e};document.addEventListener("visibilitychange",g),c("pointerdown"),this[Vr]=ao.AUTOMATIC,requestAnimationFrame(u)}[(i=Tr,s=Dr,n=Lr,o=Rr,a=qr,A=Hr,l=Or,h=Pr,c=Vr,u=Mr,g=Kr,d=Jr,p=$r,m=Yr,jr)](e){const t=this[Mr],i=this[Ll];i.framedFoVDeg=180*e[0]/Math.PI,t.changeSource=ao.NONE,t.setFieldOfView(i.adjustedFoV(i.framedFoVDeg)),this[Ur]()}[zr](e){const t=this[Mr];if(this[Yr]){const{theta:t,phi:i}=this.getCameraOrbit();e[0]=t,e[1]=i,this[Yr]=!1}t.changeSource=ao.NONE,t.setOrbit(e[0],e[1],e[2]),this[Ur]()}[Xr](e){this[Mr].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}[Zr](e){this[Mr].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[_r](e[2]),this.jumpCameraToGoal()}[eo](e){this[Mr].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}[to](e){const t=this[Ll].adjustedFoV(180*e[0]/Math.PI);this[Mr].applyOptions({maximumFieldOfView:t}),this.jumpCameraToGoal()}[Wr](e){const[t,i,s]=e;this[Gl].arRenderer.isPresenting||this[Ll].setTarget(t,i,s),this[Mr].changeSource=ao.NONE,this[Gl].arRenderer.updateTarget(),this[Ur]()}[kl](e,t){if(super[kl](e,t),this[Gl].isPresenting||!this[Ol]())return;const i=this[Mr],s=this[Ll],n=performance.now();if(this[Pr]&&this.loaded&&n>this[bl]+this.interactionPromptThreshold&&(this[Pr]=!1,this[Hr]=n,this[Tr].classList.add("visible")),isFinite(this[Hr])&&this.interactionPromptStyle===Ir){const e=(n-this[Hr])/5e3%1,t=hr(e),r=cr(e);if(this[Dr].style.opacity=`${r}`,t!==this[qr]){const e=t*s.width*.05,n=(t-this[qr])*Math.PI/16;this[Dr].style.transform=`translateX(${e}px)`,i.changeSource=ao.AUTOMATIC,i.adjustOrbit(n,0,0),this[qr]=t}}const r=i.update(e,t),o=s.updateTarget(t);(r||o)&&this[Gr]()}[Fr](){this[Pr]=!1,this[Tr].classList.remove("visible"),this[Hr]=1/0}[_r](e){const t=Math.max(this[Ll].boundingSphere.radius,e),i=Math.abs(2*t);this[Mr].updateNearFar(0,i)}[kr](){const{theta:e,phi:t}=this[Mr].getCameraSpherical(this[Kr]),i=(4+Math.floor((e%xr+br)/vr))%4,s=Math.floor(t/Sr),n=gr[i],r=dr[s];this[Sl](`View from stage ${r}${n}`)}get[wl](){return super[wl].replace(/\.$/,"")+(this.cameraControls?". Use mouse, touch or arrow keys to move.":"")}async[Ul](e){const t=this[Mr],i=this[Ll],s=i.adjustedFoV(i.framedFoVDeg);super[Ul](e);const n=i.adjustedFoV(i.framedFoVDeg)/s,r=t.getFieldOfView()*(isFinite(n)?n:1);t.updateAspect(this[Ll].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[Mr].setFieldOfView(r),this.jumpCameraToGoal()}[_l](){super[_l](),this[$r]?this[Yr]=!0:this[$r]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return I=Ur,f=Gr,C=Nr,lr([r({type:Boolean,attribute:"camera-controls"})],E.prototype,"cameraControls",void 0),lr([rr({intrinsics:Br,observeEffects:!0,updateHandler:zr}),r({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],E.prototype,"cameraOrbit",void 0),lr([rr({intrinsics:Qr,observeEffects:!0,updateHandler:Wr}),r({type:String,attribute:"camera-target",hasChanged:()=>!0})],E.prototype,"cameraTarget",void 0),lr([rr({intrinsics:Cr,observeEffects:!0,updateHandler:jr}),r({type:String,attribute:"field-of-view",hasChanged:()=>!0})],E.prototype,"fieldOfView",void 0),lr([rr({intrinsics:yr,updateHandler:Xr}),r({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],E.prototype,"minCameraOrbit",void 0),lr([rr({intrinsics:wr,updateHandler:Zr}),r({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],E.prototype,"maxCameraOrbit",void 0),lr([rr({intrinsics:Er,updateHandler:eo}),r({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],E.prototype,"minFieldOfView",void 0),lr([rr({intrinsics:Cr,updateHandler:to}),r({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],E.prototype,"maxFieldOfView",void 0),lr([r({type:Number,attribute:"interaction-prompt-threshold"})],E.prototype,"interactionPromptThreshold",void 0),lr([r({type:String,attribute:"interaction-prompt"})],E.prototype,"interactionPrompt",void 0),lr([r({type:String,attribute:"interaction-prompt-style"})],E.prototype,"interactionPromptStyle",void 0),lr([r({type:Number,attribute:"orbit-sensitivity"})],E.prototype,"orbitSensitivity",void 0),lr([r({type:Number,attribute:"zoom-sensitivity"})],E.prototype,"zoomSensitivity",void 0),lr([r({type:Number,attribute:"pan-sensitivity"})],E.prototype,"panSensitivity",void 0),lr([r({type:String,attribute:"touch-action"})],E.prototype,"touchAction",void 0),lr([r({type:Boolean,attribute:"disable-zoom"})],E.prototype,"disableZoom",void 0),lr([r({type:Boolean,attribute:"disable-pan"})],E.prototype,"disablePan",void 0),lr([r({type:Boolean,attribute:"disable-tap"})],E.prototype,"disableTap",void 0),lr([r({type:Number,attribute:"interpolation-decay"})],E.prototype,"interpolationDecay",void 0),E})((e=>{var t,i,s,n,o,a,A,l,h,c;class u extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[s]=document.createElement("a"),this[n]=new Set,this[o]=uc,this[a]=!1,this[A]=e=>{e.preventDefault(),this.activateAR()},this[l]=({status:e})=>{e!==lo&&this[Gl].arRenderer.presentedScene!==this[Ll]||(this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}})),e===lo?this.removeAttribute("ar-tracking"):e===ho&&this.setAttribute("ar-tracking",go))},this[h]=({status:e})=>{this.setAttribute("ar-tracking",e),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:e}}))},this[c]=e=>{"_apple_ar_quicklook_button_tapped"==e.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[fc]!==uc}connectedCallback(){super.connectedCallback(),this[Gl].arRenderer.addEventListener("status",this[wc]),this.setAttribute("ar-status",lo),this[Gl].arRenderer.addEventListener("tracking",this[Qc]),this[Ec].addEventListener("message",this[vc])}disconnectedCallback(){super.disconnectedCallback(),this[Gl].arRenderer.removeEventListener("status",this[wc]),this[Gl].arRenderer.removeEventListener("tracking",this[Qc]),this[Ec].removeEventListener("message",this[vc])}update(e){super.update(e),e.has("arScale")&&(this[Ll].canScale="fixed"!==this.arScale),e.has("arPlacement")&&(this[Ll].updateShadow(),this[Fl]()),e.has("arModes")&&(this[Cc]=ac(this.arModes)),(e.has("ar")||e.has("arModes")||e.has("src")||e.has("iosSrc"))&&this[Sc]()}async activateAR(){switch(this[fc]){case lc:await this[mc]();break;case cc:await this[dc]();break;case hc:this[pc]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=Ic,i=gc,s=Ec,n=Cc,o=fc,a=Bc,A=yc,l=wc,h=Qc,c=vc,Sc)](){let e=uc;if(this.ar){if(null!=this.src)for(const t of this[Cc]){if("webxr"===t&&De&&!nc&&await this[Gl].arRenderer.supportsPresentation()){e=cc;break}if("scene-viewer"===t&&Ue&&!rc){e=hc;break}if("quick-look"===t&&Ne){e=lc;break}}e===uc&&null!=this.iosSrc&&Ne&&(e=lc)}if(e!==uc)this[gc].classList.add("enabled"),this[gc].addEventListener("click",this[yc]);else if(this[gc].classList.contains("enabled")){this[gc].removeEventListener("click",this[yc]),this[gc].classList.remove("enabled");const e=uo;this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}}))}this[fc]=e}async[dc](){console.log("Attempting to present in AR with WebXR..."),await this[bc]();try{this[gc].removeEventListener("click",this[yc]);const{arRenderer:e}=this[Gl];e.placeOnWall="wall"===this.arPlacement,await e.present(this[Ll],this.xrEnvironment)}catch(e){console.warn("Error while trying to present in AR with WebXR"),console.error(e),await this[Gl].arRenderer.stopPresenting(),nc=!0,console.warn("Falling back to next ar-mode"),await this[Sc](),this.activateAR()}finally{this[Sc]()}}async[bc](){this.loaded||(this[Bc]=!0,this[xl](),await((e,t,i=null)=>new Promise((s=>{e.addEventListener(t,(function n(r){i&&!i(r)||(s(r),e.removeEventListener(t,n))}))})))(this,"load"),this[Bc]=!1)}[Hl](){return super[Hl]()||this[Bc]}[pc](){const e=self.location.toString(),t=new URL(e),i=new URL(this.src,e);i.hash&&(i.hash="");const s=new URLSearchParams(i.search);if(t.hash=oc,s.set("mode","ar_preferred"),s.has("disable_occlusion")||s.set("disable_occlusion","true"),"fixed"===this.arScale&&s.set("resizable","false"),"wall"===this.arPlacement&&s.set("enable_vertical_placement","true"),s.has("sound")){const t=new URL(s.get("sound"),e);s.set("sound",t.toString())}if(s.has("link")){const t=new URL(s.get("link"),e);s.set("link",t.toString())}const n=`intent://arvr.google.com/scene-viewer/1.0?${s.toString()+"&file="+encodeURIComponent(i.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(t.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===oc&&(rc=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Sc]())}),{once:!0}),this[Ec].setAttribute("href",n),console.log("Attempting to present in AR with Scene Viewer..."),this[Ec].click()}async[mc](){const e=!this.iosSrc;this[gc].classList.remove("enabled");const t=e?await this.prepareUSDZ():this.iosSrc,i=new URL(t,self.location.toString());if(e){const e=self.location.toString(),t=new URL(e),s=new URL(this.src,t);s.hash&&(i.hash=s.hash)}"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0");const s=this[Ec];s.setAttribute("rel","ar");const n=document.createElement("img");s.appendChild(n),s.setAttribute("href",i.toString()),e&&s.setAttribute("download","model.usdz"),s.style.display="none",s.isConnected||this.shadowRoot.appendChild(s),console.log("Attempting to present in AR with Quick Look..."),s.click(),s.removeChild(n),e&&URL.revokeObjectURL(t),this[gc].classList.add("enabled")}async prepareUSDZ(){const e=this[Nl].beginActivity();await this[bc]();const{model:t,shadow:i}=this[Ll];if(null==t)return"";let s=!1;null!=i&&(s=i.visible,i.visible=!1),e(.2);const n=new $h,r=await n.parse(t),o=new Blob([r],{type:"model/vnd.usdz+zip"}),a=URL.createObjectURL(o);return e(1),null!=i&&(i.visible=s),a}}return sc([r({type:Boolean,attribute:"ar"})],u.prototype,"ar",void 0),sc([r({type:String,attribute:"ar-scale"})],u.prototype,"arScale",void 0),sc([r({type:String,attribute:"ar-placement"})],u.prototype,"arPlacement",void 0),sc([r({type:String,attribute:"ar-modes"})],u.prototype,"arModes",void 0),sc([r({type:String,attribute:"ios-src"})],u.prototype,"iosSrc",void 0),sc([r({type:Boolean,attribute:"xr-environment"})],u.prototype,"xrEnvironment",void 0),u})((e=>{var i,s,n,o,a,A,l,h;class c extends e{constructor(...e){super(...e),this.poster=null,this.reveal=Mc,this.loading=Rc,this[i]=!1,this[s]=!1,this[n]=this.shadowRoot.querySelector(".slot.poster"),this[o]=this.shadowRoot.querySelector("#default-poster"),this[a]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[A]=this[Fc].getAttribute("aria-label"),this[l]=((e,t)=>{let i=null;const s=(...s)=>{null==i&&(e(...s),i=self.setTimeout((()=>i=null),t))};return s.flush=()=>{null!=i&&(self.clearTimeout(i),i=null)},s})((e=>{const t=this[Dc].parentNode;requestAnimationFrame((()=>{this[Dc].style.transform=`scaleX(${e})`,0===e&&(t.removeChild(this[Dc]),t.appendChild(this[Dc])),1===e?this[Dc].classList.add("hide"):this[Dc].classList.remove("hide")}))}),100),this[h]=e=>{const t=e.detail.totalProgress;1===t&&(this[Gc].flush(),this.loaded&&(this[kc]||this.reveal===Mc)&&this[_c]()),this[Gc](t),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t}}))};const t=self.ModelViewerElement||{},r=t.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";Ki.setDRACODecoderLocation(r);const c=t.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";Ki.setKTX2TranscoderLocation(c),t.meshoptDecoderLocation&&Ki.setMeshoptDecoderLocation(t.meshoptDecoderLocation);const u=t.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";Yo.singleton.textureUtils.lottieLoaderUrl=u}static set dracoDecoderLocation(e){Ki.setDRACODecoderLocation(e)}static get dracoDecoderLocation(){return Ki.getDRACODecoderLocation()}static set ktx2TranscoderLocation(e){Ki.setKTX2TranscoderLocation(e)}static get ktx2TranscoderLocation(){return Ki.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(e){Ki.setMeshoptDecoderLocation(e)}static get meshoptDecoderLocation(){return Ki.getMeshoptDecoderLocation()}static set lottieLoaderLocation(e){Yo.singleton.textureUtils.lottieLoaderUrl=e}static get lottieLoaderLocation(){return Yo.singleton.textureUtils.lottieLoaderUrl}static mapURLs(e){Yo.singleton.loader[Hi].manager.setURLModifier(e)}dismissPoster(){this.loaded?this[_c]():(this[kc]=!0,this[xl]())}showPoster(){const e=this[Lc];if(e.classList.contains("show"))return;e.classList.add("show"),this[Tl].classList.remove("show");const t=this[Fc];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden");const i=this.modelIsVisible;this[Uc]=!1,this[yl](i)}getDimensions(){return ql(this[Ll].size)}getBoundingBoxCenter(){return ql(this[Ll].boundingBox.getCenter(new t.Vector3))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[Nl].addEventListener("progress",this[Pc])}disconnectedCallback(){super.disconnectedCallback(),this[Nl].removeEventListener("progress",this[Pc])}async updated(e){super.updated(e),e.has("poster")&&null!=this.poster&&(this[Fc].style.backgroundImage=`url(${this.poster})`),e.has("alt")&&this[Fc].setAttribute("aria-label",this[Ql]),(e.has("reveal")||e.has("loading"))&&this[xl]()}[(i=Uc,s=kc,n=Lc,o=Fc,a=Dc,A=Nc,l=Gc,h=Pc,Hl)](){return!!this.src&&(this[kc]||this.loading===Tc||this.reveal===Mc&&this[Bl])}[_c](){this[kc]=!1;const e=this[Lc];if(!e.classList.contains("show"))return;e.classList.remove("show"),this[Tl].classList.add("show");const t=this.modelIsVisible;this[Uc]=!0,this[yl](t);const i=this.getRootNode();i&&i.activeElement===this&&this[Tl].focus();const s=this[Fc];s.setAttribute("aria-hidden","true"),s.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Ol](){return super[Ol]()&&this[Uc]}}return xc([r({type:String})],c.prototype,"poster",void 0),xc([r({type:String})],c.prototype,"reveal",void 0),xc([r({type:String})],c.prototype,"loading",void 0),c})((e=>{var i;class s extends e{constructor(...e){super(e),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[i]=!0,this[Ll].subscribeMixerEvent("loop",(e=>{const t=e.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:t}}))})),this[Ll].subscribeMixerEvent("finished",(()=>{this[Yl]=!0,this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[Ll].animationNames:[]}get duration(){return this[Ll].duration}get paused(){return this[Yl]}get currentTime(){return this[Ll].animationTime}set currentTime(e){this[Ll].animationTime=e,this[Fl]()}get timeScale(){return this[Ll].animationTimeScale}set timeScale(e){this[Ll].animationTimeScale=e}pause(){this[Yl]||(this[Yl]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(e){this.availableAnimations.length>0&&(this[Yl]=!1,this[$l](e),this.dispatchEvent(new CustomEvent("play")))}[(i=Yl,_l)](){super[_l](),this[Yl]=!0,null!=this.animationName&&this[$l](),this.autoplay&&this.play()}[kl](e,t){super[kl](e,t),this[Yl]||!this[Ol]()&&!this[Gl].isPresenting||(this[Ll].updateAnimation(t/1e3),this[Fl]())}updated(e){super.updated(e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[$l]()}[$l](e=zl){var i;const s=null!==(i=e.repetitions)&&void 0!==i?i:1/0,n=e.pingpong?t.LoopPingPong:1===s?t.LoopOnce:t.LoopRepeat;this[Ll].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,n,s),this[Yl]&&(this[Ll].updateAnimation(0),this[Fl]())}}return Jl([r({type:Boolean})],s.prototype,"autoplay",void 0),Jl([r({type:String,attribute:"animation-name"})],s.prototype,"animationName",void 0),Jl([r({type:Number,attribute:"animation-crossfade-duration"})],s.prototype,"animationCrossfadeDuration",void 0),s})(Kl))))))));customElements.define("model-viewer",Yc),Object.defineProperty(e,"CanvasTexture",{enumerable:!0,get:function(){return t.CanvasTexture}}),Object.defineProperty(e,"FileLoader",{enumerable:!0,get:function(){return t.FileLoader}}),Object.defineProperty(e,"Loader",{enumerable:!0,get:function(){return t.Loader}}),Object.defineProperty(e,"NearestFilter",{enumerable:!0,get:function(){return t.NearestFilter}}),e.ModelViewerElement=Yc,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ModelViewerElement={},e.three)}));
//# sourceMappingURL=model-viewer-module-umd.min.js.map
